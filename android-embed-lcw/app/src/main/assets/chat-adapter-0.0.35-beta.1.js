!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ChatAdapter=t():e.ChatAdapter=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=200)}([function(e,t,n){"use strict";n.d(t,"e",(function(){return o})),n.d(t,"f",(function(){return i})),n.d(t,"d",(function(){return s})),n.d(t,"h",(function(){return a})),n.d(t,"g",(function(){return u})),n.d(t,"c",(function(){return l})),n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return p}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function o(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function i(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function s(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function a(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function u(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}function l(e){return this instanceof l?(this.v=e,this):new l(e)}function d(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(e){o[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||a(e,t)}))})}function a(e,t){try{(n=o[e](t)).value instanceof l?Promise.resolve(n.value.v).then(c,u):d(i[0][2],n)}catch(e){d(i[0][3],e)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function d(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}function p(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=a(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,o,(t=e[n](t)).done,t.value)}))}}}},function(e,t,n){"use strict";(function(e){n.d(t,"f",(function(){return s})),n.d(t,"b",(function(){return a})),n.d(t,"o",(function(){return c})),n.d(t,"n",(function(){return u})),n.d(t,"i",(function(){return l})),n.d(t,"d",(function(){return d})),n.d(t,"c",(function(){return p})),n.d(t,"k",(function(){return h})),n.d(t,"l",(function(){return f})),n.d(t,"j",(function(){return g})),n.d(t,"a",(function(){return m})),n.d(t,"e",(function(){return v})),n.d(t,"m",(function(){return b})),n.d(t,"h",(function(){return T})),n.d(t,"g",(function(){return w}));var r=n(202),o=(n(8),n(2));const i=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i,s=void 0!==e&&!!e.version&&!!e.versions&&!!e.versions.node;function a(e){return encodeURIComponent(e).replace(/!/g,"%21").replace(/"/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")}function c(e){const t={};return t.body=e.bodyAsText,t.headers=e.headers,t.status=e.status,t}function u(e){const t=e.clone();return t.headers&&t.headers.remove("authorization"),t}function l(e){return i.test(e)}function d(){return Object(r.a)()}function p(e,t){let n=Promise.resolve(t);return e.forEach(e=>{n=n.then(e)}),n}function h(e){if("function"!=typeof e.then)throw new Error("The provided input is not a Promise.");return t=>{e.then(e=>t(void 0,e)).catch(e=>{t(e)})}}function f(t){if("function"!=typeof t.then)throw new Error("The provided input is not a Promise.");return n=>{t.then(t=>e.nextTick(n,void 0,t.parsedBody,t.request,t)).catch(t=>{e.nextTick(n,t)})}}function g(e,t,n,r){if(Array.isArray(e)||(e=[e]),!n||!r)return{[t]:e};const i={[t]:e};return i[o.a]={[n]:r},i}function m(e,t){const n=e;t.forEach(e=>{Object.getOwnPropertyNames(e.prototype).forEach(t=>{n.prototype[t]=e.prototype[t]})})}const y=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function v(e){return y.test(e)}function b(e,t,n){return e&&t?e.split(t).join(n||""):e}function T(e){return"object"!=typeof e&&"function"!=typeof e||null===e}function w(e){return!("object"!=typeof e||null===e||Array.isArray(e)||e instanceof RegExp||e instanceof Date)}}).call(this,n(35))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o}));const r="$",o="_"},function(e,t,n){var r=n(4),o=n(39).f,i=n(12),s=n(29),a=n(54),c=n(75),u=n(78);e.exports=function(e,t){var n,l,d,p,h,f=e.target,g=e.global,m=e.stat;if(n=g?r:m?r[f]||a(f,{}):(r[f]||{}).prototype)for(l in t){if(p=t[l],d=e.noTargetGet?(h=o(n,l))&&h.value:n[l],!u(g?l:f+(m?".":"#")+l,e.forced)&&void 0!==d){if(typeof p==typeof d)continue;c(p,d)}(e.sham||d&&d.sham)&&i(p,"sham",!0),s(n,l,p,e)}}},function(e,t,n){(function(t){var n=function(e){return e&&e.Math==Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof t&&t)||function(){return this}()||Function("return this")()}).call(this,n(38))},function(e,t,n){var r=n(4),o=n(56),i=n(9),s=n(57),a=n(61),c=n(80),u=o("wks"),l=r.Symbol,d=c?l:l&&l.withoutSetter||s;e.exports=function(e){return i(u,e)&&(a||"string"==typeof u[e])||(a&&i(l,e)?u[e]=l[e]:u[e]=d("Symbol."+e)),u[e]}},function(e,t,n){var r=n(11);e.exports=function(e){if(!r(e))throw TypeError(String(e)+" is not an object");return e}},function(e,t,n){var r=n(19),o=n(9),i=n(83),s=n(15).f;e.exports=function(e){var t=r.Symbol||(r.Symbol={});o(t,e)||s(t,e,{value:i.f(e)})}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));const r={coreHttpVersion:"2.2.1",HTTP:"http:",HTTPS:"https:",HTTP_PROXY:"HTTP_PROXY",HTTPS_PROXY:"HTTPS_PROXY",NO_PROXY:"NO_PROXY",ALL_PROXY:"ALL_PROXY",HttpConstants:{HttpVerbs:{PUT:"PUT",GET:"GET",DELETE:"DELETE",POST:"POST",MERGE:"MERGE",HEAD:"HEAD",PATCH:"PATCH"},StatusCodes:{TooManyRequests:429,ServiceUnavailable:503}},HeaderConstants:{AUTHORIZATION:"authorization",AUTHORIZATION_SCHEME:"Bearer",RETRY_AFTER:"Retry-After",USER_AGENT:"User-Agent"}}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){"use strict";(function(e){var r;n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return s})),n.d(t,"d",(function(){return a}));const o=void 0!==e&&Boolean(e.version)&&Boolean(null===(r=e.versions)||void 0===r?void 0:r.node);function i(e,t){return new Promise(n=>setTimeout(()=>n(t),e))}function s(e,t){e=Math.ceil(e),t=Math.floor(t);return Math.floor(Math.random()*(t-e+1))+e}function a(e){return!("object"!=typeof e||null===e||Array.isArray(e)||e instanceof RegExp||e instanceof Date)}}).call(this,n(35))},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var r=n(17),o=n(15),i=n(31);e.exports=r?function(e,t,n){return o.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){var r=n(17),o=n(74),i=n(6),s=n(41),a=Object.defineProperty;t.f=r?a:function(e,t,n){if(i(e),t=s(t,!0),i(n),o)try{return a(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){"use strict";n.d(t,"a",(function(){return A})),n.d(t,"b",(function(){return re})),n.d(t,"c",(function(){return oe}));var r="object"==typeof globalThis?globalThis:window,o=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;var i=function(e){var t=new Set([e]),n=new Set,r=e.match(o);if(!r)return function(){return!1};var i=+r[1],s=+r[2],a=+r[3];if(null!=r[4])return function(t){return t===e};function c(e){return n.add(e),!1}function u(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(n.has(e))return!1;var r=e.match(o);if(!r)return c(e);var l=+r[1],d=+r[2],p=+r[3];return null!=r[4]||i!==l?c(e):0===i?s===d&&a<=p?u(e):c(e):s<=d?u(e):c(e)}}("1.0.3"),s="1.0.3".split(".")[0],a=Symbol.for("opentelemetry.js.api."+s),c=r;function u(e,t,n,r){var o;void 0===r&&(r=!1);var i=c[a]=null!==(o=c[a])&&void 0!==o?o:{version:"1.0.3"};if(!r&&i[e]){var s=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return n.error(s.stack||s.message),!1}if("1.0.3"!==i.version){s=new Error("@opentelemetry/api: All API registration versions must match");return n.error(s.stack||s.message),!1}return i[e]=t,n.debug("@opentelemetry/api: Registered a global for "+e+" v1.0.3."),!0}function l(e){var t,n,r=null===(t=c[a])||void 0===t?void 0:t.version;if(r&&i(r))return null===(n=c[a])||void 0===n?void 0:n[e]}function d(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v1.0.3.");var n=c[a];n&&delete n[e]}var p,h=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return f("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return f("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return f("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return f("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return f("verbose",this._namespace,e)},e}();function f(e,t,n){var r=l("diag");if(r)return n.unshift(t),r[e].apply(r,n)}!function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(p||(p={}));var g=function(){function e(){function e(e){return function(){var t=l("diag");if(t)return t[e].apply(t,arguments)}}var t=this;t.setLogger=function(e,n){var r,o;if(void 0===n&&(n=p.INFO),e===t){var i=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(r=i.stack)&&void 0!==r?r:i.message),!1}var s=l("diag"),a=function(e,t){function n(n,r){var o=t[n];return"function"==typeof o&&e>=r?o.bind(t):function(){}}return e<p.NONE?e=p.NONE:e>p.ALL&&(e=p.ALL),t=t||{},{error:n("error",p.ERROR),warn:n("warn",p.WARN),info:n("info",p.INFO),debug:n("debug",p.DEBUG),verbose:n("verbose",p.VERBOSE)}}(n,e);if(s){var c=null!==(o=(new Error).stack)&&void 0!==o?o:"<failed to generate stacktrace>";s.warn("Current logger will be overwritten from "+c),a.warn("Current logger will overwrite one already registered from "+c)}return u("diag",a,t,!0)},t.disable=function(){d("diag",t)},t.createComponentLogger=function(e){return new h(e)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}(),m=function(){function e(e){this._entries=e?new Map(e):new Map}return e.prototype.getEntry=function(e){var t=this._entries.get(e);if(t)return Object.assign({},t)},e.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map((function(e){return[e[0],e[1]]}))},e.prototype.setEntry=function(t,n){var r=new e(this._entries);return r._entries.set(t,n),r},e.prototype.removeEntry=function(t){var n=new e(this._entries);return n._entries.delete(t),n},e.prototype.removeEntries=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=new e(this._entries),o=0,i=t;o<i.length;o++){var s=i[o];r._entries.delete(s)}return r},e.prototype.clear=function(){return new e},e}();Symbol("BaggageEntryMetadata"),g.instance();function y(e){return void 0===e&&(e={}),new m(new Map(Object.entries(e)))}var v={get:function(e,t){if(null!=e)return e[t]},keys:function(e){return null==e?[]:Object.keys(e)}},b={set:function(e,t,n){null!=e&&(e[t]=n)}};function T(e){return Symbol.for(e)}var w,E=new function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(e){return n._currentContext.get(e)},n.setValue=function(t,r){var o=new e(n._currentContext);return o._currentContext.set(t,r),o},n.deleteValue=function(t){var r=new e(n._currentContext);return r._currentContext.delete(t),r}},S=function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e},R=function(){function e(){}return e.prototype.active=function(){return E},e.prototype.with=function(e,t,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];return t.call.apply(t,S([n],r))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),C=function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e},O=new R,I=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(e){return u("context",e,g.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,n){for(var r,o=[],i=3;i<arguments.length;i++)o[i-3]=arguments[i];return(r=this._getContextManager()).with.apply(r,C([e,t,n],o))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return l("context")||O},e.prototype.disable=function(){this._getContextManager().disable(),d("context",g.instance())},e}();!function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(w||(w={}));var A={traceId:"00000000000000000000000000000000",spanId:"0000000000000000",traceFlags:w.NONE},P=function(){function e(e){void 0===e&&(e=A),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),_=T("OpenTelemetry Context Key SPAN");function x(e){return e.getValue(_)||void 0}function k(e,t){return e.setValue(_,t)}function N(e){return e.deleteValue(_)}function M(e,t){return k(e,new P(t))}function D(e){var t;return null===(t=x(e))||void 0===t?void 0:t.spanContext()}var j=/^([0-9a-f]{32})$/i,U=/^[0-9a-f]{16}$/i;function L(e){return n=e.traceId,j.test(n)&&"00000000000000000000000000000000"!==n&&(t=e.spanId,U.test(t)&&"0000000000000000"!==t);var t,n}function q(e){return new P(e)}var B=I.getInstance(),z=function(){function e(){}return e.prototype.startSpan=function(e,t,n){if(Boolean(null==t?void 0:t.root))return new P;var r,o=n&&D(n);return"object"==typeof(r=o)&&"string"==typeof r.spanId&&"string"==typeof r.traceId&&"number"==typeof r.traceFlags&&L(o)?new P(o):new P},e.prototype.startActiveSpan=function(e,t,n,r){var o,i,s;if(!(arguments.length<2)){2===arguments.length?s=t:3===arguments.length?(o=t,s=n):(o=t,i=n,s=r);var a=null!=i?i:B.active(),c=this.startSpan(e,o,a),u=k(a,c);return B.with(u,s,void 0,c)}},e}();var H,F,$,G=new z,V=function(){function e(e,t,n){this._provider=e,this.name=t,this.version=n}return e.prototype.startSpan=function(e,t,n){return this._getTracer().startSpan(e,t,n)},e.prototype.startActiveSpan=function(e,t,n,r){var o=this._getTracer();return Reflect.apply(o.startActiveSpan,o,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version);return e?(this._delegate=e,this._delegate):G},e}(),J=new(function(){function e(){}return e.prototype.getTracer=function(e,t){return new z},e}()),W=function(){function e(){}return e.prototype.getTracer=function(e,t){var n;return null!==(n=this.getDelegateTracer(e,t))&&void 0!==n?n:new V(this,e,t)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:J},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t){var n;return null===(n=this._delegate)||void 0===n?void 0:n.getTracer(e,t)},e}();!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(H||(H={})),function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(F||(F={})),function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}($||($={}));var Y=function(){function e(){this._proxyTracerProvider=new W,this.wrapSpanContext=q,this.isSpanContextValid=L,this.deleteSpan=N,this.getSpan=x,this.getSpanContext=D,this.setSpan=k,this.setSpanContext=M}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=u("trace",this._proxyTracerProvider,g.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return l("trace")||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){d("trace",g.instance()),this._proxyTracerProvider=new W},e}(),K=function(){function e(){}return e.prototype.inject=function(e,t){},e.prototype.extract=function(e,t){return e},e.prototype.fields=function(){return[]},e}(),X=T("OpenTelemetry Baggage Key");function Q(e){return e.getValue(X)||void 0}function Z(e,t){return e.setValue(X,t)}function ee(e){return e.deleteValue(X)}var te=new K,ne=function(){function e(){this.createBaggage=y,this.getBaggage=Q,this.setBaggage=Z,this.deleteBaggage=ee}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalPropagator=function(e){return u("propagation",e,g.instance())},e.prototype.inject=function(e,t,n){return void 0===n&&(n=b),this._getGlobalPropagator().inject(e,t,n)},e.prototype.extract=function(e,t,n){return void 0===n&&(n=v),this._getGlobalPropagator().extract(e,t,n)},e.prototype.fields=function(){return this._getGlobalPropagator().fields()},e.prototype.disable=function(){d("propagation",g.instance())},e.prototype._getGlobalPropagator=function(){return l("propagation")||te},e}(),re=I.getInstance(),oe=Y.getInstance();ne.getInstance(),g.instance()},function(e,t,n){var r=n(14);e.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(e,t,n){var r=n(19),o=n(4),i=function(e){return"function"==typeof e?e:void 0};e.exports=function(e,t){return arguments.length<2?i(r[e])||i(o[e]):r[e]&&r[e][t]||o[e]&&o[e][t]}},function(e,t,n){var r=n(4);e.exports=r},function(e,t,n){n(190),n(84),n(63),n(91),n(96);var r=n(19);e.exports=r.Observable},function(e,t,n){var r=n(73),o=n(52);e.exports=function(e){return r(o(e))}},function(e,t,n){var r,o,i,s=n(118),a=n(4),c=n(11),u=n(12),l=n(9),d=n(42),p=n(43),h=n(44),f=a.WeakMap;if(s){var g=d.state||(d.state=new f),m=g.get,y=g.has,v=g.set;r=function(e,t){return t.facade=e,v.call(g,e,t),t},o=function(e){return m.call(g,e)||{}},i=function(e){return y.call(g,e)}}else{var b=p("state");h[b]=!0,r=function(e,t){return t.facade=e,u(e,b,t),t},o=function(e){return l(e,b)?e[b]:{}},i=function(e){return l(e,b)}}e.exports={set:r,get:o,has:i,enforce:function(e){return i(e)?o(e):r(e,{})},getterFor:function(e){return function(t){var n;if(!c(t)||(n=o(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}}},function(e,t){e.exports=!1},function(e,t,n){var r=n(15).f,o=n(9),i=n(5)("toStringTag");e.exports=function(e,t,n){e&&!o(e=n?e:e.prototype,i)&&r(e,i,{configurable:!0,value:t})}},function(e,t,n){"use strict";var r=n(19),o=n(13),i=n(6),s=n(49),a=n(12),c=n(67),u=n(5),l=n(22),d=n(18)("Promise"),p=l.set,h=l.get,f=u("toStringTag"),g=function(e){var t=h(this).iterator,n=t.return;return void 0===n?d.resolve({done:!0,value:e}):i(n.call(t,e))},m=function(e){var t=h(this).iterator,n=t.throw;return void 0===n?d.reject(e):n.call(t,e)};e.exports=function(e,t){var n=function(e){e.next=o(e.iterator.next),e.done=!1,p(this,e)};return n.prototype=c(s(r.AsyncIterator.prototype),{next:function(t){var n=h(this);if(n.done)return d.resolve({done:!0,value:void 0});try{return d.resolve(i(e.call(n,t,d)))}catch(e){return d.reject(e)}},return:g,throw:m}),t||a(n.prototype,f,"Generator"),n}},function(e,t,n){"use strict";(function(e){var r,o=n(0),i=n(106),s=void 0!==e&&e.env&&e.env.DEBUG||void 0,a=[],c=[],u=[];function l(e){var t,n,i,s;r=e,a=[],c=[];var l=/\*/g,p=e.split(",").map((function(e){return e.trim().replace(l,".*?")}));try{for(var h=Object(o.h)(p),f=h.next();!f.done;f=h.next()){var g=f.value;g.startsWith("-")?c.push(new RegExp("^"+g.substr(1)+"$")):a.push(new RegExp("^"+g+"$"))}}catch(e){t={error:e}}finally{try{f&&!f.done&&(n=h.return)&&n.call(h)}finally{if(t)throw t.error}}try{for(var m=Object(o.h)(u),y=m.next();!y.done;y=m.next()){var v=y.value;v.enabled=d(v.namespace)}}catch(e){i={error:e}}finally{try{y&&!y.done&&(s=m.return)&&s.call(m)}finally{if(i)throw i.error}}}function d(e){var t,n,r,i;if(e.endsWith("*"))return!0;try{for(var s=Object(o.h)(c),u=s.next();!u.done;u=s.next()){if(u.value.test(e))return!1}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}try{for(var l=Object(o.h)(a),d=l.next();!d.done;d=l.next()){if(d.value.test(e))return!0}}catch(e){r={error:e}}finally{try{d&&!d.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}return!1}function p(e){var t=Object.assign((function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];t.enabled&&(n.length>0&&(n[0]=e+" "+n[0]),t.log.apply(t,Object(o.g)(n)))}),{enabled:d(e),destroy:h,log:g.log,namespace:e,extend:f});return u.push(t),t}function h(){var e=u.indexOf(this);return e>=0&&(u.splice(e,1),!0)}function f(e){var t=p(this.namespace+":"+e);return t.log=this.log,t}s&&l(s);var g=Object.assign((function(e){return p(e)}),{enable:l,enabled:d,disable:function(){var e=r||"";return l(""),e},log:i.a});t.a=g}).call(this,n(35))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=new WeakMap,o=new WeakMap;function i(e){const t=r.get(e);return console.assert(null!=t,"'this' is expected an Event object, but got",e),t}function s(e){null==e.passiveListener?e.event.cancelable&&(e.canceled=!0,"function"==typeof e.event.preventDefault&&e.event.preventDefault()):"undefined"!=typeof console&&"function"==typeof console.error&&console.error("Unable to preventDefault inside passive event listener invocation.",e.passiveListener)}function a(e,t){r.set(this,{eventTarget:e,event:t,eventPhase:2,currentTarget:e,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:t.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});const n=Object.keys(t);for(let e=0;e<n.length;++e){const t=n[e];t in this||Object.defineProperty(this,t,c(t))}}function c(e){return{get(){return i(this).event[e]},set(t){i(this).event[e]=t},configurable:!0,enumerable:!0}}function u(e){return{value(){const t=i(this).event;return t[e].apply(t,arguments)},configurable:!0,enumerable:!0}}function l(e){if(null==e||e===Object.prototype)return a;let t=o.get(e);return null==t&&(t=function(e,t){const n=Object.keys(t);if(0===n.length)return e;function r(t,n){e.call(this,t,n)}r.prototype=Object.create(e.prototype,{constructor:{value:r,configurable:!0,writable:!0}});for(let o=0;o<n.length;++o){const i=n[o];if(!(i in e.prototype)){const e="function"==typeof Object.getOwnPropertyDescriptor(t,i).value;Object.defineProperty(r.prototype,i,e?u(i):c(i))}}return r}(l(Object.getPrototypeOf(e)),e),o.set(e,t)),t}function d(e){return i(e).immediateStopped}function p(e,t){i(e).passiveListener=t}a.prototype={get type(){return i(this).event.type},get target(){return i(this).eventTarget},get currentTarget(){return i(this).currentTarget},composedPath(){const e=i(this).currentTarget;return null==e?[]:[e]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return i(this).eventPhase},stopPropagation(){const e=i(this);e.stopped=!0,"function"==typeof e.event.stopPropagation&&e.event.stopPropagation()},stopImmediatePropagation(){const e=i(this);e.stopped=!0,e.immediateStopped=!0,"function"==typeof e.event.stopImmediatePropagation&&e.event.stopImmediatePropagation()},get bubbles(){return Boolean(i(this).event.bubbles)},get cancelable(){return Boolean(i(this).event.cancelable)},preventDefault(){s(i(this))},get defaultPrevented(){return i(this).canceled},get composed(){return Boolean(i(this).event.composed)},get timeStamp(){return i(this).timeStamp},get srcElement(){return i(this).eventTarget},get cancelBubble(){return i(this).stopped},set cancelBubble(e){if(!e)return;const t=i(this);t.stopped=!0,"boolean"==typeof t.event.cancelBubble&&(t.event.cancelBubble=!0)},get returnValue(){return!i(this).canceled},set returnValue(e){e||s(i(this))},initEvent(){}},Object.defineProperty(a.prototype,"constructor",{value:a,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.Event&&(Object.setPrototypeOf(a.prototype,window.Event.prototype),o.set(window.Event.prototype,a));const h=new WeakMap;function f(e){return null!==e&&"object"==typeof e}function g(e){const t=h.get(e);if(null==t)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return t}function m(e,t){Object.defineProperty(e,"on"+t,function(e){return{get(){let t=g(this).get(e);for(;null!=t;){if(3===t.listenerType)return t.listener;t=t.next}return null},set(t){"function"==typeof t||f(t)||(t=null);const n=g(this);let r=null,o=n.get(e);for(;null!=o;)3===o.listenerType?null!==r?r.next=o.next:null!==o.next?n.set(e,o.next):n.delete(e):r=o,o=o.next;if(null!==t){const o={listener:t,listenerType:3,passive:!1,once:!1,next:null};null===r?n.set(e,o):r.next=o}},configurable:!0,enumerable:!0}}(t))}function y(e){function t(){v.call(this)}t.prototype=Object.create(v.prototype,{constructor:{value:t,configurable:!0,writable:!0}});for(let n=0;n<e.length;++n)m(t.prototype,e[n]);return t}function v(){if(!(this instanceof v)){if(1===arguments.length&&Array.isArray(arguments[0]))return y(arguments[0]);if(arguments.length>0){const e=new Array(arguments.length);for(let t=0;t<arguments.length;++t)e[t]=arguments[t];return y(e)}throw new TypeError("Cannot call a class as a function")}h.set(this,new Map)}v.prototype={addEventListener(e,t,n){if(null==t)return;if("function"!=typeof t&&!f(t))throw new TypeError("'listener' should be a function or an object.");const r=g(this),o=f(n),i=(o?Boolean(n.capture):Boolean(n))?1:2,s={listener:t,listenerType:i,passive:o&&Boolean(n.passive),once:o&&Boolean(n.once),next:null};let a=r.get(e);if(void 0===a)return void r.set(e,s);let c=null;for(;null!=a;){if(a.listener===t&&a.listenerType===i)return;c=a,a=a.next}c.next=s},removeEventListener(e,t,n){if(null==t)return;const r=g(this),o=(f(n)?Boolean(n.capture):Boolean(n))?1:2;let i=null,s=r.get(e);for(;null!=s;){if(s.listener===t&&s.listenerType===o)return void(null!==i?i.next=s.next:null!==s.next?r.set(e,s.next):r.delete(e));i=s,s=s.next}},dispatchEvent(e){if(null==e||"string"!=typeof e.type)throw new TypeError('"event.type" should be a string.');const t=g(this),n=e.type;let r=t.get(n);if(null==r)return!0;const o=function(e,t){return new(l(Object.getPrototypeOf(t)))(e,t)}(this,e);let s=null;for(;null!=r;){if(r.once?null!==s?s.next=r.next:null!==r.next?t.set(n,r.next):t.delete(n):s=r,p(o,r.passive?r.listener:null),"function"==typeof r.listener)try{r.listener.call(this,o)}catch(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e)}else 3!==r.listenerType&&"function"==typeof r.listener.handleEvent&&r.listener.handleEvent(o);if(d(o))break;r=r.next}return p(o,null),function(e,t){i(e).eventPhase=t}(o,0),function(e,t){i(e).currentTarget=t}(o,null),!o.defaultPrevented}},Object.defineProperty(v.prototype,"constructor",{value:v,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.EventTarget&&Object.setPrototypeOf(v.prototype,window.EventTarget.prototype),t.defineEventAttribute=m,t.EventTarget=v,t.default=v,e.exports=v,e.exports.EventTarget=e.exports.default=v,e.exports.defineEventAttribute=m},,function(e,t,n){var r=n(4),o=n(12),i=n(9),s=n(54),a=n(55),c=n(22),u=c.get,l=c.enforce,d=String(String).split("String");(e.exports=function(e,t,n,a){var c,u=!!a&&!!a.unsafe,p=!!a&&!!a.enumerable,h=!!a&&!!a.noTargetGet;"function"==typeof n&&("string"!=typeof t||i(n,"name")||o(n,"name",t),(c=l(n)).source||(c.source=d.join("string"==typeof t?t:""))),e!==r?(u?!h&&e[t]&&(p=!0):delete e[t],p?e[t]=n:o(e,t,n)):p?e[t]=n:s(t,n)})(Function.prototype,"toString",(function(){return"function"==typeof this&&u(this).source||a(this)}))},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return d}));var r,o=n(0),i=n(26),s=new Set,a=void 0!==e&&e.env&&e.env.AZURE_LOG_LEVEL||void 0,c=Object(i.a)("azure");c.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.a.log.apply(i.a,Object(o.g)(e))};var u=["verbose","info","warning","error"];a&&(g(a)?function(e){var t,n;if(e&&!g(e))throw new Error("Unknown log level '"+e+"'. Acceptable values: "+u.join(","));r=e;var a=[];try{for(var c=Object(o.h)(s),l=c.next();!l.done;l=c.next()){var d=l.value;f(d)&&a.push(d.namespace)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}i.a.enable(a.join(","))}(a):console.error("AZURE_LOG_LEVEL set to unknown log level '"+a+"'; logging is not enabled. Acceptable values: "+u.join(", ")+"."));var l={verbose:400,info:300,warning:200,error:100};function d(e){var t=c.extend(e);return p(c,t),{error:h(t,"error"),warning:h(t,"warning"),info:h(t,"info"),verbose:h(t,"verbose")}}function p(e,t){t.log=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.log.apply(e,Object(o.g)(t))}}function h(e,t){var n=Object.assign(e.extend(t),{level:t});if(p(e,n),f(n)){var r=i.a.disable();i.a.enable(r+","+n.namespace)}return s.add(n),n}function f(e){return!!(r&&l[e.level]<=l[r])}function g(e){return u.includes(e)}}).call(this,n(35))},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var r=n(52);e.exports=function(e){return Object(r(e))}},function(e,t){e.exports={}},function(e,t,n){"use strict";var r=n(13),o=n(6),i=n(18)("Promise"),s=[].push,a=function(e){var t=0==e,n=1==e,a=2==e,c=3==e;return function(e,u){o(e);var l=r(e.next),d=t?[]:void 0;return t||r(u),new i((function(r,p){var h=function(t,n){try{var r=e.return;if(void 0!==r)return i.resolve(r.call(e)).then((function(){t(n)}),(function(e){p(e)}))}catch(e){return p(e)}t(n)},f=function(e){h(p,e)},g=function(){try{i.resolve(o(l.call(e))).then((function(e){try{if(o(e).done)r(t?d:!c&&(a||void 0));else{var l=e.value;t?(s.call(d,l),g()):i.resolve(u(l)).then((function(e){n?g():a?e?g():h(r,!1):e?h(r,c||l):g()}),f)}}catch(e){f(e)}}),f)}catch(e){f(e)}};g()}))}};e.exports={toArray:a(0),forEach:a(1),every:a(2),some:a(3),find:a(4)}},function(e,t){var n,r,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var c,u=[],l=!1,d=-1;function p(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&h())}function h(){if(!l){var e=a(p);l=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new f(e,t)),1!==u.length||l||a(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"f",(function(){return i})),n.d(t,"e",(function(){return s})),n.d(t,"d",(function(){return a})),n.d(t,"c",(function(){return c})),n.d(t,"b",(function(){return u}));var r,o=n(16);function i(e,t){return o.c.setSpan(e,t)}function s(e){return o.c.isSpanContextValid(e)}function a(e,t){return o.c.getTracer(e||"azure/core-tracing",t)}!function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(r||(r={}));const c=o.b;var u;!function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(u||(u={}))},,function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(17),o=n(51),i=n(31),s=n(21),a=n(41),c=n(9),u=n(74),l=Object.getOwnPropertyDescriptor;t.f=r?l:function(e,t){if(e=s(e),t=a(t,!0),u)try{return l(e,t)}catch(e){}if(c(e,t))return i(!o.f.call(e,t),e[t])}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var r=n(11);e.exports=function(e,t){if(!r(e))return e;var n,o;if(t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;if("function"==typeof(n=e.valueOf)&&!r(o=n.call(e)))return o;if(!t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var r=n(4),o=n(54),i=r["__core-js_shared__"]||o("__core-js_shared__",{});e.exports=i},function(e,t,n){var r=n(56),o=n(57),i=r("keys");e.exports=function(e){return i[e]||(i[e]=o(e))}},function(e,t){e.exports={}},function(e,t,n){var r=n(46),o=Math.min;e.exports=function(e){return e>0?o(r(e),9007199254740991):0}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){var r=n(40),o=n(4);e.exports="process"==r(o.process)},function(e,t,n){var r,o,i=n(4),s=n(62),a=i.process,c=a&&a.versions,u=c&&c.v8;u?o=(r=u.split("."))[0]+r[1]:s&&(!(r=s.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=s.match(/Chrome\/(\d+)/))&&(o=r[1]),e.exports=o&&+o},function(e,t,n){var r,o=n(6),i=n(126),s=n(59),a=n(44),c=n(82),u=n(53),l=n(43),d=l("IE_PROTO"),p=function(){},h=function(e){return"<script>"+e+"<\/script>"},f=function(){try{r=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;f=r?function(e){e.write(h("")),e.close();var t=e.parentWindow.Object;return e=null,t}(r):((t=u("iframe")).style.display="none",c.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(h("document.F=Object")),e.close(),e.F);for(var n=s.length;n--;)delete f.prototype[s[n]];return f()};a[d]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(p.prototype=o(e),n=new p,p.prototype=null,n[d]=e):n=f(),void 0===t?n:i(n,t)}},,function(e,t,n){"use strict";var r={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,i=o&&!r.call({1:2},1);t.f=i?function(e){var t=o(this,e);return!!t&&t.enumerable}:r},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},function(e,t,n){var r=n(4),o=n(11),i=r.document,s=o(i)&&o(i.createElement);e.exports=function(e){return s?i.createElement(e):{}}},function(e,t,n){var r=n(4),o=n(12);e.exports=function(e,t){try{o(r,e,t)}catch(n){r[e]=t}return t}},function(e,t,n){var r=n(42),o=Function.toString;"function"!=typeof r.inspectSource&&(r.inspectSource=function(e){return o.call(e)}),e.exports=r.inspectSource},function(e,t,n){var r=n(23),o=n(42);(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.9.1",mode:r?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++n+r).toString(36)}},function(e,t,n){var r=n(76),o=n(59).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,o)}},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t,n){var r=n(40);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){var r=n(47),o=n(48),i=n(14);e.exports=!!Object.getOwnPropertySymbols&&!i((function(){return!Symbol.sham&&(r?38===o:o>37&&o<41)}))},function(e,t,n){var r=n(18);e.exports=r("navigator","userAgent")||""},function(e,t,n){var r=n(64),o=n(29),i=n(124);r||o(Object.prototype,"toString",i,{unsafe:!0})},function(e,t,n){var r={};r[n(5)("toStringTag")]="z",e.exports="[object z]"===String(r)},function(e,t,n){var r=n(76),o=n(59);e.exports=Object.keys||function(e){return r(e,o)}},function(e,t,n){var r=n(13);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){var r=n(29);e.exports=function(e,t,n){for(var o in t)r(e,o,t[o],n);return e}},function(e,t){e.exports=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e}},function(e,t,n){var r=n(81),o=n(33),i=n(5)("iterator");e.exports=function(e){if(null!=e)return e[i]||e["@@iterator"]||o[r(e)]}},function(e,t,n){var r=n(9),o=n(32),i=n(43),s=n(163),a=i("IE_PROTO"),c=Object.prototype;e.exports=s?Object.getPrototypeOf:function(e){return e=o(e),r(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?c:null}},function(e,t,n){"use strict";(function(e,r){var o,i=n(97);o="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:r;var s=Object(i.a)(o);t.a=s}).call(this,n(38),n(114)(e))},,function(e,t,n){var r=n(14),o=n(40),i="".split;e.exports=r((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==o(e)?i.call(e,""):Object(e)}:Object},function(e,t,n){var r=n(17),o=n(14),i=n(53);e.exports=!r&&!o((function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}))},function(e,t,n){var r=n(9),o=n(119),i=n(39),s=n(15);e.exports=function(e,t){for(var n=o(t),a=s.f,c=i.f,u=0;u<n.length;u++){var l=n[u];r(e,l)||a(e,l,c(t,l))}}},function(e,t,n){var r=n(9),o=n(21),i=n(120).indexOf,s=n(44);e.exports=function(e,t){var n,a=o(e),c=0,u=[];for(n in a)!r(s,n)&&r(a,n)&&u.push(n);for(;t.length>c;)r(a,n=t[c++])&&(~i(u,n)||u.push(n));return u}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var r=n(14),o=/#|\.prototype\./,i=function(e,t){var n=a[s(e)];return n==u||n!=c&&("function"==typeof t?r(t):!!t)},s=i.normalize=function(e){return String(e).replace(o,".").toLowerCase()},a=i.data={},c=i.NATIVE="N",u=i.POLYFILL="P";e.exports=i},function(e,t,n){var r=n(11),o=n(60),i=n(5)("species");e.exports=function(e,t){var n;return o(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!o(n.prototype)?r(n)&&null===(n=n[i])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)}},function(e,t,n){var r=n(61);e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,n){var r=n(64),o=n(40),i=n(5)("toStringTag"),s="Arguments"==o(function(){return arguments}());e.exports=r?o:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?n:s?o(t):"Object"==(r=o(t))&&"function"==typeof t.callee?"Arguments":r}},function(e,t,n){var r=n(18);e.exports=r("document","documentElement")},function(e,t,n){var r=n(5);t.f=r},function(e,t,n){n(7)("observable")},function(e,t,n){"use strict";var r=n(18),o=n(15),i=n(5),s=n(17),a=i("species");e.exports=function(e){var t=r(e),n=o.f;s&&t&&!t[a]&&n(t,a,{configurable:!0,get:function(){return this}})}},function(e,t,n){var r=n(6),o=n(153),i=n(45),s=n(66),a=n(69),c=n(154),u=function(e,t){this.stopped=e,this.result=t};e.exports=function(e,t,n){var l,d,p,h,f,g,m,y=n&&n.that,v=!(!n||!n.AS_ENTRIES),b=!(!n||!n.IS_ITERATOR),T=!(!n||!n.INTERRUPTED),w=s(t,y,1+v+T),E=function(e){return l&&c(l),new u(!0,e)},S=function(e){return v?(r(e),T?w(e[0],e[1],E):w(e[0],e[1])):T?w(e,E):w(e)};if(b)l=e;else{if("function"!=typeof(d=a(e)))throw TypeError("Target is not iterable");if(o(d)){for(p=0,h=i(e.length);h>p;p++)if((f=S(e[p]))&&f instanceof u)return f;return new u(!1)}l=d.call(e)}for(g=l.next;!(m=g.call(l)).done;){try{f=S(m.value)}catch(e){throw c(l),e}if("object"==typeof f&&f&&f instanceof u)return f}return new u(!1)}},function(e,t,n){var r,o,i,s=n(4),a=n(14),c=n(66),u=n(82),l=n(53),d=n(88),p=n(47),h=s.location,f=s.setImmediate,g=s.clearImmediate,m=s.process,y=s.MessageChannel,v=s.Dispatch,b=0,T={},w=function(e){if(T.hasOwnProperty(e)){var t=T[e];delete T[e],t()}},E=function(e){return function(){w(e)}},S=function(e){w(e.data)},R=function(e){s.postMessage(e+"",h.protocol+"//"+h.host)};f&&g||(f=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return T[++b]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},r(b),b},g=function(e){delete T[e]},p?r=function(e){m.nextTick(E(e))}:v&&v.now?r=function(e){v.now(E(e))}:y&&!d?(i=(o=new y).port2,o.port1.onmessage=S,r=c(i.postMessage,i,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts&&h&&"file:"!==h.protocol&&!a(R)?(r=R,s.addEventListener("message",S,!1)):r="onreadystatechange"in l("script")?function(e){u.appendChild(l("script")).onreadystatechange=function(){u.removeChild(this),w(e)}}:function(e){setTimeout(E(e),0)}),e.exports={set:f,clear:g}},function(e,t,n){var r=n(62);e.exports=/(iphone|ipod|ipad).*applewebkit/i.test(r)},function(e,t,n){"use strict";var r=n(13),o=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)};e.exports.f=function(e){return new o(e)}},function(e,t,n){var r=n(4);e.exports=function(e,t){var n=r.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}},function(e,t,n){"use strict";var r=n(161).charAt,o=n(22),i=n(92),s=o.set,a=o.getterFor("String Iterator");i(String,"String",(function(e){s(this,{type:"String Iterator",string:String(e),index:0})}),(function(){var e,t=a(this),n=t.string,o=t.index;return o>=n.length?{value:void 0,done:!0}:(e=r(n,o),t.index+=e.length,{value:e,done:!1})}))},function(e,t,n){"use strict";var r=n(3),o=n(162),i=n(70),s=n(164),a=n(24),c=n(12),u=n(29),l=n(5),d=n(23),p=n(33),h=n(93),f=h.IteratorPrototype,g=h.BUGGY_SAFARI_ITERATORS,m=l("iterator"),y=function(){return this};e.exports=function(e,t,n,l,h,v,b){o(n,t,l);var T,w,E,S=function(e){if(e===h&&A)return A;if(!g&&e in O)return O[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}},R=t+" Iterator",C=!1,O=e.prototype,I=O[m]||O["@@iterator"]||h&&O[h],A=!g&&I||S(h),P="Array"==t&&O.entries||I;if(P&&(T=i(P.call(new e)),f!==Object.prototype&&T.next&&(d||i(T)===f||(s?s(T,f):"function"!=typeof T[m]&&c(T,m,y)),a(T,R,!0,!0),d&&(p[R]=y))),"values"==h&&I&&"values"!==I.name&&(C=!0,A=function(){return I.call(this)}),d&&!b||O[m]===A||c(O,m,A),p[t]=A,h)if(w={values:S("values"),keys:v?A:S("keys"),entries:S("entries")},b)for(E in w)(g||C||!(E in O))&&u(O,E,w[E]);else r({target:t,proto:!0,forced:g||C},w);return w}},function(e,t,n){"use strict";var r,o,i,s=n(14),a=n(70),c=n(12),u=n(9),l=n(5),d=n(23),p=l("iterator"),h=!1;[].keys&&("next"in(i=[].keys())?(o=a(a(i)))!==Object.prototype&&(r=o):h=!0);var f=null==r||s((function(){var e={};return r[p].call(e)!==e}));f&&(r={}),d&&!f||u(r,p)||c(r,p,(function(){return this})),e.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:h}},function(e,t,n){var r=n(46);e.exports=function(e){var t=r(e);if(t<0)throw RangeError("The argument can't be less than 0");return t}},function(e,t,n){var r=n(69),o=n(5)("asyncIterator");e.exports=function(e){var t=e[o];return void 0===t?r(e):t}},function(e,t,n){var r=n(4),o=n(181),i=n(182),s=n(12),a=n(5),c=a("iterator"),u=a("toStringTag"),l=i.values;for(var d in o){var p=r[d],h=p&&p.prototype;if(h){if(h[c]!==l)try{s(h,c,l)}catch(e){h[c]=l}if(h[u]||s(h,u,d),o[d])for(var f in i)if(h[f]!==i[f])try{s(h,f,i[f])}catch(e){h[f]=i[f]}}}},function(e,t,n){"use strict";function r(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}n.d(t,"a",(function(){return r}))},function(e,t){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){"use strict";e.exports=function(){var e={};return e.promise=new Promise((function(t,n){e.resolve=t,e.reject=n})),e}},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r);t.default=o.a}])},function(e,t,n){var r=n(184);e.exports=r},function(e,t,n){"use strict";e.exports=()=>{const e={};return e.promise=new Promise((t,n)=>{e.resolve=t,e.reject=n}),e}},function(e,t){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.r(t),n.d(t,"defineEventAttribute",(function(){return y})),n.d(t,"EventTarget",(function(){return T}));var o=new WeakMap,i=new WeakMap;function s(e){var t=o.get(e);return console.assert(null!=t,"'this' is expected an Event object, but got",e),t}function a(e){null==e.passiveListener?e.event.cancelable&&(e.canceled=!0,"function"==typeof e.event.preventDefault&&e.event.preventDefault()):"undefined"!=typeof console&&"function"==typeof console.error&&console.error("Unable to preventDefault inside passive event listener invocation.",e.passiveListener)}function c(e,t){o.set(this,{eventTarget:e,event:t,eventPhase:2,currentTarget:e,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:t.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});for(var n=Object.keys(t),r=0;r<n.length;++r){var i=n[r];i in this||Object.defineProperty(this,i,u(i))}}function u(e){return{get:function(){return s(this).event[e]},set:function(t){s(this).event[e]=t},configurable:!0,enumerable:!0}}function l(e){return{value:function(){var t=s(this).event;return t[e].apply(t,arguments)},configurable:!0,enumerable:!0}}function d(e){if(null==e||e===Object.prototype)return c;var t=i.get(e);return null==t&&(t=function(e,t){var n=Object.keys(t);if(0===n.length)return e;function r(t,n){e.call(this,t,n)}r.prototype=Object.create(e.prototype,{constructor:{value:r,configurable:!0,writable:!0}});for(var o=0;o<n.length;++o){var i=n[o];if(!(i in e.prototype)){var s="function"==typeof Object.getOwnPropertyDescriptor(t,i).value;Object.defineProperty(r.prototype,i,s?l(i):u(i))}}return r}(d(Object.getPrototypeOf(e)),e),i.set(e,t)),t}function p(e){return s(e).immediateStopped}function h(e,t){s(e).passiveListener=t}c.prototype={get type(){return s(this).event.type},get target(){return s(this).eventTarget},get currentTarget(){return s(this).currentTarget},composedPath:function(){var e=s(this).currentTarget;return null==e?[]:[e]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return s(this).eventPhase},stopPropagation:function(){var e=s(this);e.stopped=!0,"function"==typeof e.event.stopPropagation&&e.event.stopPropagation()},stopImmediatePropagation:function(){var e=s(this);e.stopped=!0,e.immediateStopped=!0,"function"==typeof e.event.stopImmediatePropagation&&e.event.stopImmediatePropagation()},get bubbles(){return Boolean(s(this).event.bubbles)},get cancelable(){return Boolean(s(this).event.cancelable)},preventDefault:function(){a(s(this))},get defaultPrevented(){return s(this).canceled},get composed(){return Boolean(s(this).event.composed)},get timeStamp(){return s(this).timeStamp},get srcElement(){return s(this).eventTarget},get cancelBubble(){return s(this).stopped},set cancelBubble(e){if(e){var t=s(this);t.stopped=!0,"boolean"==typeof t.event.cancelBubble&&(t.event.cancelBubble=!0)}},get returnValue(){return!s(this).canceled},set returnValue(e){e||a(s(this))},initEvent:function(){}},Object.defineProperty(c.prototype,"constructor",{value:c,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.Event&&(Object.setPrototypeOf(c.prototype,window.Event.prototype),i.set(window.Event.prototype,c));var f=new WeakMap;function g(e){return null!==e&&"object"===r(e)}function m(e){var t=f.get(e);if(null==t)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return t}function y(e,t){Object.defineProperty(e,"on".concat(t),function(e){return{get:function(){for(var t=m(this).get(e);null!=t;){if(3===t.listenerType)return t.listener;t=t.next}return null},set:function(t){"function"==typeof t||g(t)||(t=null);for(var n=m(this),r=null,o=n.get(e);null!=o;)3===o.listenerType?null!==r?r.next=o.next:null!==o.next?n.set(e,o.next):n.delete(e):r=o,o=o.next;if(null!==t){var i={listener:t,listenerType:3,passive:!1,once:!1,next:null};null===r?n.set(e,i):r.next=i}},configurable:!0,enumerable:!0}}(t))}function v(e){function t(){b.call(this)}t.prototype=Object.create(b.prototype,{constructor:{value:t,configurable:!0,writable:!0}});for(var n=0;n<e.length;++n)y(t.prototype,e[n]);return t}function b(){if(!(this instanceof b)){if(1===arguments.length&&Array.isArray(arguments[0]))return v(arguments[0]);if(arguments.length>0){for(var e=new Array(arguments.length),t=0;t<arguments.length;++t)e[t]=arguments[t];return v(e)}throw new TypeError("Cannot call a class as a function")}f.set(this,new Map)}b.prototype={addEventListener:function(e,t,n){if(null!=t){if("function"!=typeof t&&!g(t))throw new TypeError("'listener' should be a function or an object.");var r=m(this),o=g(n),i=(o?Boolean(n.capture):Boolean(n))?1:2,s={listener:t,listenerType:i,passive:o&&Boolean(n.passive),once:o&&Boolean(n.once),next:null},a=r.get(e);if(void 0!==a){for(var c=null;null!=a;){if(a.listener===t&&a.listenerType===i)return;c=a,a=a.next}c.next=s}else r.set(e,s)}},removeEventListener:function(e,t,n){if(null!=t)for(var r=m(this),o=(g(n)?Boolean(n.capture):Boolean(n))?1:2,i=null,s=r.get(e);null!=s;){if(s.listener===t&&s.listenerType===o)return void(null!==i?i.next=s.next:null!==s.next?r.set(e,s.next):r.delete(e));i=s,s=s.next}},dispatchEvent:function(e){if(null==e||"string"!=typeof e.type)throw new TypeError('"event.type" should be a string.');var t=m(this),n=e.type,r=t.get(n);if(null==r)return!0;for(var o=function(e,t){return new(d(Object.getPrototypeOf(t)))(e,t)}(this,e),i=null;null!=r;){if(r.once?null!==i?i.next=r.next:null!==r.next?t.set(n,r.next):t.delete(n):i=r,h(o,r.passive?r.listener:null),"function"==typeof r.listener)try{r.listener.call(this,o)}catch(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e)}else 3!==r.listenerType&&"function"==typeof r.listener.handleEvent&&r.listener.handleEvent(o);if(p(o))break;r=r.next}return h(o,null),function(e,t){s(e).eventPhase=t}(o,0),function(e,t){s(e).currentTarget=t}(o,null),!o.defaultPrevented}},Object.defineProperty(b.prototype,"constructor",{value:b,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.EventTarget&&Object.setPrototypeOf(b.prototype,window.EventTarget.prototype);var T=b;t.default=T}])},function(e,t,n){var r=n(187);e.exports=r},function(e,t){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.r(t),n.d(t,"AbortController",(function(){return M})),n.d(t,"AbortSignal",(function(){return D}));var o=new WeakMap,i=new WeakMap;function s(e){var t=o.get(e);return console.assert(null!=t,"'this' is expected an Event object, but got",e),t}function a(e){null==e.passiveListener?e.event.cancelable&&(e.canceled=!0,"function"==typeof e.event.preventDefault&&e.event.preventDefault()):"undefined"!=typeof console&&"function"==typeof console.error&&console.error("Unable to preventDefault inside passive event listener invocation.",e.passiveListener)}function c(e,t){o.set(this,{eventTarget:e,event:t,eventPhase:2,currentTarget:e,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:t.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});for(var n=Object.keys(t),r=0;r<n.length;++r){var i=n[r];i in this||Object.defineProperty(this,i,u(i))}}function u(e){return{get:function(){return s(this).event[e]},set:function(t){s(this).event[e]=t},configurable:!0,enumerable:!0}}function l(e){return{value:function(){var t=s(this).event;return t[e].apply(t,arguments)},configurable:!0,enumerable:!0}}function d(e){if(null==e||e===Object.prototype)return c;var t=i.get(e);return null==t&&(t=function(e,t){var n=Object.keys(t);if(0===n.length)return e;function r(t,n){e.call(this,t,n)}r.prototype=Object.create(e.prototype,{constructor:{value:r,configurable:!0,writable:!0}});for(var o=0;o<n.length;++o){var i=n[o];if(!(i in e.prototype)){var s="function"==typeof Object.getOwnPropertyDescriptor(t,i).value;Object.defineProperty(r.prototype,i,s?l(i):u(i))}}return r}(d(Object.getPrototypeOf(e)),e),i.set(e,t)),t}function p(e){return s(e).immediateStopped}function h(e,t){s(e).passiveListener=t}c.prototype={get type(){return s(this).event.type},get target(){return s(this).eventTarget},get currentTarget(){return s(this).currentTarget},composedPath:function(){var e=s(this).currentTarget;return null==e?[]:[e]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return s(this).eventPhase},stopPropagation:function(){var e=s(this);e.stopped=!0,"function"==typeof e.event.stopPropagation&&e.event.stopPropagation()},stopImmediatePropagation:function(){var e=s(this);e.stopped=!0,e.immediateStopped=!0,"function"==typeof e.event.stopImmediatePropagation&&e.event.stopImmediatePropagation()},get bubbles(){return Boolean(s(this).event.bubbles)},get cancelable(){return Boolean(s(this).event.cancelable)},preventDefault:function(){a(s(this))},get defaultPrevented(){return s(this).canceled},get composed(){return Boolean(s(this).event.composed)},get timeStamp(){return s(this).timeStamp},get srcElement(){return s(this).eventTarget},get cancelBubble(){return s(this).stopped},set cancelBubble(e){if(e){var t=s(this);t.stopped=!0,"boolean"==typeof t.event.cancelBubble&&(t.event.cancelBubble=!0)}},get returnValue(){return!s(this).canceled},set returnValue(e){e||a(s(this))},initEvent:function(){}},Object.defineProperty(c.prototype,"constructor",{value:c,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.Event&&(Object.setPrototypeOf(c.prototype,window.Event.prototype),i.set(window.Event.prototype,c));var f=new WeakMap;function g(e){return null!==e&&"object"===r(e)}function m(e){var t=f.get(e);if(null==t)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return t}function y(e,t){Object.defineProperty(e,"on".concat(t),function(e){return{get:function(){for(var t=m(this).get(e);null!=t;){if(3===t.listenerType)return t.listener;t=t.next}return null},set:function(t){"function"==typeof t||g(t)||(t=null);for(var n=m(this),r=null,o=n.get(e);null!=o;)3===o.listenerType?null!==r?r.next=o.next:null!==o.next?n.set(e,o.next):n.delete(e):r=o,o=o.next;if(null!==t){var i={listener:t,listenerType:3,passive:!1,once:!1,next:null};null===r?n.set(e,i):r.next=i}},configurable:!0,enumerable:!0}}(t))}function v(e){function t(){b.call(this)}t.prototype=Object.create(b.prototype,{constructor:{value:t,configurable:!0,writable:!0}});for(var n=0;n<e.length;++n)y(t.prototype,e[n]);return t}function b(){if(!(this instanceof b)){if(1===arguments.length&&Array.isArray(arguments[0]))return v(arguments[0]);if(arguments.length>0){for(var e=new Array(arguments.length),t=0;t<arguments.length;++t)e[t]=arguments[t];return v(e)}throw new TypeError("Cannot call a class as a function")}f.set(this,new Map)}b.prototype={addEventListener:function(e,t,n){if(null!=t){if("function"!=typeof t&&!g(t))throw new TypeError("'listener' should be a function or an object.");var r=m(this),o=g(n),i=(o?Boolean(n.capture):Boolean(n))?1:2,s={listener:t,listenerType:i,passive:o&&Boolean(n.passive),once:o&&Boolean(n.once),next:null},a=r.get(e);if(void 0!==a){for(var c=null;null!=a;){if(a.listener===t&&a.listenerType===i)return;c=a,a=a.next}c.next=s}else r.set(e,s)}},removeEventListener:function(e,t,n){if(null!=t)for(var r=m(this),o=(g(n)?Boolean(n.capture):Boolean(n))?1:2,i=null,s=r.get(e);null!=s;){if(s.listener===t&&s.listenerType===o)return void(null!==i?i.next=s.next:null!==s.next?r.set(e,s.next):r.delete(e));i=s,s=s.next}},dispatchEvent:function(e){if(null==e||"string"!=typeof e.type)throw new TypeError('"event.type" should be a string.');var t=m(this),n=e.type,r=t.get(n);if(null==r)return!0;for(var o=function(e,t){return new(d(Object.getPrototypeOf(t)))(e,t)}(this,e),i=null;null!=r;){if(r.once?null!==i?i.next=r.next:null!==r.next?t.set(n,r.next):t.delete(n):i=r,h(o,r.passive?r.listener:null),"function"==typeof r.listener)try{r.listener.call(this,o)}catch(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e)}else 3!==r.listenerType&&"function"==typeof r.listener.handleEvent&&r.listener.handleEvent(o);if(p(o))break;r=r.next}return h(o,null),function(e,t){s(e).eventPhase=t}(o,0),function(e,t){s(e).currentTarget=t}(o,null),!o.defaultPrevented}},Object.defineProperty(b.prototype,"constructor",{value:b,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.EventTarget&&Object.setPrototypeOf(b.prototype,window.EventTarget.prototype);function T(e){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t,n){return t&&E(e.prototype,t),n&&E(e,n),e}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I(e);if(t){var o=I(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return O(this,n)}}function O(e,t){return!t||"object"!==T(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var A=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(n,e);var t=C(n);function n(){throw w(this,n),t.call(this),new TypeError("AbortSignal cannot be constructed directly")}return S(n,[{key:"aborted",get:function(){var e=P.get(this);if("boolean"!=typeof e)throw new TypeError("Expected 'this' to be an 'AbortSignal' object, but got ".concat(null===this?"null":T(this)));return e}}]),n}(b);y(A.prototype,"abort");var P=new WeakMap;Object.defineProperties(A.prototype,{aborted:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"===T(Symbol.toStringTag)&&Object.defineProperty(A.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortSignal"});var _=function(){function e(){var t;w(this,e),x.set(this,(t=Object.create(A.prototype),b.call(t),P.set(t,!1),t))}return S(e,[{key:"signal",get:function(){return k(this)}},{key:"abort",value:function(){var e;e=k(this),!1===P.get(e)&&(P.set(e,!0),e.dispatchEvent({type:"abort"}))}}]),e}(),x=new WeakMap;function k(e){var t=x.get(e);if(null==t)throw new TypeError("Expected 'this' to be an 'AbortController' object, but got ".concat(null===e?"null":T(e)));return t}Object.defineProperties(_.prototype,{signal:{enumerable:!0},abort:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"===T(Symbol.toStringTag)&&Object.defineProperty(_.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortController"});var N=_,M=("undefined"==typeof window?{}:window).AbortController||N,D=("undefined"==typeof window?{}:window).AbortSignal||A;t.default=M}])},function(e,t,n){"use strict";var r=n(192);function o(e){this.message=e}o.prototype=new Error,o.prototype.name="InvalidTokenError",e.exports=function(e,t){if("string"!=typeof e)throw new o("Invalid token specified");var n=!0===(t=t||{}).header?0:1;try{return JSON.parse(r(e.split(".")[n]))}catch(e){throw new o("Invalid token specified: "+e.message)}},e.exports.InvalidTokenError=o},function(e,t,n){"use strict";var r,o="object"==typeof Reflect?Reflect:null,i=o&&"function"==typeof o.apply?o.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=o&&"function"==typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(n,r){function o(){void 0!==i&&e.removeListener("error",i),n([].slice.call(arguments))}var i;"error"!==t&&(i=function(n){e.removeListener(t,o),r(n)},e.once("error",i)),e.once(t,o)}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function d(e,t,n,r){var o,i,s,a;if(u(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),s=i[t]),void 0===s)s=i[t]=n,++e._eventsCount;else if("function"==typeof s?s=i[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(o=l(e))>0&&s.length>o&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=p.bind(r);return o.listener=n,r.wrapFn=o,o}function f(e,t,n){var r=e._events;if(void 0===r)return[];var o=r[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):m(o,o.length)}function g(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)i(c,this,t);else{var u=c.length,l=m(c,u);for(n=0;n<u;++n)i(l[n],this,t)}return!0},a.prototype.addListener=function(e,t){return d(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return d(this,e,t,!0)},a.prototype.once=function(e,t){return u(t),this.on(e,h(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,h(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,o,i,s;if(u(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){s=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return f(this,e,!0)},a.prototype.rawListeners=function(e){return f(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},a.prototype.listenerCount=g,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),o=console.debug||console.log;function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.apply(void 0,Object(r.g)(e))}},function(module,exports,__webpack_require__){"use strict";(function(global,Buffer){function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var coreHttp=_interopDefault(__webpack_require__(201)),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:{};function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var tsregistrar=createCommonjsModule((function(e,t){e.exports=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.toJson=function(e){try{return JSON.stringify(e)}catch(t){return"Unable to serialize object of type "+typeof e}};var r=function(){function e(){this.start=Date.now()}return Object.defineProperty(e.prototype,"duration",{get:function(){return Date.now()-this.start},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.start},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.start=Date.now()},e}();t.Timespan=r},function(e,t,n){var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(s,a)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),a=function(e){function t(t){var n=e.call(this,t)||this;return n.name="CancelationError",n}return r(t,e),t}(Error),c=function(){function e(t,n,r){this.logger=t,this.maxBackoffInMs=n,this.initialDelay=r,this.backoffCount=0,this.id=++e.idCounter}return e.prototype.delay=function(e){var t=this;if(void 0!==this.timerHandle)throw new Error("Retry sequence logical failure");if(-1===this.backoffCount)return new Promise((function(e,t){t(new a("Cancelled"))}));var n=this.calculateNextBackoffMs();return this.backoffCount++,this.logger.info("[RegistrarClient] Backing off "+e+" for "+n+" milliseconds with ID "+this.id),new Promise((function(r,o){t.cancelFunc=o,t.timerHandle=setTimeout((function(){t.logger.info("[RegistrarClient] Back off for "+e+" with ID "+t.id+" complete"),t.timerHandle=void 0,r()}),n)}))},e.prototype.cancel=function(){void 0!==this.timerHandle&&(this.logger.debug("Resetting back off"),clearTimeout(this.timerHandle),void 0!==this.cancelFunc&&this.cancelFunc(new a("Cancelled"))),this.backoffCount=-1},e.prototype.calculateNextBackoffMs=function(){var e=1+.4*(Math.random()-.5),t=this.initialDelay*Math.pow(2,this.backoffCount)*e;return t=Math.round(t),Math.min(this.maxBackoffInMs,t)},e.idCounter=0,e}(),u=function(){function e(e,t,n){this.logger=e,this.skypeTokenProvider=t,this.options=n,this.backoffs={}}return e.prototype.setTelemetryLogger=function(e){this.eventLogger=e},e.prototype.register=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.performRegistration(e,t,"pr_set_registration")];case 1:return n.sent(),this.cachedRegistrationParams=[e,t],[2]}}))}))},e.prototype.unregister=function(){return o(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this.logger.info("[RegistrarClient] sending unregister request"),e=new Request(this.options.registrarUrl+"/"+this.options.registrationId,{method:"DELETE",mode:"cors",headers:new Headers({accept:"application/json, text/javascript"})}),[4,this.callRegistrar(e,"pr_delete_registration")];case 1:return t.sent(),[2]}}))}))},e.prototype.cancelPendingRequests=function(){var e=this;Object.keys(this.backoffs).forEach((function(t){e.backoffs[t].cancel()})),this.backoffs={}},e.prototype.resendRegistration=function(){return o(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:if(!this.cachedRegistrationParams)throw new Error("Re-registration failed because there is no registration parameters cached");return[4,this.performRegistration(this.cachedRegistrationParams[0],this.cachedRegistrationParams[1],"pr_resend_registration")];case 1:return e.sent(),[2]}}))}))},e.prototype.performRegistration=function(e,t,n){return o(this,void 0,void 0,(function(){var r,o;return i(this,(function(i){switch(i.label){case 0:return this.logger.info("[RegistrarClient] Sending register request"),r={clientDescription:e,registrationId:this.options.registrationId,nodeId:"",transports:t},o=new Request(this.options.registrarUrl,{method:"POST",mode:"cors",headers:new Headers({"content-type":"application/json",accept:"application/json, text/javascript"}),body:s.toJson(r)}),[4,this.callRegistrar(o,n)];case 1:return i.sent(),[2]}}))}))},e.prototype.startBackoff=function(){var e=new c(this.logger,this.options.maxRetryDelayMs,this.options.initialRetryDelayMs);return this.backoffs[e.id]=e,e},e.prototype.stopBackoff=function(e){e.cancel(),delete this.backoffs[e.id]},e.prototype.getSkypeToken=function(){return o(this,void 0,void 0,(function(){var e,t,n;return i(this,(function(r){switch(r.label){case 0:e=this.startBackoff(),r.label=1;case 1:return r.trys.push([1,3,,8]),this.logger.info("[RegistrarClient] Asking for a new skypetoken"),[4,this.skypeTokenProvider(!0)];case 2:return t=r.sent(),this.stopBackoff(e),[2,t];case 3:r.sent(),r.label=4;case 4:return r.trys.push([4,6,,7]),[4,e.delay("Fetching a new skypetoken")];case 5:return r.sent(),[3,8];case 6:throw n=r.sent(),this.stopBackoff(e),n;case 7:return[3,8];case 8:return[3,1];case 9:return[2]}}))}))},e.prototype.callRegistrar=function(e,t){return o(this,void 0,void 0,(function(){var n,r,o,a,c,u,l,d,p,h,f,g,m;return i(this,(function(i){switch(i.label){case 0:return n=this.startBackoff(),[4,this.skypeTokenProvider(!1)];case 1:r=i.sent(),this.setSkypeTokenHeader(e,r),o=new s.Timespan,i.label=2;case 2:a=void 0,i.label=3;case 3:return i.trys.push([3,8,13,14]),c=e.clone(),[4,this.fetchWithTimeout(c)];case 4:return 401!==(a=i.sent()).status?[3,6]:(u=this.setSkypeTokenHeader,l=[e],[4,this.getSkypeToken()]);case 5:return u.apply(this,l.concat([i.sent()])),[3,20];case 6:if(a.status>=500&&a.status<600)throw new Error("Fetch for '"+e.url+"' failed with "+a.status+" "+a.statusText);i.label=7;case 7:return[3,14];case 8:d=i.sent(),this.logger.error("[RegistrarClient] Request failed with "+d),i.label=9;case 9:return i.trys.push([9,11,,12]),[4,n.delay("Registrar call retry")];case 10:return i.sent(),[3,20];case 11:throw p=i.sent(),this.logger.error("[RegistrarClient] Request cancelled"),this.stopBackoff(n),p;case 12:return[3,14];case 13:return this.sendTelemetryEvent(t,e,a,o),[7];case 14:return this.stopBackoff(n),a.ok?[2,a]:[3,15];case 15:h=void 0,i.label=16;case 16:return i.trys.push([16,18,,19]),g=(f=JSON).stringify,[4,a.json()];case 17:return h=g.apply(f,[i.sent()]),[3,19];case 18:return i.sent(),h="no details",[3,19];case 19:throw m="Fetch for '"+e.url+"' failed with "+a.status+" "+a.statusText+" ("+h+", MS-CV: "+a.headers.get("MS-CV")+")",this.logger.error("[RegistrarClient] "+m),new Error(m);case 20:return[3,2];case 21:return[2]}}))}))},e.prototype.setSkypeTokenHeader=function(e,t){e.headers.set("X-Skypetoken",t)},e.prototype.fetchWithTimeout=function(e){var t=this;return new Promise((function(n,r){fetch(e).then(n).catch(r),0!==t.options.requestTimeoutMs&&setTimeout(r,t.options.requestTimeoutMs,new Error("Fetch for '"+e.url+"' timed out"))}))},e.prototype.sendTelemetryEvent=function(e,t,n,r){if(void 0!==this.eventLogger){var o={name:e,properties:{url:{value:t.url},result_code:{value:void 0!==n?n.status:0},begin_timestamp:{value:r.startTime},elapsed:{value:r.duration}}};this.eventLogger.logEvent(o)}},e}();t.RegistrarClient=u,t.createRegistrarClient=function(e,t,n){return new u(e,t,n)}}])}));unwrapExports(tsregistrar);var tstrouter=createCommonjsModule((function(module,exports){var e;e=function(__WEBPACK_EXTERNAL_MODULE_20__){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=19)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.name=e,this.logger=t}return e.prototype.debug=function(e){this.logger.debug("["+this.name+"] "+e)},e.prototype.info=function(e){this.logger.info("["+this.name+"] "+e)},e.prototype.warn=function(e){this.logger.warn("["+this.name+"] "+e)},e.prototype.error=function(e){this.logger.error("["+this.name+"] "+e)},e}();t.Logger=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.constants={TROUTER_INIT:"trouterinit",TROUTER_READY_EVENT:"trouterReadyEvent",TROUTER_READY_TIMEOUT:"trouterReadyTimeout",TROUTER_TOKEN_REQUEST:"trouterTokenRequest",TROUTER_TOKEN_GET_SUCCEEDED:"trouterTokenGetSucceeded",TROUTER_TOKEN_GET_FAILED:"trouterTokenGetFailed",TROUTER_RECONNECTING:"trouterReconnecting",RENEWAL:"renewal",NEW_CONNECTION:"newConnection",ENDPOINT_REGISTRATION_FAILED:"endpointRegistrationFailed"},t.CLIENT_VERSION="2021.32.00.1",t.HANDLED_MESSAGE_ACK=200,t.UNHANDLED_MESSAGE_ACK=404,t.FAILED_MESSAGE_ACK=500},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Unknown=0]="Unknown",e[e.Active=1]="Active",e[e.Inactive=2]="Inactive"}(t.UserActivityState||(t.UserActivityState={}));var r=function(){};t.HttpHeaders=r,function(e){e[e.Unknown=0]="Unknown",e[e.Connected=2]="Connected",e[e.Disconnected=3]="Disconnected",e[e.Switching=9]="Switching"}(t.TrouterState||(t.TrouterState={}))},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.toJson=function(e){try{return JSON.stringify(e)}catch(t){return"Unable to serialize object of type "+typeof e}},t.calculateTtlInSec=function(e){var t=Math.round((new Date).getTime()/1e3);return void 0!==e&&e>t?e-t:0},t.calculateExpireTsInSec=function(e){return Math.round((new Date).getTime()/1e3)+e};var r=function(){function e(e){this.base=void 0!==e?e:this.createCorrelationVectorBase(),this.extension=0}return e.extend=function(t){return new e(t)},e.prototype.increase=function(){this.extension++},e.prototype.value=function(){return this.base+"."+this.extension},e.prototype.createCorrelationVectorBase=function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0987654321/+",t="AQgw",n="",r=0;r<21;r++)n+=e.charAt(Math.floor(Math.random()*e.length));return n+t.charAt(Math.floor(Math.random()*t.length))},e}();t.CorrelationVector=r;var o=function(){function e(){this.start=Date.now()}return Object.defineProperty(e.prototype,"duration",{get:function(){return Date.now()-this.start},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.start},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.start=Date.now()},e}();t.Timespan=o},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(){function e(e,t,n,r,o,i,s){this.connectionId=e,this.connectedClientId=t,this.domId=n,this.unsecureUrl=r,this.url=o,this.c2cUrlBase=i,this.expirationTsSec=s}return e.prototype.getRemainingTtlInSec=function(){return r.calculateTtlInSec(this.expirationTsSec)},e}();t.ServerState=o,function(e){e[e.Unknown=0]="Unknown",e[e.Modified=1]="Modified",e[e.Snapshot=2]="Snapshot",e[e.Connected=3]="Connected"}(t.UserActivityEventReason||(t.UserActivityEventReason={}))},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=function(){function e(e){this.logger=e,this.messageHandlers=[]}return e.prototype.register=function(e){if(this.messageHandlers.some((function(t){return t===e})))throw new Error("Registering the same handler twice is not allowed");this.messageHandlers.push(e)},e.prototype.clear=function(){this.logger.debug("Clearing message handlers"),this.messageHandlers=[]},e.prototype.active=function(){return this.messageHandlers.length>0},e.prototype.handleMessage=function(e){for(var t={resultCode:r.UNHANDLED_MESSAGE_ACK,isHandled:!1},n=0,o=this.messageHandlers;n<o.length;n++){var i=o[n],s=this.safeExecuteHandle(i,e);if(void 0!==s&&(void 0===s.isHandled||s.isHandled))return void 0===s.resultCode&&(s.resultCode=r.HANDLED_MESSAGE_ACK),s}return t},e.prototype.safeExecuteHandle=function(e,t){try{return e.handleMessage(t)}catch(e){return void this.logger.warn("A trouter message handler is throwing exceptions. exception: "+e)}},e}();t.MessageHandlerRegistry=o},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(s,a)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.addCacheAsBackupTo=function(e){var t,n=this;return function(i){return r(n,void 0,void 0,(function(){return o(this,(function(n){return i&&(t=void 0),[2,new Promise((function(n,r){e(i).then((function(e){t=e,n(e)})).catch((function(e){void 0!==t&&t.length>0&&n(t),r(e)}))}))]}))}))}}},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(s,a)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),s=n(2),a=n(0),c=n(16),u=n(18),l=function(){function e(e,t){this.state=e,this.correlationVector=void 0!==t?t:i.CorrelationVector.extend()}return e.prototype.getStateString=function(){switch(this.state){case s.UserActivityState.Active:return"active";case s.UserActivityState.Inactive:return"inactive";case s.UserActivityState.Unknown:return"unknown";default:return"undefined"}},e.prototype.toEventObject=function(){return{state:this.getStateString(),cv:this.correlationVector.value()}},e.prototype.toEventJSON=function(){return i.toJson(this.toEventObject())},e}();t.UserActivityObject=l;var d=function(){function e(e,t,n,r){this.logFunc=e,this.options=t,this.tokenProvider=n,this.listener=r,this.logger=new a.Logger("Manager",e),this.logger.info("Created TrouterManager with options "+i.toJson(this.options)),this.fsm=new u.TrouterManagerFsm(e,this),this.baseEndpointUrl="",this.processedMessageLoss={},this.userActivityObject=new l(s.UserActivityState.Unknown)}return e.prototype.start=function(){this.fsm.start()},e.prototype.stop=function(e){this.fsm.stop(e)},e.prototype.configure=function(e){this.options=e,void 0!==this.firstConnection&&this.firstConnection.configure(e),void 0!==this.secondConnection&&this.secondConnection.configure(e),this.logger.info("Reconfigured TrouterManager with options "+i.toJson(this.options))},e.prototype.checkConnection=function(e){void 0!==this.firstConnection&&this.firstConnection.checkConnection(e),void 0!==this.secondConnection&&this.secondConnection.checkConnection(e)},e.prototype.resendRegistration=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){return void 0!==this.secondConnection?(this.logger.info("Resending registration on the second/new connection"),[2,this.secondConnection.resendRegistration()]):void 0!==this.firstConnection?(this.logger.info("Resending registration on the first/current connection"),[2,this.firstConnection.resendRegistration()]):(this.logger.info("No connection to resend registration on, will be done upon (re)connect"),[2])}))}))},e.prototype.getServerState=function(){if(void 0!==this.firstConnection)return this.firstConnection.getServerState()},e.prototype.getState=function(){return this.fsm.getState()},e.prototype.startFirstConnection=function(){var e=new c.TrouterConnection(this.logFunc,this.options,this,this.tokenProvider,this.userActivityObject);this.firstConnection=e,this.getConnectionCache().then((function(t){e.start(t)})).catch()},e.prototype.startSecondConnection=function(){this.secondConnection=new c.TrouterConnection(this.logFunc,this.options,this,this.tokenProvider,this.userActivityObject),this.secondConnection.start()},e.prototype.stopFirstConnection=function(e){void 0!==this.firstConnection&&(this.firstConnection.stop(e),this.storedFirstConnection=this.firstConnection,this.firstConnection=void 0)},e.prototype.stopSecondConnection=function(e){void 0!==this.secondConnection&&(this.secondConnection.stop(e),this.secondConnection=void 0)},e.prototype.stopSecondConnectionDelayed=function(){if(void 0!==this.secondConnection){var e=this.secondConnection;this.secondConnection=void 0,this.logger.info("Closing an inactive connection in "+Math.round(this.options.lingeringConnectionDelayMs/1e3)+"s"),setTimeout((function(){e.stop(!0)}),this.options.lingeringConnectionDelayMs)}},e.prototype.forceStopLingeringConnection=function(){this.storedFirstConnection&&(this.storedFirstConnection.stop(!1),this.storedFirstConnection=void 0)},e.prototype.switchConnections=function(){var e=this.firstConnection;this.firstConnection=this.secondConnection,this.secondConnection=e},e.prototype.doesSecondConnectionExist=function(){return void 0!==this.secondConnection},e.prototype.dispatchConnected=function(){if(void 0!==this.firstConnection){var e=this.firstConnection.getServerState(),t="/"===e.url.slice(-1)?e.url.slice(0,-1):e.url,n={baseEndpointUrl:t,newEndpointUrl:t!==this.baseEndpointUrl,c2cUrlBase:e.c2cUrlBase,clientId:e.connectedClientId,connectionId:e.connectionId,connectionTtlSec:e.getRemainingTtlInSec()};this.baseEndpointUrl=t,this.listener.onTrouterConnected(e.url,n)}},e.prototype.dispatchReconnecting=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},e.prototype.dispatchStopped=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},e.prototype.dispatchRegistrationState=function(e){this.options.registrationStateCallback&&this.options.registrationStateCallback(e)},e.prototype.onDownstreamRequest=function(e,t,n){var r={id:t.id,method:t.method,path:"/"+t.shortUrl,body:t.body,headers:t.headers},o={id:t.id,status:0,headers:{},body:"",send:function(){return o.status<=100||o.status>=999?3:(n.writeHead(o.status,o.headers),n.end(o.body))}};this.listener.onTrouterRequest(r,o)},e.prototype.onConnected=function(e){this.fsm.onConnected(e===this.firstConnection)},e.prototype.onRegistered=function(e){this.fsm.onRegistered(e===this.firstConnection)},e.prototype.onUnregistered=function(e){this.fsm.onUnregistered(e===this.firstConnection||e===this.storedFirstConnection)},e.prototype.onReconnecting=function(e){this.fsm.onReconnecting(e===this.firstConnection)},e.prototype.onReconnectIsRequired=function(e){this.fsm.onReconnectionRequired(e===this.firstConnection)},e.prototype.onDisconnected=function(e){this.fsm.onDisconnected(e===this.storedFirstConnection),this.storedFirstConnection=void 0},e.prototype.onUserActivityStateAccepted=function(e){this.listener.onTrouterUserActivityStateAccepted&&this.listener.onTrouterUserActivityStateAccepted(e)},e.prototype.onConnectionParametersUpdated=function(e){this.setConnectionCache(e)},e.prototype.setUserActivityState=function(e,t){return this.userActivityObject=new l(e,i.CorrelationVector.extend(t)),void 0!==this.secondConnection?(this.logger.info("Setting user activity "+this.userActivityObject.toEventJSON()+" on the second/new connection"),void this.secondConnection.setUserActivityState(this.userActivityObject)):void 0!==this.firstConnection?(this.logger.info("Setting user activity "+this.userActivityObject.toEventJSON()+" on the first/current connection"),void this.firstConnection.setUserActivityState(this.userActivityObject)):void 0},e.prototype.onTrouterMessageLost=function(e){var t=this;if(this.listener.onTrouterMessageLoss)if(e&&e.length){var n=e.filter((function(e){return void 0!==t.processedMessageLoss[e.tag+"-"+e.etag]}));if(n.length&&(this.logger.warn("onTrouterMessageLoss - removing duplicates and sending event to server"),this.sendProcessedDroppedIndicators(n),!(e=e.filter((function(e){return void 0===t.processedMessageLoss[e.tag+"-"+e.etag]}))).length))return void this.logger.warn("onTrouterMessageLoss - All the data are duplicated");if(!this.listener.onTrouterMessageLoss(e.map((function(e){return e.tag}))))return void this.logger.warn("onTrouterMessageLoss - flow tags have not been processed by listeners");e.forEach((function(e){t.processedMessageLoss[e.tag+"-"+e.etag]=""})),this.sendProcessedDroppedIndicators(e)}else this.logger.warn("onTrouterMessageLoss - no flow tags have been provided")},e.prototype.getConnectionCache=function(){var e=this;return this.options.connectionCache?(this.logger.debug("Querying host's connection cache"),this.options.connectionCache.onGetTrouterConnectionCache().then((function(e){return e?JSON.parse(e):void 0})).catch((function(t){return e.logger.warn("Invalid connection cache content provided: "+t),e.connectionCache}))):Promise.resolve(this.connectionCache)},e.prototype.setConnectionCache=function(e){if(this.connectionCache=e,this.options.connectionCache)try{this.options.connectionCache.onSetTrouterConnectionCache(JSON.stringify(e))}catch(e){this.logger.warn("Error setting external connection cache: "+e)}},e.prototype.sendProcessedDroppedIndicators=function(e){return void 0!==this.firstConnection?void this.firstConnection.sendProcessedDroppedIndicators(e):void 0!==this.secondConnection?void this.secondConnection.sendProcessedDroppedIndicators(e):void 0},e}();t.TrouterManager=d},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.logger=e}return e.prototype.getPromise=function(){var e=this;return void 0!==this.url?(this.logger.debug("[TrouterUrlPromise] returning previously resolved url: "+this.url),Promise.resolve(this.url)):(void 0===this.pendingPromise?(this.logger.debug("[TrouterUrlPromise] creating and returning promise"),this.pendingPromise=new Promise((function(t,n){e.pendingPromiseResolveRef=t,e.pendingPromiseRejectRef=n}))):this.logger.debug("[TrouterUrlPromise] returning existing promise"),this.pendingPromise)},e.prototype.resolveUrl=function(e){this.url=e,this.logger.debug("[TrouterUrlPromise] got url: "+this.url);var t=this.pendingPromiseResolveRef;this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==t&&(this.logger.debug("[TrouterUrlPromise] resolving promise"),t(e))},e.prototype.rejectUrl=function(e){this.logger.debug("[TrouterUrlPromise] aborting");var t=this.pendingPromiseRejectRef;this.url=void 0,this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==t&&(this.logger.debug("[TrouterUrlPromise] rejecting promise"),t(e))},e.prototype.resetUrl=function(){this.logger.debug("[TrouterUrlPromise] resetting url"),this.url=void 0},e}();t.TrouterUrlPromise=r},function(module,exports,__webpack_require__){(function(global,module){var t,e,n;t=module.exports,e=void 0===global?window:global,n=t,n.version="0.9.6",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(t,r){var o,i,s=n.util.parseUri(t);e&&e.location&&(s.protocol=s.protocol||e.location.protocol.slice(0,-1),s.host=s.host||(e.document?e.document.domain:e.location.hostname),s.port=s.port||e.location.port),o=n.util.uniqueUri(s);var a={host:s.host,secure:"https"==s.protocol,port:s.port||("https"==s.protocol?443:80),query:s.query||""};return n.util.merge(a,r),!a["force new connection"]&&n.sockets[o]||(i=new n.Socket(a)),!a["force new connection"]&&i&&(n.sockets[o]=i),(i=i||n.sockets[o]).of(s.path.length>1?s.path:"")};var io=module.exports;!function(e,t){var n=e.util={},r=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,o=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){for(var t=r.exec(e||""),n={},i=14;i--;)n[o[i]]=t[i]||"";return n},n.uniqueUri=function(e){var n=e.protocol,r=e.host,o=e.port;return"document"in t?(r=r||document.domain,o=o||("https"==n&&"https:"!==document.location.protocol?443:document.location.port)):(r=r||"localhost",o||"https"!=n||(o=443)),(n||"http")+"://"+r+":"+(o||80)},n.query=function(e,t){var r=n.chunkQuery(e||""),o=[];for(var i in n.merge(r,n.chunkQuery(t||"")),r)r.hasOwnProperty(i)&&o.push(i+"="+r[i]);return o.length?"?"+o.join("&"):""},n.chunkQuery=function(e){for(var t,n={},r=e.split("&"),o=0,i=r.length;o<i;++o)(t=r[o].split("="))[0]&&(n[t[0]]=t[1]);return n};var i=!1;n.load=function(e){if("document"in t&&"complete"===document.readyState||i)return e();n.on(t,"load",e,!1)},n.on=function(e,t,n,r){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,r)},n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null},"undefined"!=typeof window&&n.load((function(){i=!0})),n.defer=function(e){if(!n.ua.webkit||"undefined"!=typeof importScripts)return e();n.load((function(){setTimeout(e,100)}))},n.merge=function(e,t,r,o){var i,s=o||[],a=void 0===r?2:r;for(i in t)t.hasOwnProperty(i)&&n.indexOf(s,i)<0&&("object"==typeof e[i]&&a?n.merge(e[i],t[i],a-1,s):(e[i]=t[i],s.push(t[i])));return e},n.mixin=function(e,t){n.merge(e.prototype,t.prototype)},n.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.intersect=function(e,t){for(var r=[],o=e.length>t.length?e:t,i=e.length>t.length?t:e,s=0,a=i.length;s<a;s++)~n.indexOf(o,i[s])&&r.push(i[s]);return r},n.indexOf=function(e,t,n){var r=e.length;for(n=n<0?n+r<0?0:n+r:n||0;n<r&&e[n]!==t;n++);return r<=n?-1:n},n.toArray=function(e){for(var t=[],n=0,r=e.length;n<r;n++)t.push(e[n]);return t},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(e){return!1}return null!=e.withCredentials}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent)}(void 0!==io?io:module.exports,void 0===global?window:global),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function n(){r.removeListener(e,n),t.apply(this,arguments)}var r=this;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var r=this.$events[e];if(t.util.isArray(r)){for(var o=-1,i=0,s=r.length;i<s;i++)if(r[i]===n||r[i].listener&&r[i].listener===n){o=i;break}if(o<0)return this;r.splice(o,1),r.length||delete this.$events[e]}else(r===n||r.listener&&r.listener===n)&&delete this.$events[e]}return this},n.prototype.removeAllListeners=function(e){return this.$events&&this.$events[e]&&(this.$events[e]=null),this},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){if(!this.$events)return!1;var n=this.$events[e];if(!n)return!1;var r=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,r);else{if(!t.util.isArray(n))return!1;for(var o=n.slice(),i=0,s=o.length;i<s;i++)o[i].apply(this,r)}return!0}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(exports,nativeJSON){function f(e){return e<10?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,(function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+e+'"'}function str(e,t){var n,r,o,i,s,a=gap,c=t[e];switch(c instanceof Date&&(c=date(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(c)){for(i=c.length,n=0;n<i;n+=1)s[n]=str(n,c)||"null";return o=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,o}if(rep&&"object"==typeof rep)for(i=rep.length,n=0;n<i;n+=1)"string"==typeof rep[n]&&(o=str(r=rep[n],c))&&s.push(quote(r)+(gap?": ":":")+o);else for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(o=str(r,c))&&s.push(quote(r)+(gap?": ":":")+o);return o=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,o}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(e,t,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;r<n;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})},JSON.parse=function(text,reviver){function walk(e,t){var n,r,o=e[t];if(o&&"object"==typeof o)for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(void 0!==(r=walk(o,n))?o[n]=r:delete o[n]);return reviver.call(e,t,o)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,(function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}(void 0!==io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var n=e.parser={},r=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],o=n.reasons=["transport not supported","client not handshaken","unauthorized"],i=n.advice=["reconnect"],s=t.JSON,a=t.util.indexOf;n.encodePacket=function(e){var t=a(r,e.type),n=e.id||"",c=e.endpoint||"",u=e.ack,l=null;switch(e.type){case"error":var d=e.reason?a(o,e.reason):"",p=e.advice?a(i,e.advice):"";""===d&&""===p||(l=d+(""!==p?"+"+p:""));break;case"message":""!==e.data&&(l=e.data);break;case"event":var h={name:e.name};e.args&&e.args.length&&(h.args=e.args),l=s.stringify(h);break;case"json":l=s.stringify(e.data);break;case"connect":e.qs&&(l=e.qs);break;case"ack":l=e.ackId+(e.args&&e.args.length?"+"+s.stringify(e.args):"")}var f=[t,n+("data"==u?"+":""),c];return null!=l&&f.push(l),f.join(":")},n.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var n=0,r=e.length;n<r;n++)t+="�"+e[n].length+"�"+e[n];return t};var c=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(e){if(!(a=e.match(c)))return{};var t=a[2]||"",n=(e=a[5]||"",{type:r[a[1]],endpoint:a[4]||""});switch(t&&(n.id=t,a[3]?n.ack="data":n.ack=!0),n.type){case"error":var a=e.split("+");n.reason=o[a[0]]||"",n.advice=i[a[1]]||"";break;case"message":n.data=e||"";break;case"event":try{var u=s.parse(e);n.name=u.name,n.args=u.args}catch(e){}n.args=n.args||[];break;case"json":try{n.data=s.parse(e)}catch(e){}break;case"connect":n.qs=e||"";break;case"ack":if((a=e.match(/^([0-9]+)(\+)?(.*)/))&&(n.ackId=a[1],n.args=[],a[3]))try{n.args=a[3]?s.parse(a[3]):[]}catch(e){}break;case"disconnect":n.reason=e}return n},n.decodePayload=function(e){if("�"==e.charAt(0)){for(var t=[],r=1,o="";r<e.length;r++)"�"==e.charAt(r)?(t.push(n.decodePacket(e.substr(r+1).substr(0,o))),r+=Number(o)+1,o=""):o+=e.charAt(r);return t}return[n.decodePacket(e)]}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t,this.connectErrorCallback=void 0,this.isOpened=!1}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.onData=function(e){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e){var n=t.parser.decodePayload(e);if(n&&n.length)for(var r=0,o=n.length;r<o;r++)this.onPacket(n[r])}return this},n.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),"error"==e.type&&"reconnect"==e.advice&&(this.isOpened=!1),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout((function(){e.onDisconnect()}),this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.close&&this.isOpened&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this.connectErrorCallback=void 0,this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.isOpened=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){this.isOpened=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(e,t){t.call(this)},n.prototype.clearEventHandlers=function(){return this}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,n){function r(e){if(this.options={port:80,secure:!1,document:"document"in n&&document,resource:"socket.io",transports:t.transports.slice(),"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.disconnected=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var r=this;t.util.on(n,"unload",(function(){r.disconnectSync()}),!1)}this.options["auto connect"]&&this.connect()}function o(){}e.Socket=r,t.util.mixin(r,t.EventEmitter),r.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},r.prototype.publish=function(){var e;for(var t in this.emit.apply(this,arguments),this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t)).$emit.apply(e,arguments)},r.prototype.handshake=function(e){function n(t){t instanceof Error?r.onError(t.message):e.apply(null,t.split(":"))}var r=this,i=this.options;if(!r.disconnected){var s=["http"+(i.secure?"s":"")+":/",i.host+":"+i.port,i.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var a=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=s+"&jsonp="+t.j.length,a.parentNode.insertBefore(c,a),t.j.push((function(e){n(e),c.parentNode.removeChild(c)}))}else{var u=t.util.request();u.open("GET",s,!0),u.withCredentials=!0,u.onreadystatechange=function(){4==u.readyState&&(u.onreadystatechange=o,200==u.status?n(u.responseText):!r.reconnecting&&r.onError(u.responseText))},u.send(null)}}},r.prototype.getTransport=function(e){for(var n,r=e||this.transports,o=0;n=r[o];o++)if(t.Transport[n]&&t.Transport[n].check(this)&&(!this.isXDomain()||t.Transport[n].xdomainCheck()))return new t.Transport[n](this,this.sessionid);return null},r.prototype.connect=function(e){if(this.connecting||this.disconnected)return this;var n=this;return this.handshake((function(r,o,i,s){function a(){if(!n.connected&&!n.disconnected)if(n.connecting=!1,clearTimeout(n.connectTimeoutTimer),n.options["try multiple transports"]){for(;n.remainingTransports.length>0&&n.remainingTransports.splice(0,1)[0]!=n.transport.name;);n.remainingTransports.length?c(n.remainingTransports):n.publish("connect_failed")}else n.publish("connect_failed")}function c(e){if(n.transport&&(n.transport.clearTimeouts(),n.transport.clearEventHandlers()),n.transport=n.getTransport(e),!n.transport||n.disconnected)return n.publish("connect_failed");n.transport.ready(n,(function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(a),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout((function(){a()}),n.options["connect timeout"]))}))}n.sessionid=r,n.closeTimeout=1e3*i+2e3,n.heartbeatTimeout=1e3*o+2e3,n.transports=s?t.util.intersect(s.split(","),n.options.transports):n.options.transports,n.setHeartbeatTimeout(),n.remainingTransports=n.transports.slice(0),c(n.transports),n.once("connect",(function(){clearTimeout(n.connectTimeoutTimer),e&&"function"==typeof e&&e()}))})),this},r.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var e=this;this.heartbeatTimeoutTimer=setTimeout((function(){e.transport.onClose()}),this.heartbeatTimeout)},r.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},r.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},r.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this.disconnected=!0,this},r.prototype.disconnectSync=function(){var e=t.util.request(),n=this.resource+"/"+t.protocol+"/"+this.sessionid;e.open("GET",n,!0),this.onDisconnect("booted")},r.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},r.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},r.prototype.onOpen=function(){this.open=!0},r.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},r.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},r.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},r.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||n)&&(this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},r.prototype.reconnect=function(){function e(){if(n.connected){for(var e in n.namespaces)n.namespaces.hasOwnProperty(e)&&""!==e&&n.namespaces[e].packet({type:"connect"});n.publish("reconnect",n.transport.name,n.reconnectionAttempts)}clearTimeout(n.reconnectionTimer),n.removeListener("connect_failed",t),n.removeListener("connect",t),n.reconnecting=!1,delete n.reconnectionAttempts,delete n.reconnectionDelay,delete n.reconnectionTimer,delete n.redoTransports,n.options["try multiple transports"]=o}function t(){if(n.reconnecting)return n.connected?e():n.connecting&&n.reconnecting?n.reconnectionTimer=setTimeout(t,1e3):void(n.reconnectionAttempts++>=r?n.redoTransports?(n.publish("reconnect_failed"),e()):(n.on("connect_failed",t),n.options["try multiple transports"]=!0,n.transport=n.getTransport(),n.redoTransports=!0,n.connect()):(n.reconnectionDelay<i&&(n.reconnectionDelay*=2),n.connect(),n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts),n.reconnectionTimer=setTimeout(t,n.reconnectionDelay)))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var n=this,r=this.options["max reconnection attempts"],o=this.options["try multiple transports"],i=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(t,this.reconnectionDelay),this.on("connect",t)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new r(this,"json"),this.ackPackets=0,this.acks={}}function r(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],r={type:"event",name:e};return"function"==typeof n&&(r.id=++this.ackPackets,r.ack="data",this.acks[r.id]=n,t=t.slice(0,t.length-1)),r.args=t,this.packet(r)},n.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function n(){r.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var r=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason||"");break;case"message":case"json":var o=["message",e.data];"data"==e.ack?o.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,o);break;case"event":o=[e.name].concat(e.args),"data"==e.ack&&o.push(n),this.$emit.apply(this,o);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):"unauthorized"==e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},r.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},r.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,n){function r(e){t.Transport.apply(this,arguments)}function o(){}e.websocket=r,t.util.inherit(r,t.Transport),r.prototype.name="websocket",r.prototype.open=function(e){var r,o=t.util.query(this.socket.options.query),i=this;return this.connectErrorCallback=e,r||(r=n.MozWebSocket||n.WebSocket),this.websocket=new r(this.prepareUrl()+o),this.websocket.onopen=function(){i.onOpen(),i.socket.setBuffer(!1)},this.websocket.onmessage=function(e){i.onData(e.data)},this.websocket.onclose=function(){i.onClose(),i.socket.setBuffer(!0)},this.websocket.onerror=function(e){i.onError(e)},this},r.prototype.send=function(e){return this.websocket.send(e),this},r.prototype.payload=function(e){for(var t=0,n=e.length;t<n;t++)this.packet(e[t]);return this},r.prototype.close=function(){return this.websocket.close(),this},r.prototype.onError=function(e){void 0!==this.connectErrorCallback&&(this.connectErrorCallback(),this.connectErrorCallback=void 0),this.socket.onError(e)},r.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},r.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},r.xdomainCheck=function(){return!0},r.prototype.clearEventHandlers=function(){return this.websocket&&(this.websocket.onopen=this.websocket.onmessage=this.websocket.onclose=this.websocket.onerror=o),this},t.transports.push("websocket")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t,n){function r(e){e&&(t.Transport.apply(this,arguments),this.sendBuffer=[])}function o(){}e.XHR=r,t.util.inherit(r,t.Transport),r.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},r.prototype.payload=function(e){for(var n=[],r=0,o=e.length;r<o;r++)n.push(t.parser.encodePacket(e[r]));this.send(t.parser.encodePayload(n))},r.prototype.send=function(e){return this.post(e),this},r.prototype.post=function(e){var t=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=function(){this.onload=o,t.socket.setBuffer(!1)}:this.sendXHR.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=o,t.posting=!1,200==this.status?(t.socket.setBuffer(!1),clearTimeout(t.sendXHR.ackTimeoutTimer)):t.onClose())},this.sendXHR.send(e),t.sendXHR.ackTimeoutTimer=setTimeout((function(){t.onClose()}),t.socket.options.ackTimeoutMs)},r.prototype.close=function(){return this.onClose(),this},r.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),r=t.util.query(this.socket.options.query,"t="+ +new Date);if(n.open(e||"GET",this.prepareUrl()+r,!0),"POST"==e)try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(e){}return n},r.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},r.check=function(e,r){try{var o=t.util.request(r),i=n.XDomainRequest&&o instanceof XDomainRequest,s=(e&&e.options&&e.options.secure?"https:":"http:")!=n.location.protocol;if(o&&(!i||!s))return!0}catch(e){}return!1},r.xdomainCheck=function(){return r.check(null,!0)},r.prototype.clearEventHandlers=function(){return this.sendXHR&&(this.sendXHR.onreadystatechange=this.sendXHR.onload=o),this}}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t,n){function r(){t.Transport.XHR.apply(this,arguments)}function o(){}e["xhr-polling"]=r,t.util.inherit(r,t.Transport.XHR),t.util.merge(r,t.Transport.XHR),r.prototype.name="xhr-polling",r.prototype.open=function(e){return this.connectErrorCallback=e,t.Transport.XHR.prototype.open.call(this),!1},r.prototype.get=function(){if(this.isOpened){var e=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=function(){e.connectErrorCallback=void 0,this.onload=o,this.onerror=o,e.onData(this.responseText),e.get()},this.xhr.onerror=function(){e.onClose(),void 0!==e.connectErrorCallback&&(e.connectErrorCallback(),e.connectErrorCallback=void 0)}):this.xhr.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=o,200==this.status?(e.connectErrorCallback=void 0,e.onData(this.responseText),e.get()):(e.onClose(),void 0!==e.connectErrorCallback&&(e.connectErrorCallback(),e.connectErrorCallback=void 0)))},this.xhr.send(null)}},r.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=o;try{this.xhr.abort()}catch(e){}this.xhr=null}},r.prototype.ready=function(e,n){var r=this;t.util.defer((function(){n.call(r)}))},r.prototype.clearEventHandlers=function(){return t.Transport.XHR.prototype.clearEventHandlers.call(this),this.xhr&&(this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=o),this},t.transports.push("xhr-polling")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),exports.io=io}).call(exports,__webpack_require__(4),__webpack_require__(13)(module))},function(e,t,n){(function(t,r){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   4.0.5
 */
!function(t,n){e.exports=n()}(0,(function(){function e(e){return"function"==typeof e}function o(){var e=setTimeout;return function(){return e(i,1)}}function i(){for(var e=0;e<S;e+=2)(0,k[e])(k[e+1]),k[e]=void 0,k[e+1]=void 0;S=0}function s(e,t){var n=arguments,r=this,o=new this.constructor(c);void 0===o[M]&&b(o);var i=r._state;return i?function(){var e=n[i-1];O((function(){return v(i,o,e,r._result)}))}():g(r,o,e,t),o}function a(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(c);return d(t,e),t}function c(){}function u(e){try{return e.then}catch(e){return L.error=e,L}}function l(t,n,r){n.constructor===t.constructor&&r===s&&n.constructor.resolve===a?function(e,t){t._state===j?h(e,t._result):t._state===U?f(e,t._result):g(t,void 0,(function(t){return d(e,t)}),(function(t){return f(e,t)}))}(t,n):r===L?f(t,L.error):void 0===r?h(t,n):e(r)?function(e,t,n){O((function(e){var r=!1,o=function(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}(n,t,(function(n){r||(r=!0,t!==n?d(e,n):h(e,n))}),(function(t){r||(r=!0,f(e,t))}),e._label);!r&&o&&(r=!0,f(e,o))}),e)}(t,n,r):h(t,n)}function d(e,t){e===t?f(e,new TypeError("You cannot resolve a promise with itself")):function(e){return"function"==typeof e||"object"==typeof e&&null!==e}(t)?l(e,t,u(t)):h(e,t)}function p(e){e._onerror&&e._onerror(e._result),m(e)}function h(e,t){e._state===D&&(e._result=t,e._state=j,0!==e._subscribers.length&&O(m,e))}function f(e,t){e._state===D&&(e._state=U,e._result=t,O(p,e))}function g(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+j]=n,o[i+U]=r,0===i&&e._state&&O(m,e)}function m(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,o=void 0,i=e._result,s=0;s<t.length;s+=3)r=t[s],o=t[s+n],r?v(n,r,o,i):o(i);e._subscribers.length=0}}function y(){this.error=null}function v(t,n,r,o){var i=e(r),s=void 0,a=void 0,c=void 0,u=void 0;if(i){if((s=function(e,t){try{return e(t)}catch(e){return q.error=e,q}}(r,o))===q?(u=!0,a=s.error,s=null):c=!0,n===s)return void f(n,new TypeError("A promises callback cannot return that same promise."))}else s=o,c=!0;n._state!==D||(i&&c?d(n,s):u?f(n,a):t===j?h(n,s):t===U&&f(n,s))}function b(e){e[M]=B++,e._state=void 0,e._result=void 0,e._subscribers=[]}function T(e,t){this._instanceConstructor=e,this.promise=new e(c),this.promise[M]||b(this.promise),E(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?h(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&h(this.promise,this._result))):f(this.promise,new Error("Array Methods must be provided an Array"))}function w(e){this[M]=B++,this._result=this._state=void 0,this._subscribers=[],c!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof w?function(e,t){try{t((function(t){d(e,t)}),(function(t){f(e,t)}))}catch(t){f(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}var E=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},S=0,R=void 0,C=void 0,O=function(e,t){k[S]=e,k[S+1]=t,2===(S+=2)&&(C?C(i):N())},I="undefined"!=typeof window?window:void 0,A=I||{},P=A.MutationObserver||A.WebKitMutationObserver,_="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),x="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,k=new Array(1e3),N=void 0;N=_?function(){return t.nextTick(i)}:P?function(){var e=0,t=new P(i),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}():x?function(){var e=new MessageChannel;return e.port1.onmessage=i,function(){return e.port2.postMessage(0)}}():void 0===I?function(){try{var e=n(21);return void 0!==(R=e.runOnLoop||e.runOnContext)?function(){R(i)}:o()}catch(e){return o()}}():o();var M=Math.random().toString(36).substring(16),D=void 0,j=1,U=2,L=new y,q=new y,B=0;return T.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===D&&n<e;n++)this._eachEntry(t[n],n)},T.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===a){var o=u(e);if(o===s&&e._state!==D)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===w){var i=new n(c);l(i,e,o),this._willSettleAt(i,t)}else this._willSettleAt(new n((function(t){return t(e)})),t)}else this._willSettleAt(r(e),t)},T.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===D&&(this._remaining--,e===U?f(r,n):this._result[t]=n),0===this._remaining&&h(r,this._result)},T.prototype._willSettleAt=function(e,t){var n=this;g(e,void 0,(function(e){return n._settledAt(j,t,e)}),(function(e){return n._settledAt(U,t,e)}))},w.all=function(e){return new T(this,e).promise},w.race=function(e){var t=this;return new t(E(e)?function(n,r){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(n,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})},w.resolve=a,w.reject=function(e){var t=new this(c);return f(t,e),t},w._setScheduler=function(e){C=e},w._setAsap=function(e){O=e},w._asap=O,w.prototype={constructor:w,then:s,catch:function(e){return this.then(null,e)}},w.polyfill=function(){var e=void 0;if(void 0!==r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=w},w.Promise=w,w}))}).call(t,n(12),n(4))},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(e){if(u===setTimeout)return setTimeout(e,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function i(){f&&p&&(f=!1,p.length?h=p.concat(h):g=-1,h.length&&s())}function s(){if(!f){var e=o(i);f=!0;for(var t=h.length;t;){for(p=h,h=[];++g<t;)p&&p[g].run();g=-1,t=h.length}p=null,f=!1,function(e){if(l===clearTimeout)return clearTimeout(e);if((l===r||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{l(e)}catch(t){try{return l.call(null,e)}catch(t){return l.call(this,e)}}}(e)}}function a(e,t){this.fun=e,this.array=t}function c(){}var u,l,d=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:n}catch(e){u=n}try{l="function"==typeof clearTimeout?clearTimeout:r}catch(e){l=r}}();var p,h=[],f=!1,g=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new a(e,t)),1!==h.length||f||o(s)},a.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.prependListener=c,d.prependOnceListener=c,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(3),i=n(1),s=n(0),a=function(e){this.id=e,this.status=200,this.headers={},this.body=""};t.ResponseData=a,function(e){e.Connected="trouter_js_client_connected",e.Disconnected="trouter_js_client_disconnected",e.Error="trouter_js_client_error",e.Progress="trouter_js_client_progress",e.Response="trouter_js_client_response",e.Request="trouter_js_client_request",e.CheckConnection="trouter_js_client_check_connection",e.Registration="trouter_js_client_registration",e.Unregistration="trouter_js_client_unregistration"}(r=t.ClientEventName||(t.ClientEventName={}));var c=function(e,t,n,r,o){this.stepName=e,this.operation=t,this.delta=n,this.ts=r,this.error=o};t.TrackerStep=c;var u=function(){};t.Properties=u;var l=function(){this.numberOfPingReplies=0,this.connectedTimestamp=0,this.isNewUrl=!1,this.transportType="",this.connectionNumber=0},d=function(){this.enabled=!1,this.numberOfStepsToMaintain=40,this.logHealthCheckError=!1,this.sendProgressTimeoutSecs=55,this.logSendPingError=!1,this.maxBackoffInMs=12e4,this.trouter_js_client_connected=!1,this.trouter_js_client_disconnected=!1,this.trouter_js_client_error=!1,this.trouter_js_client_progress=!1,this.trouter_js_client_response=!1,this.trouter_js_client_request=!1,this.trouter_js_client_registration=!1,this.trouter_js_client_unregistration=!1,this.trouter_js_client_check_connection=!0},p=function(){function e(e,t,n,r,i,a,c){this.clientId=t,this.clientInfo=n,this.getServerState=r,this.endpointId=i,this.clientCorrelationID=a,this.environment=c,this.logger=new s.Logger("ConnectionTracker",e),this.clientCorrelationID=void 0!==a?a:"",this.steps=[],this.connectionAttempt=0,this.totalStepCount=0,this.beginTimestamp=new o.Timespan,this.eventLogSettings=new d,this.connectedInfo=new l}return e.prototype.enable=function(e){this.eventLogSettings.enabled=!0,this.eventLogger=e},e.prototype.disable=function(){this.eventLogSettings.enabled=!1},e.prototype.sendProgress=function(e){this.steps.length>0&&this.sendTelemetry(r.Progress,e,this.steps)},e.prototype.cancelProgressTimer=function(){void 0!==this.progressTimeout&&(clearTimeout(this.progressTimeout),this.progressTimeout=void 0)},e.prototype.resetProgressSendTimer=function(){var e=this;this.cancelProgressTimer(),void 0!==this.eventLogSettings.sendProgressTimeoutSecs&&this.eventLogSettings.sendProgressTimeoutSecs>0&&(this.progressTimeout=setTimeout((function(){e.sendProgress({reason:"timeout",timeoutSecs:e.eventLogSettings.sendProgressTimeoutSecs})}),1e3*this.eventLogSettings.sendProgressTimeoutSecs))},e.prototype.setConnectedInfo=function(e,t){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=Date.now(),this.connectedInfo.isNewUrl=e,this.connectedInfo.transportType=t,++this.connectedInfo.connectionNumber},e.prototype.clearConnectedInfo=function(){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=0,this.connectedInfo.isNewUrl=!0,this.connectedInfo.transportType=""},e.prototype.copyProperties=function(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var o=r[n];t.hasOwnProperty(o)&&void 0!==t[o]&&(e[o.replace(/-/g,"_")]={value:t[o]})}},e.prototype.increasePingResponseCount=function(){++this.connectedInfo.numberOfPingReplies},e.prototype.sendTelemetry=function(e,t,n){try{if(!0===this.eventLogSettings.enabled&&!0===this.eventLogSettings[e]&&void 0!==this.eventLogger){var r=this.getServerState(),s={name:e,properties:{connectionAttempt:{value:this.connectionAttempt},epid:{value:this.endpointId},clientCorrelationID:{value:this.clientCorrelationID},steps:{value:o.toJson(n)},clientID:{value:this.clientId},eventVersion:{value:3},environment:{value:this.environment},cv:{value:i.CLIENT_VERSION},ua:{value:this.clientInfo.ua},connectionId:{value:r.connectionId},connectedClientId:{value:r.connectedClientId},domId:{value:r.domId},url:{value:r.unsecureUrl},surl:{value:r.url},ttlInSecs:{value:r.getRemainingTtlInSec()},numberOfPingReplies:{value:this.connectedInfo.numberOfPingReplies},connectedTimestamp:{value:this.connectedInfo.connectedTimestamp},isNewUrl:{value:this.connectedInfo.isNewUrl},transportType:{value:this.connectedInfo.transportType},connectionNumber:{value:this.connectedInfo.connectionNumber}}};this.copyProperties(s.properties,t),this.eventLogger.logEvent(s)}}catch(t){this.logger.warn("error in sending event "+e+": "+o.toJson(t))}},e.prototype.createStep=function(e,t,n){return new c(e,t,this.beginTimestamp.duration,Date.now(),n)},e.prototype.addStep=function(e,t,n){if(!1!==this.eventLogSettings.enabled&&(0===this.steps.length&&this.beginTimestamp.reset(),this.steps.push(this.createStep(e,t,n)),++this.totalStepCount,void 0!==this.eventLogSettings.numberOfStepsToMaintain&&this.steps.length>this.eventLogSettings.numberOfStepsToMaintain)){var o=this.steps.slice(0);this.steps.length=0,this.sendTelemetry(r.Progress,{reason:"flush"},o)}},e.prototype.trackStart=function(e){this.addStep(e,"start")},e.prototype.trackEnd=function(e){this.addStep(e,"end")},e.prototype.trackError=function(e,t,n,o){void 0===n&&(n=!0),"health"===e&&!0!==this.eventLogSettings.logHealthCheckError||"ping"===e&&!1===this.eventLogSettings.logSendPingError||(void 0===o&&(o="error"),!0===n&&this.addStep(e,o,t),this.sendTelemetry(r.Error,{},[this.createStep(e,o,t)]))},e.prototype.trackProgress=function(e,t){this.addStep(e,t)},e.prototype.trackConnected=function(e,t){this.setConnectedInfo(e,t);var n=this.steps.slice(0),o=this.totalStepCount,i=this.beginTimestamp.duration;this.steps.length=0,this.totalStepCount=0,this.sendTelemetry(r.Connected,{stepCount:n.length,totalStepCount:o,connectionEstablishmentMs_Total:i},n),this.cancelProgressTimer()},e.prototype.trackDisconnected=function(e){e.sessionLengthMS=Date.now()-this.connectedInfo.connectedTimestamp,this.sendTelemetry(r.Disconnected,e,[]),this.resetProgressSendTimer()},e.prototype.trackNewConnection=function(){++this.connectionAttempt},e.prototype.trackRequest=function(e,t){var n={};void 0!==t&&(n.hasError=!0,n.error=t);try{if(e){n.requestID=e.id,n.httpMethod=e.method,n.url=e.url,n.bodyLength=e.body.length,n.shortUrl=e.shortUrl,n.requestTimeStamp=e.startTS,n.correlationVector=e.correlationVector;for(var i=e.headers,s=0,a=Object.keys(i);s<a.length;s++){var c=a[s];i.hasOwnProperty(c)&&(n[c]=i[c])}}}catch(e){n.hasError=!0,n.error=n.error+" error creating request context "+o.toJson(e)}this.sendTelemetry(r.Request,n,[])},e.prototype.trackResponse=function(e,t,n,i){var s={};void 0!==i&&(s.hasError=!0,s.error=i);try{if(s.responseTimestamp=void 0!==n?n.sentTS:Date.now(),e){s.requestID=e.id,s.httpMethod=e.method,s.shortUrl=e.shortUrl,s.correlationVector=e.correlationVector;for(var a=e.headers,c=0,u=Object.keys(a);c<u.length;c++){var l=u[c];a.hasOwnProperty(l)&&(s[l]=a[l])}}n&&(s.latencyMS=t,s.responseCode=n.status,s.responseLength=n.body.length)}catch(e){s.hasError=!0,s.error=s.error+" error creating response context "+o.toJson(e)}this.sendTelemetry(r.Response,s,[])},e.prototype.sendResponseError=function(e,t,n){this.trackResponse(t,void 0,n,e)},e.prototype.close=function(){this.sendProgress({reason:"closed"}),this.steps.length=0,this.cancelProgressTimer()},e.prototype.mergeSettings=function(e){if(e){this.eventLogSettings.numberOfStepsToMaintain=Math.min(40,Math.max(10,void 0!==e.numberOfStepsToMaintain?e.numberOfStepsToMaintain:0));var t=Math.min(3600,Math.max(55,void 0!==e.sendProgressTimeoutSecs?e.sendProgressTimeoutSecs:0));this.eventLogSettings.logHealthCheckError=e.logHealthCheckError,this.eventLogSettings.logSendPingError=e.logSendPingError;for(var n=0,o=Object.keys(r).map((function(e){return r[e]}));n<o.length;n++){var i=o[n];e.hasOwnProperty(i)&&void 0!==e[i]&&(this.eventLogSettings[i]=e[i])}this.eventLogSettings.sendProgressTimeoutSecs!==t&&(this.eventLogSettings.sendProgressTimeoutSecs=t,this.resetProgressSendTimer())}},e}();t.ConnectionTracker=p},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.logger=e,this.maxBackoffInMs=t,this.backoffId=0,this.backoffCount=0}return e.calculateNextBackoffMs=function(e,t){var n=1+.4*(Math.random()-.5),r=1e3*Math.pow(2,e)*n;return r=Math.round(r),Math.min(t,r)},e.prototype.setMaxBackoffMs=function(e){this.maxBackoffInMs=e},e.prototype.backoff=function(t,n){var r=this;void 0!==this.timerHandle&&(this.logger.debug("Clearing current back off"),clearTimeout(this.timerHandle),this.timerHandle=void 0);var o=e.calculateNextBackoffMs(this.backoffCount,this.maxBackoffInMs);this.backoffId++,this.backoffCount++,this.logger.info("Backing off "+t+" for "+o+" milliseconds with ID "+this.backoffId),this.timerHandle=setTimeout((function(){r.logger.info("Back off for "+t+" with ID "+r.backoffId+" complete, invoking handler"),r.timerHandle=void 0,n()}),o)},e.prototype.reset=function(){void 0!==this.timerHandle&&(this.logger.debug("Resetting back off"),clearTimeout(this.timerHandle),this.timerHandle=void 0),this.backoffCount=0},e}();t.ExponentialBackoff=r},function(e,t,n){var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e};Object.defineProperty(t,"__esModule",{value:!0});var o=n(20),i=n(11),s=n(3),a=n(14),c=n(1),u=n(15),l=n(2),d=n(5),p=n(0),h=n(17),f=n(10),g=function(){this.cv=c.CLIENT_VERSION,this.ua="",this.hr="",this.v=""},m=function(){this["force new connection"]=!0,this.reconnect=!1,this.query="",this.ackTimeoutMs=5e3},y="MS-CV",v=function(){function e(e){this.cvCounter=0;var t=JSON.parse(e);this.startTS=t.hasOwnProperty("startTS")?t.startTS:0,this.url=t.hasOwnProperty("url")?t.url:"",this.shortUrl=t.hasOwnProperty("shortUrl")?t.shortUrl:"",this.body=t.hasOwnProperty("body")?t.body:"",this.headers=t.hasOwnProperty("headers")?t.headers:{},this.id=t.hasOwnProperty("id")&&"number"==typeof t.id?t.id:-1,this.method=t.hasOwnProperty("method")?t.method:"",this.replied=!1,this.timedout=!1,this.timeoutTimerId=0,this.receivedCv=this.headers[y],this.updateCvHeader()}return Object.defineProperty(e.prototype,"correlationVector",{get:function(){return this.receivedCv?this.receivedCv+"."+this.cvCounter:""},enumerable:!0,configurable:!0}),e.prototype.on=function(e,t){"data"===e?this.dataCallback=t:"end"===e&&("function"==typeof this.dataCallback&&this.dataCallback(this.body),t())},e.prototype.incrementCorrelationVector=function(){++this.cvCounter,this.updateCvHeader()},e.prototype.updateCvHeader=function(){var e=this.correlationVector;e&&(this.headers[y]=e)},e}(),b=function(){function e(e,t,n){this.request=e,this.responseData=t,this.sendResponse=n}return e.prototype.writeHead=function(e,t){this.responseData.status=e,this.responseData.headers=t},e.prototype.write=function(e){this.responseData.body+=e},e.prototype.end=function(e){return e&&(this.responseData.body+=e),this.sendResponse(this.request,this.responseData)},e}(),T=function(e){this.name=e,this.args={},this.timeoutTimerId=0},w=function(){function e(e,t,n,r,i){var s=this;this.options=t,this.manager=n,this.tokenProvider=r,this.connectionId="",this.inIncallMode=!1,this.connectionAttempt=0,this.connectedClientId="",this.c2cUrlBase="",this.pendingTimers={},this.lastDisconnectReason="",this.UNKNOWN_TRANSPORT="unknown_transport",this.logger=new p.Logger("Connection",e),this.timeoutOptions=this.options.timeoutOptions,this.healthBackoff=new u.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.tokenBackoff=new u.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.clientID=Date.now(),"undefined"!=typeof window&&window.location&&(this.domId=window.location.hostname),this.clientInfo=new g,this.clientInfo.cv=c.CLIENT_VERSION,this.clientInfo.ua="",this.options&&this.options.clientInfo&&(this.clientInfo.ua=this.safeString(this.options.clientInfo.ua),this.clientInfo.v=this.safeString(this.options.clientInfo.v)),this.connectionTracker=new a.ConnectionTracker(e,this.clientID,this.clientInfo,(function(){return s.getServerState()}),this.options.endpointId,this.options.clientCorrelationID,this.options.environment),this.applyConnectionTrackerOptions(t);var l=this.options.incallModeTimeoutMs>0;if(this.fsm=new h.TrouterFsm(e,this,l),t.registration){var d={registrarUrl:t.registration.registrarUrl,registrationId:t.registration.registrationId,requestTimeoutMs:t.timeoutOptions.fetchTimeoutMs,initialRetryDelayMs:1e3,maxRetryDelayMs:t.timeoutOptions.maxBackoffMs};this.registrarClient=o.createRegistrarClient(e,this.tokenProvider,d)}this.userActivityState=i}return e.prototype.start=function(e){this.logger.info("Starting"),this.externalConnectParams=e,this.fsm.start()},e.prototype.stop=function(e){this.logger.info("Stopping"),this.connectionTracker.close(),this.fsm.stop(e)},e.prototype.configure=function(e){var t=this.options.trouterUrl!==e.trouterUrl;this.options=e,this.applyConnectionTrackerOptions(e),t&&this.onTrouterReconnect()},e.prototype.checkConnection=function(e){this.logger.info("checkConnection called with "+e),this.fsm.checkConnection(e),e&&this.connectionTracker.sendTelemetry(a.ClientEventName.CheckConnection,{disconnectDetected:e},[])},e.prototype.getServerState=function(){return new d.ServerState(this.connectionId,this.connectedClientId,this.domId?this.domId:"",this.allocateResult?this.allocateResult.url:"",this.allocateResult?this.allocateResult.surl:"",this.c2cUrlBase,this.connectionExpireTimestampInSecs)},e.prototype.getToken=function(e,t){var n=this;this.logger.info("Getting token "+(t?"with backoff":"without backoff"));var r=function(){n.connectionTracker.trackStart("token"),n.tokenProvider(!e).then((function(e){n.logger.debug("token is received"),n.connectionTracker.trackEnd("token"),n.fsm.onTokenReceived(e)})).catch((function(t){var r=s.toJson(t.stack);n.logger.error("Getting token failed, will retry after timeout. Error: "+r),n.connectionTracker.trackError("token",r),n.getToken(e,!0)}))};t?this.tokenBackoff.backoff("getting token",r):(this.tokenBackoff.reset(),r())},e.prototype.startConnectionTimer=function(){var e=this;this.stopConnectionTimer(),this.logger.debug("Starting connection timeout for "+this.timeoutOptions.connectionTimeoutMs+" ms"),this.connectionTimeoutId=setTimeout((function(){e.logger.info("Connection timeout is fired"),e.fsm.onConnectingTimeout()}),this.timeoutOptions.connectionTimeoutMs)},e.prototype.stopConnectionTimer=function(){this.connectionTimeoutId&&(this.logger.debug("Stopping connection timeout"),clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=void 0)},e.prototype.startPingTimer=function(){var e=this;"websocket"===this.transportTypeName?(this.logger.debug("Starting ping timeout for "+this.timeoutOptions.pingTimeoutMs+" ms"),this.pingTimerId=setInterval((function(){e.logger.info("Ping interval fired"),e.fsm.onPingInterval()}),this.timeoutOptions.pingTimeoutMs)):this.logger.debug("Not starting ping for transport "+this.transportTypeName)},e.prototype.stopPingTimer=function(){this.pingTimerId&&(this.logger.debug("Stopping ping timeout"),this.clearPingResponseTimer(),clearInterval(this.pingTimerId),this.pingTimerId=void 0)},e.prototype.shouldSkipRegistration=function(){return void 0===this.options.registration},e.prototype.hasCustomRegisterTtl=function(){return this.options.registration&&this.options.registration.registrarTtlSec},e.prototype.startRegisterTimer=function(){var e=this;void 0!==this.registrationTimerId&&this.stopRegisterTimer();var t=this.getRegistrationTtl()-30;this.logger.debug("Starting registration timeout for "+t+" sec"),this.registrationTimerId=setTimeout((function(){e.logger.info("Registration timeout is fired"),e.registrationTimerId=setTimeout((function(){e.registrationTimerId=void 0,e.logger.debug("Re-registration did not happen in time"),e.dispatchUnregistered()}),3e4),e.fsm.onRegistrationTimeout()}),1e3*t)},e.prototype.stopRegisterTimer=function(){this.registrationTimerId&&(this.logger.debug("Stopping registration timeout"),clearTimeout(this.registrationTimerId),this.registrationTimerId=void 0)},e.prototype.resendRegistration=function(){if(!this.registrarClient)throw new Error("Trouter Client not configured to handle registrations");return this.registrarClient.resendRegistration()},e.prototype.buildSocketIoUrlParams=function(){if(!this.allocateResult)throw new Error("Allocate result is undefined in buildSocketIoUrlParams()");var e={};if(this.allocateResult.connectparams)for(var t=this.allocateResult.connectparams,n=0,r=Object.keys(t);n<r.length;n++){var o=r[n];t.hasOwnProperty(o)&&void 0!==t[o]&&(e[o]=t[o])}return e.v="v4",e.tc=encodeURI(s.toJson(this.clientInfo)),e.timeout=this.timeoutOptions.pingTimeoutMs/1e3,e.auth="true",this.options.endpointId&&(e.epid=this.options.endpointId),this.userActivityState.state!==l.UserActivityState.Unknown&&(e.userActivity=encodeURI(s.toJson(this.userActivityState.toEventObject()))),this.appendConnectedClientIds(this.buildQuery(e),!0)},e.prototype.startSocketIo=function(){var e=this;if(this.logger.info("Starting socket io"),this.connectionTracker.trackStart("connectSocket"),!this.allocateResult)throw new Error("Allocate result is undefined in startSocketIo()");var t=this.options.ioOptions||new m;if(t["force new connection"]=!0,t.reconnect=!1,t.query=this.buildSocketIoUrlParams(),this.logger.info("connecting to "+this.allocateResult.socketio+"?"+t.query),this.stopSocketIo(),this.socket=(this.options.io||f).connect(this.allocateResult.socketio,t),void 0===this.socket)throw new Error("Can't create Socket.io object");this.socket.on("connecting",(function(t){e.onSocketConnecting(t)})),this.socket.on("connect",(function(){e.onSocketConnect()})),this.socket.on("connect_failed",(function(t){e.onSocketConnectFailed(t)})),this.socket.on("disconnect",(function(t){e.onSocketDisconnect(t)})),this.socket.on("reconnect",(function(){e.onSocketReconnect()})),this.socket.on("reconnect_failed",(function(t){e.onSocketReconnectFailed(t)})),this.socket.on("reconnecting",(function(){e.onSocketReconnecting()})),this.socket.on("error",(function(t){e.onSocketError(t)})),this.socket.on("message",(function(t){e.onSocketMessage(t)})),this.socket.on("trouter.connected",(function(t){e.onTrouterConnected(t)})),this.socket.on("trouter.reconnect",(function(){e.onTrouterReconnect()})),this.socket.on("trouter.message_loss",(function(t){e.onTrouterMessageLoss(t)}))},e.prototype.stopSocketIo=function(){if(this.socket){this.logger.info("clearing socket.io");try{for(var e=0,t=["connecting","connect","connect_failed","disconnect","reconnect","reconnect_failed","reconnecting","error","message","trouter.connected","trouter.reconnect","trouter.message_loss"];e<t.length;e++){var n=t[e];this.socket.removeAllListeners(n)}this.socket.disconnect(),this.logger.debug("cleared socket"),this.socket=void 0}catch(e){this.logger.error("exception in disconnecting previous socket. Error: "+s.toJson(e.stack))}}},e.prototype.dispatchConnected=function(){this.logger.info("dispatching connected"),this.manager.onConnected(this)},e.prototype.dispatchRegistered=function(){this.logger.info("dispatching registered"),this.manager.onRegistered(this)},e.prototype.dispatchUnregistered=function(){this.logger.info("dispatching unregistered"),this.manager.onUnregistered(this)},e.prototype.dispatchDownstreamRequest=function(e){var t=this;this.logger.info("dispatching downstream request");try{var n=new b(e,new a.ResponseData(e.id),(function(e,n){return t.logger.info("sending response to downstream"),t.sendResponse(e,n)}));this.manager.onDownstreamRequest(this,e,n)}catch(e){this.logger.error("exception in socket.on message. Error : "+s.toJson(e.stack))}},e.prototype.dispatchReconnecting=function(){this.logger.info("dispatching reconnecting"),this.manager.onReconnecting(this)},e.prototype.dispatchReconnectIsRequired=function(){this.logger.info("dispatching reconnect is required by server"),this.manager.onReconnectIsRequired(this)},e.prototype.dispatchDisconnected=function(){this.logger.info("dispatching disconnected"),this.manager.onDisconnected(this)},e.prototype.dispatchTrouterMessageLost=function(e){this.logger.info("dispatching trouter lost message"),this.manager.onTrouterMessageLost(e)},e.prototype.sendProcessedDroppedIndicators=function(e){var t=this;try{this.logger.info("emitting processed flow tags to the server");var n=new T("trouter.processed_message_loss");n.args={droppedIndicators:e},this.sendDownstreamEvent(n,(function(){t.logger.info("emitted processed flow tags to the server")}))}catch(e){var r=s.toJson(e.stack);this.logger.error("unable to send processed message loss event. Error: "+r),this.connectionTracker.trackError("trouter.processed_message_loss",r,!1)}},e.prototype.resetAllocationConnectionParams=function(){this.allocateResult&&(this.logger.info("Resetting allocation connection parameters"),this.allocateResult.connectparams=void 0)},e.prototype.sendAllocateRequest=function(e){var t=this;this.connectionAttempt++,this.connectionTracker.trackNewConnection();var n=this.options.trouterUrl,o=n,i=this.allocateResult&&this.allocateResult.connectparams;if(!i){var s=this.externalConnectParams;s&&s.se&&parseInt(s.se,10)<=Date.now()+36e5&&(this.logger.warn("Dropping expired cached connection parameters: "+new Date(parseInt(s.se,10))),this.externalConnectParams=s=void 0),s&&s.serviceUrl!==o&&(this.logger.warn("Dropping cached connection parameters for a different environment ("+s.serviceUrl+", now "+o+")"),this.externalConnectParams=s=void 0),s&&s.reconnectUrl?(o=s.reconnectUrl,i=r({},s,{reconnectUrl:void 0})):i=s}o=this.appendCorrelationIds(o,!1),o=this.appendEndpointId(o,!1),i&&(o+="&"+this.buildQuery(i),i.v||(o+="&v=v4"));var a=new Request(o,{method:"POST",mode:"cors",headers:new Headers({"X-Skypetoken":e,"Content-Type":"text/plain"})});this.logger.info("sendAllocateRequest: POST "+o),this.connectionTracker.trackStart("allocation");var c=-1;this.fetchWithTimeout(a,this.timeoutOptions.fetchTimeoutMs).then((function(e){if(c=e.status,!e.ok)throw new Error(e.statusText);var n=e.headers.get("content-type");if(!n||"application/json"!==n&&"application/json;"!==n.substring(0,17))throw new Error("Content-type '"+n+"' is unexpected");return t.connectionTracker.trackEnd("allocation"),e.json()})).then((function(e){t.onAllocationResponse(e,n)})).catch((function(e){var n=e+", status code "+c;t.logger.error("Allocation request failed. Error: "+n),t.connectionTracker.trackError("allocation",n),t.externalConnectParams&&t.connectionAttempt>2&&(c>=400&&c<=599?(t.logger.warn(t.connectionAttempt+" connection attempts, server-side failure: erasing external connection parameters"),t.externalConnectParams=void 0):t.externalConnectParams.reconnectUrl&&(t.logger.warn(t.connectionAttempt+" connection attempts, erasing reconnect URL"),delete t.externalConnectParams.reconnectUrl)),t.fsm.onAllocationFailed(401===c)}))},e.prototype.sendPingRequest=function(){var e=this;if(this.socket&&void 0===this.pingResponseTimerId)try{this.logger.info("emitting ping event"),this.socket.emit("ping",(function(){e.onPingResponse()})),this.pingResponseTimerId=setTimeout((function(){e.logger.error("Ping response timeout is fired"),e.clearPingResponseTimer(),e.fsm.onPingResponseTimeout()}),this.timeoutOptions.pongTimeoutMs)}catch(e){var t=s.toJson(e.stack);this.logger.error("unable to send ping. Error: "+t),this.connectionTracker.trackError("ping",t,!1)}},e.prototype.setUserActivityState=function(e){var t=e.state!==this.userActivityState.state;this.userActivityState=e,this.fsm.onSetUserActivityState(e,t)},e.prototype.sendUserActivityState=function(e,t){this.userActivityState.state!==l.UserActivityState.Unknown&&("websocket"===this.transportTypeName&&t?e===d.UserActivityEventReason.Connected?this.sendUserActivityStateMultiple(2):this.sendUserActivityStateMultiple(1):"xhr-polling"===this.transportTypeName&&e===d.UserActivityEventReason.Modified&&this.fsm.forceReconnect())},e.prototype.sendRegisterRequest=function(){var e=this;if(!this.options.registration||!this.registrarClient)throw new Error("Internal error - options.registration is undefined");if(!this.allocateResult)throw new Error("Allocate result is undefined in sendRegisterRequest()");this.logger.info("sending register request");var t=new s.Timespan;this.connectionTracker.trackStart("registration"),this.registrarClient.register({appId:this.options.registration.pnhAppId,aesKey:"",languageId:"en-US",platform:this.options.registration.platform,templateKey:this.options.registration.pnhTemplateKey,platformUIVersion:this.options.registration.platformUIVersion,productContext:this.options.registration.productContext},{TROUTER:[{context:this.options.registration.context,path:this.allocateResult.surl,ttl:this.getRegistrationTtl()}]}).then((function(){e.logger.info("Register request successful"),e.connectionTracker.trackEnd("registration"),e.fsm.onRegistrationSucceed(),e.connectionTracker.sendTelemetry(a.ClientEventName.Registration,{duration:t.duration},[])})).catch((function(n){e.logger.error("Register request failed. Error: "+n),e.connectionTracker.trackError("registration",n.message),e.fsm.onRegistrationFailed(!1),e.connectionTracker.sendTelemetry(a.ClientEventName.Registration,{duration:t.duration},[])}))},e.prototype.sendUnregisterRequest=function(){var e=this;this.logger.info("sending unregister request");var t=new s.Timespan;if(!this.options.registration||!this.registrarClient)throw new Error("Internal error - options.registration is undefined");this.connectionTracker.trackStart("unregistration"),this.registrarClient.unregister().then((function(){e.logger.info("Unregister request successful"),e.connectionTracker.trackEnd("unregistration"),e.fsm.onUnregistrationSucceed(),e.connectionTracker.sendTelemetry(a.ClientEventName.Unregistration,{duration:t.duration},[])})).catch((function(n){e.logger.error("Unregister request failed. Error: "+n),e.connectionTracker.trackError("unregistration",n.message),e.fsm.onUnregistrationFailed(!1),e.connectionTracker.sendTelemetry(a.ClientEventName.Unregistration,{duration:t.duration},[])}))},e.prototype.fetchWithTimeout=function(e,t){return new i.Promise((function(n,r){fetch(e).then(n).catch(r),0!==t&&setTimeout(r,t,new Error("Fetch for '"+e.url+"' timed out"))}))},e.prototype.resetTokenBackoff=function(){this.tokenBackoff.reset()},e.prototype.resetRegisterBackoff=function(){this.registrarClient&&this.registrarClient.cancelPendingRequests()},e.prototype.clearTimers=function(){this.logger.debug("Clearing all pending downstream events related timers");for(var e=0,t=Object.keys(this.pendingTimers);e<t.length;e++){var n=t[e];this.clearTimer(Number(n))}},e.prototype.restartIncallModeTimer=function(){var e=this;this.clearIncallModeTimerId(),this.logger.debug("Restarting incall mode timer"),this.incallModeTimerId=setTimeout((function(){e.logger.info("Call mode timer fired"),e.fsm.onIncallModeTimer()}),this.options.incallModeTimeoutMs)},e.prototype.enterIncallMode=function(){this.logger.info("Entering incall mode"),this.timeoutOptions=this.options.incallTimeoutOptions,this.healthBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!0},e.prototype.exitIncallMode=function(){this.logger.info("Exiting incall mode"),this.clearIncallModeTimerId(),this.timeoutOptions=this.options.timeoutOptions,this.healthBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!1},e.prototype.isIncallMode=function(){return this.inIncallMode},e.prototype.onSocketConnecting=function(e){this.logger.info("onSocketConnecting("+e+")"),this.transportTypeName=e,this.connectionTracker.trackProgress("connecting",this.transportTypeName),this.fsm.onConnecting()},e.prototype.onSocketConnect=function(){this.logger.info("onSocketConnect")},e.prototype.onSocketConnectFailed=function(e){this.logger.error("onSocketConnectFailed"),this.connectionTracker.trackError("connect_failed",e,!0,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),this.fsm.onConnectingFailed()},e.prototype.onSocketDisconnect=function(e){this.logger.error("onSocketDisconnect, reason: "+e);var t={reason:e,serverClosed:!this.fsm.isActive()};this.connectionTracker.trackDisconnected(t),this.connectionTracker.clearConnectedInfo();var n=t.sessionLengthMS||0;"dup"===e&&"dup"===this.lastDisconnectReason&&n<this.options.duplicateDisconnectThresholdMs&&(this.logger.warn("Socket was closed by server as Duplicate for the second time in a row after "+n+" ms which is below the threshold of "+this.options.duplicateDisconnectThresholdMs+" ms. Resetting cached connection parameters and making a new allocation."),this.resetAllocationConnectionParams()),this.lastDisconnectReason=e,this.fsm.onSocketError(void 0),this.connectionExpireTimestampInSecs=void 0},e.prototype.onSocketReconnect=function(){this.logger.error("onSocketReconnect"),this.fsm.onTrouterConnected()},e.prototype.onSocketReconnectFailed=function(e){this.logger.error("onSocketReconnectFailed with '"+e+"'"),this.fsm.onSocketError("string"==typeof e?e:void 0)},e.prototype.onSocketReconnecting=function(){this.logger.error("onSocketReconnecting")},e.prototype.onSocketError=function(e){this.logger.error("onSocketError with '"+s.toJson(e)+"'"),this.connectionTracker.trackError("connectSocket",e),this.fsm.onSocketError("string"==typeof e?e:void 0)},e.prototype.onSocketMessage=function(e){var t,n=this;this.logger.info("onSocketMessage");try{var r=(t=new v(e)).headers&&t.headers["X-Microsoft-Skype-Chain-ID"],o=r?" Chain-Id "+r:"";this.logger.info("Received request N "+t.id+o+" CV "+t.correlationVector+" to '"+t.url+"'"),t.startTS=Date.now(),t.url&&this.urlPath&&0===t.url.indexOf(this.urlPath)&&(t.shortUrl=t.url.substring(this.urlPath.length))}catch(e){var i=s.toJson(e.stack);return this.logger.error("unable to parse request. Error: "+i),this.connectionTracker.trackRequest(void 0,i),void this.connectionTracker.sendResponseError("unable to parse request, error: "+e)}t.timeoutTimerId=setTimeout((function(){if(!t.replied){n.logger.error("Request "+t.id+" timed out");var e=new a.ResponseData(t.id);e.status=504,e.headers={"Trouter-Responder":"ClientLib"},n.sendResponse(t,e),t.timedout=!0}}),this.timeoutOptions.requestTimeoutMs);try{this.connectionTracker.trackRequest(t),this.fsm.onDownstreamRequest(t)}catch(e){this.logger.error("exception in socket.on message. Error: "+s.toJson(e.stack)),this.connectionTracker.sendResponseError(e.message,t,void 0)}},e.prototype.onTrouterConnected=function(e){if(this.allocateResult){this.logger.info("onTrouterConnected: "+this.allocateResult.url),this.socket&&this.socket.socket&&this.socket.socket.options&&this.socket.socket.options.query&&(this.socket.socket.options.query+="&connected=true"),this.urlPath=this.allocateResult.url.replace(/https?:\/\/([A-z0-9\:\$\-\_\.\+\!\*\"\(\)\,]*)\//,"/");var t=this.connectedUrl!==this.allocateResult.url;this.connectedUrl=this.allocateResult.url,this.connectionExpireTimestampInSecs=s.calculateExpireTsInSec(e.ttl),this.connectionTracker.trackEnd("connectSocket"),this.connectionTracker.trackConnected(t,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),this.fsm.onTrouterConnected()}else this.logger.error("Invalid internal state - received onTrouterConnected while allocateResult is not set")},e.prototype.onTrouterReconnect=function(){this.logger.info("onTrouterReconnect"),this.fsm.onReconnectRequired()},e.prototype.onTrouterMessageLoss=function(e){this.logger.info("onTrouterMessageLoss"),this.fsm.onTrouterMessageLost(e.droppedIndicators)},e.prototype.onAllocationResponse=function(e,t){this.logger.info("Received allocation response "+JSON.stringify(e)),this.allocateResult=e,this.externalConnectParams=void 0;var n=+e.ttl;if(this.connectionExpireTimestampInSecs=s.calculateExpireTsInSec(n),this.connectionId=this.allocateResult.id||"",this.connectedClientId=this.allocateResult.ccid,this.logger.info("connected client id set {connectedClientId:"+this.connectedClientId+"}"),this.c2cUrlBase=e.curlb||"",""===this.c2cUrlBase){var o=e.surl.indexOf("://");o>=0&&(o=e.surl.indexOf("/",o+3))>=5&&":3443"===e.surl.substr(o-5,5)&&(this.c2cUrlBase=e.surl.substr(0,o-5))}var i=r({serviceUrl:t,reconnectUrl:e.socketio+"v4/a"},e.connectparams);this.manager.onConnectionParametersUpdated(i),this.fsm.onAllocationSucceed()},e.prototype.onPingResponse=function(){this.logger.info("onPingResponse"),this.connectionTracker.increasePingResponseCount(),this.clearPingResponseTimer(),this.fsm.onPingResponse()},e.prototype.clearPingResponseTimer=function(){void 0!==this.pingResponseTimerId&&(clearTimeout(this.pingResponseTimerId),this.pingResponseTimerId=void 0)},e.prototype.buildQuery=function(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var o=r[n];e.hasOwnProperty(o)&&void 0!==e[o]&&t.push(o+"="+e[o])}return t.join("&")},e.prototype.appendConnectedClientIds=function(e,t){var n="";e.indexOf("ccid=")<0&&(n="ccid="+this.connectedClientId+"&"),this.domId&&(n+="dom="+this.domId+"&"),n.length>0&&(n=n.slice(0,-1));var r=t||-1!==e.indexOf("?")?"&":"?";return this.appendCorrelationIds(e+r+n,t)},e.prototype.appendEndpointId=function(e,t){var n=t||-1!==e.indexOf("?")?"&":"?";return e.indexOf("epid")<0&&this.options.endpointId?""+e+n+"epid="+this.options.endpointId:e},e.prototype.appendCorrelationIds=function(e,t){var n=t||-1!==e.indexOf("?")?"&":"?";return e.indexOf("cor_id")<0?""+e+n+"cor_id="+this.options.clientCorrelationID+"&con_num="+this.clientID+"_"+this.connectionAttempt:e},e.prototype.getHealthUrl=function(e){return e.substring(0,e.lastIndexOf("/a"))+"/h"},e.prototype.safeString=function(e){return"string"==typeof e?e:""},e.prototype.sendResponse=function(e,t){if(e.timedout)return this.logger.error("Request "+e.id+" already timed out"),1;if(e.replied)return this.logger.error("Response for request "+e.id+" already sent"),2;clearTimeout(e.timeoutTimerId),e.timeoutTimerId=0,e.replied=!0,t.headers=t.headers||{};var n=e.correlationVector;this.logger.info("Sending response for request N "+e.id+" CV "+n+" with status "+t.status),n&&(t.headers[y]=n),e.headers&&e.headers["trouter-request"]&&!t.headers["trouter-request"]&&(t.headers["trouter-request"]=e.headers["trouter-request"]);var r=Date.now()-e.startTS;if(t.headers["trouter-client"]=s.toJson({cd:r}),this.logger.debug("response: "+s.toJson(t)),!this.socket)return this.connectionTracker.sendResponseError("no socket",e,t),4;try{return this.socket.send(s.toJson(t)),t.sentTS=Date.now(),e.incrementCorrelationVector(),this.connectionTracker.trackResponse(e,r,t),"websocket"===this.transportTypeName&&this.sendPingRequest(),0}catch(n){var o="unable to send data on response.end. Error: "+s.toJson(n.stack);return this.logger.error(o),this.connectionTracker.sendResponseError(o,e,t),4}},e.prototype.sendUserActivityStateMultiple=function(e){var t=this,n=new T("user.activity"),r=this.userActivityState.toEventObject();n.args=r,this.userActivityState.correlationVector.increase(),this.logger.debug("Sending user activity '"+this.userActivityState.toEventJSON()+"', remaining "+(e-1)),this.sendDownstreamEvent(n,(function(){if(t.logger.info("User activity state: "+r.state+", cv: "+r.cv+" accepted"),t.manager.onUserActivityStateAccepted&&t.manager.onUserActivityStateAccepted(r.cv),t.clearTimer(n.timeoutTimerId),e>1){var o=setTimeout((function(){t.clearTimer(o),t.sendUserActivityStateMultiple(e-1)}),t.options.userActivitySecondResendDelayMs);t.registerTimer(o,"user.activity/resend")}})),n.timeoutTimerId=setTimeout((function(){t.logger.error("Activity state response timeout is fired"),t.fsm.onActivityStateResponseTimeout(),t.clearTimer(n.timeoutTimerId)}),this.timeoutOptions.userActivityResponseTimeoutMs),this.registerTimer(n.timeoutTimerId,"user.activity/response")},e.prototype.sendDownstreamEvent=function(e,t){this.logger.info("Sending downstream event "+e.name),this.socket&&this.socket.emit(e.name,e.args,t)},e.prototype.registerTimer=function(e,t){this.logger.debug("registering timer "+e+" -> "+t),this.pendingTimers[e]=t},e.prototype.clearTimer=function(e){var t=this.pendingTimers[e];this.logger.debug("clearing timer "+e+" -> "+t),delete this.pendingTimers[e],clearTimeout(e)},e.prototype.getRegistrationTtl=function(){var e=s.calculateTtlInSec(this.connectionExpireTimestampInSecs);return this.logger.debug("Current connectionID will expire in "+e+" seconds"),this.options.registration&&this.options.registration.registrarTtlSec&&e>0?Math.min(this.options.registration.registrarTtlSec,e):this.options.registration&&this.options.registration.registrarTtlSec?this.options.registration.registrarTtlSec:e>0?e:3600},e.prototype.clearIncallModeTimerId=function(){void 0!==this.incallModeTimerId&&(this.logger.debug("Clearing in-call mode timer"),clearTimeout(this.incallModeTimerId),this.incallModeTimerId=void 0)},e.prototype.applyConnectionTrackerOptions=function(e){try{e.eventLogger&&"function"==typeof e.eventLogger.logEvent?(this.connectionTracker.mergeSettings(e.telemetrySettings),this.connectionTracker.enable(e.eventLogger)):this.logger.warn("Trouter client event logging disabled due to invalid configuration.")}catch(e){this.logger.warn("Trouter client event logging disabled. Error: "+s.toJson(e.stack)),this.connectionTracker.disable()}},e}();t.TrouterConnection=w},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,o,i=n(5),s=n(0);!function(e){e[e.Initial=0]="Initial",e[e.RetrievingToken=1]="RetrievingToken",e[e.Allocating=2]="Allocating",e[e.Handshaking=3]="Handshaking",e[e.Connecting=4]="Connecting",e[e.Connected=5]="Connected",e[e.UnregisteringRetrievingToken=6]="UnregisteringRetrievingToken",e[e.Unregistering=7]="Unregistering"}(r=t.State||(t.State={})),function(e){e[e.Initial=0]="Initial",e[e.RetrievingToken=1]="RetrievingToken",e[e.Registering=2]="Registering",e[e.Registered=3]="Registered",e[e.NotRegistered=4]="NotRegistered"}(o||(o={}));var a=function(){function e(e,t,n){this.worker=t,this.incallModeEnabled=n,this.state=r.Initial,this.connectionErrors=0,this.logger=new s.Logger("ConnectionFsm",e),this.connectedSubstate=o.Initial}return e.prototype.getState=function(){return this.state},e.prototype.isActive=function(){return this.state===r.Allocating||this.state===r.Connected||this.state===r.Handshaking||this.state===r.Connecting||this.state===r.RetrievingToken},e.prototype.start=function(){return this.state===r.Initial?(this.setState(r.RetrievingToken),this.worker.getToken(!0,!1),!0):(this.showIgnored("start"),!1)},e.prototype.stop=function(e){e&&(this.connectedSubstate=o.Initial),this.worker.isIncallMode()&&this.worker.exitIncallMode(),this.worker.resetTokenBackoff(),this.worker.resetRegisterBackoff(),this.worker.stopConnectionTimer(),this.worker.stopPingTimer(),this.worker.clearTimers(),this.state!==r.Connecting&&this.state!==r.Handshaking&&this.state!==r.Connected||this.worker.stopSocketIo(),this.isRegistered()&&this.state!==r.UnregisteringRetrievingToken&&this.state!==r.Unregistering?(this.setState(r.UnregisteringRetrievingToken),this.worker.stopRegisterTimer(),this.worker.getToken(!0,!1)):(this.setState(r.Initial),this.worker.dispatchDisconnected())},e.prototype.onTokenReceived=function(e){this.state===r.RetrievingToken?(this.setState(r.Allocating),this.worker.startConnectionTimer(),this.worker.sendAllocateRequest(e)):this.state===r.Connected&&this.connectedSubstate===o.RetrievingToken?(this.connectedSubstate=o.Registering,this.worker.sendRegisterRequest()):this.state===r.UnregisteringRetrievingToken?(this.setState(r.Unregistering),this.worker.sendUnregisterRequest()):this.showIgnored("onTokenReceived")},e.prototype.checkConnection=function(e){e&&this.onPingInterval()},e.prototype.onAllocationSucceed=function(){return this.state===r.Allocating?(this.setState(r.Handshaking),this.connectedSubstate===o.Registered&&this.worker.dispatchUnregistered(),this.connectedSubstate=o.Initial,this.worker.startSocketIo(),!0):(this.showIgnored("onAllocationSucceed"),!1)},e.prototype.onAllocationFailed=function(e){this.state===r.Allocating?(this.setState(r.RetrievingToken),this.worker.stopConnectionTimer(),this.worker.getToken(!e,!0)):this.showIgnored("onAllocationFailed")},e.prototype.onConnectingTimeout=function(){this.state===r.Allocating||this.state===r.Connecting||this.state===r.Handshaking?(this.setState(r.RetrievingToken),this.resetAllocationIfNecessary(void 0),this.worker.stopSocketIo(),this.worker.getToken(!0,!1)):this.showIgnored("onConnectingTimeout")},e.prototype.onConnecting=function(){this.state===r.Handshaking?this.setState(r.Connecting):this.showIgnored("onConnecting")},e.prototype.onConnectingFailed=function(){this.state===r.Connecting?this.onConnectingTimeout():this.state===r.Handshaking?(this.logger.error("Unexpected error in Socket.io - no valid transports"),this.onConnectingTimeout()):this.showIgnored("onConnectingFailed")},e.prototype.onSocketError=function(e){this.state===r.Handshaking||this.state===r.Connected?(this.worker.stopSocketIo(),this.worker.stopPingTimer(),this.worker.clearTimers(),this.worker.stopConnectionTimer(),this.state!==r.Connected&&this.worker.resetAllocationConnectionParams(),this.setState(r.RetrievingToken),this.worker.dispatchReconnecting(),this.worker.getToken(!0,!1)):this.showIgnored("onSocketError")},e.prototype.onTrouterConnected=function(){this.state===r.Connecting?(this.setState(r.Connected),this.worker.resetTokenBackoff(),this.worker.stopConnectionTimer(),this.worker.sendUserActivityState(i.UserActivityEventReason.Connected,!0),this.worker.startPingTimer(),this.worker.dispatchConnected(),this.connectionErrors=0,this.worker.shouldSkipRegistration()?(this.connectedSubstate=o.NotRegistered,this.worker.dispatchRegistered()):(this.connectedSubstate=o.RetrievingToken,this.worker.getToken(!0,!1))):this.showIgnored("onTrouterConnected")},e.prototype.onReconnectRequired=function(){this.worker.dispatchReconnectIsRequired()},e.prototype.onDownstreamRequest=function(e){this.state===r.Connected?(this.switchToIncallModeIfEnabled(),this.worker.dispatchDownstreamRequest(e)):this.showIgnored("onDownstreamRequest")},e.prototype.onTrouterMessageLost=function(e){this.state===r.Connected?this.worker.dispatchTrouterMessageLost(e):this.showIgnored("onTrouterMessageLost")},e.prototype.onPingInterval=function(){this.state===r.Connected?this.worker.sendPingRequest():this.showIgnored("onPingInterval")},e.prototype.onPingResponseTimeout=function(){this.onMissedResponse("onPingResponseTimeout")},e.prototype.onPingResponse=function(){this.state===r.Connected||this.showIgnored("onPingResponse")},e.prototype.onRegistrationFailed=function(e){this.state===r.Connected&&this.connectedSubstate===o.Registering?(this.connectedSubstate=o.RetrievingToken,this.worker.getToken(!e,!0)):this.showIgnored("onRegistrationFailed")},e.prototype.onRegistrationSucceed=function(){this.state===r.Connected?(this.connectedSubstate===o.Registering&&(this.connectedSubstate=o.Registered,this.worker.dispatchRegistered()),this.worker.hasCustomRegisterTtl()&&this.worker.startRegisterTimer()):this.showIgnored("onRegistrationSucceed")},e.prototype.onRegistrationTimeout=function(){this.state===r.Connected&&this.connectedSubstate!==o.NotRegistered?(this.connectedSubstate=o.RetrievingToken,this.worker.getToken(!0,!1)):this.showIgnored("onRegistrationTimeout")},e.prototype.onUnregistrationFailed=function(e){this.state===r.Unregistering?(this.setState(r.UnregisteringRetrievingToken),this.worker.getToken(!e,!e)):this.showIgnored("onUnregistrationFailed")},e.prototype.onUnregistrationSucceed=function(){this.state===r.Unregistering?(this.setState(r.Initial),this.worker.dispatchUnregistered(),this.worker.dispatchDisconnected()):this.showIgnored("onUnregistrationSucceed")},e.prototype.onIncallModeTimer=function(){this.worker.exitIncallMode(),this.state===r.Connected?(this.worker.stopPingTimer(),this.worker.startPingTimer()):this.showIgnored("onIncallModeTimer")},e.prototype.onSetUserActivityState=function(e,t){t?(this.logger.info("Changing user activity state to '"+e.toEventJSON()+"'"),this.worker.sendUserActivityState(i.UserActivityEventReason.Modified,this.state===r.Connected)):this.logger.debug("Not changing the same user activity state '"+e.toEventJSON()+"'")},e.prototype.onActivityStateResponseTimeout=function(){this.onMissedResponse("onActivityStateResponseTimeout")},e.prototype.forceReconnect=function(){this.setState(r.RetrievingToken),this.worker.resetTokenBackoff(),this.worker.stopConnectionTimer(),this.worker.stopPingTimer(),this.worker.clearTimers(),this.worker.stopSocketIo(),this.worker.dispatchReconnecting(),this.worker.getToken(!0,!1)},e.prototype.onMissedResponse=function(e){this.state===r.Connected?(this.setState(r.RetrievingToken),this.worker.stopPingTimer(),this.worker.clearTimers(),this.worker.stopSocketIo(),this.worker.dispatchReconnecting(),this.worker.getToken(!0,!1)):this.showIgnored(e)},e.prototype.showIgnored=function(e){this.logger.debug("Ignoring event '"+e+"' in state '"+r[this.state]+"'")},e.prototype.setState=function(e){this.logger.info("Switching from state '"+r[this.state]+"' to state '"+r[e]+"'"),this.state!==e?this.state=e:this.logger.error("Attempt to switching into the current state '"+r[e]+"'")},e.prototype.resetAllocationIfNecessary=function(e){this.connectionErrors++,this.connectionErrors>=2||void 0!==e&&/^4\d\d /.test(e)?(this.logger.error("Connection error count is "+this.connectionErrors+" - will reset allocation"),this.connectionErrors=0):this.logger.info("Connection error count is "+this.connectionErrors+" - will NOT reset allocation")},e.prototype.isRegistered=function(){return this.connectedSubstate===o.Registered||this.connectedSubstate===o.Registering},e.prototype.switchToIncallModeIfEnabled=function(){this.incallModeEnabled&&(this.worker.isIncallMode()||(this.worker.enterIncallMode(),this.worker.stopPingTimer(),this.worker.startPingTimer()),this.worker.restartIncallModeTimer())},e}();t.TrouterFsm=a},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(0),i=function(){function e(e,t){this.worker=t,this.state=r.TrouterState.Unknown,this.logger=new o.Logger("ManagerFsm",e)}return e.prototype.start=function(){this.state===r.TrouterState.Unknown?(this.setState(r.TrouterState.Disconnected),this.worker.forceStopLingeringConnection(),this.worker.startFirstConnection()):this.showIgnored("start")},e.prototype.stop=function(e){this.state!==r.TrouterState.Unknown?(this.setState(r.TrouterState.Unknown),this.worker.stopFirstConnection(!0===e),this.worker.stopSecondConnection(!0===e)):this.showIgnored("stop")},e.prototype.getState=function(){return this.state},e.prototype.onConnected=function(e){this.state===r.TrouterState.Disconnected&&e?this.worker.doesSecondConnectionExist()?this.setState(r.TrouterState.Switching):(this.setState(r.TrouterState.Connected),this.worker.dispatchConnected()):this.showIgnored("onConnected("+e+")")},e.prototype.onRegistered=function(e){this.state!==r.TrouterState.Disconnected||e?this.state!==r.TrouterState.Switching||e||(this.setState(r.TrouterState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnectionDelayed(),this.worker.dispatchConnected()):(this.setState(r.TrouterState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnection(!0),this.worker.dispatchConnected()),this.worker.dispatchRegistrationState(!0)},e.prototype.onUnregistered=function(e){e&&this.worker.dispatchRegistrationState(!1)},e.prototype.onReconnecting=function(e){this.state===r.TrouterState.Connected&&e||this.state===r.TrouterState.Switching&&e?(this.setState(r.TrouterState.Disconnected),this.worker.dispatchReconnecting()):this.showIgnored("onReconnecting("+e+")")},e.prototype.onReconnectionRequired=function(e){this.state===r.TrouterState.Connected&&e?(this.setState(r.TrouterState.Switching),this.worker.startSecondConnection()):this.state===r.TrouterState.Disconnected&&e?this.worker.startSecondConnection():this.showIgnored("onReconnectionRequired("+e+")")},e.prototype.onDisconnected=function(e){this.state===r.TrouterState.Unknown&&e?this.worker.dispatchStopped():this.showIgnored("onDisconnected("+e+")")},e.prototype.showIgnored=function(e){this.logger.info("Ignoring event '"+e+"' in state '"+r.TrouterState[this.state]+"'")},e.prototype.setState=function(e){this.logger.info("Switching from state '"+r.TrouterState[this.state]+"' to state '"+r.TrouterState[e]+"'"),this.state!==e?this.state=e:this.logger.error("Attempt to switching into the current state '"+r.TrouterState[e]+"'")},e}();t.TrouterManagerFsm=i},function(e,t,n){function r(e,t){if(!t)return e;var n=i({},e,{enabled:t.TelemetryEnabled});return void 0!==t.ClientTelemetryEventEnabled&&(n=i({},n,t.ClientTelemetryEventEnabled)),n}function o(e,t){return{clientInfo:{ua:e.trouterSettings.productName,v:e.trouterSettings.version},ioOptions:{ackTimeoutMs:5e3},clientCorrelationID:e.trouterSettings.sessionId,environment:e.trouterSettings.environment,telemetrySettings:r(e.telemetryConfig.settings,t),eventLogger:e.telemetryConfig.eventLogger,endpointId:e.trouterSettings.registrationId,trouterUrl:t&&t.TrouterConnectionUrl||e.trouterSettings.trouterServiceUrl,registration:e.trouterSettings.registrarServiceUrl?{registrarUrl:e.trouterSettings.registrarServiceUrl,registrationId:e.trouterSettings.registrationId||"",pnhAppId:e.trouterSettings.pnhAppId||"",platform:e.trouterSettings.platform||"",pnhTemplateKey:e.trouterSettings.pnhTemplate||"",platformUIVersion:e.trouterSettings.platformUIVersion||"",productContext:e.trouterSettings.pnhProductContext||void 0,context:e.trouterSettings.pnhContext||"",registrarTtlSec:(e.trouterSettings.maxRegistrationTimeInMs||0)/1e3}:void 0,timeoutOptions:i({connectionTimeoutMs:e.trouterSettings.trouterConnectTimeoutInMs||3e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:3e4,requestTimeoutMs:5e3,userActivityResponseTimeoutMs:1e4},e.trouterSettings.timeoutOptions),incallTimeoutOptions:i({connectionTimeoutMs:1e4,fetchTimeoutMs:5e3,pingTimeoutMs:5e3,pongTimeoutMs:2e3,maxBackoffMs:1e4,requestTimeoutMs:5e3,userActivityResponseTimeoutMs:1e4},e.trouterSettings.incallTimeoutOptions),incallModeTimeoutMs:e.trouterSettings.incallModeTimeoutMs||0,lingeringConnectionDelayMs:6e4,userActivitySecondResendDelayMs:e.trouterSettings.userActivitySecondResendDelayMs||1e4,duplicateDisconnectThresholdMs:1e4,connectionCache:e.connectionCache,registrationStateCallback:e.registrationStateCallbackForAcsDoNotUse}}var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(s,a)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0});var c=n(1),u=n(2);t.TrouterState=u.TrouterState,t.UserActivityState=u.UserActivityState;var l=n(0),d=n(6),p=n(7),h=n(8),f=n(9),g=function(){function e(e){this.logProvider=e,this.stateChangedListeners=[],this.logger=new l.Logger("Trouter",e),this.trouterUrlPromise=new f.TrouterUrlPromise(e),this.messageHandlers=new d.MessageHandlerRegistry(e),this.listeners={},this.connectionInfo=null,this.logger.info("Created TrouterService version "+c.CLIENT_VERSION)}return e.prototype.start=function(e){if(this.logger.info("Start"),!e.trouterSettings.disableInternalSkypeTokenCache){var t=e.skypeTokenProvider;e.skypeTokenProvider=p.addCacheAsBackupTo(t)}this.trouterCfg=e;var n=o(e,this.ecsCfg);void 0===this.trouterServer&&(this.trouterServer=new h.TrouterManager(this.logProvider,n,e.skypeTokenProvider,this)),this.trouterServer.start()},e.prototype.stop=function(e){this.logger.info("close connection"),this.trouterUrlPromise.rejectUrl(new Error("TrouterService is stopped")),void 0!==this.trouterServer&&this.trouterServer.stop(e)},e.prototype.setEcsConfig=function(e){return s(this,void 0,void 0,(function(){var t=this;return a(this,(function(n){return[2,new Promise((function(n,r){if(t.ecsCfg=e.TrouterJScriptClient,t.logger.info("Setting ECS configuration to "+JSON.stringify(t.ecsCfg)),void 0!==t.trouterServer&&void 0!==t.trouterCfg){var i=o(t.trouterCfg,t.ecsCfg);t.trouterServer.configure(i)}n()}))]}))}))},e.prototype.checkConnection=function(e){void 0!==this.trouterServer&&this.trouterServer.checkConnection(e||!1)},e.prototype.resendRegistration=function(){return s(this,void 0,void 0,(function(){return a(this,(function(e){if(!this.trouterServer)throw new Error("resendRegistration called too early");return[2,this.trouterServer.resendRegistration()]}))}))},e.prototype.registerListener=function(e,t){return""===t||"/"!==t[0]||t.indexOf("?")>=0||t.indexOf("#")>=0?(this.logger.error("Listener path '"+t+"' is not valid"),!1):this.listeners[t]?(this.logger.error("Another listener is already registered for path '"+t+"'"),!1):(this.listeners[t]=e,this.logger.debug("Listener for path '"+t+"' registered"),this.connectionInfo&&e.onTrouterConnected(this.connectionInfo.baseEndpointUrl+t,this.connectionInfo),!0)},e.prototype.unregisterListener=function(e){for(var t=[],n=0,r=Object.keys(this.listeners);n<r.length;n++){var o=r[n];this.listeners[o]===e&&t.push(o)}if(0===t.length)return!1;for(var i=0,s=t;i<s.length;i++)o=s[i],delete this.listeners[o];return this.logger.debug("Listener for path(s) '"+t.join("', '")+"' unregistered"),!0},e.prototype.onTrouterConnected=function(e,t){this.logger.debug("Trouter is now connected");for(var n=0,r=Object.keys(this.listeners);n<r.length;n++){var o=r[n];try{this.listeners[o].onTrouterConnected(t.baseEndpointUrl+o,t)}catch(e){this.logger.error("Listener '"+o+"' threw an exception from onTrouterConnected(): "+e)}}this.connectionInfo=t,this.trouterUrlPromise.resolveUrl(e),this.notifyStateChanged(u.TrouterState.Connected,{url:e,getRemainingTtlInSec:function(){return t.connectionTtlSec}})},e.prototype.onTrouterDisconnected=function(){this.logger.debug("Trouter is now disconnected"),this.connectionInfo=null;for(var e=0,t=Object.keys(this.listeners);e<t.length;e++){var n=t[e],r=this.listeners[n];if(r.onTrouterDisconnected)try{r.onTrouterDisconnected()}catch(e){this.logger.error("Listener '"+n+"' threw an exception from onTrouterDisconnected(): "+e)}}this.notifyStateChanged(u.TrouterState.Disconnected)},e.prototype.onTrouterRequest=function(e,t){for(var n="",r=0,o=Object.keys(this.listeners);r<o.length;r++){var i=o[r];e.path.substring(0,i.length)===i&&i.length>n.length&&(n=i)}if(""===n)this.tryMessageHandlers(e,t)||(t.status=404,t.headers={"Trouter-Responder":"ClientLib"},t.send());else try{this.listeners[n].onTrouterRequest(e,t)}catch(e){this.logger.error("Listener '"+n+"' threw an exception from onTrouterRequest(): "+e),t.status=500,t.headers={"Trouter-Responder":"ClientLib"},t.send()}},e.prototype.onTrouterMessageLoss=function(e){this.logger.info("onTrouterMessageLoss called with value "+e);for(var t=!0,n=0,r=Object.keys(this.listeners);n<r.length;n++){var o=r[n],i=this.listeners[o];if(i.onTrouterMessageLoss)try{void 0===(t=i.onTrouterMessageLoss(e)&&t)&&(this.logger.error("Listener '"+o+"' did not response with boolean value onTrouterMessageLoss()"),t=!1)}catch(e){this.logger.error("Listener '"+o+"' threw an exception from onTrouterMessageLoss(): "+e),t=!1}}return t},e.prototype.onTrouterUserActivityStateAccepted=function(e){this.logger.debug("onTrouterUserActivityStateAccepted cv: "+e);for(var t=0,n=Object.keys(this.listeners);t<n.length;t++){var r=n[t],o=this.listeners[r];if(o.onTrouterUserActivityStateAccepted)try{o.onTrouterUserActivityStateAccepted(e)}catch(e){this.logger.error("Listener '"+r+"' threw an exception from onTrouterUserActivityStateAccepted(): "+e)}}},e.prototype.setUserActivityState=function(e,t){if(e!==u.UserActivityState.Active&&e!==u.UserActivityState.Inactive)throw new Error("setUserActivityState called with unsupported value "+e);if(this.logger.info("setUserActivityState called with value "+u.UserActivityState[e]),!this.trouterServer||this.state()===u.TrouterState.Unknown)throw new Error("setUserActivityState called too early");this.trouterServer.setUserActivityState(e,t)},e.prototype.state=function(){return void 0!==this.trouterServer?this.trouterServer.getState():u.TrouterState.Unknown},e.prototype.getServerState=function(){if(void 0!==this.trouterServer)return this.trouterServer.getServerState()},e.prototype.getTrouterUrlAsync=function(){return void 0!==this.trouterServer?this.trouterUrlPromise.getPromise():Promise.reject(new Error("TrouterService has not been started"))},e.prototype.onStateChanged=function(e){if(this.logger.info("onStateChanged called"),void 0===e)this.stateChangedListeners=this.stateChangedListeners.filter((function(e){return void 0===e.wrappedCallback}));else{this.offStateChanged(e);var t=function(t,n){e(t,n?n.url:"")};t.wrappedCallback=e,this.stateChangedListeners.push(t)}},e.prototype.offStateChanged=function(e){this.logger.info("offStateChanged called");var t=this.stateChangedListeners.length;return this.stateChangedListeners=this.stateChangedListeners.filter((function(t){return t.wrappedCallback!==e})),t>this.stateChangedListeners.length},e.prototype.addCallback=function(e){this.logger.info("addListener called"),-1===this.stateChangedListeners.indexOf(e,0)&&void 0!==e&&this.stateChangedListeners.push(e)},e.prototype.removeCallback=function(e){this.logger.info("removeListener called");var t=this.stateChangedListeners.indexOf(e,0);return t>-1&&(this.stateChangedListeners.splice(t,1),!0)},e.prototype.registerMessageHandler=function(e){this.logger.info("registerMessageHandler is called"),this.messageHandlers.register(e)},e.prototype.clearMessageHandlers=function(){this.logger.info("clearMessageHandlers is called"),this.messageHandlers.clear()},e.prototype.notifyStateChanged=function(e,t){var n=this;this.logger.info("notifyStateChanged called, will forward to "+this.stateChangedListeners.length+" listeners"),this.stateChangedListeners.forEach((function(r){try{r(e,t)}catch(e){n.logger.error("Error in callback "+e)}}))},e.prototype.tryMessageHandlers=function(e,t){if(!this.messageHandlers.active())return!1;var n,r=null;try{r=(n=JSON.parse(e.body))&&(n.evt||n.eventId)||null}catch(e){}var o={eventId:r,url:(this.connectionInfo?this.connectionInfo.baseEndpointUrl:"")+e.path,body:n,rawBody:e.body,headers:e.headers},i=this.messageHandlers.handleMessage(o);return!!i.isHandled&&(t.status=i.resultCode,i.responseHeaders&&(t.headers=i.responseHeaders),i.responseBody&&(t.body=i.responseBody),t.send(),!0)},e}();t.TrouterService=g,t.createTrouterService=function(e){return new g(e)},t.getTrouterServiceVersion=function(){return c.CLIENT_VERSION},t.replaceTrouterUrlBase=function(e,t){var n=e.indexOf("://");if(n>=0){var r=e.indexOf("/",n+3);if(r>=0)return t+e.substr(r)}return""}},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_20__},function(e,t){}])},module.exports=e(tsregistrar)}));unwrapExports(tstrouter);var constants=createCommonjsModule((function(e,t){t.__esModule=!0,t.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES=3,t.GCCHIGH_TROUTER_SERVICE_URL="https://go.trouter.gov.teams.microsoft.us/v4/a",t.GCCHIGH_REGISTRAR_SERVICE_URL="https://registrar.gov.teams.microsoft.us/V3/registrations",t.DOD_TROUTER_SERVICE_URL="https://go.trouter.dod.teams.microsoft.us/v4/a",t.DOD_REGISTRAR_SERVICE_URL="https://registrar.dod.teams.microsoft.us/V3/registrations",t.INT_TROUTER_SERVICE_URL="https://go.trouter-int.skype.net/v4/a",t.INT_REGISTRAR_SERVICE_URL="https://edge.skype.net/registrar/testenv/v3/registrations",t.PUBLIC_TROUTER_SERVICE_URL="https://go.trouter.skype.com/v4/a",t.PUBLIC_REGISTRAR_SERVICE_URL="https://edge.skype.com/registrar/prod/v3/registrations",function(e){e.Public="Public",e.GccHigh="GCC High",e.Dod="DoD"}(t.CloudType||(t.CloudType={})),function(e){e.OrgId="orgid",e.Acs="acs",e.Spool="spool",e.GccHigh="gcch",e.GccHighAcs="gcch-acs",e.Dod="dod",e.DodAcs="dod-acs"}(t.CloudPrefix||(t.CloudPrefix={}))}));unwrapExports(constants);var constants_1=constants.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES,constants_2=constants.GCCHIGH_TROUTER_SERVICE_URL,constants_3=constants.GCCHIGH_REGISTRAR_SERVICE_URL,constants_4=constants.DOD_TROUTER_SERVICE_URL,constants_5=constants.DOD_REGISTRAR_SERVICE_URL,constants_6=constants.INT_TROUTER_SERVICE_URL,constants_7=constants.INT_REGISTRAR_SERVICE_URL,constants_8=constants.PUBLIC_TROUTER_SERVICE_URL,constants_9=constants.PUBLIC_REGISTRAR_SERVICE_URL,constants_10=constants.CloudType,constants_11=constants.CloudPrefix,TrouterUtils=createCommonjsModule((function(e,t){var n=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},r=commonjsGlobal&&commonjsGlobal.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};t.__esModule=!0;var o=new Map([["chatMessageReceived",200],["typingIndicatorReceived",245],["readReceiptReceived",246],["chatMessageEdited",247],["chatMessageDeleted",248],["chatThreadCreated",257],["chatThreadPropertiesUpdated",258],["chatThreadDeleted",259],["participantsAdded",260],["participantsRemoved",261]]);t.toMessageHandler=function(e,t){var n=o.get(e);return{handleMessage:function(r){var o=null;if((null==r?void 0:r.rawBody)&&(o=JSON.parse(r.rawBody)),null!==o&&o.eventId===n){var s=i(e,o);if(null!==s)return t(s),{isHandled:!0,resultCode:200}}}}};var i=function(e,t){if("chatMessageReceived"===e)return{threadId:(n=t).groupId,sender:s(n.senderId),senderDisplayName:n.senderDisplayName,recipient:s(n.recipientMri),id:n.messageId,createdOn:new Date(n.originalArrivalTime),version:n.version,type:n.messageType,message:n.messageBody,metadata:a(n.acsChatMessageMetadata)};if("chatMessageEdited"===e)return{threadId:(n=t).groupId,sender:s(n.senderId),senderDisplayName:n.senderDisplayName,recipient:s(n.recipientMri),id:n.messageId,createdOn:new Date(n.originalArrivalTime),version:n.version,message:n.messageBody,editedOn:new Date(n.edittime),type:n.messageType,metadata:a(n.acsChatMessageMetadata)};if("chatMessageDeleted"===e)return{threadId:(n=t).groupId,sender:s(n.senderId),senderDisplayName:n.senderDisplayName,recipient:s(n.recipientMri),id:n.messageId,createdOn:new Date(n.originalArrivalTime),version:n.version,deletedOn:new Date(n.deletetime),type:n.messageType};if("typingIndicatorReceived"===e)return{threadId:(n=t).groupId,sender:s(n.senderId),senderDisplayName:n.senderDisplayName,recipient:s(n.recipientMri),version:n.version,receivedOn:new Date(n.originalArrivalTime)};if("readReceiptReceived"===e){var n=t,r=JSON.parse(n.messageBody).consumptionhorizon.split(";");return{threadId:n.groupId,sender:s(n.senderId),senderDisplayName:"",recipient:s(n.recipientMri),chatMessageId:n.messageId,readOn:new Date(+r[1])}}if("chatThreadCreated"===e){n=t;var o=JSON.parse(unescape(n.createdBy)),i=JSON.parse(unescape(n.members)),c=JSON.parse(unescape(n.properties)),u={id:s(o.participantId),displayName:o.displayName},l=i.map((function(e){return{id:s(e.participantId),displayName:e.displayName}}));return{threadId:n.threadId,createdOn:new Date(n.createTime),createdBy:u,version:n.version,participants:l,properties:c}}if("chatThreadPropertiesUpdated"===e){n=t;var d=JSON.parse(unescape(n.editedBy)),p=(c=JSON.parse(unescape(n.properties)),{id:s(d.participantId),displayName:d.displayName});return{threadId:n.threadId,updatedOn:new Date(n.editTime),updatedBy:p,version:n.version,properties:c}}if("chatThreadDeleted"===e){n=t;var h=JSON.parse(unescape(n.deletedBy)),f={id:s(h.participantId),displayName:h.displayName};return{threadId:n.threadId,deletedOn:new Date(n.deleteTime),deletedBy:f,version:n.version}}if("participantsAdded"===e){n=t;var g=JSON.parse(unescape(n.addedBy)),m=JSON.parse(unescape(n.participantsAdded)),y={id:s(g.participantId),displayName:g.displayName};l=m.map((function(e){return{id:s(e.participantId),displayName:e.displayName,shareHistoryTime:new Date(e.shareHistoryTime)}}));return{threadId:n.threadId,addedOn:new Date(n.time),addedBy:y,version:n.version,participantsAdded:l}}if("participantsRemoved"===e){n=t;var v=JSON.parse(unescape(n.removedBy)),b=JSON.parse(unescape(n.participantsRemoved)),T={id:s(v.participantId),displayName:v.displayName};l=b.map((function(e){return{id:s(e.participantId),displayName:e.displayName,shareHistoryTime:new Date(e.shareHistoryTime)}}));return{threadId:n.threadId,removedOn:new Date(n.time),removedBy:T,version:n.version,participantsRemoved:l}}return null};t.toLogProvider=function(e){return{log:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.info(t)},warn:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.warning(t)},error:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.error(t)},debug:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.verbose(t)},info:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.verbose(t)}}},t.toTelemetrySender=function(e){return{logEvent:function(t){return e.info(t)}}};var s=function(e){return e.startsWith("8:orgid:")?{kind:"microsoftTeamsUser",rawId:e,microsoftTeamsUserId:e.substring("8:orgid:".length),isAnonymous:!1,cloud:"public"}:e.startsWith("8:dod:")?{kind:"microsoftTeamsUser",rawId:e,microsoftTeamsUserId:e.substring("8:dod:".length),isAnonymous:!1,cloud:"dod"}:e.startsWith("8:gcch:")?{kind:"microsoftTeamsUser",rawId:e,microsoftTeamsUserId:e.substring("8:gcch:".length),isAnonymous:!1,cloud:"gcch"}:e.startsWith("8:teamsvisitor:")?{kind:"microsoftTeamsUser",rawId:e,microsoftTeamsUserId:e.substring("8:teamsvisitor:".length),isAnonymous:!0}:e.startsWith("4:")?{kind:"phoneNumber",rawId:e,phoneNumber:e.substring("4:".length)}:e.startsWith("8:acs:")||e.startsWith("8:spool:")?{kind:"communicationUser",communicationUserId:e}:{kind:"unknown",id:e}},a=function(e){return null==e||""===e||"null"===e?{}:JSON.parse(e)};function c(e){return coreHttp.isNode?Buffer.from(e,"base64").toString():atob(e)}t.base64decode=c;function u(e){switch(e.substring(0,e.indexOf(":"))){case constants.CloudPrefix.OrgId:case constants.CloudPrefix.Acs:case constants.CloudPrefix.Spool:return constants.CloudType.Public;case constants.CloudPrefix.GccHigh:case constants.CloudPrefix.GccHighAcs:return constants.CloudType.GccHigh;case constants.CloudPrefix.Dod:case constants.CloudPrefix.DodAcs:return constants.CloudType.Dod;default:return constants.CloudType.Public}}t.getCloudTypeFromCredential=function(e){return n(void 0,void 0,void 0,(function(){var t,n,o;return r(this,(function(r){switch(r.label){case 0:return[4,e.getToken()];case 1:return t=r.sent(),n=null==t?void 0:t.token,o=function(e){var t=(null==e?void 0:e.split("."))[1];if(void 0===t)throw new Error("Invalid token");return t=t.replace(/-/g,"+").replace(/_/g,"/"),JSON.parse(decodeURIComponent(escape(c(t))))}(n),[2,u(o.skypeid)]}}))}))}}));unwrapExports(TrouterUtils);var TrouterUtils_1=TrouterUtils.toMessageHandler,TrouterUtils_2=TrouterUtils.toLogProvider,TrouterUtils_3=TrouterUtils.toTelemetrySender,TrouterUtils_4=TrouterUtils.base64decode,TrouterUtils_5=TrouterUtils.getCloudTypeFromCredential,TrouterSettings=createCommonjsModule((function(e,t){var n=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},r=commonjsGlobal&&commonjsGlobal.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};t.__esModule=!0;var o={version:"1.0.0",registrationId:"",sessionId:"",pnhAppId:"AcsWeb",pnhTemplate:"AcsWeb_Chat_1.2",platform:"SPOOL",platformUIVersion:"0.0.0",environment:"",productName:"acs-chat-web",trouterServiceUrl:constants.PUBLIC_TROUTER_SERVICE_URL,registrarServiceUrl:constants.PUBLIC_REGISTRAR_SERVICE_URL,registrarRefreshTimeoutInMs:35e4,timeoutOptions:{connectionTimeoutMs:2e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:5e4,requestTimeoutMs:5e3},maxRegistrationTimeInMs:72e5},i=function(){var e=o;return e.registrationId=coreHttp.generateUuid(),e.sessionId=coreHttp.generateUuid(),e};t.createSettings=function(e,t){return n(void 0,void 0,void 0,(function(){var n,s,a;return r(this,(function(r){switch(r.label){case 0:return"INT"!==(null==t?void 0:t.environment)?[3,1]:(n=function(){var e=i();return e.pnhAppId="cns-e2e-test",e.pnhTemplate="cns-e2e-test:1.2",e.registrarServiceUrl=constants.INT_REGISTRAR_SERVICE_URL,e.trouterServiceUrl=constants.INT_TROUTER_SERVICE_URL,e}(),[3,3]);case 1:return[4,TrouterUtils.getCloudTypeFromCredential(e)];case 2:s=r.sent(),n=s===constants.CloudType.GccHigh?function(){var e=i();return e.registrarServiceUrl=constants.GCCHIGH_REGISTRAR_SERVICE_URL,e.trouterServiceUrl=constants.GCCHIGH_TROUTER_SERVICE_URL,e}():s===constants.CloudType.Dod?function(){var e=i();return e.registrarServiceUrl=constants.DOD_REGISTRAR_SERVICE_URL,e.trouterServiceUrl=constants.DOD_TROUTER_SERVICE_URL,e}():i(),r.label=3;case 3:return n.maxRegistrationTimeInMs=null!==(a=null==t?void 0:t.registrationTimeInMs)&&void 0!==a?a:o.maxRegistrationTimeInMs,[2,n]}}))}))},t.defaultTelemetrySettings={enabled:!1}}));unwrapExports(TrouterSettings);var TrouterSettings_1=TrouterSettings.createSettings,TrouterSettings_2=TrouterSettings.defaultTelemetrySettings,SignalingClient=createCommonjsModule((function(e,t){var n=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},r=commonjsGlobal&&commonjsGlobal.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};t.__esModule=!0,function(e){e[e.Unknown=0]="Unknown",e[e.Connected=2]="Connected",e[e.Disconnected=3]="Disconnected",e[e.Switching=9]="Switching"}(t.ConnectionState||(t.ConnectionState={}));var o=function(){function e(e,t,n){this.credential=e,this.logger=t,this.options=n,this.stateChangedListener=null,this.tokenFetchRetries=0,this.trouter=tstrouter.createTrouterService(TrouterUtils.toLogProvider(t))}return e.prototype.start=function(){return n(this,void 0,void 0,(function(){var e,t,o=this;return r(this,(function(i){switch(i.label){case 0:return void 0!==this.config?[3,2]:(e=this,t={},[4,TrouterSettings.createSettings(this.credential,this.options)]);case 1:e.config=(t.trouterSettings=i.sent(),t.skypeTokenProvider=function(e){return n(o,void 0,void 0,(function(){var t,n;return r(this,(function(r){switch(r.label){case 0:return e?(this.tokenFetchRetries+=1,this.tokenFetchRetries>constants.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES?[4,this.stop(!0)]:[3,2]):[3,3];case 1:throw r.sent(),new Error("Access token is expired and failed to fetch a valid one after "+constants.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES+" retries");case 2:return[3,4];case 3:this.tokenFetchRetries=0,r.label=4;case 4:return n=(t=Promise).resolve,[4,this.credential.getToken()];case 5:return[2,n.apply(t,[r.sent().token])]}}))}))},t.telemetryConfig={eventLogger:TrouterUtils.toTelemetrySender(this.logger),settings:TrouterSettings.defaultTelemetrySettings},t),i.label=2;case 2:return this.trouter.start(this.config),this.trouter.setUserActivityState(tstrouter.UserActivityState.Active),[2]}}))}))},e.prototype.stop=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(t){return this.trouter.offStateChanged(this.stateChangedListener),this.trouter.clearMessageHandlers(),this.trouter.stop(null!=e?e:this.tokenFetchRetries>constants.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES),[2]}))}))},e.prototype.on=function(e,t){if("connectionChanged"===e)return this.trouter.offStateChanged(this.stateChangedListener),this.stateChangedListener=function(e,n){return t(e)},void this.trouter.onStateChanged(this.stateChangedListener);this.trouter.registerMessageHandler(TrouterUtils.toMessageHandler(e,t))},e}();t.CommunicationSignalingClient=o}));unwrapExports(SignalingClient);var SignalingClient_1=SignalingClient.ConnectionState,SignalingClient_2=SignalingClient.CommunicationSignalingClient,src=createCommonjsModule((function(e,t){t.__esModule=!0,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(SignalingClient)})),index=unwrapExports(src);module.exports=index}).call(this,__webpack_require__(38),__webpack_require__(194).Buffer)},function(e,t,n){e.exports=function(e){if(!e)return Math.random;var t=Math.pow(2,32),n=new Uint32Array(1);return function(){return e.getRandomValues(n)[0]/t}}(n(199))},,,,,,function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,n){var r=n(116);n(146),n(147),n(84),n(148),n(149),e.exports=r},function(e,t,n){n(117),n(63),n(125),n(129),n(130),n(131),n(132),n(133),n(134),n(135),n(136),n(137),n(138),n(139),n(140),n(141),n(142),n(143),n(144),n(145);var r=n(19);e.exports=r.Symbol},function(e,t,n){"use strict";var r=n(3),o=n(14),i=n(60),s=n(11),a=n(32),c=n(45),u=n(122),l=n(79),d=n(123),p=n(5),h=n(48),f=p("isConcatSpreadable"),g=h>=51||!o((function(){var e=[];return e[f]=!1,e.concat()[0]!==e})),m=d("concat"),y=function(e){if(!s(e))return!1;var t=e[f];return void 0!==t?!!t:i(e)};r({target:"Array",proto:!0,forced:!g||!m},{concat:function(e){var t,n,r,o,i,s=a(this),d=l(s,0),p=0;for(t=-1,r=arguments.length;t<r;t++)if(y(i=-1===t?s:arguments[t])){if(p+(o=c(i.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<o;n++,p++)n in i&&u(d,p,i[n])}else{if(p>=9007199254740991)throw TypeError("Maximum allowed index exceeded");u(d,p++,i)}return d.length=p,d}})},function(e,t,n){var r=n(4),o=n(55),i=r.WeakMap;e.exports="function"==typeof i&&/native code/.test(o(i))},function(e,t,n){var r=n(18),o=n(58),i=n(77),s=n(6);e.exports=r("Reflect","ownKeys")||function(e){var t=o.f(s(e)),n=i.f;return n?t.concat(n(e)):t}},function(e,t,n){var r=n(21),o=n(45),i=n(121),s=function(e){return function(t,n,s){var a,c=r(t),u=o(c.length),l=i(s,u);if(e&&n!=n){for(;u>l;)if((a=c[l++])!=a)return!0}else for(;u>l;l++)if((e||l in c)&&c[l]===n)return e||l||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},function(e,t,n){var r=n(46),o=Math.max,i=Math.min;e.exports=function(e,t){var n=r(e);return n<0?o(n+t,0):i(n,t)}},function(e,t,n){"use strict";var r=n(41),o=n(15),i=n(31);e.exports=function(e,t,n){var s=r(t);s in e?o.f(e,s,i(0,n)):e[s]=n}},function(e,t,n){var r=n(14),o=n(5),i=n(48),s=o("species");e.exports=function(e){return i>=51||!r((function(){var t=[];return(t.constructor={})[s]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},function(e,t,n){"use strict";var r=n(64),o=n(81);e.exports=r?{}.toString:function(){return"[object "+o(this)+"]"}},function(e,t,n){"use strict";var r=n(3),o=n(4),i=n(18),s=n(23),a=n(17),c=n(61),u=n(80),l=n(14),d=n(9),p=n(60),h=n(11),f=n(6),g=n(32),m=n(21),y=n(41),v=n(31),b=n(49),T=n(65),w=n(58),E=n(127),S=n(77),R=n(39),C=n(15),O=n(51),I=n(12),A=n(29),P=n(56),_=n(43),x=n(44),k=n(57),N=n(5),M=n(83),D=n(7),j=n(24),U=n(22),L=n(128).forEach,q=_("hidden"),B=N("toPrimitive"),z=U.set,H=U.getterFor("Symbol"),F=Object.prototype,$=o.Symbol,G=i("JSON","stringify"),V=R.f,J=C.f,W=E.f,Y=O.f,K=P("symbols"),X=P("op-symbols"),Q=P("string-to-symbol-registry"),Z=P("symbol-to-string-registry"),ee=P("wks"),te=o.QObject,ne=!te||!te.prototype||!te.prototype.findChild,re=a&&l((function(){return 7!=b(J({},"a",{get:function(){return J(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=V(F,t);r&&delete F[t],J(e,t,n),r&&e!==F&&J(F,t,r)}:J,oe=function(e,t){var n=K[e]=b($.prototype);return z(n,{type:"Symbol",tag:e,description:t}),a||(n.description=t),n},ie=u?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof $},se=function(e,t,n){e===F&&se(X,t,n),f(e);var r=y(t,!0);return f(n),d(K,r)?(n.enumerable?(d(e,q)&&e[q][r]&&(e[q][r]=!1),n=b(n,{enumerable:v(0,!1)})):(d(e,q)||J(e,q,v(1,{})),e[q][r]=!0),re(e,r,n)):J(e,r,n)},ae=function(e,t){f(e);var n=m(t),r=T(n).concat(de(n));return L(r,(function(t){a&&!ce.call(n,t)||se(e,t,n[t])})),e},ce=function(e){var t=y(e,!0),n=Y.call(this,t);return!(this===F&&d(K,t)&&!d(X,t))&&(!(n||!d(this,t)||!d(K,t)||d(this,q)&&this[q][t])||n)},ue=function(e,t){var n=m(e),r=y(t,!0);if(n!==F||!d(K,r)||d(X,r)){var o=V(n,r);return!o||!d(K,r)||d(n,q)&&n[q][r]||(o.enumerable=!0),o}},le=function(e){var t=W(m(e)),n=[];return L(t,(function(e){d(K,e)||d(x,e)||n.push(e)})),n},de=function(e){var t=e===F,n=W(t?X:m(e)),r=[];return L(n,(function(e){!d(K,e)||t&&!d(F,e)||r.push(K[e])})),r};(c||(A(($=function(){if(this instanceof $)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=k(e),n=function(e){this===F&&n.call(X,e),d(this,q)&&d(this[q],t)&&(this[q][t]=!1),re(this,t,v(1,e))};return a&&ne&&re(F,t,{configurable:!0,set:n}),oe(t,e)}).prototype,"toString",(function(){return H(this).tag})),A($,"withoutSetter",(function(e){return oe(k(e),e)})),O.f=ce,C.f=se,R.f=ue,w.f=E.f=le,S.f=de,M.f=function(e){return oe(N(e),e)},a&&(J($.prototype,"description",{configurable:!0,get:function(){return H(this).description}}),s||A(F,"propertyIsEnumerable",ce,{unsafe:!0}))),r({global:!0,wrap:!0,forced:!c,sham:!c},{Symbol:$}),L(T(ee),(function(e){D(e)})),r({target:"Symbol",stat:!0,forced:!c},{for:function(e){var t=String(e);if(d(Q,t))return Q[t];var n=$(t);return Q[t]=n,Z[n]=t,n},keyFor:function(e){if(!ie(e))throw TypeError(e+" is not a symbol");if(d(Z,e))return Z[e]},useSetter:function(){ne=!0},useSimple:function(){ne=!1}}),r({target:"Object",stat:!0,forced:!c,sham:!a},{create:function(e,t){return void 0===t?b(e):ae(b(e),t)},defineProperty:se,defineProperties:ae,getOwnPropertyDescriptor:ue}),r({target:"Object",stat:!0,forced:!c},{getOwnPropertyNames:le,getOwnPropertySymbols:de}),r({target:"Object",stat:!0,forced:l((function(){S.f(1)}))},{getOwnPropertySymbols:function(e){return S.f(g(e))}}),G)&&r({target:"JSON",stat:!0,forced:!c||l((function(){var e=$();return"[null]"!=G([e])||"{}"!=G({a:e})||"{}"!=G(Object(e))}))},{stringify:function(e,t,n){for(var r,o=[e],i=1;arguments.length>i;)o.push(arguments[i++]);if(r=t,(h(t)||void 0!==e)&&!ie(e))return p(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!ie(t))return t}),o[1]=t,G.apply(null,o)}});$.prototype[B]||I($.prototype,B,$.prototype.valueOf),j($,"Symbol"),x[q]=!0},function(e,t,n){var r=n(17),o=n(15),i=n(6),s=n(65);e.exports=r?Object.defineProperties:function(e,t){i(e);for(var n,r=s(t),a=r.length,c=0;a>c;)o.f(e,n=r[c++],t[n]);return e}},function(e,t,n){var r=n(21),o=n(58).f,i={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return s&&"[object Window]"==i.call(e)?function(e){try{return o(e)}catch(e){return s.slice()}}(e):o(r(e))}},function(e,t,n){var r=n(66),o=n(73),i=n(32),s=n(45),a=n(79),c=[].push,u=function(e){var t=1==e,n=2==e,u=3==e,l=4==e,d=6==e,p=7==e,h=5==e||d;return function(f,g,m,y){for(var v,b,T=i(f),w=o(T),E=r(g,m,3),S=s(w.length),R=0,C=y||a,O=t?C(f,S):n||p?C(f,0):void 0;S>R;R++)if((h||R in w)&&(b=E(v=w[R],R,T),e))if(t)O[R]=b;else if(b)switch(e){case 3:return!0;case 5:return v;case 6:return R;case 2:c.call(O,v)}else switch(e){case 4:return!1;case 7:c.call(O,v)}return d?-1:u||l?l:O}};e.exports={forEach:u(0),map:u(1),filter:u(2),some:u(3),every:u(4),find:u(5),findIndex:u(6),filterOut:u(7)}},function(e,t,n){n(7)("asyncIterator")},function(e,t,n){"use strict";var r=n(3),o=n(17),i=n(4),s=n(9),a=n(11),c=n(15).f,u=n(75),l=i.Symbol;if(o&&"function"==typeof l&&(!("description"in l.prototype)||void 0!==l().description)){var d={},p=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof p?new l(e):void 0===e?l():l(e);return""===e&&(d[t]=!0),t};u(p,l);var h=p.prototype=l.prototype;h.constructor=p;var f=h.toString,g="Symbol(test)"==String(l("test")),m=/^Symbol\((.*)\)[^)]+$/;c(h,"description",{configurable:!0,get:function(){var e=a(this)?this.valueOf():this,t=f.call(e);if(s(d,e))return"";var n=g?t.slice(7,-1):t.replace(m,"$1");return""===n?void 0:n}}),r({global:!0,forced:!0},{Symbol:p})}},function(e,t,n){n(7)("hasInstance")},function(e,t,n){n(7)("isConcatSpreadable")},function(e,t,n){n(7)("iterator")},function(e,t,n){n(7)("match")},function(e,t,n){n(7)("matchAll")},function(e,t,n){n(7)("replace")},function(e,t,n){n(7)("search")},function(e,t,n){n(7)("species")},function(e,t,n){n(7)("split")},function(e,t,n){n(7)("toPrimitive")},function(e,t,n){n(7)("toStringTag")},function(e,t,n){n(7)("unscopables")},function(e,t,n){var r=n(4);n(24)(r.JSON,"JSON",!0)},function(e,t,n){n(24)(Math,"Math",!0)},function(e,t,n){var r=n(3),o=n(4),i=n(24);r({global:!0},{Reflect:{}}),i(o.Reflect,"Reflect",!0)},function(e,t,n){n(7)("asyncDispose")},function(e,t,n){n(7)("dispose")},function(e,t,n){n(7)("patternMatch")},function(e,t,n){n(7)("replaceAll")},function(e,t,n){n(63),n(151),n(91),n(166),n(168),n(169),n(170),n(171),n(172),n(173),n(174),n(175),n(176),n(177),n(178),n(179),n(180),n(96);var r=n(19);e.exports=r.AsyncIterator},function(e,t,n){"use strict";var r,o,i,s,a=n(3),c=n(23),u=n(4),l=n(18),d=n(152),p=n(29),h=n(67),f=n(24),g=n(85),m=n(11),y=n(13),v=n(68),b=n(55),T=n(86),w=n(155),E=n(156),S=n(87).set,R=n(157),C=n(159),O=n(90),I=n(89),A=n(160),P=n(22),_=n(78),x=n(5),k=n(47),N=n(48),M=x("species"),D="Promise",j=P.get,U=P.set,L=P.getterFor(D),q=d,B=u.TypeError,z=u.document,H=u.process,F=l("fetch"),$=I.f,G=$,V=!!(z&&z.createEvent&&u.dispatchEvent),J="function"==typeof PromiseRejectionEvent,W=_(D,(function(){if(!(b(q)!==String(q))){if(66===N)return!0;if(!k&&!J)return!0}if(c&&!q.prototype.finally)return!0;if(N>=51&&/native code/.test(q))return!1;var e=q.resolve(1),t=function(e){e((function(){}),(function(){}))};return(e.constructor={})[M]=t,!(e.then((function(){}))instanceof t)})),Y=W||!w((function(e){q.all(e).catch((function(){}))})),K=function(e){var t;return!(!m(e)||"function"!=typeof(t=e.then))&&t},X=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;R((function(){for(var r=e.value,o=1==e.state,i=0;n.length>i;){var s,a,c,u=n[i++],l=o?u.ok:u.fail,d=u.resolve,p=u.reject,h=u.domain;try{l?(o||(2===e.rejection&&te(e),e.rejection=1),!0===l?s=r:(h&&h.enter(),s=l(r),h&&(h.exit(),c=!0)),s===u.promise?p(B("Promise-chain cycle")):(a=K(s))?a.call(s,d,p):d(s)):p(r)}catch(e){h&&!c&&h.exit(),p(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&Z(e)}))}},Q=function(e,t,n){var r,o;V?((r=z.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),u.dispatchEvent(r)):r={promise:t,reason:n},!J&&(o=u["on"+e])?o(r):"unhandledrejection"===e&&O("Unhandled promise rejection",n)},Z=function(e){S.call(u,(function(){var t,n=e.facade,r=e.value;if(ee(e)&&(t=A((function(){k?H.emit("unhandledRejection",r,n):Q("unhandledrejection",n,r)})),e.rejection=k||ee(e)?2:1,t.error))throw t.value}))},ee=function(e){return 1!==e.rejection&&!e.parent},te=function(e){S.call(u,(function(){var t=e.facade;k?H.emit("rejectionHandled",t):Q("rejectionhandled",t,e.value)}))},ne=function(e,t,n){return function(r){e(t,r,n)}},re=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,X(e,!0))},oe=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw B("Promise can't be resolved itself");var r=K(t);r?R((function(){var n={done:!1};try{r.call(t,ne(oe,n,e),ne(re,n,e))}catch(t){re(n,t,e)}})):(e.value=t,e.state=1,X(e,!1))}catch(t){re({done:!1},t,e)}}};W&&(q=function(e){v(this,q,D),y(e),r.call(this);var t=j(this);try{e(ne(oe,t),ne(re,t))}catch(e){re(t,e)}},(r=function(e){U(this,{type:D,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=h(q.prototype,{then:function(e,t){var n=L(this),r=$(E(this,q));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=k?H.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&X(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new r,t=j(e);this.promise=e,this.resolve=ne(oe,t),this.reject=ne(re,t)},I.f=$=function(e){return e===q||e===i?new o(e):G(e)},c||"function"!=typeof d||(s=d.prototype.then,p(d.prototype,"then",(function(e,t){var n=this;return new q((function(e,t){s.call(n,e,t)})).then(e,t)}),{unsafe:!0}),"function"==typeof F&&a({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return C(q,F.apply(u,arguments))}}))),a({global:!0,wrap:!0,forced:W},{Promise:q}),f(q,D,!1,!0),g(D),i=l(D),a({target:D,stat:!0,forced:W},{reject:function(e){var t=$(this);return t.reject.call(void 0,e),t.promise}}),a({target:D,stat:!0,forced:c||W},{resolve:function(e){return C(c&&this===i?q:this,e)}}),a({target:D,stat:!0,forced:Y},{all:function(e){var t=this,n=$(t),r=n.resolve,o=n.reject,i=A((function(){var n=y(t.resolve),i=[],s=0,a=1;T(e,(function(e){var c=s++,u=!1;i.push(void 0),a++,n.call(t,e).then((function(e){u||(u=!0,i[c]=e,--a||r(i))}),o)})),--a||r(i)}));return i.error&&o(i.value),n.promise},race:function(e){var t=this,n=$(t),r=n.reject,o=A((function(){var o=y(t.resolve);T(e,(function(e){o.call(t,e).then(n.resolve,r)}))}));return o.error&&r(o.value),n.promise}})},function(e,t,n){var r=n(4);e.exports=r.Promise},function(e,t,n){var r=n(5),o=n(33),i=r("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(o.Array===e||s[i]===e)}},function(e,t,n){var r=n(6);e.exports=function(e){var t=e.return;if(void 0!==t)return r(t.call(e)).value}},function(e,t,n){var r=n(5)("iterator"),o=!1;try{var i=0,s={next:function(){return{done:!!i++}},return:function(){o=!0}};s[r]=function(){return this},Array.from(s,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!o)return!1;var n=!1;try{var i={};i[r]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch(e){}return n}},function(e,t,n){var r=n(6),o=n(13),i=n(5)("species");e.exports=function(e,t){var n,s=r(e).constructor;return void 0===s||null==(n=r(s)[i])?t:o(n)}},function(e,t,n){var r,o,i,s,a,c,u,l,d=n(4),p=n(39).f,h=n(87).set,f=n(88),g=n(158),m=n(47),y=d.MutationObserver||d.WebKitMutationObserver,v=d.document,b=d.process,T=d.Promise,w=p(d,"queueMicrotask"),E=w&&w.value;E||(r=function(){var e,t;for(m&&(e=b.domain)&&e.exit();o;){t=o.fn,o=o.next;try{t()}catch(e){throw o?s():i=void 0,e}}i=void 0,e&&e.enter()},f||m||g||!y||!v?T&&T.resolve?(u=T.resolve(void 0),l=u.then,s=function(){l.call(u,r)}):s=m?function(){b.nextTick(r)}:function(){h.call(d,r)}:(a=!0,c=v.createTextNode(""),new y(r).observe(c,{characterData:!0}),s=function(){c.data=a=!a})),e.exports=E||function(e){var t={fn:e,next:void 0};i&&(i.next=t),o||(o=t,s()),i=t}},function(e,t,n){var r=n(62);e.exports=/web0s(?!.*chrome)/i.test(r)},function(e,t,n){var r=n(6),o=n(11),i=n(89);e.exports=function(e,t){if(r(e),o(t)&&t.constructor===e)return t;var n=i.f(e);return(0,n.resolve)(t),n.promise}},function(e,t){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},function(e,t,n){var r=n(46),o=n(52),i=function(e){return function(t,n){var i,s,a=String(o(t)),c=r(n),u=a.length;return c<0||c>=u?e?"":void 0:(i=a.charCodeAt(c))<55296||i>56319||c+1===u||(s=a.charCodeAt(c+1))<56320||s>57343?e?a.charAt(c):i:e?a.slice(c,c+2):s-56320+(i-55296<<10)+65536}};e.exports={codeAt:i(!1),charAt:i(!0)}},function(e,t,n){"use strict";var r=n(93).IteratorPrototype,o=n(49),i=n(31),s=n(24),a=n(33),c=function(){return this};e.exports=function(e,t,n){var u=t+" Iterator";return e.prototype=o(r,{next:i(1,n)}),s(e,u,!1,!0),a[u]=c,e}},function(e,t,n){var r=n(14);e.exports=!r((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},function(e,t,n){var r=n(6),o=n(165);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,i){return r(n),o(i),t?e.call(n,i):n.__proto__=i,n}}():void 0)},function(e,t,n){var r=n(11);e.exports=function(e){if(!r(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},function(e,t,n){"use strict";var r=n(3),o=n(68),i=n(12),s=n(9),a=n(5),c=n(167),u=n(23),l=a("toStringTag"),d=function(){o(this,d)};d.prototype=c,s(c,l)||i(c,l,"AsyncIterator"),s(c,"constructor")&&c.constructor!==Object||i(c,"constructor",d),r({global:!0,forced:u},{AsyncIterator:d})},function(e,t,n){var r,o,i=n(4),s=n(42),a=n(70),c=n(9),u=n(12),l=n(5),d=n(23),p=l("asyncIterator"),h=i.AsyncIterator,f=s.AsyncIteratorPrototype;if(!d)if(f)r=f;else if("function"==typeof h)r=h.prototype;else if(s.USE_FUNCTION_CONSTRUCTOR||i.USE_FUNCTION_CONSTRUCTOR)try{o=a(a(a(Function("return async function*(){}()")()))),a(o)===Object.prototype&&(r=o)}catch(e){}r||(r={}),c(r,p)||u(r,p,(function(){return this})),e.exports=r},function(e,t,n){"use strict";var r=n(3),o=n(6),i=n(25)((function(e,t){var n=this,r=n.iterator;return t.resolve(o(n.next.call(r,e))).then((function(e){return o(e).done?(n.done=!0,{done:!0,value:void 0}):{done:!1,value:[n.index++,e.value]}}))}));r({target:"AsyncIterator",proto:!0,real:!0},{asIndexedPairs:function(){return new i({iterator:o(this),index:0})}})},function(e,t,n){"use strict";var r=n(3),o=n(6),i=n(94),s=n(25)((function(e,t){var n=this;return new t((function(r,i){var s=function(){try{t.resolve(o(n.next.call(n.iterator,n.remaining?void 0:e))).then((function(e){try{o(e).done?(n.done=!0,r({done:!0,value:void 0})):n.remaining?(n.remaining--,s()):r({done:!1,value:e.value})}catch(e){i(e)}}),i)}catch(e){i(e)}};s()}))}));r({target:"AsyncIterator",proto:!0,real:!0},{drop:function(e){return new s({iterator:o(this),remaining:i(e)})}})},function(e,t,n){"use strict";var r=n(3),o=n(34).every;r({target:"AsyncIterator",proto:!0,real:!0},{every:function(e){return o(this,e)}})},function(e,t,n){"use strict";var r=n(3),o=n(13),i=n(6),s=n(25)((function(e,t){var n=this,r=n.filterer;return new t((function(o,s){var a=function(){try{t.resolve(i(n.next.call(n.iterator,e))).then((function(e){try{if(i(e).done)n.done=!0,o({done:!0,value:void 0});else{var c=e.value;t.resolve(r(c)).then((function(e){e?o({done:!1,value:c}):a()}),s)}}catch(e){s(e)}}),s)}catch(e){s(e)}};a()}))}));r({target:"AsyncIterator",proto:!0,real:!0},{filter:function(e){return new s({iterator:i(this),filterer:o(e)})}})},function(e,t,n){"use strict";var r=n(3),o=n(34).find;r({target:"AsyncIterator",proto:!0,real:!0},{find:function(e){return o(this,e)}})},function(e,t,n){"use strict";var r=n(3),o=n(13),i=n(6),s=n(25),a=n(95),c=s((function(e,t){var n,r,s=this,c=s.mapper;return new t((function(u,l){var d=function(){try{t.resolve(i(s.next.call(s.iterator,e))).then((function(e){try{i(e).done?(s.done=!0,u({done:!0,value:void 0})):t.resolve(c(e.value)).then((function(e){try{if(void 0!==(r=a(e)))return s.innerIterator=n=i(r.call(e)),s.innerNext=o(n.next),p();l(TypeError(".flatMap callback should return an iterable object"))}catch(e){l(e)}}),l)}catch(e){l(e)}}),l)}catch(e){l(e)}},p=function(){if(n=s.innerIterator)try{t.resolve(i(s.innerNext.call(n))).then((function(e){try{i(e).done?(s.innerIterator=s.innerNext=null,d()):u({done:!1,value:e.value})}catch(e){l(e)}}),l)}catch(e){l(e)}else d()};p()}))}));r({target:"AsyncIterator",proto:!0,real:!0},{flatMap:function(e){return new c({iterator:i(this),mapper:o(e),innerIterator:null,innerNext:null})}})},function(e,t,n){"use strict";var r=n(3),o=n(34).forEach;r({target:"AsyncIterator",proto:!0,real:!0},{forEach:function(e){return o(this,e)}})},function(e,t,n){var r=n(3),o=n(19),i=n(13),s=n(6),a=n(32),c=n(25),u=n(95),l=o.AsyncIterator,d=c((function(e){return s(this.next.call(this.iterator,e))}),!0);r({target:"AsyncIterator",stat:!0},{from:function(e){var t,n=a(e),r=u(n);if(null!=r){if((t=i(r).call(n))instanceof l)return t}else t=n;return new d({iterator:t})}})},function(e,t,n){"use strict";var r=n(3),o=n(13),i=n(6),s=n(25)((function(e,t){var n=this,r=n.mapper;return t.resolve(i(n.next.call(n.iterator,e))).then((function(e){return i(e).done?(n.done=!0,{done:!0,value:void 0}):t.resolve(r(e.value)).then((function(e){return{done:!1,value:e}}))}))}));r({target:"AsyncIterator",proto:!0,real:!0},{map:function(e){return new s({iterator:i(this),mapper:o(e)})}})},function(e,t,n){"use strict";var r=n(3),o=n(13),i=n(6),s=n(18)("Promise");r({target:"AsyncIterator",proto:!0,real:!0},{reduce:function(e){var t=i(this),n=o(t.next),r=arguments.length<2,a=r?void 0:arguments[1];return o(e),new s((function(o,c){var u=function(){try{s.resolve(i(n.call(t))).then((function(t){try{if(i(t).done)r?c(TypeError("Reduce of empty iterator with no initial value")):o(a);else{var n=t.value;r?(r=!1,a=n,u()):s.resolve(e(a,n)).then((function(e){a=e,u()}),c)}}catch(e){c(e)}}),c)}catch(e){c(e)}};u()}))}})},function(e,t,n){"use strict";var r=n(3),o=n(34).some;r({target:"AsyncIterator",proto:!0,real:!0},{some:function(e){return o(this,e)}})},function(e,t,n){"use strict";var r=n(3),o=n(6),i=n(94),s=n(25)((function(e,t){var n,r,o=this.iterator;return this.remaining--?this.next.call(o,e):(r={done:!0,value:void 0},this.done=!0,void 0!==(n=o.return)?t.resolve(n.call(o)).then((function(){return r})):r)}));r({target:"AsyncIterator",proto:!0,real:!0},{take:function(e){return new s({iterator:o(this),remaining:i(e)})}})},function(e,t,n){"use strict";var r=n(3),o=n(34).toArray;r({target:"AsyncIterator",proto:!0,real:!0},{toArray:function(){return o(this)}})},function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(e,t,n){"use strict";var r=n(21),o=n(183),i=n(33),s=n(22),a=n(92),c=s.set,u=s.getterFor("Array Iterator");e.exports=a(Array,"Array",(function(e,t){c(this,{type:"Array Iterator",target:r(e),index:0,kind:t})}),(function(){var e=u(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values"),i.Arguments=i.Array,o("keys"),o("values"),o("entries")},function(e,t,n){var r=n(5),o=n(49),i=n(15),s=r("unscopables"),a=Array.prototype;null==a[s]&&i.f(a,s,{configurable:!0,value:o(null)}),e.exports=function(e){a[s][e]=!0}},function(e,t,n){n(185);var r=n(19);e.exports=r.Object.is},function(e,t,n){n(3)({target:"Object",stat:!0},{is:n(186)})},function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},function(e,t,n){n(188);var r=n(19);e.exports=r.Object.entries},function(e,t,n){var r=n(3),o=n(189).entries;r({target:"Object",stat:!0},{entries:function(e){return o(e)}})},function(e,t,n){var r=n(17),o=n(65),i=n(21),s=n(51).f,a=function(e){return function(t){for(var n,a=i(t),c=o(a),u=c.length,l=0,d=[];u>l;)n=c[l++],r&&!s.call(a,n)||d.push(e?[n,a[n]]:a[n]);return d}};e.exports={entries:a(!0),values:a(!1)}},function(e,t,n){"use strict";var r=n(3),o=n(17),i=n(85),s=n(13),a=n(6),c=n(11),u=n(68),l=n(15).f,d=n(12),p=n(67),h=n(191),f=n(86),g=n(90),m=n(5),y=n(22),v=m("observable"),b=y.get,T=y.set,w=function(e){return null==e?void 0:s(e)},E=function(e){var t=e.cleanup;if(t){e.cleanup=void 0;try{t()}catch(e){g(e)}}},S=function(e){return void 0===e.observer},R=function(e,t){if(!o){e.closed=!0;var n=t.subscriptionObserver;n&&(n.closed=!0)}t.observer=void 0},C=function(e,t){var n,r=T(this,{cleanup:void 0,observer:a(e),subscriptionObserver:void 0});o||(this.closed=!1);try{(n=w(e.start))&&n.call(e,this)}catch(e){g(e)}if(!S(r)){var i=r.subscriptionObserver=new O(this);try{var c=t(i),u=c;null!=c&&(r.cleanup="function"==typeof c.unsubscribe?function(){u.unsubscribe()}:s(c))}catch(e){return void i.error(e)}S(r)&&E(r)}};C.prototype=p({},{unsubscribe:function(){var e=b(this);S(e)||(R(this,e),E(e))}}),o&&l(C.prototype,"closed",{configurable:!0,get:function(){return S(b(this))}});var O=function(e){T(this,{subscription:e}),o||(this.closed=!1)};O.prototype=p({},{next:function(e){var t=b(b(this).subscription);if(!S(t)){var n=t.observer;try{var r=w(n.next);r&&r.call(n,e)}catch(e){g(e)}}},error:function(e){var t=b(this).subscription,n=b(t);if(!S(n)){var r=n.observer;R(t,n);try{var o=w(r.error);o?o.call(r,e):g(e)}catch(e){g(e)}E(n)}},complete:function(){var e=b(this).subscription,t=b(e);if(!S(t)){var n=t.observer;R(e,t);try{var r=w(n.complete);r&&r.call(n)}catch(e){g(e)}E(t)}}}),o&&l(O.prototype,"closed",{configurable:!0,get:function(){return S(b(b(this).subscription))}});var I=function(e){u(this,I,"Observable"),T(this,{subscriber:s(e)})};p(I.prototype,{subscribe:function(e){var t=arguments.length;return new C("function"==typeof e?{next:e,error:t>1?arguments[1]:void 0,complete:t>2?arguments[2]:void 0}:c(e)?e:{},b(this).subscriber)}}),p(I,{from:function(e){var t="function"==typeof this?this:I,n=w(a(e)[v]);if(n){var r=a(n.call(e));return r.constructor===t?r:new t((function(e){return r.subscribe(e)}))}var o=h(e);return new t((function(e){f(o,(function(t,n){if(e.next(t),e.closed)return n()}),{IS_ITERATOR:!0,INTERRUPTED:!0}),e.complete()}))},of:function(){for(var e="function"==typeof this?this:I,t=arguments.length,n=new Array(t),r=0;r<t;)n[r]=arguments[r++];return new e((function(e){for(var r=0;r<t;r++)if(e.next(n[r]),e.closed)return;e.complete()}))}}),d(I.prototype,v,(function(){return this})),r({global:!0},{Observable:I}),i("Observable")},function(e,t,n){var r=n(6),o=n(69);e.exports=function(e){var t=o(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return r(t.call(e))}},function(e,t,n){var r=n(193);e.exports=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(r(e).replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(e){return r(t)}}},function(e,t){function n(e){this.message=e}n.prototype=new Error,n.prototype.name="InvalidCharacterError",e.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new n("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,o,i=0,s=0,a="";o=t.charAt(s++);~o&&(r=i%4?64*r+o:o,i++%4)?a+=String.fromCharCode(255&r>>(-2*i&6)):0)o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(o);return a}},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var r=n(195),o=n(196),i=n(197);function s(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=p(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|f(t,n),o=(e=a(e,r)).write(t,n);o!==r&&(e=e.slice(0,o));return e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|h(t.length);return 0===(e=a(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?a(e,0):p(e,t);if("Buffer"===t.type&&i(t.data))return p(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(l(t),e=a(e,t<0?0:0|h(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function p(e,t){var n=t.length<0?0:0|h(t.length);e=a(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function h(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function f(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return z(e).length;default:if(r)return B(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return P(this,t,n);case"utf8":case"utf-8":return O(this,t,n);case"ascii":return I(this,t,n);case"latin1":case"binary":return A(this,t,n);case"base64":return C(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,o){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=o?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(o)return-1;n=e.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:v(e,t,n,r,o);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,r,o);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,r,o){var i,s=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,n/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(o){var l=-1;for(i=n;i<a;i++)if(u(e,i)===u(t,-1===l?0:i-l)){if(-1===l&&(l=i),i-l+1===c)return l*s}else-1!==l&&(i-=i-l),l=-1}else for(n+c>a&&(n=a-c),i=n;i>=0;i--){for(var d=!0,p=0;p<c;p++)if(u(e,i+p)!==u(t,p)){d=!1;break}if(d)return i}return-1}function b(e,t,n,r){n=Number(n)||0;var o=e.length-n;r?(r=Number(r))>o&&(r=o):r=o;var i=t.length;if(i%2!=0)throw new TypeError("Invalid hex string");r>i/2&&(r=i/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function T(e,t,n,r){return H(B(t,e.length-n),e,n,r)}function w(e,t,n,r){return H(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function E(e,t,n,r){return w(e,t,n,r)}function S(e,t,n,r){return H(z(t),e,n,r)}function R(e,t,n,r){return H(function(e,t){for(var n,r,o,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,o=n%256,i.push(o),i.push(r);return i}(t,e.length-n),e,n,r)}function C(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function O(e,t,n){n=Math.min(e.length,n);for(var r=[],o=t;o<n;){var i,s,a,c,u=e[o],l=null,d=u>239?4:u>223?3:u>191?2:1;if(o+d<=n)switch(d){case 1:u<128&&(l=u);break;case 2:128==(192&(i=e[o+1]))&&(c=(31&u)<<6|63&i)>127&&(l=c);break;case 3:i=e[o+1],s=e[o+2],128==(192&i)&&128==(192&s)&&(c=(15&u)<<12|(63&i)<<6|63&s)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:i=e[o+1],s=e[o+2],a=e[o+3],128==(192&i)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&i)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(l=c)}null===l?(l=65533,d=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),o+=d}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return u(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?a(e,t):void 0!==n?"string"==typeof r?a(e,t).fill(n,r):a(e,t).fill(n):a(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return d(null,e)},c.allocUnsafeSlow=function(e){return d(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,o=0,i=Math.min(n,r);o<i;++o)if(e[o]!==t[o]){n=e[o],r=t[o];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!i(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=c.allocUnsafe(t),o=0;for(n=0;n<e.length;++n){var s=e[n];if(!c.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,o),o+=s.length}return r},c.byteLength=f,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?O(this,0,e):g.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,r,o){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),t<0||n>e.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&t>=n)return 0;if(r>=o)return-1;if(t>=n)return 1;if(this===e)return 0;for(var i=(o>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(i,s),u=this.slice(r,o),l=e.slice(t,n),d=0;d<a;++d)if(u[d]!==l[d]){i=u[d],s=l[d];break}return i<s?-1:s<i?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var o=this.length-t;if((void 0===n||n>o)&&(n=o),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return T(this,e,t,n);case"ascii":return w(this,e,t,n);case"latin1":case"binary":return E(this,e,t,n);case"base64":return S(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function I(e,t,n){var r="";n=Math.min(e.length,n);for(var o=t;o<n;++o)r+=String.fromCharCode(127&e[o]);return r}function A(e,t,n){var r="";n=Math.min(e.length,n);for(var o=t;o<n;++o)r+=String.fromCharCode(e[o]);return r}function P(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var o="",i=t;i<n;++i)o+=q(e[i]);return o}function _(e,t,n){for(var r=e.slice(t,n),o="",i=0;i<r.length;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}function x(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function k(e,t,n,r,o,i){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function N(e,t,n,r){t<0&&(t=65535+t+1);for(var o=0,i=Math.min(e.length-n,2);o<i;++o)e[n+o]=(t&255<<8*(r?o:1-o))>>>8*(r?o:1-o)}function M(e,t,n,r){t<0&&(t=4294967295+t+1);for(var o=0,i=Math.min(e.length-n,4);o<i;++o)e[n+o]=t>>>8*(r?o:3-o)&255}function D(e,t,n,r,o,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function j(e,t,n,r,i){return i||D(e,0,n,4),o.write(e,t,n,r,23,4),n+4}function U(e,t,n,r,i){return i||D(e,0,n,8),o.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var o=t-e;n=new c(o,void 0);for(var i=0;i<o;++i)n[i]=this[i+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||x(e,t,this.length);for(var r=this[e],o=1,i=0;++i<t&&(o*=256);)r+=this[e+i]*o;return r},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||x(e,t,this.length);for(var r=this[e+--t],o=1;t>0&&(o*=256);)r+=this[e+--t]*o;return r},c.prototype.readUInt8=function(e,t){return t||x(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||x(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||x(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||x(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||x(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||x(e,t,this.length);for(var r=this[e],o=1,i=0;++i<t&&(o*=256);)r+=this[e+i]*o;return r>=(o*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||x(e,t,this.length);for(var r=t,o=1,i=this[e+--r];r>0&&(o*=256);)i+=this[e+--r]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*t)),i},c.prototype.readInt8=function(e,t){return t||x(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||x(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||x(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||x(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||x(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||x(e,4,this.length),o.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||x(e,4,this.length),o.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||x(e,8,this.length),o.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||x(e,8,this.length),o.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||k(this,e,t,n,Math.pow(2,8*n)-1,0);var o=1,i=0;for(this[t]=255&e;++i<n&&(o*=256);)this[t+i]=e/o&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||k(this,e,t,n,Math.pow(2,8*n)-1,0);var o=n-1,i=1;for(this[t+o]=255&e;--o>=0&&(i*=256);)this[t+o]=e/i&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||k(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||k(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):N(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||k(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):N(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||k(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):M(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||k(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var o=Math.pow(2,8*n-1);k(this,e,t,n,o-1,-o)}var i=0,s=1,a=0;for(this[t]=255&e;++i<n&&(s*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var o=Math.pow(2,8*n-1);k(this,e,t,n,o-1,-o)}var i=n-1,s=1,a=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||k(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||k(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):N(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||k(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):N(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||k(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):M(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||k(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return j(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return j(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return U(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return U(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var o,i=r-n;if(this===e&&n<t&&t<r)for(o=i-1;o>=0;--o)e[o+t]=this[o+n];else if(i<1e3||!c.TYPED_ARRAY_SUPPORT)for(o=0;o<i;++o)e[o+t]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+i),t);return i},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var s=c.isBuffer(e)?e:B(new c(e,r).toString()),a=s.length;for(i=0;i<n-t;++i)this[i+t]=s[i%a]}return this};var L=/[^+\/0-9A-Za-z-_]/g;function q(e){return e<16?"0"+e.toString(16):e.toString(16)}function B(e,t){var n;t=t||1/0;for(var r=e.length,o=null,i=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!o){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&i.push(239,191,189);continue}o=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function z(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(L,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function H(e,t,n,r){for(var o=0;o<r&&!(o+n>=t.length||o>=e.length);++o)t[o+n]=e[o];return o}}).call(this,n(38))},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=u(e),s=r[0],a=r[1],c=new i(function(e,t,n){return 3*(t+n)/4-n}(0,s,a)),l=0,d=a>0?s-4:s;for(n=0;n<d;n+=4)t=o[e.charCodeAt(n)]<<18|o[e.charCodeAt(n+1)]<<12|o[e.charCodeAt(n+2)]<<6|o[e.charCodeAt(n+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;2===a&&(t=o[e.charCodeAt(n)]<<2|o[e.charCodeAt(n+1)]>>4,c[l++]=255&t);1===a&&(t=o[e.charCodeAt(n)]<<10|o[e.charCodeAt(n+1)]<<4|o[e.charCodeAt(n+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t);return c},t.fromByteArray=function(e){for(var t,n=e.length,o=n%3,i=[],s=0,a=n-o;s<a;s+=16383)i.push(l(e,s,s+16383>a?a:s+16383));1===o?(t=e[n-1],i.push(r[t>>2]+r[t<<4&63]+"==")):2===o&&(t=(e[n-2]<<8)+e[n-1],i.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return i.join("")};for(var r=[],o=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)r[a]=s[a],o[s.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var o,i,s=[],a=t;a<n;a+=3)o=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[(i=o)>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},function(e,t){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
t.read=function(e,t,n,r,o){var i,s,a=8*o-r-1,c=(1<<a)-1,u=c>>1,l=-7,d=n?o-1:0,p=n?-1:1,h=e[t+d];for(d+=p,i=h&(1<<-l)-1,h>>=-l,l+=a;l>0;i=256*i+e[t+d],d+=p,l-=8);for(s=i&(1<<-l)-1,i>>=-l,l+=r;l>0;s=256*s+e[t+d],d+=p,l-=8);if(0===i)i=1-u;else{if(i===c)return s?NaN:1/0*(h?-1:1);s+=Math.pow(2,r),i-=u}return(h?-1:1)*s*Math.pow(2,i-r)},t.write=function(e,t,n,r,o,i){var s,a,c,u=8*i-o-1,l=(1<<u)-1,d=l>>1,p=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:i-1,f=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+d>=1?p/c:p*Math.pow(2,1-d))*c>=2&&(s++,c/=2),s+d>=l?(a=0,s=l):s+d>=1?(a=(t*c-1)*Math.pow(2,o),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,o),s=0));o>=8;e[n+h]=255&a,h+=f,a/=256,o-=8);for(s=s<<o|a,u+=o;u>0;e[n+h]=255&s,h+=f,s/=256,u-=8);e[n+h-f]|=128*g}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";void 0!==typeof Symbol&&Symbol.asyncIterator||(Symbol.asyncIterator=Symbol.for("Symbol.asyncIterator"))},function(e,t){var n="undefined"!=typeof window?window:self;e.exports=n.crypto||n.msCrypto},function(e,t,n){"use strict";n.r(t),n.d(t,"createACSAdapter",(function(){return to})),n.d(t,"OneDriveFileManager",(function(){return eo})),n.d(t,"LogLevel",(function(){return D})),n.d(t,"Logger",(function(){return j})),n.d(t,"StateKey",(function(){return S})),n.d(t,"ReadyState",(function(){return r})),n.d(t,"BOT_ADAPTIVE_CARD_METADATA_KEY",(function(){return Br})),n.d(t,"BOT_ADAPTIVE_CARD_METADATA_VALUE",(function(){return zr})),n.d(t,"ChannelDataTypes",(function(){return Lr})),n.d(t,"ActivityType",(function(){return Rr})),n.d(t,"Role",(function(){return Cr})),n.d(t,"LogEvent",(function(){return pr}));var r,o={};n.r(o),n.d(o,"ChatMessageReadReceiptsCollection",(function(){return Ce})),n.d(o,"ChatMessageReadReceipt",(function(){return Oe})),n.d(o,"CommunicationIdentifierModel",(function(){return Ie})),n.d(o,"CommunicationUserIdentifierModel",(function(){return Ae})),n.d(o,"PhoneNumberIdentifierModel",(function(){return Pe})),n.d(o,"MicrosoftTeamsUserIdentifierModel",(function(){return _e})),n.d(o,"CommunicationErrorResponse",(function(){return xe})),n.d(o,"ChatError",(function(){return ke})),n.d(o,"SendReadReceiptRequest",(function(){return Ne})),n.d(o,"SendChatMessageRequest",(function(){return Me})),n.d(o,"SendChatMessageResult",(function(){return De})),n.d(o,"ChatMessagesCollection",(function(){return je})),n.d(o,"ChatMessage",(function(){return Ue})),n.d(o,"ChatMessageContent",(function(){return Le})),n.d(o,"ChatParticipant",(function(){return qe})),n.d(o,"UpdateChatMessageRequest",(function(){return Be})),n.d(o,"ChatParticipantsCollection",(function(){return ze})),n.d(o,"AddChatParticipantsRequest",(function(){return He})),n.d(o,"AddChatParticipantsResult",(function(){return Fe})),n.d(o,"CreateChatThreadRequest",(function(){return $e})),n.d(o,"CreateChatThreadResult",(function(){return Ge})),n.d(o,"ChatThreadProperties",(function(){return Ve})),n.d(o,"ChatThreadsItemCollection",(function(){return Je})),n.d(o,"ChatThreadItem",(function(){return We})),n.d(o,"UpdateChatThreadRequest",(function(){return Ye})),n.d(o,"SendTypingNotificationRequest",(function(){return Ke})),function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSED=2]="CLOSED"}(r||(r={}));n(71);var i=function(){return Math.random().toString(36).substring(7).split("").join(".")};i(),i();function s(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function a(e,t){return(...n)=>r=>o=>{const i=r(o);if(Object.getPrototypeOf(i)!==Object.prototype)throw new Error("One of the enhancer is returning the adapter as a class object. This is not supported.");let a=()=>{throw new Error("Calling function while constructing your middleware is not allowed. Other middleware would not be applied to this function.")};const c=t(function(e){return{close:(...t)=>e.close(...t),egress:(...t)=>e.egress(...t),getReadyState:(...t)=>e.getReadyState(...t),getState:t=>e.getState(t),ingress:(...t)=>e.ingress(...t),setReadyState:(...t)=>e.setReadyState(...t),setState:(t,n)=>e.setState(t,n),subscribe:(...t)=>e.subscribe(...t)}}(i),(...e)=>a(...e)),u=n.map(e=>e(c));if(u.some(e=>"function"!=typeof e))throw new Error("All middlewares must return a function after caling with middleware API.");return a=s(...u)(e(i)),Object.assign(Object.assign({},i),t(i,a))}}var c=n(0),u=(n(115),n(150),n(98)),l=n.n(u),d=n(99),p=n.n(d),h=n(100),f=n.n(h);const g=Symbol();function m(e={}){const t=function(e){const t=new Error("aborted");if(e&&e.aborted)return Promise.reject(t);const n=f()(),r=()=>{e.removeEventListener("abort",r),n.reject(t)};return e&&e.addEventListener("abort",r),n.promise}(e.signal),n=[];let r,o;return t.catch(()=>{}),{iterable:{[Symbol.asyncIterator](){return Object(c.a)(this,arguments,(function*(){if(r)throw new Error("asyncIterableQueue: You can only iterate once. The iteration has already started or finished.");for(r=!0;;){n.length?yield Object(c.c)(e.signal&&e.signal.aborted&&t):(yield Object(c.c)(Promise.race([t,(o||(o=l()())).promise])),o=null);const r=n.shift();if(p()(r,g))break;yield yield Object(c.c)(r)}}))}},end(){n.push(g)},push(e){n.push(e),o&&o.resolve()},watermark:()=>n.length}}var y=n(101),v=n.n(y),b=n(102),T=n.n(b);const w={};const E=e=>t=>e(t);var S,R,C=n(20),O=n.n(C),I=n(103),A=n.n(I);function P(e){let t,n=[];return new O.a(r=>(n=[...n,r],t||(t=e.subscribe({complete:()=>n.forEach(e=>e.complete()),error:e=>n.forEach(t=>t.error(e)),next:e=>n.forEach(t=>t.next(e))})),()=>{n=n.filter(e=>e!==r),n.length||(t.unsubscribe(),t=void 0)}))}function _(e){return new Promise(t=>setTimeout(()=>{t()},e))}!function(e){e.BotId="acs.botId",e.ChatClient="acs.chatClient",e.ChatThreadClient="acs.chatThreadClient",e.Reconnect="acs.reconnect",e.UserId="acs.userId",e.UserDisplayName="acs.userDisplayName",e.AuthConfig="acs.authConfig",e.ConnectionStatusObserverReady="dl.connectionStatusObserverReady",e.ThreadId="acs.threadId",e.DisconnectUTC="acs.disconnectUTC",e.AdapterOptions="acs.adapterOptions",e.EventManager="acs.eventManager",e.EnvironmentUrl="acs.environmentUrl",e.Token="acs.token",e.FileManager="fileManager",e.PollingInterval="pollingInterval"}(S||(S={})),function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Connecting=1]="Connecting",e[e.Connected=2]="Connected",e[e.FailedToConnect=4]="FailedToConnect"}(R||(R={}));var x=function(e={},t=E){const n={};let o,i=!1;const s=t(()=>{const e=new v.a,t=[];let a=r.CONNECTING;return{addEventListener:e.addEventListener.bind(e),dispatchEvent:e.dispatchEvent.bind(e),removeEventListener:e.removeEventListener.bind(e),activities:({signal:e}={})=>{const n=m({signal:e});return t.push(n),e&&e.addEventListener("abort",()=>{const e=t.indexOf(n);~e||t.splice(e,1)}),n.iterable},close:()=>{t.forEach(e=>e.end()),t.splice(0,1/0),o&&o.unsubscribe(),o=null},egress:()=>Promise.resolve(),getState:e=>n[e],getReadyState:()=>a,ingress:e=>{t.forEach(t=>t.push(e))},setState:(e,t)=>{if(i&&!(e in n))throw new Error(`Cannot set config "${e}" because it was not set before being sealed.`);n[e]=t},setReadyState:t=>{if(t!==a){if(a===r.CLOSED)throw new Error('Cannot change "readyState" after it is CLOSED.');if(t!==r.CLOSED&&t!==r.CONNECTING&&t!==r.OPEN)throw new Error('"readyState" must be either CLOSED, CONNECTING or OPEN.');a=t,t===r.CLOSED&&(o&&o.unsubscribe(),o=null),e.dispatchEvent(function(e,t){if("function"==typeof Event)return new Event(e,t);const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!0,!0,void 0),T()(null!=t?t:w).forEach(([e,t])=>{n[e]=t}),n}(t===r.OPEN?"open":"error"))}},subscribe:e=>{if(o&&o.unsubscribe(),o=null,!e)return;let t;e.subscribe({start(e){o=e,t=e},complete(){o===t&&(o=null)},error(){o===t&&(o=null)},next(e){s.ingress(e)}})}}})(e);if(Object.getPrototypeOf(s)!==Object.prototype)throw new Error("Object returned from enhancer must not be a class object.");const a=function(e,t){const{getReadyState:n}=e,r=Object(c.f)(e,["getReadyState"]),o=Object.assign(Object.assign({},r),{readyState:-1});for(const e in t)Object.defineProperty(o,e,{enumerable:!0,get:()=>t[e]});return Object.defineProperty(o,"readyState",{get:()=>n()}),Object.seal(o)}(s,n);return i=!0,a};const{CLOSED:k,CONNECTING:N,OPEN:M}=r;var D;!function(e){e.INFO="INFO",e.DEBUG="DEBUG",e.WARN="WARN",e.ERROR="ERROR"}(D||(D={}));const j={loggerInstance:void 0,setInstance:e=>{j.loggerInstance=e},logEvent:(e,t)=>{void 0!==j.loggerInstance&&j.loggerInstance.logEvent(e,t)}};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function U(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}Object.create;function L(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function q(e){return this instanceof q?(this.v=e,this):new q(e)}function B(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(e){o[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||a(e,t)}))})}function a(e,t){try{(n=o[e](t)).value instanceof q?Promise.resolve(n.value.v).then(c,u):l(i[0][2],n)}catch(e){l(i[0][3],e)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}function z(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,o){t[r]=e[r]?function(t){return(n=!n)?{value:q(e[r](t)),done:"return"===r}:o?o(t):t}:o}}function H(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=L(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,o,(t=e[n](t)).done,t.value)}))}}}Object.create;var F=n(30);const $=Object(F.a)("communication-chat");var G=n(105),V=n(107);var J=n(36),W=n(208);const Y=Object(W.a)({packagePrefix:"Azure.Communication",namespace:"Microsoft.Communication"}),K=(e,t)=>void 0===t?e:Object.assign(Object.assign({},e),{rawId:t}),X=(e,t)=>{const n=Object.keys(e)[0],r=e[n];if(t in r)return r[t];throw new Error(`Property ${t} is required for identifier of type ${n}.`)},Q=e=>{var t,n;const r=(e=>(e=>"string"==typeof e.communicationUserId)(e)?Object.assign(Object.assign({},e),{kind:"communicationUser"}):(e=>"string"==typeof e.phoneNumber)(e)?Object.assign(Object.assign({},e),{kind:"phoneNumber"}):(e=>"string"==typeof e.microsoftTeamsUserId)(e)?Object.assign(Object.assign({},e),{kind:"microsoftTeamsUser"}):Object.assign(Object.assign({},e),{kind:"unknown"}))(e);switch(r.kind){case"communicationUser":return{communicationUser:{id:r.communicationUserId}};case"phoneNumber":return K({phoneNumber:{value:r.phoneNumber}},r.rawId);case"microsoftTeamsUser":return K({microsoftTeamsUser:{userId:r.microsoftTeamsUserId,isAnonymous:null!==(t=r.isAnonymous)&&void 0!==t&&t,cloud:null!==(n=r.cloud)&&void 0!==n?n:"public"}},r.rawId);case"unknown":return{rawId:r.id};default:throw new Error("Can't serialize an identifier with kind "+r.kind)}},Z=e=>{(e=>{const{rawId:t}=e,n=U(e,["rawId"]),r=Object.keys(n);if(r.length>1)throw new Error(`Only one of the properties in ${JSON.stringify(r)} should be present.`)})(e);const{communicationUser:t,microsoftTeamsUser:n,phoneNumber:r}=e;return t?{kind:"communicationUser",communicationUserId:X({communicationUser:t},"id")}:r?{kind:"phoneNumber",phoneNumber:X({phoneNumber:r},"value"),rawId:X({phoneNumber:e},"rawId")}:n?{kind:"microsoftTeamsUser",microsoftTeamsUserId:X({microsoftTeamsUser:n},"userId"),isAnonymous:X({microsoftTeamsUser:n},"isAnonymous"),cloud:X({microsoftTeamsUser:n},"cloud"),rawId:X({microsoftTeamsUser:e},"rawId")}:{kind:"unknown",id:X({unknown:e},"rawId")}},ee=e=>{const{id:t}=e,n=U(e,["id"]);return Object.assign(Object.assign({},n),{communicationIdentifier:Q(t)})},te=e=>{const{communicationIdentifier:t}=e,n=U(e,["communicationIdentifier"]);return Object.assign(Object.assign({},n),{id:Z(t)})},ne=e=>{const{participants:t,initiatorCommunicationIdentifier:n}=e,r=U(e,["participants","initiatorCommunicationIdentifier"]);let o=Object.assign({},r);if(n){const e=Z(n);o=Object.assign(Object.assign({},o),{initiator:e})}return t&&(o=Object.assign(Object.assign({},o),{participants:null==t?void 0:t.map(e=>te(e))})),o},re=e=>{const{content:t,senderCommunicationIdentifier:n}=e,r=U(e,["content","senderCommunicationIdentifier"]);let o=Object.assign({},r);if(t&&(o=Object.assign(Object.assign({},o),{content:ne(t)})),n){const e=Z(n);o=Object.assign(Object.assign({},o),{sender:e})}return o},oe=e=>{const{createdByCommunicationIdentifier:t}=e,n=U(e,["createdByCommunicationIdentifier"]);return t?Object.assign(Object.assign({},n),{createdBy:Z(t)}):Object.assign({},n)},ie=e=>{const{senderCommunicationIdentifier:t}=e,n=U(e,["senderCommunicationIdentifier"]);return Object.assign(Object.assign({},n),{sender:Z(t)})};const se=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;const ae=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i;function ce(e,t){var n,r;const o=e.parsedHeaders;if("HEAD"===e.request.method)return Object.assign(Object.assign({},o),{body:e.parsedBody});const i=t&&t.bodyMapper,s=Boolean(null==i?void 0:i.nullable),a=null==i?void 0:i.type.name;if("Stream"===a)return Object.assign(Object.assign({},o),{blobBody:e.blobBody,readableStreamBody:e.readableStreamBody});const c="Composite"===a&&i.type.modelProperties||{},u=Object.keys(c).some(e=>""===c[e].serializedName);if("Sequence"===a||u){const t=null!==(n=e.parsedBody)&&void 0!==n?n:[];for(const n of Object.keys(c))c[n].serializedName&&(t[n]=null===(r=e.parsedBody)||void 0===r?void 0:r[n]);if(o)for(const e of Object.keys(o))t[e]=o[e];return!s||e.parsedBody||o||0!==Object.getOwnPropertyNames(c).length?t:null}return function(e){const t=Object.assign(Object.assign({},e.headers),e.body);return e.hasNullableType&&0===Object.getOwnPropertyNames(t).length?e.shouldWrapBody?{body:null}:null:e.shouldWrapBody?Object.assign(Object.assign({},e.headers),{body:e.body}):t}({body:e.parsedBody,headers:o,hasNullableType:s,shouldWrapBody:(l=e.parsedBody,d=a,"Composite"!==d&&"Dictionary"!==d&&("string"==typeof l||"number"==typeof l||"boolean"==typeof l||null!==(null==d?void 0:d.match(/^(Date|DateTime|DateTimeRfc1123|UnixTime|ByteArray|Base64Url)$/i))||null==l))});var l,d}function ue(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function le(e){const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}const de="$";class pe{constructor(e={},t=!1){this.modelMappers=e,this.isXML=t}validateConstraints(e,t,n){const r=(e,r)=>{throw new Error(`"${n}" with value "${t}" should satisfy the constraint "${e}": ${r}.`)};if(e.constraints&&null!=t){const{ExclusiveMaximum:n,ExclusiveMinimum:o,InclusiveMaximum:i,InclusiveMinimum:s,MaxItems:a,MaxLength:c,MinItems:u,MinLength:l,MultipleOf:d,Pattern:p,UniqueItems:h}=e.constraints;if(void 0!==n&&t>=n&&r("ExclusiveMaximum",n),void 0!==o&&t<=o&&r("ExclusiveMinimum",o),void 0!==i&&t>i&&r("InclusiveMaximum",i),void 0!==s&&t<s&&r("InclusiveMinimum",s),void 0!==a&&t.length>a&&r("MaxItems",a),void 0!==c&&t.length>c&&r("MaxLength",c),void 0!==u&&t.length<u&&r("MinItems",u),void 0!==l&&t.length<l&&r("MinLength",l),void 0!==d&&t%d!=0&&r("MultipleOf",d),p){const e="string"==typeof p?new RegExp(p):p;"string"==typeof t&&null!==t.match(e)||r("Pattern",p)}h&&t.some((e,t,n)=>n.indexOf(e)!==t)&&r("UniqueItems",h)}}serialize(e,t,n,r={xml:{}}){var o,i,s;const a={xml:{rootName:null!==(o=r.xml.rootName)&&void 0!==o?o:"",includeRoot:null!==(i=r.xml.includeRoot)&&void 0!==i&&i,xmlCharKey:null!==(s=r.xml.xmlCharKey)&&void 0!==s?s:"_"}};let c={};const u=e.type.name;n||(n=e.serializedName),null!==u.match(/^Sequence$/i)&&(c=[]),e.isConstant&&(t=e.defaultValue);const{required:l,nullable:d}=e;if(l&&d&&void 0===t)throw new Error(n+" cannot be undefined.");if(l&&!d&&null==t)throw new Error(n+" cannot be null or undefined.");if(!l&&!1===d&&null===t)throw new Error(n+" cannot be null.");if(null==t)c=t;else if(this.validateConstraints(e,t,n),null!==u.match(/^any$/i))c=t;else if(null!==u.match(/^(Number|String|Boolean|Object|Stream|Uuid)$/i))c=function(e,t,n){if(null!=n)if(null!==e.match(/^Number$/i)){if("number"!=typeof n)throw new Error(`${t} with value ${n} must be of type number.`)}else if(null!==e.match(/^String$/i)){if("string"!=typeof n.valueOf())throw new Error(`${t} with value "${n}" must be of type string.`)}else if(null!==e.match(/^Uuid$/i)){if("string"!=typeof n.valueOf()||(r=n,!ae.test(r)))throw new Error(`${t} with value "${n}" must be of type string and a valid uuid.`)}else if(null!==e.match(/^Boolean$/i)){if("boolean"!=typeof n)throw new Error(`${t} with value ${n} must be of type boolean.`)}else if(null!==e.match(/^Stream$/i)){if(!("string"===typeof n||"function"==typeof n.pipe||n instanceof ArrayBuffer||ArrayBuffer.isView(n)||("function"==typeof Blob||"object"==typeof Blob)&&n instanceof Blob))throw new Error(t+" must be a string, Blob, ArrayBuffer, ArrayBufferView, or NodeJS.ReadableStream.")}var r;return n}(u,n,t);else if(null!==u.match(/^Enum$/i)){c=function(e,t,n){if(!t)throw new Error(`Please provide a set of allowedValues to validate ${e} as an Enum Type.`);if(!t.some(e=>"string"==typeof e.valueOf()?e.toLowerCase()===n.toLowerCase():e===n))throw new Error(`${n} is not a valid value for ${e}. The valid values are: ${JSON.stringify(t)}.`);return n}(n,e.type.allowedValues,t)}else null!==u.match(/^(Date|DateTime|TimeSpan|DateTimeRfc1123|UnixTime)$/i)?c=function(e,t,n){if(null!=t)if(null!==e.match(/^Date$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(n+" must be an instanceof Date or a string in ISO8601 format.");t=t instanceof Date?t.toISOString().substring(0,10):new Date(t).toISOString().substring(0,10)}else if(null!==e.match(/^DateTime$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(n+" must be an instanceof Date or a string in ISO8601 format.");t=t instanceof Date?t.toISOString():new Date(t).toISOString()}else if(null!==e.match(/^DateTimeRfc1123$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(n+" must be an instanceof Date or a string in RFC-1123 format.");t=t instanceof Date?t.toUTCString():new Date(t).toUTCString()}else if(null!==e.match(/^UnixTime$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(n+" must be an instanceof Date or a string in RFC-1123/ISO8601 format for it to be serialized in UnixTime/Epoch format.");t=function(e){if(!e)return;"string"==typeof e.valueOf()&&(e=new Date(e));return Math.floor(e.getTime()/1e3)}(t)}else if(null!==e.match(/^TimeSpan$/i)&&!function(e){return se.test(e)}(t))throw new Error(`${n} must be a string in ISO 8601 format. Instead was "${t}".`);return t}(u,t,n):null!==u.match(/^ByteArray$/i)?c=function(e,t){if(null!=t){if(!(t instanceof Uint8Array))throw new Error(e+" must be of type Uint8Array.");t=ue(t)}return t}(n,t):null!==u.match(/^Base64Url$/i)?c=function(e,t){if(null!=t){if(!(t instanceof Uint8Array))throw new Error(e+" must be of type Uint8Array.");t=function(e){if(!e)return;if(!(e instanceof Uint8Array))throw new Error("Please provide an input of type Uint8Array for converting to Base64Url.");return function(e,t){let n=e.length;for(;n-1>=0&&e[n-1]===t;)--n;return e.substr(0,n)}(ue(e),"=").replace(/\+/g,"-").replace(/\//g,"_")}(t)}return t}(n,t):null!==u.match(/^Sequence$/i)?c=function(e,t,n,r,o,i){if(!Array.isArray(n))throw new Error(r+" must be of type Array.");const s=t.type.element;if(!s||"object"!=typeof s)throw new Error(`element" metadata for an Array must be defined in the mapper and it must of type "object" in ${r}.`);const a=[];for(let t=0;t<n.length;t++){const c=e.serialize(s,n[t],r,i);if(o&&s.xmlNamespace){const e=s.xmlNamespacePrefix?"xmlns:"+s.xmlNamespacePrefix:"xmlns";"Composite"===s.type.name?(a[t]=Object.assign({},c),a[t][de]={[e]:s.xmlNamespace}):(a[t]={},a[t][i.xml.xmlCharKey]=c,a[t][de]={[e]:s.xmlNamespace})}else a[t]=c}return a}(this,e,t,n,Boolean(this.isXML),a):null!==u.match(/^Dictionary$/i)?c=function(e,t,n,r,o,i){if("object"!=typeof n)throw new Error(r+" must be of type object.");const s=t.type.value;if(!s||"object"!=typeof s)throw new Error(`"value" metadata for a Dictionary must be defined in the mapper and it must of type "object" in ${r}.`);const a={};for(const t of Object.keys(n)){const c=e.serialize(s,n[t],r,i);a[t]=ye(s,c,o,i)}if(o&&t.xmlNamespace){const e=t.xmlNamespacePrefix?"xmlns:"+t.xmlNamespacePrefix:"xmlns",n=a;return n[de]={[e]:t.xmlNamespace},n}return a}(this,e,t,n,Boolean(this.isXML),a):null!==u.match(/^Composite$/i)&&(c=function(e,t,n,r,o,i){Te(e,t)&&(t=be(e,t,n,"clientName"));if(null!=n){const s={},a=me(e,t,r);for(const c of Object.keys(a)){const u=a[c];if(u.readOnly)continue;let l,d=s;if(e.isXML)l=u.xmlIsWrapped?u.xmlName:u.xmlElementName||u.xmlName;else{const e=fe(u.serializedName);l=e.pop();for(const t of e){const e=d[t];null==e&&(void 0!==n[c]&&null!==n[c]||void 0!==u.defaultValue)&&(d[t]={}),d=d[t]}}if(null!=d){if(o&&t.xmlNamespace){const e=t.xmlNamespacePrefix?"xmlns:"+t.xmlNamespacePrefix:"xmlns";d[de]=Object.assign(Object.assign({},d[de]),{[e]:t.xmlNamespace})}const s=""!==u.serializedName?r+"."+u.serializedName:r;let a=n[c];const p=Te(e,t);p&&p.clientName===c&&null==a&&(a=t.serializedName);const h=e.serialize(u,a,s,i);if(void 0!==h&&null!=l){const e=ye(u,h,o,i);o&&u.xmlIsAttribute?(d[de]=d[de]||{},d[de][l]=h):o&&u.xmlIsWrapped?d[l]={[u.xmlElementName]:e}:d[l]=e}}}const c=function(e,t,n){const r=t.type.additionalProperties;if(!r&&t.type.className){const r=ge(e,t,n);return null==r?void 0:r.type.additionalProperties}return r}(e,t,r);if(c){const t=Object.keys(a);for(const o in n){t.every(e=>e!==o)&&(s[o]=e.serialize(c,n[o],r+'["'+o+'"]',i))}}return s}return n}(this,e,t,n,Boolean(this.isXML),a));return c}deserialize(e,t,n,r={xml:{}}){var o,i,s;const a={xml:{rootName:null!==(o=r.xml.rootName)&&void 0!==o?o:"",includeRoot:null!==(i=r.xml.includeRoot)&&void 0!==i&&i,xmlCharKey:null!==(s=r.xml.xmlCharKey)&&void 0!==s?s:"_"}};if(null==t)return this.isXML&&"Sequence"===e.type.name&&!e.xmlIsWrapped&&(t=[]),void 0!==e.defaultValue&&(t=e.defaultValue),t;let c;const u=e.type.name;if(n||(n=e.serializedName),null!==u.match(/^Composite$/i))c=function(e,t,n,r,o){var i;Te(e,t)&&(t=be(e,t,n,"serializedName"));const s=me(e,t,r);let a={};const c=[];for(const u of Object.keys(s)){const l=s[u],d=fe(s[u].serializedName);c.push(d[0]);const{serializedName:p,xmlName:h,xmlElementName:f}=l;let g=r;""!==p&&void 0!==p&&(g=r+"."+p);const m=l.headerCollectionPrefix;if(m){const t={};for(const r of Object.keys(n))r.startsWith(m)&&(t[r.substring(m.length)]=e.deserialize(l.type.value,n[r],g,o)),c.push(r);a[u]=t}else if(e.isXML)if(l.xmlIsAttribute&&n[de])a[u]=e.deserialize(l,n[de][h],g,o);else{const t=f||h||p;if(l.xmlIsWrapped){const t=n[h],r=null!==(i=null==t?void 0:t[f])&&void 0!==i?i:[];a[u]=e.deserialize(l,r,g,o)}else{const r=n[t];a[u]=e.deserialize(l,r,g,o)}}else{let r,i=n;for(const e of d){if(!i)break;i=i[e]}r=i;const c=t.type.polymorphicDiscriminator;let p;if(c&&u===c.clientName&&null==r&&(r=t.serializedName),Array.isArray(n[u])&&""===s[u].serializedName){r=n[u];const t=e.deserialize(l,r,g,o);for(const[e,n]of Object.entries(a))Object.prototype.hasOwnProperty.call(t,e)||(t[e]=n);a=t}else void 0===r&&void 0===l.defaultValue||(p=e.deserialize(l,r,g,o),a[u]=p)}}const u=t.type.additionalProperties;if(u){const t=e=>{for(const t in s){if(fe(s[t].serializedName)[0]===e)return!1}return!0};for(const i in n)t(i)&&(a[i]=e.deserialize(u,n[i],r+'["'+i+'"]',o))}else if(n)for(const e of Object.keys(n))void 0!==a[e]||c.includes(e)||ve(e,o)||(a[e]=n[e]);return a}(this,e,t,n,a);else{if(this.isXML){const e=a.xml.xmlCharKey;void 0!==t[de]&&void 0!==t[e]&&(t=t[e])}null!==u.match(/^Number$/i)?(c=parseFloat(t),isNaN(c)&&(c=t)):null!==u.match(/^Boolean$/i)?c="true"===t||"false"!==t&&t:null!==u.match(/^(String|Enum|Object|Stream|Uuid|TimeSpan|any)$/i)?c=t:null!==u.match(/^(Date|DateTime|DateTimeRfc1123)$/i)?c=new Date(t):null!==u.match(/^UnixTime$/i)?c=function(e){if(!e)return;return new Date(1e3*e)}(t):null!==u.match(/^ByteArray$/i)?c=le(t):null!==u.match(/^Base64Url$/i)?c=function(e){if(!e)return;if(e&&"string"!=typeof e.valueOf())throw new Error("Please provide an input of type string for converting to Uint8Array");return le(e=e.replace(/-/g,"+").replace(/_/g,"/"))}(t):null!==u.match(/^Sequence$/i)?c=function(e,t,n,r,o){const i=t.type.element;if(!i||"object"!=typeof i)throw new Error('element" metadata for an Array must be defined in the mapper and it must of type "object" in '+r);if(n){Array.isArray(n)||(n=[n]);const t=[];for(let s=0;s<n.length;s++)t[s]=e.deserialize(i,n[s],`${r}[${s}]`,o);return t}return n}(this,e,t,n,a):null!==u.match(/^Dictionary$/i)&&(c=function(e,t,n,r,o){const i=t.type.value;if(!i||"object"!=typeof i)throw new Error('"value" metadata for a Dictionary must be defined in the mapper and it must of type "object" in '+r);if(n){const t={};for(const s of Object.keys(n))t[s]=e.deserialize(i,n[s],r,o);return t}return n}(this,e,t,n,a))}return e.isConstant&&(c=e.defaultValue),c}}function he(e={},t=!1){return new pe(e,t)}function fe(e){const t=[];let n="";if(e){const r=e.split(".");for(const e of r)"\\"===e.charAt(e.length-1)?n+=e.substr(0,e.length-1)+".":(n+=e,t.push(n),n="")}return t}function ge(e,t,n){const r=t.type.className;if(!r)throw new Error(`Class name for model "${n}" is not provided in the mapper "${JSON.stringify(t,void 0,2)}".`);return e.modelMappers[r]}function me(e,t,n){let r=t.type.modelProperties;if(!r){const o=ge(e,t,n);if(!o)throw new Error(`mapper() cannot be null or undefined for model "${t.type.className}".`);if(r=null==o?void 0:o.type.modelProperties,!r)throw new Error(`modelProperties cannot be null or undefined in the mapper "${JSON.stringify(o)}" of type "${t.type.className}" for object "${n}".`)}return r}function ye(e,t,n,r){if(!n||!e.xmlNamespace)return t;const o={[e.xmlNamespacePrefix?"xmlns:"+e.xmlNamespacePrefix:"xmlns"]:e.xmlNamespace};if(["Composite"].includes(e.type.name)){if(t[de])return t;{const e=Object.assign({},t);return e[de]=o,e}}const i={};return i[r.xml.xmlCharKey]=t,i[de]=o,i}function ve(e,t){return[de,t.xml.xmlCharKey].includes(e)}function be(e,t,n,r){const o=Te(e,t);if(o){const i=o[r];if(i){const r=n[i];if(null!=r){const n=t.type.uberParent||t.type.className,o=r===n?r:n+"."+r,i=e.modelMappers.discriminators[o];i&&(t=i)}}}return t}function Te(e,t){return t.type.polymorphicDiscriminator||we(e,t.type.uberParent)||we(e,t.type.className)}function we(e,t){return t&&e.modelMappers[t]&&e.modelMappers[t].type.polymorphicDiscriminator}const Ee="Sequence",Se="String",Re="Stream",Ce={type:{name:"Composite",className:"ChatMessageReadReceiptsCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatMessageReadReceipt"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},Oe={type:{name:"Composite",className:"ChatMessageReadReceipt",modelProperties:{senderCommunicationIdentifier:{serializedName:"senderCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},chatMessageId:{serializedName:"chatMessageId",required:!0,type:{name:"String"}},readOn:{serializedName:"readOn",required:!0,type:{name:"DateTime"}}}}},Ie={type:{name:"Composite",className:"CommunicationIdentifierModel",modelProperties:{rawId:{serializedName:"rawId",type:{name:"String"}},communicationUser:{serializedName:"communicationUser",type:{name:"Composite",className:"CommunicationUserIdentifierModel"}},phoneNumber:{serializedName:"phoneNumber",type:{name:"Composite",className:"PhoneNumberIdentifierModel"}},microsoftTeamsUser:{serializedName:"microsoftTeamsUser",type:{name:"Composite",className:"MicrosoftTeamsUserIdentifierModel"}}}}},Ae={type:{name:"Composite",className:"CommunicationUserIdentifierModel",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}}}}},Pe={type:{name:"Composite",className:"PhoneNumberIdentifierModel",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"String"}}}}},_e={type:{name:"Composite",className:"MicrosoftTeamsUserIdentifierModel",modelProperties:{userId:{serializedName:"userId",required:!0,type:{name:"String"}},isAnonymous:{serializedName:"isAnonymous",type:{name:"Boolean"}},cloud:{serializedName:"cloud",type:{name:"String"}}}}},xe={type:{name:"Composite",className:"CommunicationErrorResponse",modelProperties:{error:{serializedName:"error",type:{name:"Composite",className:"ChatError"}}}}},ke={type:{name:"Composite",className:"ChatError",modelProperties:{code:{serializedName:"code",required:!0,type:{name:"String"}},message:{serializedName:"message",required:!0,type:{name:"String"}},target:{serializedName:"target",readOnly:!0,type:{name:"String"}},details:{serializedName:"details",readOnly:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatError"}}}},innerError:{serializedName:"innererror",type:{name:"Composite",className:"ChatError"}}}}},Ne={type:{name:"Composite",className:"SendReadReceiptRequest",modelProperties:{chatMessageId:{serializedName:"chatMessageId",required:!0,type:{name:"String"}}}}},Me={type:{name:"Composite",className:"SendChatMessageRequest",modelProperties:{content:{serializedName:"content",required:!0,type:{name:"String"}},senderDisplayName:{serializedName:"senderDisplayName",type:{name:"String"}},type:{serializedName:"type",type:{name:"Enum",allowedValues:["text","html","topicUpdated","participantAdded","participantRemoved"]}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}}}}},De={type:{name:"Composite",className:"SendChatMessageResult",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}}}}},je={type:{name:"Composite",className:"ChatMessagesCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatMessage"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},Ue={type:{name:"Composite",className:"ChatMessage",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},type:{serializedName:"type",required:!0,type:{name:"Enum",allowedValues:["text","html","topicUpdated","participantAdded","participantRemoved"]}},sequenceId:{serializedName:"sequenceId",required:!0,type:{name:"String"}},version:{serializedName:"version",required:!0,type:{name:"String"}},content:{serializedName:"content",type:{name:"Composite",className:"ChatMessageContent"}},senderDisplayName:{serializedName:"senderDisplayName",type:{name:"String"}},createdOn:{serializedName:"createdOn",required:!0,type:{name:"DateTime"}},senderCommunicationIdentifier:{serializedName:"senderCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},deletedOn:{serializedName:"deletedOn",type:{name:"DateTime"}},editedOn:{serializedName:"editedOn",type:{name:"DateTime"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}}}}},Le={type:{name:"Composite",className:"ChatMessageContent",modelProperties:{message:{serializedName:"message",type:{name:"String"}},topic:{serializedName:"topic",type:{name:"String"}},participants:{serializedName:"participants",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}},initiatorCommunicationIdentifier:{serializedName:"initiatorCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}}}}},qe={type:{name:"Composite",className:"ChatParticipant",modelProperties:{communicationIdentifier:{serializedName:"communicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},displayName:{serializedName:"displayName",type:{name:"String"}},shareHistoryTime:{serializedName:"shareHistoryTime",type:{name:"DateTime"}}}}},Be={type:{name:"Composite",className:"UpdateChatMessageRequest",modelProperties:{content:{serializedName:"content",type:{name:"String"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}}}}},ze={type:{name:"Composite",className:"ChatParticipantsCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},He={type:{name:"Composite",className:"AddChatParticipantsRequest",modelProperties:{participants:{serializedName:"participants",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}}}}},Fe={type:{name:"Composite",className:"AddChatParticipantsResult",modelProperties:{invalidParticipants:{serializedName:"invalidParticipants",readOnly:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatError"}}}}}}},$e={type:{name:"Composite",className:"CreateChatThreadRequest",modelProperties:{topic:{serializedName:"topic",required:!0,type:{name:"String"}},participants:{serializedName:"participants",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}}}}},Ge={type:{name:"Composite",className:"CreateChatThreadResult",modelProperties:{chatThread:{serializedName:"chatThread",type:{name:"Composite",className:"ChatThreadProperties"}},invalidParticipants:{serializedName:"invalidParticipants",readOnly:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatError"}}}}}}},Ve={type:{name:"Composite",className:"ChatThreadProperties",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},topic:{serializedName:"topic",required:!0,type:{name:"String"}},createdOn:{serializedName:"createdOn",required:!0,type:{name:"DateTime"}},createdByCommunicationIdentifier:{serializedName:"createdByCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},deletedOn:{serializedName:"deletedOn",type:{name:"DateTime"}}}}},Je={type:{name:"Composite",className:"ChatThreadsItemCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatThreadItem"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},We={type:{name:"Composite",className:"ChatThreadItem",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},topic:{serializedName:"topic",required:!0,type:{name:"String"}},deletedOn:{serializedName:"deletedOn",type:{name:"DateTime"}},lastMessageReceivedOn:{serializedName:"lastMessageReceivedOn",readOnly:!0,type:{name:"DateTime"}}}}},Ye={type:{name:"Composite",className:"UpdateChatThreadRequest",modelProperties:{topic:{serializedName:"topic",type:{name:"String"}}}}},Ke={type:{name:"Composite",className:"SendTypingNotificationRequest",modelProperties:{senderDisplayName:{serializedName:"senderDisplayName",type:{name:"String"}}}}},Xe={parameterPath:"accept",mapper:{defaultValue:"application/json",isConstant:!0,serializedName:"Accept",type:{name:"String"}}},Qe={parameterPath:"endpoint",mapper:{serializedName:"endpoint",required:!0,type:{name:"String"}},skipEncoding:!0},Ze={parameterPath:"chatThreadId",mapper:{serializedName:"chatThreadId",required:!0,type:{name:"String"}}},et={parameterPath:["options","maxPageSize"],mapper:{serializedName:"maxPageSize",type:{name:"Number"}}},tt={parameterPath:["options","skip"],mapper:{serializedName:"skip",type:{name:"Number"}}},nt={parameterPath:"apiVersion",mapper:{defaultValue:"2021-09-07",isConstant:!0,serializedName:"api-version",type:{name:"String"}}},rt={parameterPath:["options","contentType"],mapper:{defaultValue:"application/json",isConstant:!0,serializedName:"Content-Type",type:{name:"String"}}},ot={parameterPath:"sendReadReceiptRequest",mapper:Ne},it={parameterPath:"sendChatMessageRequest",mapper:Me},st={parameterPath:["options","startTime"],mapper:{serializedName:"startTime",type:{name:"DateTime"}}},at={parameterPath:"chatMessageId",mapper:{serializedName:"chatMessageId",required:!0,type:{name:"String"}}},ct={parameterPath:["options","contentType"],mapper:{defaultValue:"application/merge-patch+json",isConstant:!0,serializedName:"Content-Type",type:{name:"String"}}},ut={parameterPath:"updateChatMessageRequest",mapper:Be},lt={parameterPath:"participantCommunicationIdentifier",mapper:Ie},dt={parameterPath:"addChatParticipantsRequest",mapper:He},pt={parameterPath:"updateChatThreadRequest",mapper:Ye},ht={parameterPath:["options","sendTypingNotificationRequest"],mapper:Ke},ft={parameterPath:"nextLink",mapper:{serializedName:"nextLink",required:!0,type:{name:"String"}},skipEncoding:!0},gt={parameterPath:"createChatThreadRequest",mapper:$e};class mt{constructor(e){this.client=e}listChatReadReceipts(e,t){return this.client.sendOperationRequest({chatThreadId:e,options:t},vt)}sendChatReadReceipt(e,t,n){return this.client.sendOperationRequest({chatThreadId:e,sendReadReceiptRequest:t,options:n},bt)}sendChatMessage(e,t,n){return this.client.sendOperationRequest({chatThreadId:e,sendChatMessageRequest:t,options:n},Tt)}listChatMessages(e,t){return this.client.sendOperationRequest({chatThreadId:e,options:t},wt)}getChatMessage(e,t,n){return this.client.sendOperationRequest({chatThreadId:e,chatMessageId:t,options:n},Et)}updateChatMessage(e,t,n,r){return this.client.sendOperationRequest({chatThreadId:e,chatMessageId:t,updateChatMessageRequest:n,options:r},St)}deleteChatMessage(e,t,n){return this.client.sendOperationRequest({chatThreadId:e,chatMessageId:t,options:n},Rt)}listChatParticipants(e,t){return this.client.sendOperationRequest({chatThreadId:e,options:t},Ct)}removeChatParticipant(e,t,n){return this.client.sendOperationRequest({chatThreadId:e,participantCommunicationIdentifier:t,options:n},Ot)}addChatParticipants(e,t,n){return this.client.sendOperationRequest({chatThreadId:e,addChatParticipantsRequest:t,options:n},It)}updateChatThreadProperties(e,t,n){return this.client.sendOperationRequest({chatThreadId:e,updateChatThreadRequest:t,options:n},At)}getChatThreadProperties(e,t){return this.client.sendOperationRequest({chatThreadId:e,options:t},Pt)}sendTypingNotification(e,t){return this.client.sendOperationRequest({chatThreadId:e,options:t},_t)}listChatReadReceiptsNext(e,t,n){return this.client.sendOperationRequest({chatThreadId:e,nextLink:t,options:n},xt)}listChatMessagesNext(e,t,n){return this.client.sendOperationRequest({chatThreadId:e,nextLink:t,options:n},kt)}listChatParticipantsNext(e,t,n){return this.client.sendOperationRequest({chatThreadId:e,nextLink:t,options:n},Nt)}}const yt=he(o,!1),vt={path:"/chat/threads/{chatThreadId}/readReceipts",httpMethod:"GET",responses:{200:{bodyMapper:Ce},401:{bodyMapper:xe,isError:!0},403:{bodyMapper:xe,isError:!0},429:{bodyMapper:xe,isError:!0},503:{bodyMapper:xe,isError:!0}},queryParameters:[et,tt,nt],urlParameters:[Qe,Ze],headerParameters:[Xe],serializer:yt},bt={path:"/chat/threads/{chatThreadId}/readReceipts",httpMethod:"POST",responses:{200:{},401:{bodyMapper:xe,isError:!0},403:{bodyMapper:xe,isError:!0},429:{bodyMapper:xe,isError:!0},503:{bodyMapper:xe,isError:!0}},requestBody:ot,queryParameters:[nt],urlParameters:[Qe,Ze],headerParameters:[Xe,rt],mediaType:"json",serializer:yt},Tt={path:"/chat/threads/{chatThreadId}/messages",httpMethod:"POST",responses:{201:{bodyMapper:De},401:{bodyMapper:xe,isError:!0},403:{bodyMapper:xe,isError:!0},429:{bodyMapper:xe,isError:!0},503:{bodyMapper:xe,isError:!0}},requestBody:it,queryParameters:[nt],urlParameters:[Qe,Ze],headerParameters:[Xe,rt],mediaType:"json",serializer:yt},wt={path:"/chat/threads/{chatThreadId}/messages",httpMethod:"GET",responses:{200:{bodyMapper:je},401:{bodyMapper:xe,isError:!0},403:{bodyMapper:xe,isError:!0},429:{bodyMapper:xe,isError:!0},503:{bodyMapper:xe,isError:!0}},queryParameters:[et,nt,st],urlParameters:[Qe,Ze],headerParameters:[Xe],serializer:yt},Et={path:"/chat/threads/{chatThreadId}/messages/{chatMessageId}",httpMethod:"GET",responses:{200:{bodyMapper:Ue},401:{bodyMapper:xe,isError:!0},403:{bodyMapper:xe,isError:!0},429:{bodyMapper:xe,isError:!0},503:{bodyMapper:xe,isError:!0}},queryParameters:[nt],urlParameters:[Qe,Ze,at],headerParameters:[Xe],serializer:yt},St={path:"/chat/threads/{chatThreadId}/messages/{chatMessageId}",httpMethod:"PATCH",responses:{204:{},401:{bodyMapper:xe,isError:!0},403:{bodyMapper:xe,isError:!0},429:{bodyMapper:xe,isError:!0},503:{bodyMapper:xe,isError:!0}},requestBody:ut,queryParameters:[nt],urlParameters:[Qe,Ze,at],headerParameters:[Xe,ct],mediaType:"json",serializer:yt},Rt={path:"/chat/threads/{chatThreadId}/messages/{chatMessageId}",httpMethod:"DELETE",responses:{204:{},401:{bodyMapper:xe,isError:!0},403:{bodyMapper:xe,isError:!0},429:{bodyMapper:xe,isError:!0},503:{bodyMapper:xe,isError:!0}},queryParameters:[nt],urlParameters:[Qe,Ze,at],headerParameters:[Xe],serializer:yt},Ct={path:"/chat/threads/{chatThreadId}/participants",httpMethod:"GET",responses:{200:{bodyMapper:ze},401:{bodyMapper:xe,isError:!0},403:{bodyMapper:xe,isError:!0},429:{bodyMapper:xe,isError:!0},503:{bodyMapper:xe,isError:!0}},queryParameters:[et,tt,nt],urlParameters:[Qe,Ze],headerParameters:[Xe],serializer:yt},Ot={path:"/chat/threads/{chatThreadId}/participants/:remove",httpMethod:"POST",responses:{204:{},401:{bodyMapper:xe,isError:!0},403:{bodyMapper:xe,isError:!0},429:{bodyMapper:xe,isError:!0},503:{bodyMapper:xe,isError:!0}},requestBody:lt,queryParameters:[nt],urlParameters:[Qe,Ze],headerParameters:[Xe,rt],mediaType:"json",serializer:yt},It={path:"/chat/threads/{chatThreadId}/participants/:add",httpMethod:"POST",responses:{201:{bodyMapper:Fe},401:{bodyMapper:xe,isError:!0},403:{bodyMapper:xe,isError:!0},429:{bodyMapper:xe,isError:!0},503:{bodyMapper:xe,isError:!0}},requestBody:dt,queryParameters:[nt],urlParameters:[Qe,Ze],headerParameters:[Xe,rt],mediaType:"json",serializer:yt},At={path:"/chat/threads/{chatThreadId}",httpMethod:"PATCH",responses:{204:{},401:{bodyMapper:xe,isError:!0},403:{bodyMapper:xe,isError:!0},429:{bodyMapper:xe,isError:!0},503:{bodyMapper:xe,isError:!0}},requestBody:pt,queryParameters:[nt],urlParameters:[Qe,Ze],headerParameters:[Xe,ct],mediaType:"json",serializer:yt},Pt={path:"/chat/threads/{chatThreadId}",httpMethod:"GET",responses:{200:{bodyMapper:Ve},401:{bodyMapper:xe,isError:!0},403:{bodyMapper:xe,isError:!0},429:{bodyMapper:xe,isError:!0},503:{bodyMapper:xe,isError:!0}},queryParameters:[nt],urlParameters:[Qe,Ze],headerParameters:[Xe],serializer:yt},_t={path:"/chat/threads/{chatThreadId}/typing",httpMethod:"POST",responses:{200:{},401:{bodyMapper:xe,isError:!0},403:{bodyMapper:xe,isError:!0},429:{bodyMapper:xe,isError:!0},503:{bodyMapper:xe,isError:!0}},requestBody:ht,queryParameters:[nt],urlParameters:[Qe,Ze],headerParameters:[Xe,rt],mediaType:"json",serializer:yt},xt={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:Ce},401:{bodyMapper:xe,isError:!0},403:{bodyMapper:xe,isError:!0},429:{bodyMapper:xe,isError:!0},503:{bodyMapper:xe,isError:!0}},queryParameters:[et,tt,nt],urlParameters:[Qe,Ze,ft],headerParameters:[Xe],serializer:yt},kt={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:je},401:{bodyMapper:xe,isError:!0},403:{bodyMapper:xe,isError:!0},429:{bodyMapper:xe,isError:!0},503:{bodyMapper:xe,isError:!0}},queryParameters:[et,nt,st],urlParameters:[Qe,Ze,ft],headerParameters:[Xe],serializer:yt},Nt={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:ze},401:{bodyMapper:xe,isError:!0},403:{bodyMapper:xe,isError:!0},429:{bodyMapper:xe,isError:!0},503:{bodyMapper:xe,isError:!0}},queryParameters:[et,tt,nt],urlParameters:[Qe,Ze,ft],headerParameters:[Xe],serializer:yt};class Mt{constructor(e){this.client=e}createChatThread(e,t){return this.client.sendOperationRequest({createChatThreadRequest:e,options:t},jt)}listChatThreads(e){return this.client.sendOperationRequest({options:e},Ut)}deleteChatThread(e,t){return this.client.sendOperationRequest({chatThreadId:e,options:t},Lt)}listChatThreadsNext(e,t){return this.client.sendOperationRequest({nextLink:e,options:t},qt)}}const Dt=he(o,!1),jt={path:"/chat/threads",httpMethod:"POST",responses:{201:{bodyMapper:Ge},401:{bodyMapper:xe,isError:!0},403:{bodyMapper:xe,isError:!0},429:{bodyMapper:xe,isError:!0},503:{bodyMapper:xe,isError:!0}},requestBody:gt,queryParameters:[nt],urlParameters:[Qe],headerParameters:[Xe,rt,{parameterPath:["options","repeatabilityRequestId"],mapper:{serializedName:"repeatability-request-id",type:{name:"String"}}}],mediaType:"json",serializer:Dt},Ut={path:"/chat/threads",httpMethod:"GET",responses:{200:{bodyMapper:Je},401:{bodyMapper:xe,isError:!0},403:{bodyMapper:xe,isError:!0},429:{bodyMapper:xe,isError:!0},503:{bodyMapper:xe,isError:!0}},queryParameters:[et,nt,st],urlParameters:[Qe],headerParameters:[Xe],serializer:Dt},Lt={path:"/chat/threads/{chatThreadId}",httpMethod:"DELETE",responses:{204:{},401:{bodyMapper:xe,isError:!0},403:{bodyMapper:xe,isError:!0},429:{bodyMapper:xe,isError:!0},503:{bodyMapper:xe,isError:!0}},queryParameters:[nt],urlParameters:[Qe,Ze],headerParameters:[Xe],serializer:Dt},qt={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:Je},401:{bodyMapper:xe,isError:!0},403:{bodyMapper:xe,isError:!0},429:{bodyMapper:xe,isError:!0},503:{bodyMapper:xe,isError:!0}},queryParameters:[et,nt,st],urlParameters:[Qe,ft],headerParameters:[Xe],serializer:Dt};function Bt(e){return e.toLowerCase()}class zt{constructor(e){if(this._headersMap=new Map,e)for(const t of Object.keys(e))this.set(t,e[t])}set(e,t){this._headersMap.set(Bt(e),String(t))}get(e){return this._headersMap.get(Bt(e))}has(e){return this._headersMap.has(Bt(e))}delete(e){this._headersMap.delete(Bt(e))}toJSON(){const e={};for(const[t,n]of this._headersMap)e[t]=n;return e}toString(){return JSON.stringify(this.toJSON())}[Symbol.iterator](){return this._headersMap.entries()}}function Ht(e){return new zt(e)}var Ft,$t=new Uint8Array(16);function Gt(){if(!Ft&&!(Ft="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ft($t)}var Vt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var Jt=function(e){return"string"==typeof e&&Vt.test(e)},Wt=[],Yt=0;Yt<256;++Yt)Wt.push((Yt+256).toString(16).substr(1));var Kt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(Wt[e[t+0]]+Wt[e[t+1]]+Wt[e[t+2]]+Wt[e[t+3]]+"-"+Wt[e[t+4]]+Wt[e[t+5]]+"-"+Wt[e[t+6]]+Wt[e[t+7]]+"-"+Wt[e[t+8]]+Wt[e[t+9]]+"-"+Wt[e[t+10]]+Wt[e[t+11]]+Wt[e[t+12]]+Wt[e[t+13]]+Wt[e[t+14]]+Wt[e[t+15]]).toLowerCase();if(!Jt(n))throw TypeError("Stringified UUID is invalid");return n};var Xt=function(e,t,n){var r=(e=e||{}).random||(e.rng||Gt)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return Kt(r)};class Qt{constructor(e){var t,n,r,o,i,s;this.url=e.url,this.body=e.body,this.headers=null!==(t=e.headers)&&void 0!==t?t:Ht(),this.method=null!==(n=e.method)&&void 0!==n?n:"GET",this.timeout=null!==(r=e.timeout)&&void 0!==r?r:0,this.formData=e.formData,this.disableKeepAlive=null!==(o=e.disableKeepAlive)&&void 0!==o&&o,this.proxySettings=e.proxySettings,this.streamResponseStatusCodes=e.streamResponseStatusCodes,this.withCredentials=null!==(i=e.withCredentials)&&void 0!==i&&i,this.abortSignal=e.abortSignal,this.tracingOptions=e.tracingOptions,this.onUploadProgress=e.onUploadProgress,this.onDownloadProgress=e.onDownloadProgress,this.requestId=e.requestId||Xt(),this.allowInsecureConnection=null!==(s=e.allowInsecureConnection)&&void 0!==s&&s}}function Zt(e){const{parameterPath:t,mapper:n}=e;let r;return r="string"==typeof t?t:Array.isArray(t)?t.join("."):n.serializedName,r}function en(e,t,n){let r=t.parameterPath;const o=t.mapper;let i;if("string"==typeof r&&(r=[r]),Array.isArray(r)){if(r.length>0)if(o.isConstant)i=o.defaultValue;else{let t=tn(e,r);!t.propertyFound&&n&&(t=tn(n,r));let s=!1;t.propertyFound||(s=o.required||"options"===r[0]&&2===r.length),i=s?o.defaultValue:t.propertyValue}}else{o.required&&(i={});for(const t in r){const s=o.type.modelProperties[t],a=en(e,{parameterPath:r[t],mapper:s},n);void 0!==a&&(i||(i={}),i[t]=a)}}return i}function tn(e,t){const n={propertyFound:!1};let r=0;for(;r<t.length;++r){const n=t[r];if(!e||!(n in e))break;e=e[n]}return r===t.length&&(n.propertyValue=e,n.propertyFound=!0),n}const nn=new WeakMap;function rn(e){let t=nn.get(e);return t||(t={},nn.set(e,t)),t}const on={CSV:",",SSV:" ",Multi:"Multi",TSV:"\t",Pipes:"|"};function sn(e,t,n,r){const o=function(e,t,n){var r;const o=new Map;if(null===(r=e.urlParameters)||void 0===r?void 0:r.length)for(const r of e.urlParameters){let i=en(t,r,n);const s=Zt(r);i=e.serializer.serialize(r.mapper,i,s),r.skipEncoding||(i=encodeURIComponent(i)),o.set(`{${r.mapper.serializedName||s}}`,i)}return o}(t,n,r);let i=an(e,o);if(t.path){const e=an(t.path,o);i=e.includes("://")?e:function(e,t){if(!t)return e;const n=new URL(e);let r=n.pathname;r.endsWith("/")||(r+="/");t.startsWith("/")&&(t=t.substring(1));const o=t.indexOf("?");if(-1!==o){const e=t.substring(0,o),i=t.substring(o+1);r+=e,i&&(n.search=n.search?`${n.search}&${i}`:i)}else r+=t;return n.pathname=r,n.toString()}(i,e)}const{queryParams:s,sequenceParams:a}=function(e,t,n){var r;const o=new Map,i=new Set;if(null===(r=e.queryParameters)||void 0===r?void 0:r.length)for(const r of e.queryParameters){"Sequence"===r.mapper.type.name&&r.mapper.serializedName&&i.add(r.mapper.serializedName);let s=en(t,r,n);if(null!=s||r.mapper.required){s=e.serializer.serialize(r.mapper,s,Zt(r));const t=r.collectionFormat?on[r.collectionFormat]:"";if(Array.isArray(s)&&(s=s.map(e=>null==e?"":e)),"Multi"===r.collectionFormat&&0===s.length)continue;!Array.isArray(s)||"SSV"!==r.collectionFormat&&"TSV"!==r.collectionFormat||(s=s.join(t)),r.skipEncoding||(s=Array.isArray(s)?s.map(e=>encodeURIComponent(e)):encodeURIComponent(s)),!Array.isArray(s)||"CSV"!==r.collectionFormat&&"Pipes"!==r.collectionFormat||(s=s.join(t)),o.set(r.mapper.serializedName||Zt(r),s)}}return{queryParams:o,sequenceParams:i}}(t,n,r);return i=function(e,t,n){if(0===t.size)return e;const r=new URL(e),o=function(e){const t=new Map;if(!e||"?"!==e[0])return t;const n=(e=e.slice(1)).split("&");for(const e of n){const[n,r]=e.split("=",2),o=t.get(n);o?Array.isArray(o)?o.push(r):t.set(n,[o,r]):t.set(n,r)}return t}(r.search);for(const[e,r]of t){const t=o.get(e);if(Array.isArray(t))if(Array.isArray(r)){t.push(...r);const n=new Set(t);o.set(e,Array.from(n))}else t.push(r);else if(t){let i=r;Array.isArray(r)?r.unshift(t):n.has(e)&&(i=[t,r]),o.set(e,i)}else o.set(e,r)}const i=[];for(const[e,t]of o)if("string"==typeof t)i.push(`${e}=${t}`);else for(const n of t)i.push(`${e}=${n}`);return r.search=i.length?"?"+i.join("&"):"",r.toString()}(i,s,a),i}function an(e,t){let n=e;for(const[e,r]of t)n=n.split(e).join(r);return n}var cn=n(210);const un={};var ln=n(10);const dn=URL,pn=(URLSearchParams,["x-ms-client-request-id","x-ms-return-client-request-id","x-ms-useragent","x-ms-correlation-request-id","x-ms-request-id","client-request-id","ms-cv","return-client-request-id","traceparent","Access-Control-Allow-Credentials","Access-Control-Allow-Headers","Access-Control-Allow-Methods","Access-Control-Allow-Origin","Access-Control-Expose-Headers","Access-Control-Max-Age","Access-Control-Request-Headers","Access-Control-Request-Method","Origin","Accept","Accept-Encoding","Cache-Control","Connection","Content-Length","Content-Type","Date","ETag","Expires","If-Match","If-Modified-Since","If-None-Match","If-Unmodified-Since","Last-Modified","Pragma","Request-Id","Retry-After","Server","Transfer-Encoding","User-Agent"]),hn=["api-version"];class fn{constructor({additionalAllowedHeaderNames:e=[],additionalAllowedQueryParameters:t=[]}={}){e=pn.concat(e),t=hn.concat(t),this.allowedHeaderNames=new Set(e.map(e=>e.toLowerCase())),this.allowedQueryParameters=new Set(t.map(e=>e.toLowerCase()))}sanitize(e){const t=new Set;return JSON.stringify(e,(e,n)=>{if(n instanceof Error)return Object.assign(Object.assign({},n),{name:n.name,message:n.message});if("headers"===e)return this.sanitizeHeaders(n);if("url"===e)return this.sanitizeUrl(n);if("query"===e)return this.sanitizeQuery(n);if("body"!==e&&"response"!==e&&"operationSpec"!==e){if(Array.isArray(n)||Object(ln.d)(n)){if(t.has(n))return"[Circular]";t.add(n)}return n}},2)}sanitizeHeaders(e){const t={};for(const n of Object.keys(e))this.allowedHeaderNames.has(n.toLowerCase())?t[n]=e[n]:t[n]="REDACTED";return t}sanitizeQuery(e){if("object"!=typeof e||null===e)return e;const t={};for(const n of Object.keys(e))this.allowedQueryParameters.has(n.toLowerCase())?t[n]=e[n]:t[n]="REDACTED";return t}sanitizeUrl(e){if("string"!=typeof e||null===e)return e;const t=new dn(e);if(!t.search)return e;for(const[e]of t.searchParams)this.allowedQueryParameters.has(e.toLowerCase())||t.searchParams.set(e,"REDACTED");return t.toString()}}const gn=new fn;class mn extends Error{constructor(e,t={}){super(e),this.name="RestError",this.code=t.code,this.statusCode=t.statusCode,this.request=t.request,this.response=t.response,Object.setPrototypeOf(this,mn.prototype)}[un](){return`RestError: ${this.message} \n ${gn.sanitize(this)}`}}mn.REQUEST_SEND_ERROR="REQUEST_SEND_ERROR",mn.PARSE_ERROR="PARSE_ERROR";class yn{async sendRequest(e){var t;if("https:"!==new URL(e.url).protocol&&!e.allowInsecureConnection)throw new Error(`Cannot connect to ${e.url} while allowInsecureConnection is false.`);const n=new XMLHttpRequest;if(e.proxySettings)throw new Error("HTTP proxy is not supported in browser environment");const r=e.abortSignal;if(r){if(r.aborted)throw new cn.a("The operation was aborted.");const e=()=>{n.abort()};r.addEventListener("abort",e),n.addEventListener("readystatechange",()=>{n.readyState===XMLHttpRequest.DONE&&r.removeEventListener("abort",e)})}vn(n.upload,e.onUploadProgress),vn(n,e.onDownloadProgress),n.open(e.method,e.url),n.timeout=e.timeout,n.withCredentials=e.withCredentials;for(const[t,r]of e.headers)n.setRequestHeader(t,r);if(n.responseType=(null===(t=e.streamResponseStatusCodes)||void 0===t?void 0:t.size)?"blob":"text",(o=e.body)&&"function"==typeof o.pipe)throw new Error("Node streams are not supported in browser environment.");var o;return n.send(void 0===e.body?null:e.body),"blob"===n.responseType?new Promise((t,r)=>{!function(e,t,n,r){e.addEventListener("readystatechange",()=>{var o;if(e.readyState===XMLHttpRequest.HEADERS_RECEIVED)if(null===(o=t.streamResponseStatusCodes)||void 0===o?void 0:o.has(e.status)){const r=new Promise((n,r)=>{e.addEventListener("load",()=>{n(e.response)}),Tn(t,e,r)});n({request:t,status:e.status,headers:bn(e),blobBody:r})}else e.addEventListener("load",()=>{e.response?e.response.text().then(r=>{n({request:t,status:e.status,headers:bn(e),bodyAsText:r})}).catch(e=>{r(e)}):n({request:t,status:e.status,headers:bn(e)})})})}(n,e,t,r),Tn(e,n,r)}):new Promise((function(t,r){n.addEventListener("load",()=>t({request:e,status:n.status,headers:bn(n),bodyAsText:n.responseText})),Tn(e,n,r)}))}}function vn(e,t){t&&e.addEventListener("progress",e=>t({loadedBytes:e.loaded}))}function bn(e){const t=Ht(),n=e.getAllResponseHeaders().trim().split(/[\r\n]+/);for(const e of n){const n=e.indexOf(":"),r=e.slice(0,n),o=e.slice(n+2);t.set(r,o)}return t}function Tn(e,t,n){t.addEventListener("error",()=>n(new mn("Failed to send request to "+e.url,{code:mn.REQUEST_SEND_ERROR,request:e})));const r=new cn.a("The operation was aborted.");t.addEventListener("abort",()=>n(r)),t.addEventListener("timeout",()=>n(r))}function wn(){return new yn}let En;const Sn=new Set(["Deserialize","Serialize","Retry"]);class Rn{constructor(e=[]){this._policies=[],this._policies=e,this._orderedPolicies=void 0}addPolicy(e,t={}){if(t.phase&&t.afterPhase)throw new Error("Policies inside a phase cannot specify afterPhase.");if(t.phase&&!Sn.has(t.phase))throw new Error("Invalid phase name: "+t.phase);if(t.afterPhase&&!Sn.has(t.afterPhase))throw new Error("Invalid afterPhase name: "+t.afterPhase);this._policies.push({policy:e,options:t}),this._orderedPolicies=void 0}removePolicy(e){const t=[];return this._policies=this._policies.filter(n=>!(e.name&&n.policy.name===e.name||e.phase&&n.options.phase===e.phase)||(t.push(n.policy),!1)),this._orderedPolicies=void 0,t}sendRequest(e,t){return this.getOrderedPolicies().reduceRight((e,t)=>n=>t.sendRequest(n,e),t=>e.sendRequest(t))(t)}getOrderedPolicies(){return this._orderedPolicies||(this._orderedPolicies=this.orderPolicies()),this._orderedPolicies}clone(){return new Rn(this._policies)}static create(){return new Rn}orderPolicies(){const e=[],t=new Map,n=new Set,r=new Set,o=new Set,i=new Set,s=[n,r,o,i];function a(e){return"Retry"===e?i:"Serialize"===e?n:"Deserialize"===e?o:r}for(const e of this._policies){const n=e.policy,r=e.options,o=n.name;if(t.has(o))throw new Error("Duplicate policy names not allowed in pipeline");const i={policy:n,dependsOn:new Set,dependants:new Set};r.afterPhase&&(i.afterPhase=a(r.afterPhase)),t.set(o,i);a(r.phase).add(i)}for(const e of this._policies){const{policy:n,options:r}=e,o=n.name,i=t.get(o);if(!i)throw new Error("Missing node for policy "+o);if(r.afterPolicies)for(const e of r.afterPolicies){const n=t.get(e);n&&(i.dependsOn.add(n),n.dependants.add(i))}if(r.beforePolicies)for(const e of r.beforePolicies){const n=t.get(e);n&&(n.dependsOn.add(i),i.dependants.add(n))}}function c(n){for(const r of n)if(!(r.afterPhase&&r.afterPhase.size||0!==r.dependsOn.size)){e.push(r.policy);for(const e of r.dependants)e.dependsOn.delete(r);t.delete(r.policy.name),n.delete(r)}}function u(){let e=!1;for(const t of s)if(c(t),t===r&&(e=!0),t.size>0&&t!==r)return void(!1===e&&c(r))}for(;t.size>0;){const t=e.length;if(u(),e.length<=t)throw new Error("Cannot satisfy policy dependencies due to requirements cycle.")}return e}}const Cn=new Error("decompressResponsePolicy is not supported in browser environment");const On=Object(F.a)("core-rest-pipeline");function In(e={}){var t,n,r;const o=null!==(t=e.maxRetries)&&void 0!==t?t:10,i=null!==(n=e.retryDelayInMs)&&void 0!==n?n:1e3,s=null!==(r=e.maxRetryDelayInMs)&&void 0!==r?r:64e3;async function a(e,t,n,r,c){var u;t=function(e,t){t&&(e.error&&(t.innerError=e.error),e.error=t),e.retryCount++;const n=i*Math.pow(2,e.retryCount),r=Math.min(s,n),o=r/2+Object(ln.b)(0,r/2);return e.retryInterval=o,e}(t,c);const l=null===(u=n.abortSignal)||void 0===u?void 0:u.aborted;if(l||!function(e,t){const n=null==e?void 0:e.status;return(503!==n||!(null==e?void 0:e.headers.get("Retry-After")))&&(!(void 0===n||n<500&&408!==n||501===n||505===n)&&(t&&t.retryCount)<o)}(r,t)){if(l||c||!r){throw t.error||new mn("Failed to send the request.",{code:mn.REQUEST_SEND_ERROR,statusCode:null==r?void 0:r.status,request:null==r?void 0:r.request,response:r})}return r}On.info("Retrying request in "+t.retryInterval);try{await Object(ln.a)(t.retryInterval);const r=await e(n);return a(e,t,n,r)}catch(o){return a(e,t,n,r,o)}}return{name:"exponentialRetryPolicy",async sendRequest(e,t){const n={retryCount:0,retryInterval:0};try{const r=await t(e);return a(t,n,e,r)}catch(r){const o=r;return a(t,n,e,o.response,o)}}}}const An=new Error("proxyPolicy is not supported in browser environment");const Pn=["GET","HEAD"];function _n(e={}){const{maxRetries:t=20}=e;return{name:"redirectPolicy",async sendRequest(e,n){const r=await n(e);return async function e(t,n,r,o=0){const{request:i,status:s,headers:a}=n,c=a.get("location");if(c&&(300===s||301===s&&Pn.includes(i.method)||302===s&&Pn.includes(i.method)||303===s&&"POST"===i.method||307===s)&&o<r){const n=new dn(c,i.url);i.url=n.toString(),303===s&&(i.method="GET",i.headers.delete("Content-Length"),delete i.body);const a=await t(i);return e(t,a,r,o+1)}return n}(n,r,t)}}}function xn(e={}){var t,n,r;const o=null!==(t=e.maxRetries)&&void 0!==t?t:10,i=null!==(n=e.retryDelayInMs)&&void 0!==n?n:1e3,s=null!==(r=e.maxRetryDelayInMs)&&void 0!==r?r:64e3;async function a(e,t,n,r,c){if(!function(e,t){return!!function(e){if(!e)return!1;return"ETIMEDOUT"===e.code||"ESOCKETTIMEDOUT"===e.code||"ECONNREFUSED"===e.code||"ECONNRESET"===e.code||"ENOENT"===e.code}(t)&&e.retryCount<=o}(t=function(e,t){t&&(e.error&&(t.innerError=e.error),e.error=t),e.retryCount++;const n=i*Math.pow(2,e.retryCount),r=Math.min(s,n),o=r/2+Object(ln.b)(0,r/2);return e.retryInterval=o,e}(t,c),c)){if(c||!r){throw t.error||new mn("Failed to send the request.",{code:mn.REQUEST_SEND_ERROR,statusCode:null==r?void 0:r.status,request:null==r?void 0:r.request,response:r})}return r}try{On.info("Retrying request in "+t.retryInterval),await Object(ln.a)(t.retryInterval);const r=await e(n);return a(e,t,n,r)}catch(o){return a(e,t,n,r,o)}}return{name:"systemErrorRetryPolicy",async sendRequest(e,t){const n={retryCount:0,retryInterval:0};try{const r=await t(e);return a(t,n,e,r)}catch(r){const o=r;return a(t,n,e,o.response,o)}}}}function kn(e){try{const t=Number(e);if(Number.isNaN(t)){const t=Date.now(),n=Date.parse(e)-t;return Number.isNaN(n)?void 0:n}return 1e3*t}catch(e){return}}var Nn=n(209);function Mn(e){const t=new Map;t.set("core-rest-pipeline","1.3.1"),function(e){const t=self.navigator;e.set("OS",(t.oscpu||t.platform).replace(" ",""))}(t);const n=function(e){const t=[];for(const[n,r]of e){const e=r?`${n}/${r}`:n;t.push(e)}return t.join(" ")}(t);return e?`${e} ${n}`:n}const Dn=Object(W.a)({packagePrefix:"",namespace:""});function jn(e={}){const t=Mn(e.userAgentPrefix);return{name:"tracingPolicy",async sendRequest(e,n){var r;if(!(null===(r=e.tracingOptions)||void 0===r?void 0:r.tracingContext))return n(e);const o=function(e,t){var n,r,o;try{const i=Object.assign(Object.assign({},null===(n=e.tracingOptions)||void 0===n?void 0:n.spanOptions),{kind:J.a.CLIENT}),s=new dn(e.url).pathname||"/",{span:a}=Dn(s,{tracingOptions:Object.assign(Object.assign({},e.tracingOptions),{spanOptions:i})});if(!a.isRecording())return void a.end();const c=null===(o=null===(r=e.tracingOptions)||void 0===r?void 0:r.tracingContext)||void 0===o?void 0:o.getValue(Symbol.for("az.namespace"));"string"==typeof c&&a.setAttribute("az.namespace",c),a.setAttributes({"http.method":e.method,"http.url":e.url,requestId:e.requestId}),t&&a.setAttribute("http.user_agent",t);const u=a.spanContext(),l=Object(Nn.a)(u);if(l&&Object(J.e)(u)){e.headers.set("traceparent",l);const t=u.traceState&&u.traceState.serialize();t&&e.headers.set("tracestate",t)}return a}catch(e){return void On.warning("Skipping creating a tracing span due to an error: "+e.message)}}(e,t);if(!o)return n(e);try{const t=await n(e);return function(e,t){try{e.setAttribute("http.status_code",t.status);const n=t.headers.get("x-ms-request-id");n&&e.setAttribute("serviceRequestId",n),e.setStatus({code:J.b.OK}),e.end()}catch(e){On.warning("Skipping tracing span processing due to an error: "+e.message)}}(o,t),t}catch(e){throw function(e,t){try{e.setStatus({code:J.b.ERROR,message:t.message}),t.statusCode&&e.setAttribute("http.status_code",t.statusCode),e.end()}catch(e){On.warning("Skipping tracing span processing due to an error: "+e.message)}}(o,e),e}}}}function Un(e){const t=Rn.create();return ln.c&&(t.addPolicy(function(){throw An}(e.proxyOptions)),t.addPolicy(function(){throw Cn}())),t.addPolicy({name:"formDataPolicy",async sendRequest(e,t){if(e.formData){const t=e.formData,n=new FormData;for(const e of Object.keys(t)){const r=t[e];if(Array.isArray(r))for(const t of r)n.append(e,t);else n.append(e,r)}e.body=n,e.formData=void 0;const r=e.headers.get("Content-Type");r&&-1!==r.indexOf("multipart/form-data")&&e.headers.delete("Content-Type")}return t(e)}}),t.addPolicy(jn(e.userAgentOptions)),t.addPolicy(function(e={}){const t=Mn(e.userAgentPrefix);return{name:"userAgentPolicy",sendRequest:async(e,n)=>(e.headers.has("x-ms-useragent")||e.headers.set("x-ms-useragent",t),n(e))}}(e.userAgentOptions)),t.addPolicy(function(e="x-ms-client-request-id"){return{name:"setClientRequestIdPolicy",sendRequest:async(t,n)=>(t.headers.has(e)||t.headers.set(e,t.requestId),n(t))}}()),t.addPolicy({name:"throttlingRetryPolicy",async sendRequest(e,t){let n=await t(e);for(let r=0;r<3;r++){if(429!==n.status&&503!==n.status)return n;const r=n.headers.get("Retry-After");if(!r)break;const o=kn(r);if(!o)break;await Object(ln.a)(o),n=await t(e)}return n}},{phase:"Retry"}),t.addPolicy(xn(e.retryOptions),{phase:"Retry"}),t.addPolicy(In(e.retryOptions),{phase:"Retry"}),t.addPolicy(_n(e.redirectOptions),{afterPhase:"Retry"}),t.addPolicy(function(e={}){var t;const n=null!==(t=e.logger)&&void 0!==t?t:On.info,r=new fn({additionalAllowedHeaderNames:e.additionalAllowedHeaderNames,additionalAllowedQueryParameters:e.additionalAllowedQueryParameters});return{name:"logPolicy",async sendRequest(e,t){if(!n.enabled)return t(e);n("Request: "+r.sanitize(e));const o=await t(e);return n("Response status code: "+o.status),n("Headers: "+r.sanitize(o.headers)),o}}}(e.loggingOptions),{afterPhase:"Retry"}),t}const Ln={forcedRefreshWindowInMs:1e3,retryIntervalInMs:3e3,refreshWindowInMs:12e4};function qn(e,t){let n=null,r=null;const o=Object.assign(Object.assign({},Ln),t),i={get isRefreshing(){return null!==n},get shouldRefresh(){var e;return!i.isRefreshing&&(null!==(e=null==r?void 0:r.expiresOnTimestamp)&&void 0!==e?e:0)-o.refreshWindowInMs<Date.now()},get mustRefresh(){return null===r||r.expiresOnTimestamp-o.forcedRefreshWindowInMs<Date.now()}};function s(t,s){var a;if(!i.isRefreshing){n=async function(e,t,n){async function r(){if(!(Date.now()<n)){const t=await e();if(null===t)throw new Error("Failed to refresh access token.");return t}try{return await e()}catch(e){return null}}let o=await r();for(;null===o;)await Object(ln.a)(t),o=await r();return o}(()=>e.getToken(t,s),o.retryIntervalInMs,null!==(a=null==r?void 0:r.expiresOnTimestamp)&&void 0!==a?a:Date.now()).then(e=>(n=null,r=e,r)).catch(e=>{throw n=null,r=null,e})}return n}return async(e,t)=>i.mustRefresh?s(e,t):(i.shouldRefresh&&s(e,t),r)}async function Bn(e){const{scopes:t,getAccessToken:n,request:r}=e,o={abortSignal:r.abortSignal,tracingOptions:r.tracingOptions},i=await n(t,o);i&&e.request.headers.set("Authorization","Bearer "+i.token)}function zn(e){var t;const{credential:n,scopes:r,challengeCallbacks:o}=e,i=Object.assign({authorizeRequest:null!==(t=null==o?void 0:o.authorizeRequest)&&void 0!==t?t:Bn,authorizeRequestOnChallenge:null==o?void 0:o.authorizeRequestOnChallenge},o),s=n?qn(n):()=>Promise.resolve(null);return{name:"bearerTokenAuthenticationPolicy",async sendRequest(e,t){if(!e.url.toLowerCase().startsWith("https://"))throw new Error("Bearer token authentication is not permitted for non-TLS protected (non-https) URLs.");let n,o;await i.authorizeRequest({scopes:Array.isArray(r)?r:[r],request:e,getAccessToken:s});try{n=await t(e)}catch(e){o=e,n=e.response}if(i.authorizeRequestOnChallenge&&401===(null==n?void 0:n.status)&&function(e){const t=e.headers.get("WWW-Authenticate");if(401===e.status&&t)return t}(n)){if(await i.authorizeRequestOnChallenge({scopes:Array.isArray(r)?r:[r],request:e,response:n,getAccessToken:s}))return t(e)}if(o)throw o;return n}}}const Hn=["application/json","text/json"],Fn=["application/xml","application/atom+xml"];function $n(e={}){var t,n,r,o,i,s,a;const c=null!==(n=null===(t=e.expectedContentTypes)||void 0===t?void 0:t.json)&&void 0!==n?n:Hn,u=null!==(o=null===(r=e.expectedContentTypes)||void 0===r?void 0:r.xml)&&void 0!==o?o:Fn,l=e.parseXML,d=e.serializerOptions,p={xml:{rootName:null!==(i=null==d?void 0:d.xml.rootName)&&void 0!==i?i:"",includeRoot:null!==(s=null==d?void 0:d.xml.includeRoot)&&void 0!==s&&s,xmlCharKey:null!==(a=null==d?void 0:d.xml.xmlCharKey)&&void 0!==a?a:"_"}};return{name:"deserializationPolicy",async sendRequest(e,t){const n=await t(e);return async function(e,t,n,r,o){const i=await async function(e,t,n,r,o){var i;if(!(null===(i=n.request.streamResponseStatusCodes)||void 0===i?void 0:i.has(n.status))&&n.bodyAsText){const i=n.bodyAsText,s=n.headers.get("Content-Type")||"",a=s?s.split(";").map(e=>e.toLowerCase()):[];try{if(0===a.length||a.some(t=>-1!==e.indexOf(t)))return n.parsedBody=JSON.parse(i),n;if(a.some(e=>-1!==t.indexOf(e))){if(!o)throw new Error("Parsing XML not supported.");const e=await o(i,r.xml);return n.parsedBody=e,n}}catch(e){const t=`Error "${e}" occurred while parsing the response body - ${n.bodyAsText}.`,r=e.code||mn.PARSE_ERROR;throw new mn(t,{code:r,statusCode:n.status,request:n.request,response:n})}}return n}(e,t,n,r,o);if(!function(e){const t=rn(e.request),n=null==t?void 0:t.shouldDeserialize;let r;r=void 0===n||("boolean"==typeof n?n:n(e));return r}(i))return i;const s=rn(i.request),a=null==s?void 0:s.operationSpec;if(!a||!a.responses)return i;const c=function(e){let t;const n=rn(e.request),r=null==n?void 0:n.operationSpec;r&&(t=(null==n?void 0:n.operationResponseGetter)?null==n?void 0:n.operationResponseGetter(r,e):r.responses[e.status]);return t}(i),{error:u,shouldReturnResponse:l}=function(e,t,n){var r;const o=200<=e.status&&e.status<300;if(function(e){const t=Object.keys(e.responses);return 0===t.length||1===t.length&&"default"===t[0]}(t)?o:n){if(!n)return{error:null,shouldReturnResponse:!1};if(!n.isError)return{error:null,shouldReturnResponse:!1}}const i=null!=n?n:t.responses.default,s=(null===(r=e.request.streamResponseStatusCodes)||void 0===r?void 0:r.has(e.status))?"Unexpected status code: "+e.status:e.bodyAsText,a=new mn(s,{statusCode:e.status,request:e.request,response:e});if(!i)throw a;const c=i.bodyMapper,u=i.headersMapper;try{if(e.parsedBody){const n=e.parsedBody;let r;if(c){let e=n;if(t.isXML&&c.type.name===Ee){e=[];const t=c.xmlElementName;"object"==typeof n&&t&&(e=n[t])}r=t.serializer.deserialize(c,e,"error.response.parsedBody")}const o=n.error||r||n;a.code=o.code,o.message&&(a.message=o.message),c&&(a.response.parsedBody=r)}e.headers&&u&&(a.response.parsedHeaders=t.serializer.deserialize(u,e.headers.toJSON(),"operationRes.parsedHeaders"))}catch(t){a.message=`Error "${t.message}" occurred in deserializing the responseBody - "${e.bodyAsText}" for the default response.`}return{error:a,shouldReturnResponse:!1}}(i,a,c);if(u)throw u;if(l)return i;if(c){if(c.bodyMapper){let e=i.parsedBody;a.isXML&&c.bodyMapper.type.name===Ee&&(e="object"==typeof e?e[c.bodyMapper.xmlElementName]:[]);try{i.parsedBody=a.serializer.deserialize(c.bodyMapper,e,"operationRes.parsedBody")}catch(e){throw new mn(`Error ${e} occurred in deserializing the responseBody - ${i.bodyAsText}`,{statusCode:i.status,request:i.request,response:i})}}else"HEAD"===a.httpMethod&&(i.parsedBody=n.status>=200&&n.status<300);c.headersMapper&&(i.parsedHeaders=a.serializer.deserialize(c.headersMapper,i.headers.toJSON(),"operationRes.parsedHeaders"))}return i}(c,u,n,p,l)}}}function Gn(e={}){const t=e.stringifyXML;return{name:"serializationPolicy",async sendRequest(e,n){const r=rn(e),o=null==r?void 0:r.operationSpec,i=null==r?void 0:r.operationArguments;return o&&i&&(function(e,t,n){var r,o;if(n.headerParameters)for(const r of n.headerParameters){let o=en(t,r);if(null!=o||r.mapper.required){o=n.serializer.serialize(r.mapper,o,Zt(r));const t=r.mapper.headerCollectionPrefix;if(t)for(const n of Object.keys(o))e.headers.set(t+n,o[n]);else e.headers.set(r.mapper.serializedName||Zt(r),o)}}const i=null===(o=null===(r=t.options)||void 0===r?void 0:r.requestOptions)||void 0===o?void 0:o.customHeaders;if(i)for(const t of Object.keys(i))e.headers.set(t,i[t])}(e,i,o),function(e,t,n,r=function(){throw new Error("XML serialization unsupported!")}){var o,i,s,a,c;const u=null===(o=t.options)||void 0===o?void 0:o.serializerOptions,l={xml:{rootName:null!==(i=null==u?void 0:u.xml.rootName)&&void 0!==i?i:"",includeRoot:null!==(s=null==u?void 0:u.xml.includeRoot)&&void 0!==s&&s,xmlCharKey:null!==(a=null==u?void 0:u.xml.xmlCharKey)&&void 0!==a?a:"_"}},d=l.xml.xmlCharKey;if(n.requestBody&&n.requestBody.mapper){e.body=en(t,n.requestBody);const o=n.requestBody.mapper,{required:i,serializedName:s,xmlName:a,xmlElementName:u,xmlNamespace:p,xmlNamespacePrefix:h,nullable:f}=o,g=o.type.name;try{if(void 0!==e.body&&null!==e.body||f&&null===e.body||i){const t=Zt(n.requestBody);e.body=n.serializer.serialize(o,e.body,t,l);const i=g===Re;if(n.isXML){const t=h?"xmlns:"+h:"xmlns",n=function(e,t,n,r,o){if(e&&!["Composite","Sequence","Dictionary"].includes(n)){const n={};return n[o.xml.xmlCharKey]=r,n[de]={[t]:e},n}return r}(p,t,g,e.body,l);g===Ee?e.body=r(function(e,t,n,r){Array.isArray(e)||(e=[e]);if(!n||!r)return{[t]:e};const o={[t]:e};return o[de]={[n]:r},o}(n,u||a||s,t,p),{rootName:a||s,xmlCharKey:d}):i||(e.body=r(n,{rootName:a||s,xmlCharKey:d}))}else{if(g===Se&&((null===(c=n.contentType)||void 0===c?void 0:c.match("text/plain"))||"text"===n.mediaType))return;i||(e.body=JSON.stringify(e.body))}}}catch(e){throw new Error(`Error "${e.message}" occurred in serializing the payload - ${JSON.stringify(s,void 0,"  ")}.`)}}else if(n.formDataParameters&&n.formDataParameters.length>0){e.formData={};for(const r of n.formDataParameters){const o=en(t,r);if(null!=o){const t=r.mapper.serializedName||Zt(r);e.formData[t]=n.serializer.serialize(r.mapper,o,Zt(r),l)}}}}(e,i,o,t)),n(e)}}}class Vn extends class extends class{constructor(e={}){this._requestContentType=e.requestContentType,this._baseUri=e.baseUri,this._allowInsecureConnection=e.allowInsecureConnection,this._httpClient=e.httpClient||(En||(En=wn()),En),this.pipeline=e.pipeline||function(e){const t=function(e){if(e.credentialScopes){const t=e.credentialScopes;return Array.isArray(t)?t.map(e=>new URL(e).toString()):new URL(t).toString()}if(e.baseUri)return e.baseUri+"/.default";if(e.credential&&!e.credentialScopes)throw new Error("When using credentials, the ServiceClientOptions must contain either a baseUri or a credentialScopes. Unable to create a bearerTokenAuthenticationPolicy");return}(e),n=e.credential&&t?{credentialScopes:t,credential:e.credential}:void 0;return function(e={}){const t=Un(null!=e?e:{});return e.credentialOptions&&t.addPolicy(zn({credential:e.credentialOptions.credential,scopes:e.credentialOptions.credentialScopes})),t.addPolicy(Gn(e.serializationOptions),{phase:"Serialize"}),t.addPolicy($n(e.deserializationOptions),{phase:"Deserialize"}),t}(Object.assign(Object.assign({},e),{credentialOptions:n}))}(e)}async sendRequest(e){return this.pipeline.sendRequest(this._httpClient,e)}async sendOperationRequest(e,t){const n=t.baseUrl||this._baseUri;if(!n)throw new Error("If operationSpec.baseUrl is not specified, then the ServiceClient must have a baseUri string property that contains the base URL to use.");const r=function(e){return new Qt(e)}({url:sn(n,t,e,this)});r.method=t.httpMethod;const o=rn(r);o.operationSpec=t,o.operationArguments=e;const i=t.contentType||this._requestContentType;i&&t.requestBody&&r.headers.set("Content-Type",i);const s=e.options;if(s){const e=s.requestOptions;e&&(e.timeout&&(r.timeout=e.timeout),e.onUploadProgress&&(r.onUploadProgress=e.onUploadProgress),e.onDownloadProgress&&(r.onDownloadProgress=e.onDownloadProgress),void 0!==e.shouldDeserialize&&(o.shouldDeserialize=e.shouldDeserialize),e.allowInsecureConnection&&(r.allowInsecureConnection=!0)),s.abortSignal&&(r.abortSignal=s.abortSignal),s.tracingOptions&&(r.tracingOptions=s.tracingOptions)}this._allowInsecureConnection&&(r.allowInsecureConnection=!0),void 0===r.streamResponseStatusCodes&&(r.streamResponseStatusCodes=function(e){const t=new Set;for(const n in e.responses){const r=e.responses[n];r.bodyMapper&&r.bodyMapper.type.name===Re&&t.add(Number(n))}return t}(t));try{const e=await this.sendRequest(r),n=ce(e,t.responses[e.status]);return(null==s?void 0:s.onResponse)&&s.onResponse(e,n),n}catch(e){throw e.response&&(e.details=ce(e.response,t.responses[e.statusCode]||t.responses.default)),e}}}{constructor(e,t){if(void 0===e)throw new Error("'endpoint' cannot be null");t||(t={});const n=t.userAgentOptions&&t.userAgentOptions.userAgentPrefix?t.userAgentOptions.userAgentPrefix+" azsdk-js-azure-communication-chat/1.1.0":"azsdk-js-azure-communication-chat/1.1.0";super(Object.assign(Object.assign(Object.assign({},{requestContentType:"application/json; charset=utf-8"}),t),{userAgentOptions:{userAgentPrefix:n},baseUri:t.endpoint||"{endpoint}"})),this.endpoint=e,this.apiVersion=t.apiVersion||"2021-09-07"}}{constructor(e,t){super(e,t),this.chatThread=new mt(this),this.chat=new Mt(this)}}const Jn=e=>zn({credential:{getToken:(t,n)=>e.getToken({abortSignal:null==n?void 0:n.abortSignal})},scopes:[]});class Wn{constructor(e,t,n,r={}){this.endpoint=e,this.timeOfLastTypingRequest=void 0,this.threadId=t,this.tokenCredential=n;const o=Object.assign(Object.assign({},r),{loggingOptions:{logger:$.info}});this.client=new Vn(this.endpoint,Object.assign({endpoint:this.endpoint},o));const i=Jn(this.tokenCredential);this.client.pipeline.addPolicy(i)}async getProperties(e={}){const{span:t,updatedOptions:n}=Y("ChatClient-GetProperties",e);try{const e=await this.client.chatThread.getChatThreadProperties(this.threadId,n);return oe(e)}catch(e){throw t.setStatus({code:J.b.ERROR,message:e.message}),e}finally{t.end()}}async updateTopic(e,t={}){const{span:n,updatedOptions:r}=Y("ChatThreadClient-UpdateTopic",t);try{await this.client.chatThread.updateChatThreadProperties(this.threadId,{topic:e},r)}catch(e){throw n.setStatus({code:J.b.ERROR,message:e.message}),e}finally{n.end()}}async sendMessage(e,t={}){const{span:n,updatedOptions:r}=Y("ChatThreadClient-SendMessage",t);try{this.timeOfLastTypingRequest=void 0;return await this.client.chatThread.sendChatMessage(this.threadId,Object.assign(Object.assign({},e),t),r)}catch(e){throw n.setStatus({code:J.b.ERROR,message:e.message}),e}finally{n.end()}}async getMessage(e,t={}){const{span:n,updatedOptions:r}=Y("ChatThreadClient-GetMessage",t);try{const t=await this.client.chatThread.getChatMessage(this.threadId,e,r);return re(t)}catch(e){throw n.setStatus({code:J.b.ERROR,message:e.message}),e}finally{n.end()}}listMessagesPage(e,t={}){return B(this,arguments,(function*(){if(!e.continuationToken){const n=yield q(this.client.chatThread.listChatMessages(this.threadId,t));e.continuationToken=n.nextLink,n.value&&(yield yield q(n.value.map(re,this)))}for(;e.continuationToken;){const n=yield q(this.client.chatThread.listChatMessagesNext(this.threadId,e.continuationToken,t));if(e.continuationToken=n.nextLink,!n.value)break;yield yield q(n.value.map(re,this))}}))}listMessagesAll(e){return B(this,arguments,(function*(){var t,n;try{for(var r,o=H(this.listMessagesPage({},e));!(r=yield q(o.next())).done;){const e=r.value;yield q(yield*z(H(e)))}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=o.return)&&(yield q(n.call(o)))}finally{if(t)throw t.error}}}))}listMessages(e={}){const{span:t,updatedOptions:n}=Y("ChatThreadClient-ListMessages",e);try{const e=this.listMessagesAll(n);return{next:()=>e.next(),[Symbol.asyncIterator](){return this},byPage:(e={})=>this.listMessagesPage(e,n)}}catch(e){throw t.setStatus({code:J.b.ERROR,message:e.message}),e}finally{t.end()}}async deleteMessage(e,t={}){const{span:n,updatedOptions:r}=Y("ChatThreadClient-DeleteMessage",t);try{await this.client.chatThread.deleteChatMessage(this.threadId,e,r)}catch(e){throw n.setStatus({code:J.b.ERROR,message:e.message}),e}finally{n.end()}}async updateMessage(e,t={}){const{span:n,updatedOptions:r}=Y("ChatThreadClient-UpdateMessage",t);try{await this.client.chatThread.updateChatMessage(this.threadId,e,t,r)}catch(e){throw n.setStatus({code:J.b.ERROR,message:e.message}),e}finally{n.end()}}async addParticipants(e,t={}){const{span:n,updatedOptions:r}=Y("ChatThreadClient-AddParticipants",t);try{return await this.client.chatThread.addChatParticipants(this.threadId,(o=e,{participants:null===(i=o.participants)||void 0===i?void 0:i.map(e=>ee(e))}),r)}catch(e){throw n.setStatus({code:J.b.ERROR,message:e.message}),e}finally{n.end()}var o,i}listParticipantsPage(e,t={}){return B(this,arguments,(function*(){if(!e.continuationToken){const n=yield q(this.client.chatThread.listChatParticipants(this.threadId,t));e.continuationToken=n.nextLink,n.value&&(yield yield q(n.value.map(te,this)))}for(;e.continuationToken;){const n=yield q(this.client.chatThread.listChatParticipantsNext(this.threadId,e.continuationToken,t));if(e.continuationToken=n.nextLink,!n.value)break;yield yield q(n.value.map(te,this))}}))}listParticipantsAll(e){return B(this,arguments,(function*(){var t,n;try{for(var r,o=H(this.listParticipantsPage({},e));!(r=yield q(o.next())).done;){const e=r.value;yield q(yield*z(H(e)))}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=o.return)&&(yield q(n.call(o)))}finally{if(t)throw t.error}}}))}listParticipants(e={}){const{span:t,updatedOptions:n}=Y("ChatThreadClient-ListParticipants",e);try{const e=this.listParticipantsAll(n);return{next:()=>e.next(),[Symbol.asyncIterator](){return this},byPage:(e={})=>this.listParticipantsPage(e,n)}}catch(e){throw t.setStatus({code:J.b.ERROR,message:e.message}),e}finally{t.end()}}async removeParticipant(e,t={}){const{span:n,updatedOptions:r}=Y("ChatThreadClient-RemoveParticipant",t);try{await this.client.chatThread.removeChatParticipant(this.threadId,Q(e),r)}catch(e){throw n.setStatus({code:J.b.ERROR,message:e.message}),e}finally{n.end()}}async sendTypingNotification(e={}){const{span:t,updatedOptions:n}=Y("ChatThreadClient-SendTypingNotification",e);try{const e=new Date,{senderDisplayName:r}=n,o=U(n,["senderDisplayName"]);return this.canPostTypingNotification(e)?(await this.client.chatThread.sendTypingNotification(this.threadId,Object.assign({sendTypingNotificationRequest:{senderDisplayName:r}},o)),this.timeOfLastTypingRequest=e,!0):($.info(`Typing Notification NOT Send. [thread_id=${this.threadId}]`),!1)}catch(e){throw t.setStatus({code:J.b.ERROR,message:e.message}),e}finally{t.end()}}async sendReadReceipt(e,t={}){const{span:n,updatedOptions:r}=Y("ChatThreadClient-SendReadReceipt",t);try{await this.client.chatThread.sendChatReadReceipt(this.threadId,e,r)}catch(e){throw n.setStatus({code:J.b.ERROR,message:e.message}),e}finally{n.end()}}listReadReceiptsPage(e,t={}){return B(this,arguments,(function*(){if(!e.continuationToken){const n=yield q(this.client.chatThread.listChatReadReceipts(this.threadId,t));e.continuationToken=n.nextLink,n.value&&(yield yield q(n.value.map(ie,this)))}for(;e.continuationToken;){const n=yield q(this.client.chatThread.listChatReadReceiptsNext(this.threadId,e.continuationToken,t));if(e.continuationToken=n.nextLink,!n.value)break;yield yield q(n.value.map(ie,this))}}))}listReadReceiptsAll(e){return B(this,arguments,(function*(){var t,n;try{for(var r,o=H(this.listReadReceiptsPage({},e));!(r=yield q(o.next())).done;){const e=r.value;yield q(yield*z(H(e)))}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=o.return)&&(yield q(n.call(o)))}finally{if(t)throw t.error}}}))}listReadReceipts(e={}){const{span:t,updatedOptions:n}=Y("ChatThreadClient-ListChatReadReceipts",e);try{const e=this.listReadReceiptsAll(n);return{next:()=>e.next(),[Symbol.asyncIterator](){return this},byPage:(e={})=>this.listReadReceiptsPage(e,n)}}catch(e){throw t.setStatus({code:J.b.ERROR,message:e.message}),e}finally{t.end()}}canPostTypingNotification(e){if(this.timeOfLastTypingRequest){if(e.getTime()-this.timeOfLastTypingRequest.getTime()<8e3)return $.info(`Typing interval check failed. [last_request=${this.timeOfLastTypingRequest}]`),!1}return!0}}var Yn,Kn=new Uint8Array(16);function Xn(){if(!Yn&&!(Yn="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Yn(Kn)}var Qn=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var Zn=function(e){return"string"==typeof e&&Qn.test(e)},er=[],tr=0;tr<256;++tr)er.push((tr+256).toString(16).substr(1));var nr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(er[e[t+0]]+er[e[t+1]]+er[e[t+2]]+er[e[t+3]]+"-"+er[e[t+4]]+er[e[t+5]]+"-"+er[e[t+6]]+er[e[t+7]]+"-"+er[e[t+8]]+er[e[t+9]]+"-"+er[e[t+10]]+er[e[t+11]]+er[e[t+12]]+er[e[t+13]]+er[e[t+14]]+er[e[t+15]]).toLowerCase();if(!Zn(n))throw TypeError("Stringified UUID is invalid");return n};var rr=function(e,t,n){var r=(e=e||{}).random||(e.rng||Xn)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return nr(r)};class or{constructor(e,t,n={}){this.endpoint=e,this.signalingClient=void 0,this.emitter=new G.EventEmitter,this.isRealtimeNotificationsStarted=!1,this.tokenCredential=t,this.clientOptions=Object.assign({},n);const r=Object.assign(Object.assign({},n),{loggingOptions:{logger:$.info}});this.client=new Vn(this.endpoint,Object.assign({endpoint:this.endpoint},r));const o=Jn(this.tokenCredential);this.client.pipeline.addPolicy(o),this.signalingClient=((e,t,n)=>{var r;return new V.CommunicationSignalingClient(e,t,{environment:null!==(r=null==n?void 0:n.environment)&&void 0!==r?r:void 0})})(t,$,n.signalingClientOptions)}getChatThreadClient(e){return new Wn(this.endpoint,e,this.tokenCredential,this.clientOptions)}async createChatThread(e,t={}){var n,r;const{span:o,updatedOptions:i}=Y("ChatClient-CreateChatThread",t);try{i.idempotencyToken=null!==(n=i.idempotencyToken)&&void 0!==n?n:rr();const s=(e=>{const{participants:t,idempotencyToken:n}=e,r=U(e,["participants","idempotencyToken"]);return Object.assign({repeatabilityRequestId:n},r)})(i);return(e=>{const{chatThread:t}=e,n=U(e,["chatThread"]);return t?Object.assign(Object.assign({},n),{chatThread:oe(t)}):Object.assign({},n)})(await this.client.chat.createChatThread({topic:e.topic,participants:null===(r=t.participants)||void 0===r?void 0:r.map(e=>ee(e))},s))}catch(e){throw o.setStatus({code:J.b.ERROR,message:e.message}),e}finally{o.end()}}listChatThreadsPage(e,t={}){return B(this,arguments,(function*(){if(!e.continuationToken){const n=yield q(this.client.chat.listChatThreads(t));e.continuationToken=n.nextLink,n.value&&(yield yield q(n.value))}for(;e.continuationToken;){const n=yield q(this.client.chat.listChatThreadsNext(e.continuationToken,t));if(e.continuationToken=n.nextLink,!n.value)break;yield yield q(n.value)}}))}listChatThreadsAll(e){return B(this,arguments,(function*(){var t,n;try{for(var r,o=H(this.listChatThreadsPage({},e));!(r=yield q(o.next())).done;){const e=r.value;yield q(yield*z(H(e)))}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=o.return)&&(yield q(n.call(o)))}finally{if(t)throw t.error}}}))}listChatThreads(e={}){const{span:t,updatedOptions:n}=Y("ChatClient-ListChatThreads",e);try{const e=this.listChatThreadsAll(n);return{next:()=>e.next(),[Symbol.asyncIterator](){return this},byPage:(e={})=>this.listChatThreadsPage(e,n)}}catch(e){throw t.setStatus({code:J.b.ERROR,message:e.message}),e}finally{t.end()}}async deleteChatThread(e,t={}){const{span:n,updatedOptions:r}=Y("ChatClient-DeleteChatThread",t);try{await this.client.chat.deleteChatThread(e,r)}catch(e){throw n.setStatus({code:J.b.ERROR,message:e.message}),e}finally{n.end()}}async startRealtimeNotifications(){if(void 0===this.signalingClient)throw new Error("Realtime notifications are not supported in node js.");this.isRealtimeNotificationsStarted||(this.isRealtimeNotificationsStarted=!0,await this.signalingClient.start(),this.subscribeToSignalingEvents())}async stopRealtimeNotifications(){if(void 0===this.signalingClient)throw new Error("Realtime notifications are not supported in node js.");this.isRealtimeNotificationsStarted=!1,await this.signalingClient.stop(),this.emitter.removeAllListeners()}on(e,t){if(void 0===this.signalingClient)throw new Error("Realtime notifications are only supported in the browser.");if(!this.isRealtimeNotificationsStarted)throw new Error("You must call startRealtimeNotifications before you can subscribe to events.");this.emitter.on(e,t)}off(e,t){if(void 0===this.signalingClient)throw new Error("Realtime notifications are only supported in the browser.");this.emitter.removeListener(e,t)}subscribeToSignalingEvents(){if(void 0===this.signalingClient)throw new Error("Realtime notifications are only supported in the browser.");this.signalingClient.on("chatMessageReceived",e=>{this.emitter.emit("chatMessageReceived",e)}),this.signalingClient.on("chatMessageEdited",e=>{this.emitter.emit("chatMessageEdited",e)}),this.signalingClient.on("chatMessageDeleted",e=>{this.emitter.emit("chatMessageDeleted",e)}),this.signalingClient.on("typingIndicatorReceived",e=>{this.emitter.emit("typingIndicatorReceived",e)}),this.signalingClient.on("readReceiptReceived",e=>{this.emitter.emit("readReceiptReceived",e)}),this.signalingClient.on("chatThreadCreated",e=>{this.emitter.emit("chatThreadCreated",e)}),this.signalingClient.on("chatThreadDeleted",e=>{this.emitter.emit("chatThreadDeleted",e)}),this.signalingClient.on("chatThreadPropertiesUpdated",e=>{this.emitter.emit("chatThreadPropertiesUpdated",e)}),this.signalingClient.on("participantsAdded",e=>{this.emitter.emit("participantsAdded",e)}),this.signalingClient.on("participantsRemoved",e=>{this.emitter.emit("participantsRemoved",e)})}}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function ir(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}Object.create;Object.create;var sr=n(104),ar=n.n(sr);const cr=e=>{const{exp:t}=ar()(e);return{token:e,expiresOnTimestamp:1e3*t}};class ur{constructor(e){this.token=e}getToken(){return ir(this,void 0,void 0,(function*(){return this.token}))}dispose(){}}const lr={token:"",expiresOnTimestamp:-10},dr=1e3*10*60;var pr;class hr{constructor(e){this.refreshingIntervalInMs=dr,this.activeTokenFetching=null,this.activeTokenUpdating=null,this.disposed=!1;const{tokenRefresher:t,token:n,refreshProactively:r}=e;this.refresh=t,this.currentToken=n?cr(n):lr,this.refreshProactively=null!=r&&r,this.refreshProactively&&this.scheduleRefresh()}getToken(e){return ir(this,void 0,void 0,(function*(){if(!this.isCurrentTokenExpiringSoon)return this.currentToken;const t=this.updateTokenAndReschedule(null==e?void 0:e.abortSignal);return this.isCurrentTokenValid||(yield t),this.currentToken}))}dispose(){this.disposed=!0,this.activeTokenFetching=null,this.activeTokenUpdating=null,this.currentToken=lr,this.activeTimeout&&clearTimeout(this.activeTimeout)}updateTokenAndReschedule(e){return ir(this,void 0,void 0,(function*(){if(this.activeTokenUpdating)return this.activeTokenUpdating;this.activeTokenUpdating=this.refreshTokenAndReschedule(e);try{yield this.activeTokenUpdating}finally{this.activeTokenUpdating=null}}))}refreshTokenAndReschedule(e){return ir(this,void 0,void 0,(function*(){this.currentToken=yield this.refreshToken(e),this.refreshProactively&&this.scheduleRefresh()}))}refreshToken(e){return ir(this,void 0,void 0,(function*(){try{return this.activeTokenFetching||(this.activeTokenFetching=this.refresh(e)),cr(yield this.activeTokenFetching)}finally{this.activeTokenFetching=null}}))}scheduleRefresh(){if(this.disposed)return;this.activeTimeout&&clearTimeout(this.activeTimeout);const e=this.currentToken.expiresOnTimestamp-Date.now()-this.refreshingIntervalInMs;this.activeTimeout=setTimeout(()=>this.updateTokenAndReschedule(),e)}get isCurrentTokenValid(){return this.currentToken&&Date.now()<this.currentToken.expiresOnTimestamp}get isCurrentTokenExpiringSoon(){return!this.currentToken||Date.now()>=this.currentToken.expiresOnTimestamp-this.refreshingIntervalInMs}}class fr{constructor(e){this.disposed=!1,this.tokenCredential="string"==typeof e?new ur(cr(e)):new hr(e)}getToken(e){return ir(this,void 0,void 0,(function*(){this.throwIfDisposed();const t=yield this.tokenCredential.getToken(e);return this.throwIfDisposed(),t}))}dispose(){this.disposed=!0,this.tokenCredential.dispose()}throwIfDisposed(){if(this.disposed)throw new Error("User credential is disposed")}}!function(e){e.ADAPTER_STATE_UPDATE="ADAPTER_STATE_UPDATE",e.ACS_SDK_START_INIT="ACS_SDK_START_INIT",e.ACS_SDK_CHATCLIENT_ERROR="ACS_SDK_CHATCLIENT_ERROR",e.ACS_SDK_JOINTHREAD_ERROR="ACS_SDK_JOINTHREAD_ERROR",e.ACS_ADAPTER_CONVERT_HISTORY="ACS_ADAPTER_CONVERT_HISTORY",e.ACS_ADAPTER_CONVERT_TYPING_MESSAGE="ACS_ADAPTER_CONVERT_TYPING_MESSAGE",e.ACS_ADAPTER_CONVERT_MESSAGE="ACS_ADAPTER_CONVERT_MESSAGE",e.ACS_ADAPTER_CONVERT_EDITED_MESSAGE="ACS_ADAPTER_CONVERT_EDITED_MESSAGE",e.ACS_ADAPTER_CONVERT_THREAD_UPDATED="ACS_ADAPTER_CONVERT_THREAD_UPDATED",e.ACS_ADAPTER_CONVERT_THREAD_DELETED="ACS_ADAPTER_CONVERT_THREAD_DELETED",e.ACS_ADAPTER_INGRESS_FAILED="ACS_ADAPTER_INGRESS_FAILED",e.ACS_ADAPTER_SEND_MESSAGE_FAILED="ACS_ADAPTER_SEND_MESSAGE_FAILED",e.ACS_ADAPTER_SEND_MESSAGE_SUCCESS="ACS_ADAPTER_SEND_MESSAGE_SUCCESS",e.ACS_ADAPTER_SEND_MESSAGE_RETRY="ACS_ADAPTER_SEND_MESSAGE_RETRY",e.ACS_ADAPTER_INGRESS_TYPING_FAILED="ACS_ADAPTER_INGRESS_TYPING_FAILED",e.ACS_ADAPTER_INGRESS_TYPING_SUCCESS="ACS_ADAPTER_INGRESS_TYPING_SUCCESS",e.ACS_SDK_RECONNECT="ACS_SDK_RECONNECT",e.MESSAGE_RECEIVED="ADAPTER_MESSAGE_RECEIVED",e.TYPING_MESSAGE_RECEIVED="ADAPTER_TYPING_MESSAGE_RECEIVED",e.THREAD_THREAD_UPDATED="ADAPTER_THREAD_UPDATED_RECEIVED",e.THREAD_DELETED_RECEIVED="ADAPTER_THREAD_DELETED_RECEIVED",e.PARTICIPANT_REMOVED_RECEIVED="ADAPTER_PARTICIPANT_REMOVED_RECEIVED",e.PARTICIPANT_ADDED_RECEIVED="ADAPTER_PARTICIPANT_ADDED_RECEIVED",e.MESSAGE_EDIT_RECEIVED="ADAPTER_MESSAGE_EDIT_RECEIVED",e.REGISTER_ON_NEW_MESSAGE="ADAPTER_REGISTER_ON_NEW_MESSAGE",e.REGISTER_ON_TYPING_INDICATOR="ADAPTER_REGISTER_ON_TYPING_INDICATOR",e.REGISTER_ON_MESSAGE_EDIT="ADAPTER_REGISTER_ON_MESSAGE_EDIT",e.REGISTER_ON_THREAD_DELETED="ADAPTER_REGISTER_ON_THREAD_DELETED",e.REGISTER_ON_THREAD_UPDATED="ADAPTER_REGISTER_ON_THREAD_UPDATED",e.REGISTER_ON_PARTICIPANT_ADDED="ADAPTER_REGISTER_ON_PARTICIPANT_ADDED",e.REGISTER_ON_PARTICIPANT_REMOVED="ADAPTER_REGISTER_ON_PARTICIPANT_REMOVED",e.FILEMANAGER_DOWNLOAD_FILE_FAILED="FILEMANAGER_DOWNLOAD_FILE_FAILED",e.FILEMANAGER_UPLOAD_FILE_FAILED="FILEMANAGER_UPLOAD_FILE_FAILED"}(pr||(pr={}));const gr={id:"",environmentUrl:"",token:""},mr={threadId:"",thread:void 0},yr={displayName:""},vr={chatClient:void 0,chatThreadClient:void 0};var br=n(27),Tr=n.n(br);const wr=e=>new Promise(t=>setTimeout(t,e));class Er{static isACSConnected(){return Object(c.d)(this,void 0,void 0,(function*(){try{return!(!vr.chatThreadClient||!vr.chatClient)&&(yield vr.chatThreadClient.getProperties(),!0)}catch(e){if("RestError: Failed to send"===e)return!1}return!1}))}}class Sr extends Tr.a{constructor(){super(),this.handleOnline=()=>Object(c.d)(this,void 0,void 0,(function*(){for(;!(yield Er.isACSConnected());)yield wr(1e3);this.raiseCustomEvent("online")})),this.handleOffline=()=>Object(c.d)(this,void 0,void 0,(function*(){return this.raiseCustomEvent("offline")})),this.handleLeaveChat=()=>Object(c.d)(this,void 0,void 0,(function*(){return this.raiseCustomEvent("acs-adapter-leavechat")})),this.handleBeforeunload=()=>{this.raiseCustomEvent("beforeunload")},this.handleError=e=>Object(c.d)(this,void 0,void 0,(function*(){this.raiseCustomEvent("error",e)})),this.handleLoadMoreHistoryMessages=()=>Object(c.d)(this,void 0,void 0,(function*(){this.dispatchEvent(new CustomEvent("acs-adapter-loadnextpage"))})),window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline),window.addEventListener("beforeunload",this.handleBeforeunload),window.addEventListener("acs-adapter-leavechat",this.handleLeaveChat),window.addEventListener("acs-adapter-loadnextpage",this.handleLoadMoreHistoryMessages)}raiseCustomEvent(e,t){const n=t?{detail:{payload:t}}:void 0;let r=null;try{r=new CustomEvent(e,n)}catch(t){r=document.createEvent("CustomEvent"),r.initCustomEvent(e,!0,!0,n)}this.dispatchEvent(r)}end(){window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline),window.removeEventListener("beforeunload",this.handleBeforeunload),window.removeEventListener("acs-adapter-leavechat",this.handleLeaveChat),window.removeEventListener("acs-adapter-loadnextpage",this.handleLoadMoreHistoryMessages)}}var Rr,Cr;Object(br.defineEventAttribute)(Sr.prototype,"online"),Object(br.defineEventAttribute)(Sr.prototype,"offline"),Object(br.defineEventAttribute)(Sr.prototype,"error"),Object(br.defineEventAttribute)(Sr.prototype,"beforeunload"),Object(br.defineEventAttribute)(Sr.prototype,"leavechat"),function(e){e.Message="message",e.Typing="typing"}(Rr||(Rr={})),function(e){e.Bot="bot",e.Channel="channel",e.Unknown="",e.User="user"}(Cr||(Cr={}));const Or="ACS_CHANNEL",Ir=3,Ar=500,Pr="2020-09-21-preview2",_r={},xr=e=>_r[e];function kr(){return({getState:e})=>t=>n=>Object(c.d)(this,void 0,void 0,(function*(){var r,o,i,s,a,u,l,d;if(n.type!==Rr.Message)return t(n);const p=e(S.ChatThreadClient),h=e(S.UserDisplayName),f=e(S.EventManager),g=e(S.FileManager);if(!p){const t="ACS Adapter: Failed to egress message without an active chatThreadClient.";throw j.logEvent(D.ERROR,{Event:pr.ACS_ADAPTER_INGRESS_FAILED,Description:t,ACSUserId:n.from.id,TimeStamp:n.timestamp,ChatThreadId:e(S.ThreadId),ChatMessageId:n.messageid}),new Error(t)}const{text:m,value:y}=n,v=Date.now().toString();n.clientmessageid=v;let b=m||"";const T={},w=null===(o=null===(r=n.channelData)||void 0===r?void 0:r.uploadedFiles)||void 0===o?void 0:o.map(e=>e.fileId),E=w?g.createFileIdProperty(w):void 0,R=null===(s=null===(i=n.channelData)||void 0===i?void 0:i.uploadedFiles)||void 0===s?void 0:s.map(e=>e.metadata),C=R?g.createFileMetadataProperty(R):void 0,O=null===(a=n.channelData)||void 0===a?void 0:a.tags,I=O?{tags:O}:void 0;let A=null===(u=n.channelData)||void 0===u?void 0:u.metadata;if((null===(l=n.channelData)||void 0===l?void 0:l.amsReferences)&&(null===(d=n.channelData)||void 0===d?void 0:d.amsMetadata)){const e=JSON.parse(n.channelData.amsMetadata)[0],t=JSON.parse(n.channelData.amsReferences)[0],r={contentType:e.contentType,name:e.fileName,content:{uniqueId:t}};T.attachments=[r]}y&&(T.value=y),"{}"!==JSON.stringify(T)&&(b=JSON.stringify(T),A=Object.assign({"microsoft.azure.communication.chat.bot.contenttype":"azurebotservice.adaptivecard"}));const P={senderDisplayName:h||void 0};(A||O||w)&&(P.metadata=Object.assign(Object.assign(Object.assign(Object.assign({},A),I),E),C));const _={content:b};try{const t=yield function(e,t,n){return Object(c.d)(this,void 0,void 0,(function*(){let r=0;for(;r<=Ir;)try{return yield n.sendMessage(e,t)}catch(e){if(++r>Ir)throw e;yield new Promise(e=>setTimeout(e,Ar)),j.logEvent(D.WARN,{Event:pr.ACS_ADAPTER_SEND_MESSAGE_RETRY,Description:`Attempting to retry send message request, retry attempt: ${r}}`,ChatThreadId:n.threadId})}}))}(_,P,p);x=t.id,k=n.channelData.clientActivityID,_r[x]=k,j.logEvent(D.DEBUG,{Event:pr.ACS_ADAPTER_SEND_MESSAGE_SUCCESS,Description:"Adapter: Successfully sent a message with messageid "+t.id,ACSUserId:n.from.id,TimeStamp:n.timestamp,ChatThreadId:e(S.ThreadId),ChatMessageId:n.messageid})}catch(t){j.logEvent(D.ERROR,{Event:pr.ACS_ADAPTER_SEND_MESSAGE_FAILED,Description:"Send message failed: "+t,ACSUserId:n.from.id,TimeStamp:n.timestamp,ChatThreadId:e(S.ThreadId),ChatMessageId:n.messageid}),f.handleError(t)}var x,k}))}function Nr(e){return function(...e){return a(e=>e.egress,(e,t)=>Object.assign(Object.assign({},e),{egress:t}))(...e)}(...e&&e.egressMiddleware?e.egressMiddleware:[],function(){return({getState:e})=>t=>n=>Object(c.d)(this,void 0,void 0,(function*(){if(n.type!==Rr.Message||!(n.attachments||[]).length)return t(n);const{attachments:r}=n,o=e(S.FileManager),i=e(S.EventManager);n.channelData=Object.assign(Object.assign({},n.channelData),{uploadedFiles:[]});try{const e=yield o.uploadFiles(r);n.channelData.uploadedFiles=e}catch(t){j.logEvent(D.ERROR,{Event:pr.FILEMANAGER_UPLOAD_FILE_FAILED,Description:"Uploading file failed: "+t,ACSUserId:n.from.id,TimeStamp:n.timestamp,ChatThreadId:e(S.ThreadId)}),i.handleError(t)}t(n)}))}(),kr(),function(){return({getState:e})=>t=>n=>Object(c.d)(this,void 0,void 0,(function*(){if(n.type!==Rr.Typing)return t(n);const r=e(S.ChatThreadClient),o=e(S.AdapterOptions);if(!r){const t="ACS Adapter: Failed to egress typing activity with an undefined chatThreadClient.";throw j.logEvent(D.ERROR,{Event:pr.ACS_ADAPTER_INGRESS_TYPING_FAILED,Description:t,ACSUserId:n.from.id,TimeStamp:n.timestamp,ChatThreadId:e(S.ThreadId)}),new Error(t)}const i=(null==o?void 0:o.enableSenderDisplayNameInTypingNotification)?{senderDisplayName:e(S.UserDisplayName)}:{};yield r.sendTypingNotification(i),j.logEvent(D.DEBUG,{Event:pr.ACS_ADAPTER_INGRESS_TYPING_SUCCESS,Description:"ACS Adapter: Successfully sent a typing indication",ACSUserId:n.from.id,TimeStamp:n.timestamp,ChatThreadId:e(S.ThreadId)})}))}())}const Mr=e=>{const t=(e=>(e=>"string"==typeof e.communicationUserId)(e)?Object.assign(Object.assign({},e),{kind:"communicationUser"}):(e=>"string"==typeof e.phoneNumber)(e)?Object.assign(Object.assign({},e),{kind:"phoneNumber"}):(e=>"string"==typeof e.microsoftTeamsUserId)(e)?Object.assign(Object.assign({},e),{kind:"microsoftTeamsUser"}):Object.assign(Object.assign({},e),{kind:"unknown"}))(e);switch(t.kind){case"communicationUser":return t.communicationUserId;case"microsoftTeamsUser":return t.microsoftTeamsUserId;case"phoneNumber":return t.phoneNumber;case"unknown":return t.id}},Dr=(e,t,n,r)=>Object(c.d)(void 0,void 0,void 0,(function*(){try{let r;return r=t?e.map((e,n)=>({fileId:e,metadata:t[n]})):e.map(e=>({fileId:e})),yield n.downloadFiles(r)}catch(e){j.logEvent(D.ERROR,{Event:pr.FILEMANAGER_DOWNLOAD_FILE_FAILED,Description:"Downloading attachment for message failed: "+e}),r.handleError(e)}})),jr=e=>Object(c.d)(void 0,void 0,void 0,(function*(){return Promise.all(e.map(e=>Object(c.d)(void 0,void 0,void 0,(function*(){if(e){const t=yield(e=>new Promise(t=>{const n=new FileReader;n.onloadend=()=>{t(n.result)},n.readAsDataURL(e)}))(e);return{contentType:e.type,contentUrl:t,name:e.name,thumbnailUrl:e.type.match("(image|video|audio).*")?t:void 0}}}))))})),Ur=e=>e.map(e=>e.size);var Lr;function qr({getState:e}){return()=>t=>Object(c.d)(this,void 0,void 0,(function*(){return((e,t,n)=>{const r={message:e.message,stack:e.stack};return{channelId:Or,conversation:{id:void 0},channelData:{type:Lr.ERROR},from:{id:void 0,name:void 0,role:Cr.Channel},id:t,timestamp:n,type:Rr.Message,messageid:void 0,text:JSON.stringify(r)}})(t,e(S.UserId),(new Date).toISOString())}))}!function(e){e.THREAD="Thread",e.ERROR="Error"}(Lr||(Lr={}));const Br="microsoft.azure.communication.chat.bot.contenttype",zr="azurebotservice.adaptivecard";var Hr;!function(e){e[e.READ=0]="READ",e[e.WRITE=1]="WRITE"}(Hr||(Hr={}));var Fr=n(108),$r=n.n(Fr);function Gr(e,t,n,r,o,i,s,a,u,l,d){return Object(c.d)(this,void 0,void 0,(function*(){const c=Mr(r);let p,h,f,g;if((u?u[""+Br]:void 0)===zr){const e=JSON.parse(t);a&&e.attachments&&(p=[],p=p.concat(e.attachments)),g=e?e.suggestedActions:void 0,f=e?e.text:void 0}else f=t;l&&!p&&(p=yield jr(l),h=Ur(l));return{attachments:p,channelId:Or,channelData:{attachmentSizes:h,fromUserId:c,clientActivityID:xr(e),messageId:e,state:"sent",tags:d,metadata:u},conversation:{id:s},from:{id:c,name:o||void 0,role:c===i?Cr.User:Cr.Bot},id:e||$r()().toString(36).substr(2),text:f,timestamp:new Date(n).toISOString(),type:Rr.Message,messageid:e||"",value:void 0,suggestedActions:g}}))}function Vr({getState:e}){return()=>t=>Object(c.d)(this,void 0,void 0,(function*(){return((e,t)=>({channelId:Or,conversation:{id:void 0},channelData:{type:Lr.THREAD,properties:{deleteTime:e.deletedOn.toISOString(),isDeleted:"True"}},from:{id:void 0,name:void 0,role:Cr.Channel},id:t,timestamp:e.deletedOn.toISOString(),type:Rr.Message,messageid:void 0}))(t,e(S.UserId))}))}function Jr({getState:e}){return()=>t=>Object(c.d)(this,void 0,void 0,(function*(){return((e,t,n)=>({channelId:Or,conversation:{id:void 0},channelData:{type:Lr.THREAD,members:[{id:e.id,displayName:e.displayName,tag:e.tag}]},from:{id:void 0,name:void 0,role:Cr.Channel},id:t,timestamp:n,type:Rr.Message,messageid:void 0,text:JSON.stringify(`${e.displayName} ${e.tag} chat`)}))(t,e(S.UserId),(new Date).toISOString())}))}let Wr=void 0,Yr=void 0,Kr=void 0;function Xr(){return function(...e){return a(e=>e.setState,(e,t)=>Object.assign(Object.assign({},e),{setState:t}))(...e)}(({getState:e,subscribe:t})=>{const n=s(function({getState:e}){return()=>t=>Object(c.d)(this,void 0,void 0,(function*(){var n;const r=e(S.ChatClient),o=e(S.AdapterOptions),i=e(S.FileManager),s=e(S.EventManager),a=e(S.UserId);if(!r){const e="ACS Adapter: Failed to ingress message without an active chatClient.";throw j.logEvent(D.ERROR,{Event:pr.ACS_ADAPTER_INGRESS_FAILED,Description:e,ACSUserId:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id}),new Error(e)}let c,u=void 0;if(t.metadata&&0!==Object.keys(t.metadata).length){u=t.metadata;try{const e=i.getFileIds(t.metadata),n=i.getFileMetadata(t.metadata);e&&(c=yield Dr(e,n,i,s))}catch(e){j.logEvent(D.ERROR,{Event:pr.ACS_ADAPTER_CONVERT_HISTORY,Description:"Failed to parse ChatMessage metadata",ACSUserId:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id}),s.handleError(e)}}return yield Gr(t.id,t.message,t.createdOn,t.sender,t.senderDisplayName,a,t.threadId,null==o?void 0:o.enableAdaptiveCards,u,c,null===(n=t.metadata)||void 0===n?void 0:n.tags)}))}({getState:e}))(e=>{j.logEvent(D.INFO,{Event:pr.ACS_ADAPTER_CONVERT_MESSAGE,Description:"ACS Adapter: convert normal message:"+Object.assign(Object.assign({},e),{content:void 0}),ACSUserId:e.sender.communicationUserId,TimeStamp:e.createdOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})}),r=s(function({getState:e}){return()=>t=>Object(c.d)(this,void 0,void 0,(function*(){var n,r;const o=e(S.ChatClient),i=e(S.AdapterOptions),s=e(S.FileManager),a=e(S.EventManager),c=e(S.ThreadId),u=e(S.UserId);if(!o){const e="ACS Adapter: Failed to ingress history message without an active chatClient.";throw j.logEvent(D.ERROR,{Event:pr.ACS_ADAPTER_INGRESS_FAILED,Description:e,ACSUserId:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatMessageId:t.id}),new Error(e)}let l;try{const e=s.getFileIds(t.metadata),n=s.getFileMetadata(t.metadata);e&&(l=yield Dr(e,n,s,a))}catch(e){j.logEvent(D.ERROR,{Event:pr.ACS_ADAPTER_CONVERT_HISTORY,Description:"Failed to parse ChatMessage metadata",ACSUserId:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatMessageId:t.id}),a.handleError(e)}return yield Gr(t.id,null===(n=t.content)||void 0===n?void 0:n.message,t.createdOn,t.sender,t.senderDisplayName,u,c,null==i?void 0:i.enableAdaptiveCards,t.metadata,l,null===(r=t.metadata)||void 0===r?void 0:r.tags)}))}({getState:e}))(e=>{j.logEvent(D.INFO,{Event:pr.ACS_ADAPTER_CONVERT_HISTORY,Description:"ACS Adapter: convert history message:"+Object.assign(Object.assign({},e),{content:void 0}),ACSUserId:e.sender.communicationUserId,TimeStamp:e.createdOn.toISOString(),ChatMessageId:e.id})}),o=s(function({getState:e}){return()=>t=>Object(c.d)(this,void 0,void 0,(function*(){var n,r;const o=e(S.ChatClient),i=e(S.FileManager),s=e(S.EventManager);if(!o){const e="ACS Adapter: Failed to ingress edited message without an active chatClient.";throw j.logEvent(D.ERROR,{Event:pr.ACS_ADAPTER_INGRESS_FAILED,Description:e,ACSUserId:t.sender.communicationUserId,TimeStamp:t.editedOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id}),new Error(e)}const a=Mr(t.sender),c={channelId:Or,conversation:{id:e(S.UserId)},from:{id:a,name:t.senderDisplayName,role:a===e(S.UserId)?Cr.User:Cr.Bot},messageid:t.id,text:t.message,timestamp:t.editedOn.toISOString(),type:Rr.Message};if(t.metadata&&0!==Object.keys(t.metadata).length){let e,o,a;try{const n=i.getFileIds(t.metadata),r=i.getFileMetadata(t.metadata);n&&(e=yield Dr(n,r,i,s),o=yield jr(e),a=Ur(e))}catch(e){j.logEvent(D.ERROR,{Event:pr.ACS_ADAPTER_CONVERT_HISTORY,Description:"Failed to parse ChatMessage metadata",ACSUserId:t.sender.communicationUserId,TimeStamp:t.editedOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id}),s.handleError(e)}c.channelData={},c.channelData.metadata=t.metadata,o&&(c.attachments=o,c.channelData.attachmentSizes=a),(null===(n=t.metadata)||void 0===n?void 0:n.tags)&&(c.channelData.tags=null===(r=t.metadata)||void 0===r?void 0:r.tags)}return c}))}({getState:e}))(e=>{j.logEvent(D.INFO,{Event:pr.ACS_ADAPTER_CONVERT_EDITED_MESSAGE,Description:"ACS Adapter: convert edited message:"+Object.assign(Object.assign({},e),{content:void 0}),ACSUserId:e.sender.communicationUserId,TimeStamp:e.editedOn.toISOString(),ChatThreadId:e.threadId,ChatMessageId:e.id})}),i=s(qr({getState:e}))(e=>{console.log("error message:"+e)}),a=s(function({getState:e}){return()=>t=>Object(c.d)(this,void 0,void 0,(function*(){if(!e(S.ChatClient)){const e="ACS Adapter: Failed to ingress typing message without an active chatClient.";throw j.logEvent(D.ERROR,{Event:pr.ACS_ADAPTER_INGRESS_FAILED,Description:e,ACSUserId:t.sender.communicationUserId,TimeStamp:t.receivedOn.toISOString(),ChatThreadId:t.threadId}),new Error(e)}const{receivedOn:n,sender:r}=t,o=Mr(r);return{channelId:Or,conversation:{id:e(S.UserId)},from:{id:o,name:t.senderDisplayName,role:o===e(S.UserId)?Cr.User:Cr.Bot},timestamp:new Date(n).toISOString(),type:Rr.Typing}}))}({getState:e}))(e=>{j.logEvent(D.INFO,{Event:pr.ACS_ADAPTER_CONVERT_TYPING_MESSAGE,Description:"convert typing message:"+e,ACSUserId:e.sender.communicationUserId,TimeStamp:e.receivedOn.toISOString(),ChatThreadId:e.threadId})}),u=s(Jr({getState:e}))(e=>{console.log("thread update:"+e),j.logEvent(D.INFO,{Event:pr.ACS_ADAPTER_CONVERT_THREAD_UPDATED,Description:"convert thread update:"+e,ACSUserId:e.sender.communicationUserId,TimeStamp:e.updatedOn.toISOString(),ChatThreadId:e.threadId})}),l=s(Vr({getState:e}))(e=>{console.log("thread delete:"+e),j.logEvent(D.INFO,{Event:pr.ACS_ADAPTER_CONVERT_THREAD_DELETED,Description:"convert thread delete:"+e,ACSUserId:e.sender.communicationUserId,TimeStamp:e.deletedOn.toISOString(),ChatThreadId:e.threadId})}),d=(e,t,n)=>Object(c.d)(this,void 0,void 0,(function*(){const r=yield i(n);!e&&t(r)})),p=(e,{unsubscribed:t},n,o,i)=>Object(c.d)(this,void 0,void 0,(function*(){if(void 0===i){const i=e.listMessages({startTime:o});let s=yield i.next();for(;!s.done;){const e=s.value;if("text"!==e.type){s=yield i.next();continue}s=yield i.next();const o=yield r(e);!t&&n(o)}}else{let s=Yr;void 0===s&&(s=e.listMessages({maxPageSize:i,startTime:o}).byPage());let a=0;for(;a<i;){const e=Wr,o=Kr;let c=!1;if(e&&!c){for(let i=o>=0?o:0;i<e.value.length;i++){const o=e.value[i];if("text"!==o.type)continue;const s=yield r(o);!t&&n(s),a++}c=!0}const u=yield s.next();if(u.done)break;for(let e=0;e<u.value.length;e++){if(a>=i){Yr=s,Kr=e,Wr=u;break}const o=u.value[e];if("text"!==o.type)continue;const c=yield r(o);!t&&n(c),a++}}}})),h=(t,{unsubscribed:n},r,o)=>Object(c.d)(this,void 0,void 0,(function*(){const i=e(S.EventManager);null==i||i.addEventListener("acs-adapter-loadnextpage",()=>{p(t,{unsubscribed:n},r,void 0,o)})})),f=({unsubscribed:t},n)=>Object(c.d)(this,void 0,void 0,(function*(){const r=e(S.EventManager);null==r||r.addEventListener("error",e=>{d(t,n,e.detail.payload)})})),g=(t,{unsubscribed:n},r)=>Object(c.d)(this,void 0,void 0,(function*(){const o=e(S.EventManager);null==o||o.addEventListener("online",()=>{const o=e(S.DisconnectUTC);o&&p(t,{unsubscribed:n},r,o)})})),m=({unsubscribed:t},n)=>Object(c.d)(this,void 0,void 0,(function*(){const r=e(S.EventManager);null==r||r.addEventListener("acs-adapter-leavechat",()=>{const r=e(S.UserId);!t&&n.removeParticipant({communicationUserId:r})})}));return i=>(s,d)=>Object(c.d)(this,void 0,void 0,(function*(){return(s===S.ChatThreadClient&&d||s===S.Reconnect&&d)&&t(new O.a(t=>{const i=e(S.ChatClient),s=e(S.AdapterOptions),y=t.next.bind(t);let v=!1;const b=(e,t,n,o)=>Object(c.d)(this,void 0,void 0,(function*(){if(v)return;const i=t.listMessages({startTime:n});let s=yield i.next();for(;!s.done;){const e=s.value;if("text"===e.type&&e.sequenceId!==o){const t=yield r(e);t.channelData.fromList=!0,y(t)}(!n||e.sequenceId>o)&&(n=e.createdOn,o=e.sequenceId),s=yield i.next()}setTimeout(()=>{b(e,t,n,o)},e)})),T=t=>Object(c.d)(this,void 0,void 0,(function*(){if(v=!0,t.threadId===e(S.ThreadId)){j.logEvent(D.DEBUG,{Event:pr.MESSAGE_RECEIVED,Description:"ACS Adapter: Received a message with id "+t.id,ACSUserId:t.sender.communicationUserId,TimeStamp:t.createdOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id});const e=yield n(t);y(e)}})),w=t=>Object(c.d)(this,void 0,void 0,(function*(){if(Mr(t.sender)!==e(S.UserId)&&t.threadId===e(S.ThreadId)){j.logEvent(D.DEBUG,{Event:pr.TYPING_MESSAGE_RECEIVED,Description:"ACS Adapter: Received a typing message",ACSUserId:t.sender.communicationUserId,TimeStamp:t.receivedOn.toISOString(),ChatThreadId:t.threadId});const e=yield a(t);y(e)}})),E=t=>Object(c.d)(this,void 0,void 0,(function*(){if(t.threadId===e(S.ThreadId)){j.logEvent(D.DEBUG,{Event:pr.MESSAGE_EDIT_RECEIVED,Description:"ACS Adapter: Received a message edit event with id "+t.id,ACSUserId:t.sender.communicationUserId,TimeStamp:t.editedOn.toISOString(),ChatThreadId:t.threadId,ChatMessageId:t.id});const e=yield o(t);y(e)}})),R=t=>Object(c.d)(this,void 0,void 0,(function*(){t.threadId===e(S.ThreadId)&&(j.logEvent(D.DEBUG,{Event:pr.PARTICIPANT_ADDED_RECEIVED,Description:"ACS Adapter: Received a participant added event",ACSUserId:t.addedBy.id.communicationUserId,TimeStamp:t.addedOn.toISOString(),ChatThreadId:t.threadId}),t.participantsAdded.forEach(e=>Object(c.d)(this,void 0,void 0,(function*(){const t=Mr(e.id),n={displayName:e.displayName,tag:"joined",id:t},r=yield u(n);y(r)}))))})),C=t=>Object(c.d)(this,void 0,void 0,(function*(){t.threadId===e(S.ThreadId)&&(j.logEvent(D.DEBUG,{Event:pr.PARTICIPANT_REMOVED_RECEIVED,Description:"ACS Adapter: Received a participant removed event",ACSUserId:t.removedBy.id.communicationUserId,TimeStamp:t.removedOn.toISOString(),ChatThreadId:t.threadId}),t.participantsRemoved.forEach(e=>Object(c.d)(this,void 0,void 0,(function*(){const t=Mr(e.id),n={displayName:e.displayName,tag:"left",id:t},r=yield u(n);y(r)}))))})),O=t=>Object(c.d)(this,void 0,void 0,(function*(){if(t.threadId===e(S.ThreadId)){j.logEvent(D.DEBUG,{Event:pr.THREAD_DELETED_RECEIVED,Description:"ACS Adapter: Received a thread deleted event",ACSUserId:t.deletedBy.id.communicationUserId,TimeStamp:t.deletedOn.toISOString(),ChatThreadId:t.threadId});const e=yield l(t);y(e)}}));i.on("chatMessageReceived",T),j.logEvent(D.DEBUG,{Event:pr.REGISTER_ON_NEW_MESSAGE,Description:"ACS Adapter: Registering on new message success"}),i.on("typingIndicatorReceived",w),j.logEvent(D.DEBUG,{Event:pr.REGISTER_ON_TYPING_INDICATOR,Description:"ACS Adapter: Registering on typing indicator success"}),i.on("chatMessageEdited",E),j.logEvent(D.DEBUG,{Event:pr.REGISTER_ON_MESSAGE_EDIT,Description:"ACS Adapter: Registering on message edit success"}),i.on("chatThreadDeleted",O),j.logEvent(D.DEBUG,{Event:pr.REGISTER_ON_THREAD_DELETED,Description:"ACS Adapter: Registering on thread delete success"});const I={unsubscribed:!1},A=!0===d?e(S.ChatThreadClient):d;return(null==s?void 0:s.enableThreadMemberUpdateNotification)&&(i.on("participantsAdded",R),j.logEvent(D.DEBUG,{Event:pr.REGISTER_ON_PARTICIPANT_ADDED,Description:"ACS Adapter: Registering on participant added success"}),i.on("participantsRemoved",C),j.logEvent(D.DEBUG,{Event:pr.REGISTER_ON_PARTICIPANT_REMOVED,Description:"ACS Adapter: Registering on participant removed success"})),(null==s?void 0:s.enableLeaveThreadOnWindowClosed)&&e(S.EventManager).addEventListener("beforeunload",()=>{const t=e(S.Token),n=e(S.EnvironmentUrl),r=e(S.ThreadId),o=e(S.UserId);fetch(`${n}/chat/threads/${r}/members/${o}?api-version=${Pr}`,{keepalive:!0,method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer "+t}})}),f(I,y),m(I,A),g(A,I,y),p(d,I,y,void 0,s&&s.historyPageSizeLimit),h(d,I,y,s&&s.historyPageSizeLimit),b(e(S.PollingInterval),A),()=>{I.unsubscribed=!0,i.off("chatMessageReceived",T),i.off("typingIndicatorReceived",w),i.off("chatMessageEdited",E),i.off("participantsAdded",R),i.off("participantsRemoved",C),i.off("chatThreadDeleted",O)}})),i(s,d)}))})}function Qr(e){return s(function(...e){return a(e=>e.ingress,(e,t)=>Object.assign(Object.assign({},e),{ingress:t}))(...e)}(...e&&e.ingressMiddleware?e.ingressMiddleware:[]),Xr())}function Zr(e,t,n,o,i,a,u,l,d,p){return s(s=>h=>{j.setInstance(d);const f=s(h),g=new Sr;return f.setState(S.BotId,void 0),f.setState(S.ChatClient,void 0),f.setState(S.UserId,void 0),f.setState(S.AuthConfig,void 0),f.setState(S.ChatThreadClient,void 0),f.setState(S.UserDisplayName,void 0),f.setState(S.ConnectionStatusObserverReady,!1),f.setState(S.DisconnectUTC,void 0),f.setState(S.EventManager,g),f.setState(S.AdapterOptions,p),f.setState(S.EnvironmentUrl,void 0),f.setState(S.ThreadId,void 0),f.setState(S.Token,void 0),f.setState(S.Reconnect,!1),f.setState(S.FileManager,void 0),f.setState(S.PollingInterval,a),function(){Object(c.d)(this,void 0,void 0,(function*(){yield((e,t,n,r,o,i)=>Object(c.d)(void 0,void 0,void 0,(function*(){gr.id=t,gr.environmentUrl=r,gr.token=e,yr.displayName=null!=o?o:"",j.logEvent(D.INFO,{Event:pr.ACS_SDK_START_INIT,ChatThreadId:n,ACSUserId:t,Description:"ACS Adapter: ACS Adapter start init."});const s=new fr(gr.token);vr.chatClient=null!=i?i:new or(gr.environmentUrl,s),vr.chatClient||j.logEvent(D.ERROR,{Event:pr.ACS_SDK_CHATCLIENT_ERROR,Description:"ACS Adapter: ACS ChatClient failed to init."}),vr.chatThreadClient=vr.chatClient.getChatThreadClient(n),mr.thread=yield vr.chatThreadClient.getProperties(),mr.threadId=n,vr.chatThreadClient||j.logEvent(D.ERROR,{Event:pr.ACS_SDK_JOINTHREAD_ERROR,Description:"ACS Adapter: failed to join the thread."}),yield vr.chatClient.startRealtimeNotifications()})))(e,t,n,o,u,l),f.setState(S.ThreadId,n),f.setState(S.ChatClient,vr.chatClient),f.setState(S.ChatThreadClient,vr.chatThreadClient),f.setState(S.UserId,gr.id),f.setState(S.UserDisplayName,u),f.setState(S.AuthConfig,gr),f.setState(S.EnvironmentUrl,o),f.setState(S.Token,e),f.setState(S.FileManager,i),f.setReadyState(r.OPEN),g.addEventListener("online",()=>{f.setReadyState(r.OPEN),j.logEvent(D.INFO,{Event:pr.ACS_SDK_RECONNECT,Description:"ACS Adapter: Reconnect to network."})}),g.addEventListener("offline",()=>{f.setReadyState(r.CONNECTING),f.setState(S.DisconnectUTC,new Date)})}))}(),f},Qr(p),Nr(p))}class eo{constructor(e,t,n){this.accessToken=e,this.downloadUrl=t,this.uploadUrl=n}downloadBlob(e){return Object(c.d)(this,void 0,void 0,(function*(){const t=yield fetch(e);if(!t.ok)throw new Error("Failed to fetch file contents.");return yield t.blob()}))}downloadDriveItem(e){var t;return Object(c.d)(this,void 0,void 0,(function*(){const n=this.downloadUrl(e),r={method:"GET",headers:{Authorization:"Bearer "+this.accessToken,"Content-Type":"application/json"}},o=yield fetch(n,r),i=yield o.json();if(!o.ok)throw new Error("Failed to download drive item from OneDrive: "+(null===(t=i.error)||void 0===t?void 0:t.message));return i}))}downloadDriveItemContents(e){var t;return Object(c.d)(this,void 0,void 0,(function*(){const n=yield fetch(e);if(!n.ok){const e=yield n.json();throw new Error("Failed to download drive item contents from OneDrive: "+(null===(t=e.error)||void 0===t?void 0:t.message))}return yield n.blob()}))}uploadFiles(e){return Object(c.d)(this,void 0,void 0,(function*(){return Promise.all(e.map(e=>Object(c.d)(this,void 0,void 0,(function*(){const t=yield this.downloadBlob(e.contentUrl),n=this.uploadUrl(e.name),r={method:"PUT",headers:{Authorization:"Bearer "+this.accessToken,"Content-Type":e.contentType},body:t},o=yield fetch(n,r),i=yield o.json();if(i.error)throw new Error("Failed to upload file to OneDrive. "+i.error.message);return{fileId:i.id,metadata:{filename:e.name}}}))))}))}downloadFiles(e){return Object(c.d)(this,void 0,void 0,(function*(){return Promise.all(e.map(e=>Object(c.d)(this,void 0,void 0,(function*(){var t,n;const r=yield this.downloadDriveItem(e.fileId),o=r["@microsoft.graph.downloadUrl"],i=yield this.downloadDriveItemContents(o);return e.metadata&&console.log("File name: "+(null===(t=e.metadata)||void 0===t?void 0:t.name)),new File([i],r.name,{type:null===(n=r.file)||void 0===n?void 0:n.mimeType,lastModified:r.lastModifiedDateTime})}))))}))}updatePermissions(){return Object(c.d)(this,void 0,void 0,(function*(){throw new Error("Method not implemented.")}))}getFileIds(e){if(null==e?void 0:e.onedriveReferences)try{return JSON.parse(null==e?void 0:e.onedriveReferences)}catch(e){throw new Error("Failed to parse onedriveReferences in ChatMessage metadata.")}}createFileIdProperty(e){return{onedriveReferences:JSON.stringify(e)}}getFileMetadata(e){if(null==e?void 0:e.onedriveMetadata)try{return JSON.parse(null==e?void 0:e.onedriveMetadata)}catch(e){throw new Error("Failed to parse onedriveMetadata in ChatMessage metadata.")}}createFileMetadataProperty(e){return{onedriveMetadata:JSON.stringify(e)}}}const to=(e,t,n,o,i,a=3e3,u,l,d,p)=>(a=a>=3e3?a:3e3,x({},s(function(){return e=>t=>{const n=e(t);let o;n.addEventListener("open",()=>Object(c.d)(this,void 0,void 0,(function*(){if(o)o.next(R.Connected);else{let e=5;for(;!o&&e<2e3;)yield _(e),e*=2;o.next(R.Connected)}}))),n.addEventListener("error",()=>{o.next(n.getReadyState()===r.CLOSED?R.FailedToConnect:R.Connecting)});let i=!0;return Object.assign(Object.assign({},n),{activity$:P(new O.a(e=>{const t=new A.a;return function(){var r,o;Object(c.d)(this,void 0,void 0,(function*(){try{try{for(var i,s=Object(c.b)(n.activities({signal:t.signal}));!(i=yield s.next()).done;){const t=i.value;e.next(t)}}catch(e){r={error:e}}finally{try{i&&!i.done&&(o=s.return)&&(yield o.call(s))}finally{if(r)throw r.error}}e.complete()}catch(t){e.error(t)}}))}(),i?i=!1:(n.setReadyState(r.CONNECTING),n.setReadyState(r.OPEN),n.setState(S.Reconnect,!0)),()=>{t.abort()}})),connectionStatus$:P(new O.a(e=>(e.next(R.Uninitialized),e.next(R.Connecting),o=e,()=>{o=void 0}))),end:()=>{n.close()},postActivity:e=>new O.a(t=>{!function(){Object(c.d)(this,void 0,void 0,(function*(){yield n.egress(e,{progress:({id:e})=>e&&t.next(e)}),t.complete()}))}()})})}}(),Zr(e,t,n,o,i,a,u,l,d,p))))},function(e,t,n){"use strict";function r(e){return e.toLowerCase()}function o(e){if(e&&"object"==typeof e){const t=e;if("function"==typeof t.rawHeaders&&"function"==typeof t.clone&&"function"==typeof t.get&&"function"==typeof t.set&&"function"==typeof t.contains&&"function"==typeof t.remove&&"function"==typeof t.headersArray&&"function"==typeof t.headerValues&&"function"==typeof t.headerNames&&"function"==typeof t.toJson)return!0}return!1}n.r(t),n.d(t,"WebResource",(function(){return w})),n.d(t,"DefaultHttpClient",(function(){return q})),n.d(t,"HttpHeaders",(function(){return i})),n.d(t,"HttpPipelineLogLevel",(function(){return F})),n.d(t,"RestError",(function(){return L})),n.d(t,"operationOptionsToRequestOptionsBase",(function(){return $})),n.d(t,"ServiceClient",(function(){return dt})),n.d(t,"flattenResponse",(function(){return mt})),n.d(t,"createPipelineFromOptions",(function(){return ht})),n.d(t,"QueryCollectionFormat",(function(){return He})),n.d(t,"Constants",(function(){return ye.a})),n.d(t,"bearerTokenAuthenticationPolicy",(function(){return qe})),n.d(t,"logPolicy",(function(){return K})),n.d(t,"BaseRequestPolicy",(function(){return V})),n.d(t,"RequestPolicyOptions",(function(){return J})),n.d(t,"generateClientRequestIdPolicy",(function(){return Re})),n.d(t,"exponentialRetryPolicy",(function(){return be})),n.d(t,"RetryMode",(function(){return Te})),n.d(t,"systemErrorRetryPolicy",(function(){return Be})),n.d(t,"throttlingRetryPolicy",(function(){return Je})),n.d(t,"getDefaultProxySettings",(function(){return $e})),n.d(t,"proxyPolicy",(function(){return Ge})),n.d(t,"redirectPolicy",(function(){return Ne})),n.d(t,"keepAlivePolicy",(function(){return Qe})),n.d(t,"disableResponseDecompressionPolicy",(function(){return at})),n.d(t,"signingPolicy",(function(){return Ye})),n.d(t,"userAgentPolicy",(function(){return Pe})),n.d(t,"getDefaultUserAgentValue",(function(){return Ae})),n.d(t,"deserializationPolicy",(function(){return ce})),n.d(t,"deserializeResponseBody",(function(){return he})),n.d(t,"tracingPolicy",(function(){return ot})),n.d(t,"MapperType",(function(){return T})),n.d(t,"Serializer",(function(){return l})),n.d(t,"serializeObject",(function(){return b})),n.d(t,"stripRequest",(function(){return c.n})),n.d(t,"stripResponse",(function(){return c.o})),n.d(t,"executePromisesSequentially",(function(){return c.c})),n.d(t,"generateUuid",(function(){return c.d})),n.d(t,"encodeUri",(function(){return c.b})),n.d(t,"promiseToCallback",(function(){return c.k})),n.d(t,"promiseToServiceCallback",(function(){return c.l})),n.d(t,"isValidUuid",(function(){return c.i})),n.d(t,"applyMixins",(function(){return c.a})),n.d(t,"isNode",(function(){return c.f})),n.d(t,"isDuration",(function(){return c.e})),n.d(t,"URLBuilder",(function(){return C})),n.d(t,"URLQuery",(function(){return R})),n.d(t,"delay",(function(){return ve})),n.d(t,"createSpanFunction",(function(){return yt})),n.d(t,"isTokenCredential",(function(){return G})),n.d(t,"ExpiringAccessTokenCache",(function(){return vt})),n.d(t,"AccessTokenRefresher",(function(){return bt})),n.d(t,"BasicAuthenticationCredentials",(function(){return wt})),n.d(t,"ApiKeyCredentials",(function(){return Et})),n.d(t,"TopicCredentials",(function(){return St})),n.d(t,"parseXML",(function(){return ne})),n.d(t,"stringifyXML",(function(){return se})),n.d(t,"XML_ATTRKEY",(function(){return u.a})),n.d(t,"XML_CHARKEY",(function(){return u.b}));class i{constructor(e){if(this._headersMap={},e)for(const t in e)this.set(t,e[t])}set(e,t){this._headersMap[r(e)]={name:e,value:t.toString()}}get(e){const t=this._headersMap[r(e)];return t?t.value:void 0}contains(e){return!!this._headersMap[r(e)]}remove(e){const t=this.contains(e);return delete this._headersMap[r(e)],t}rawHeaders(){const e={};for(const t in this._headersMap){const n=this._headersMap[t];e[n.name.toLowerCase()]=n.value}return e}headersArray(){const e=[];for(const t in this._headersMap)e.push(this._headersMap[t]);return e}headerNames(){const e=[],t=this.headersArray();for(let n=0;n<t.length;++n)e.push(t[n].name);return e}headerValues(){const e=[],t=this.headersArray();for(let n=0;n<t.length;++n)e.push(t[n].value);return e}toJson(){return this.rawHeaders()}toString(){return JSON.stringify(this.toJson())}clone(){return new i(this.rawHeaders())}}function s(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function a(e){const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}var c=n(1),u=n(2);class l{constructor(e={},t){this.modelMappers=e,this.isXML=t}validateConstraints(e,t,n){const r=(e,r)=>{throw new Error(`"${n}" with value "${t}" should satisfy the constraint "${e}": ${r}.`)};if(e.constraints&&null!=t){const n=t,{ExclusiveMaximum:o,ExclusiveMinimum:i,InclusiveMaximum:s,InclusiveMinimum:a,MaxItems:c,MaxLength:u,MinItems:l,MinLength:d,MultipleOf:p,Pattern:h,UniqueItems:f}=e.constraints;null!=o&&n>=o&&r("ExclusiveMaximum",o),null!=i&&n<=i&&r("ExclusiveMinimum",i),null!=s&&n>s&&r("InclusiveMaximum",s),null!=a&&n<a&&r("InclusiveMinimum",a);const g=t;if(null!=c&&g.length>c&&r("MaxItems",c),null!=u&&g.length>u&&r("MaxLength",u),null!=l&&g.length<l&&r("MinItems",l),null!=d&&g.length<d&&r("MinLength",d),null!=p&&n%p!=0&&r("MultipleOf",p),h){const e="string"==typeof h?new RegExp(h):h;"string"==typeof t&&null!==t.match(e)||r("Pattern",h)}f&&g.some((e,t,n)=>n.indexOf(e)!==t)&&r("UniqueItems",f)}}serialize(e,t,n,r={}){var o,i,a;const l={rootName:null!==(o=r.rootName)&&void 0!==o?o:"",includeRoot:null!==(i=r.includeRoot)&&void 0!==i&&i,xmlCharKey:null!==(a=r.xmlCharKey)&&void 0!==a?a:u.b};let g={};const v=e.type.name;n||(n=e.serializedName),null!==v.match(/^Sequence$/i)&&(g=[]),e.isConstant&&(t=e.defaultValue);const{required:b,nullable:T}=e;if(b&&T&&void 0===t)throw new Error(n+" cannot be undefined.");if(b&&!T&&null==t)throw new Error(n+" cannot be null or undefined.");if(!b&&!1===T&&null===t)throw new Error(n+" cannot be null.");if(null==t)g=t;else if(this.validateConstraints(e,t,n),null!==v.match(/^any$/i))g=t;else if(null!==v.match(/^(Number|String|Boolean|Object|Stream|Uuid)$/i))g=function(e,t,n){if(null!=n)if(null!==e.match(/^Number$/i)){if("number"!=typeof n)throw new Error(`${t} with value ${n} must be of type number.`)}else if(null!==e.match(/^String$/i)){if("string"!=typeof n.valueOf())throw new Error(`${t} with value "${n}" must be of type string.`)}else if(null!==e.match(/^Uuid$/i)){if("string"!=typeof n.valueOf()||!c.i(n))throw new Error(`${t} with value "${n}" must be of type string and a valid uuid.`)}else if(null!==e.match(/^Boolean$/i)){if("boolean"!=typeof n)throw new Error(`${t} with value ${n} must be of type boolean.`)}else if(null!==e.match(/^Stream$/i)){const e=typeof n;if(!("string"===e||"function"===e||n instanceof ArrayBuffer||ArrayBuffer.isView(n)||("function"==typeof Blob||"object"==typeof Blob)&&n instanceof Blob))throw new Error(t+" must be a string, Blob, ArrayBuffer, ArrayBufferView, or a function returning NodeJS.ReadableStream.")}return n}(v,n,t);else if(null!==v.match(/^Enum$/i)){g=function(e,t,n){if(!t)throw new Error(`Please provide a set of allowedValues to validate ${e} as an Enum Type.`);if(!t.some(e=>"string"==typeof e.valueOf()?e.toLowerCase()===n.toLowerCase():e===n))throw new Error(`${n} is not a valid value for ${e}. The valid values are: ${JSON.stringify(t)}.`);return n}(n,e.type.allowedValues,t)}else null!==v.match(/^(Date|DateTime|TimeSpan|DateTimeRfc1123|UnixTime)$/i)?g=function(e,t,n){if(null!=t)if(null!==e.match(/^Date$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(n+" must be an instanceof Date or a string in ISO8601 format.");t=t instanceof Date?t.toISOString().substring(0,10):new Date(t).toISOString().substring(0,10)}else if(null!==e.match(/^DateTime$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(n+" must be an instanceof Date or a string in ISO8601 format.");t=t instanceof Date?t.toISOString():new Date(t).toISOString()}else if(null!==e.match(/^DateTimeRfc1123$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(n+" must be an instanceof Date or a string in RFC-1123 format.");t=t instanceof Date?t.toUTCString():new Date(t).toUTCString()}else if(null!==e.match(/^UnixTime$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(n+" must be an instanceof Date or a string in RFC-1123/ISO8601 format for it to be serialized in UnixTime/Epoch format.");t=function(e){if(!e)return;"string"==typeof e.valueOf()&&(e=new Date(e));return Math.floor(e.getTime()/1e3)}(t)}else if(null!==e.match(/^TimeSpan$/i)&&!c.e(t))throw new Error(`${n} must be a string in ISO 8601 format. Instead was "${t}".`);return t}(v,t,n):null!==v.match(/^ByteArray$/i)?g=function(e,t){let n="";if(null!=t){if(!(t instanceof Uint8Array))throw new Error(e+" must be of type Uint8Array.");n=s(t)}return n}(n,t):null!==v.match(/^Base64Url$/i)?g=function(e,t){let n="";if(null!=t){if(!(t instanceof Uint8Array))throw new Error(e+" must be of type Uint8Array.");n=function(e){if(!e)return;if(!(e instanceof Uint8Array))throw new Error("Please provide an input of type Uint8Array for converting to Base64Url.");return function(e,t){let n=e.length;for(;n-1>=0&&e[n-1]===t;)--n;return e.substr(0,n)}(s(e),"=").replace(/\+/g,"-").replace(/\//g,"_")}(t)||""}return n}(n,t):null!==v.match(/^Sequence$/i)?g=function(e,t,n,r,o,i){if(!Array.isArray(n))throw new Error(r+" must be of type Array.");const s=t.type.element;if(!s||"object"!=typeof s)throw new Error(`element" metadata for an Array must be defined in the mapper and it must of type "object" in ${r}.`);const a=[];for(let t=0;t<n.length;t++){const c=e.serialize(s,n[t],r,i);if(o&&s.xmlNamespace){const e=s.xmlNamespacePrefix?"xmlns:"+s.xmlNamespacePrefix:"xmlns";"Composite"===s.type.name?(a[t]=Object.assign({},c),a[t][u.a]={[e]:s.xmlNamespace}):(a[t]={},a[t][i.xmlCharKey]=c,a[t][u.a]={[e]:s.xmlNamespace})}else a[t]=c}return a}(this,e,t,n,Boolean(this.isXML),l):null!==v.match(/^Dictionary$/i)?g=function(e,t,n,r,o,i){if("object"!=typeof n)throw new Error(r+" must be of type object.");const s=t.type.value;if(!s||"object"!=typeof s)throw new Error(`"value" metadata for a Dictionary must be defined in the mapper and it must of type "object" in ${r}.`);const a={};for(const t of Object.keys(n)){const c=e.serialize(s,n[t],r,i);a[t]=f(s,c,o,i)}if(o&&t.xmlNamespace){const e=t.xmlNamespacePrefix?"xmlns:"+t.xmlNamespacePrefix:"xmlns",n=a;return n[u.a]={[e]:t.xmlNamespace},n}return a}(this,e,t,n,Boolean(this.isXML),l):null!==v.match(/^Composite$/i)&&(g=function(e,t,n,r,o,i){y(e,t)&&(t=m(e,t,n,"clientName"));if(null!=n){const s={},a=h(e,t,r);for(const c of Object.keys(a)){const l=a[c];if(l.readOnly)continue;let p,h=s;if(e.isXML)p=l.xmlIsWrapped?l.xmlName:l.xmlElementName||l.xmlName;else{const e=d(l.serializedName);p=e.pop();for(const t of e){null!=h[t]||null==n[c]&&void 0===l.defaultValue||(h[t]={}),h=h[t]}}if(null!=h){if(o&&t.xmlNamespace){const e=t.xmlNamespacePrefix?"xmlns:"+t.xmlNamespacePrefix:"xmlns";h[u.a]=Object.assign(Object.assign({},h[u.a]),{[e]:t.xmlNamespace})}const s=""!==l.serializedName?r+"."+l.serializedName:r;let a=n[c];const d=y(e,t);d&&d.clientName===c&&null==a&&(a=t.serializedName);const g=e.serialize(l,a,s,i);if(void 0!==g&&null!=p){const e=f(l,g,o,i);o&&l.xmlIsAttribute?(h[u.a]=h[u.a]||{},h[u.a][p]=g):o&&l.xmlIsWrapped?h[p]={[l.xmlElementName]:e}:h[p]=e}}}const c=function(e,t,n){const r=t.type.additionalProperties;if(!r&&t.type.className){const r=p(e,t,n);return null==r?void 0:r.type.additionalProperties}return r}(e,t,r);if(c){const t=Object.keys(a);for(const o in n){t.every(e=>e!==o)&&(s[o]=e.serialize(c,n[o],r+'["'+o+'"]',i))}}return s}return n}(this,e,t,n,Boolean(this.isXML),l));return g}deserialize(e,t,n,r={}){var o,i,s;const c={rootName:null!==(o=r.rootName)&&void 0!==o?o:"",includeRoot:null!==(i=r.includeRoot)&&void 0!==i&&i,xmlCharKey:null!==(s=r.xmlCharKey)&&void 0!==s?s:u.b};if(null==t)return this.isXML&&"Sequence"===e.type.name&&!e.xmlIsWrapped&&(t=[]),void 0!==e.defaultValue&&(t=e.defaultValue),t;let l;const p=e.type.name;if(n||(n=e.serializedName),null!==p.match(/^Composite$/i))l=function(e,t,n,r,o){var i;y(e,t)&&(t=m(e,t,n,"serializedName"));const s=h(e,t,r);let a={};const c=[];for(const l of Object.keys(s)){const p=s[l],h=d(s[l].serializedName);c.push(h[0]);const{serializedName:f,xmlName:g,xmlElementName:m}=p;let y=r;""!==f&&void 0!==f&&(y=r+"."+f);const v=p.headerCollectionPrefix;if(v){const t={};for(const r of Object.keys(n))r.startsWith(v)&&(t[r.substring(v.length)]=e.deserialize(p.type.value,n[r],y,o)),c.push(r);a[l]=t}else if(e.isXML)if(p.xmlIsAttribute&&n[u.a])a[l]=e.deserialize(p,n[u.a][g],y,o);else{const t=m||g||f;if(p.xmlIsWrapped){const t=n[g],r=null!==(i=null==t?void 0:t[m])&&void 0!==i?i:[];a[l]=e.deserialize(p,r,y,o)}else{const r=n[t];a[l]=e.deserialize(p,r,y,o)}}else{let r,i=n;for(const e of h){if(!i)break;i=i[e]}r=i;const c=t.type.polymorphicDiscriminator;let u;if(c&&l===c.clientName&&null==r&&(r=t.serializedName),Array.isArray(n[l])&&""===s[l].serializedName){r=n[l];const t=e.deserialize(p,r,y,o);for(const[e,n]of Object.entries(a))Object.prototype.hasOwnProperty.call(t,e)||(t[e]=n);a=t}else void 0===r&&void 0===p.defaultValue||(u=e.deserialize(p,r,y,o),a[l]=u)}}const l=t.type.additionalProperties;if(l){const t=e=>{for(const t in s){if(d(s[t].serializedName)[0]===e)return!1}return!0};for(const i in n)t(i)&&(a[i]=e.deserialize(l,n[i],r+'["'+i+'"]',o))}else if(n)for(const e of Object.keys(n))void 0!==a[e]||c.includes(e)||g(e,o)||(a[e]=n[e]);return a}(this,e,t,n,c);else{if(this.isXML){const e=c.xmlCharKey,n=t;null!=n[u.a]&&null!=n[e]&&(t=n[e])}null!==p.match(/^Number$/i)?(l=parseFloat(t),isNaN(l)&&(l=t)):null!==p.match(/^Boolean$/i)?l="true"===t||"false"!==t&&t:null!==p.match(/^(String|Enum|Object|Stream|Uuid|TimeSpan|any)$/i)?l=t:null!==p.match(/^(Date|DateTime|DateTimeRfc1123)$/i)?l=new Date(t):null!==p.match(/^UnixTime$/i)?l=function(e){if(!e)return;return new Date(1e3*e)}(t):null!==p.match(/^ByteArray$/i)?l=a(t):null!==p.match(/^Base64Url$/i)?l=function(e){if(!e)return;if(e&&"string"!=typeof e.valueOf())throw new Error("Please provide an input of type string for converting to Uint8Array");return a(e=e.replace(/-/g,"+").replace(/_/g,"/"))}(t):null!==p.match(/^Sequence$/i)?l=function(e,t,n,r,o){const i=t.type.element;if(!i||"object"!=typeof i)throw new Error('element" metadata for an Array must be defined in the mapper and it must of type "object" in '+r);if(n){Array.isArray(n)||(n=[n]);const t=[];for(let s=0;s<n.length;s++)t[s]=e.deserialize(i,n[s],`${r}[${s}]`,o);return t}return n}(this,e,t,n,c):null!==p.match(/^Dictionary$/i)&&(l=function(e,t,n,r,o){const i=t.type.value;if(!i||"object"!=typeof i)throw new Error('"value" metadata for a Dictionary must be defined in the mapper and it must of type "object" in '+r);if(n){const t={};for(const s of Object.keys(n))t[s]=e.deserialize(i,n[s],r,o);return t}return n}(this,e,t,n,c))}return e.isConstant&&(l=e.defaultValue),l}}function d(e){const t=[];let n="";if(e){const r=e.split(".");for(const e of r)"\\"===e.charAt(e.length-1)?n+=e.substr(0,e.length-1)+".":(n+=e,t.push(n),n="")}return t}function p(e,t,n){const r=t.type.className;if(!r)throw new Error(`Class name for model "${n}" is not provided in the mapper "${JSON.stringify(t,void 0,2)}".`);return e.modelMappers[r]}function h(e,t,n){let r=t.type.modelProperties;if(!r){const o=p(e,t,n);if(!o)throw new Error(`mapper() cannot be null or undefined for model "${t.type.className}".`);if(r=null==o?void 0:o.type.modelProperties,!r)throw new Error(`modelProperties cannot be null or undefined in the mapper "${JSON.stringify(o)}" of type "${t.type.className}" for object "${n}".`)}return r}function f(e,t,n,r){if(!n||!e.xmlNamespace)return t;const o={[e.xmlNamespacePrefix?"xmlns:"+e.xmlNamespacePrefix:"xmlns"]:e.xmlNamespace};if(["Composite"].includes(e.type.name)){if(t[u.a])return t;{const e=Object.assign({},t);return e[u.a]=o,e}}const i={};return i[r.xmlCharKey]=t,i[u.a]=o,i}function g(e,t){return[u.a,t.xmlCharKey].includes(e)}function m(e,t,n,r){const o=y(e,t);if(o){const i=o[r];if(null!=i){const r=n[i];if(null!=r){const n=t.type.uberParent||t.type.className,o=r===n?r:n+"."+r,i=e.modelMappers.discriminators[o];i&&(t=i)}}}return t}function y(e,t){return t.type.polymorphicDiscriminator||v(e,t.type.uberParent)||v(e,t.type.className)}function v(e,t){return t&&e.modelMappers[t]&&e.modelMappers[t].type.polymorphicDiscriminator}function b(e){const t=e;if(null!=e){if(e instanceof Uint8Array)return e=s(e);if(e instanceof Date)return e.toISOString();if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++)t.push(b(e[n]));return t}if("object"==typeof e){const n={};for(const r in e)n[r]=b(t[r]);return n}return e}}const T=function(e){const t={};for(const n of e)t[n]=n;return t}(["Base64Url","Boolean","ByteArray","Composite","Date","DateTime","DateTimeRfc1123","Dictionary","Enum","Number","Object","Sequence","String","Stream","TimeSpan","UnixTime"]);class w{constructor(e,t,n,r,s,a,u,l,d,p,h,f,g,m,y){this.streamResponseBody=a,this.streamResponseStatusCodes=y,this.url=e||"",this.method=t||"GET",this.headers=o(s)?s:new i(s),this.body=n,this.query=r,this.formData=void 0,this.withCredentials=u||!1,this.abortSignal=l,this.timeout=d||0,this.onUploadProgress=p,this.onDownloadProgress=h,this.proxySettings=f,this.keepAlive=g,this.decompressResponse=m,this.requestId=this.headers.get("x-ms-client-request-id")||Object(c.d)()}validateRequestProperties(){if(!this.method)throw new Error("WebResource.method is required.");if(!this.url)throw new Error("WebResource.url is required.")}prepare(e){if(!e)throw new Error("options object is required");if(void 0===e.method||null===e.method||"string"!=typeof e.method.valueOf())throw new Error("options.method must be a string.");if(e.url&&e.pathTemplate)throw new Error("options.url and options.pathTemplate are mutually exclusive. Please provide exactly one of them.");if(!(void 0!==e.pathTemplate&&null!==e.pathTemplate&&"string"==typeof e.pathTemplate.valueOf()||void 0!==e.url&&null!==e.url&&"string"==typeof e.url.valueOf()))throw new Error("Please provide exactly one of options.pathTemplate or options.url.");if(e.url){if("string"!=typeof e.url)throw new Error('options.url must be of type "string".');this.url=e.url}if(e.method){const t=["GET","PUT","HEAD","DELETE","OPTIONS","POST","PATCH","TRACE"];if(-1===t.indexOf(e.method.toUpperCase()))throw new Error('The provided method "'+e.method+'" is invalid. Supported HTTP methods are: '+JSON.stringify(t))}if(this.method=e.method.toUpperCase(),e.pathTemplate){const{pathTemplate:t,pathParameters:n}=e;if("string"!=typeof t)throw new Error('options.pathTemplate must be of type "string".');e.baseUrl||(e.baseUrl="https://management.azure.com");const r=e.baseUrl;let o=r+(r.endsWith("/")?"":"/")+(t.startsWith("/")?t.slice(1):t);const i=o.match(/({[\w-]*\s*[\w-]*})/gi);if(i&&i.length){if(!n)throw new Error(`pathTemplate: ${t} has been provided. Hence, options.pathParameters must also be provided.`);i.forEach((function(e){const r=e.slice(1,-1),i=n[r];if(null==i||"string"!=typeof i&&"object"!=typeof i){const e=JSON.stringify(n,void 0,2);throw new Error(`pathTemplate: ${t} contains the path parameter ${r} however, it is not present in parameters: ${e}.The value of the path parameter can either be a "string" of the form { ${r}: "some sample value" } or it can be an "object" of the form { "${r}": { value: "some sample value", skipUrlEncoding: true } }.`)}if("string"==typeof i.valueOf()&&(o=o.replace(e,encodeURIComponent(i))),"object"==typeof i.valueOf()){if(!i.value)throw new Error(`options.pathParameters[${r}] is of type "object" but it does not contain a "value" property.`);o=i.skipUrlEncoding?o.replace(e,i.value):o.replace(e,encodeURIComponent(i.value))}}))}this.url=o}if(e.queryParameters){const t=e.queryParameters;if("object"!=typeof t)throw new Error('options.queryParameters must be of type object. It should be a JSON object of "query-parameter-name" as the key and the "query-parameter-value" as the value. The "query-parameter-value" may be fo type "string" or an "object" of the form { value: "query-parameter-value", skipUrlEncoding: true }.');this.url&&-1===this.url.indexOf("?")&&(this.url+="?");const n=[];this.query={};for(const e in t){const r=t[e];if(r)if("string"==typeof r)n.push(e+"="+encodeURIComponent(r)),this.query[e]=encodeURIComponent(r);else if("object"==typeof r){if(!r.value)throw new Error(`options.queryParameters[${e}] is of type "object" but it does not contain a "value" property.`);r.skipUrlEncoding?(n.push(e+"="+r.value),this.query[e]=r.value):(n.push(e+"="+encodeURIComponent(r.value)),this.query[e]=encodeURIComponent(r.value))}}this.url+=n.join("&")}if(e.headers){const t=e.headers;for(const n of Object.keys(e.headers))this.headers.set(n,t[n])}return this.headers.get("accept-language")||this.headers.set("accept-language","en-US"),this.headers.get("x-ms-client-request-id")||e.disableClientRequestId||this.headers.set("x-ms-client-request-id",this.requestId),this.headers.get("Content-Type")||this.headers.set("Content-Type","application/json; charset=utf-8"),this.body=e.body,void 0!==e.body&&null!==e.body&&(e.bodyIsStream?(this.headers.get("Transfer-Encoding")||this.headers.set("Transfer-Encoding","chunked"),"application/octet-stream"!==this.headers.get("Content-Type")&&this.headers.set("Content-Type","application/octet-stream")):(e.serializationMapper&&(this.body=new l(e.mappers).serialize(e.serializationMapper,e.body,"requestBody")),e.disableJsonStringifyOnBody||(this.body=JSON.stringify(e.body)))),e.spanOptions&&(this.spanOptions=e.spanOptions),e.tracingContext&&(this.tracingContext=e.tracingContext),this.abortSignal=e.abortSignal,this.onDownloadProgress=e.onDownloadProgress,this.onUploadProgress=e.onUploadProgress,this}clone(){const e=new w(this.url,this.method,this.body,this.query,this.headers&&this.headers.clone(),this.streamResponseBody,this.withCredentials,this.abortSignal,this.timeout,this.onUploadProgress,this.onDownloadProgress,this.proxySettings,this.keepAlive,this.decompressResponse,this.streamResponseStatusCodes);return this.formData&&(e.formData=this.formData),this.operationSpec&&(e.operationSpec=this.operationSpec),this.shouldDeserialize&&(e.shouldDeserialize=this.shouldDeserialize),this.operationResponseGetter&&(e.operationResponseGetter=this.operationResponseGetter),e}}var E=n(210);const S={};class R{constructor(){this._rawQuery={}}any(){return Object.keys(this._rawQuery).length>0}keys(){return Object.keys(this._rawQuery)}set(e,t){const n=t;if(e)if(null!=n){const t=Array.isArray(n)?n:n.toString();this._rawQuery[e]=t}else delete this._rawQuery[e]}get(e){return e?this._rawQuery[e]:void 0}toString(){let e="";for(const t in this._rawQuery){e&&(e+="&");const n=this._rawQuery[t];if(Array.isArray(n)){const r=[];for(const e of n)r.push(`${t}=${e}`);e+=r.join("&")}else e+=`${t}=${n}`}return e}static parse(e){const t=new R;if(e){e.startsWith("?")&&(e=e.substring(1));let n="ParameterName",r="",o="";for(let i=0;i<e.length;++i){const s=e[i];switch(n){case"ParameterName":switch(s){case"=":n="ParameterValue";break;case"&":r="",o="";break;default:r+=s}break;case"ParameterValue":switch(s){case"&":t.set(r,o),r="",o="",n="ParameterName";break;default:o+=s}break;default:throw new Error("Unrecognized URLQuery parse state: "+n)}}"ParameterValue"===n&&t.set(r,o)}return t}}class C{setScheme(e){e?this.set(e,"SCHEME"):this._scheme=void 0}getScheme(){return this._scheme}setHost(e){e?this.set(e,"SCHEME_OR_HOST"):this._host=void 0}getHost(){return this._host}setPort(e){null==e||""===e?this._port=void 0:this.set(e.toString(),"PORT")}getPort(){return this._port}setPath(e){if(e){const t=e.indexOf("://");if(-1!==t){const n=e.lastIndexOf("/",t);this.set(-1===n?e:e.substr(n+1),"SCHEME")}else this.set(e,"PATH")}else this._path=void 0}appendPath(e){if(e){let t=this.getPath();t&&(t.endsWith("/")||(t+="/"),e.startsWith("/")&&(e=e.substring(1)),e=t+e),this.set(e,"PATH")}}getPath(){return this._path}setQuery(e){this._query=e?R.parse(e):void 0}setQueryParameter(e,t){e&&(this._query||(this._query=new R),this._query.set(e,t))}getQueryParameterValue(e){return this._query?this._query.get(e):void 0}getQuery(){return this._query?this._query.toString():void 0}set(e,t){const n=new I(e,t);for(;n.next();){const e=n.current();let t;if(e)switch(e.type){case"SCHEME":this._scheme=e.text||void 0;break;case"HOST":this._host=e.text||void 0;break;case"PORT":this._port=e.text||void 0;break;case"PATH":t=e.text||void 0,this._path&&"/"!==this._path&&"/"===t||(this._path=t);break;case"QUERY":this._query=R.parse(e.text);break;default:throw new Error("Unrecognized URLTokenType: "+e.type)}}}toString(){let e="";return this._scheme&&(e+=this._scheme+"://"),this._host&&(e+=this._host),this._port&&(e+=":"+this._port),this._path&&(this._path.startsWith("/")||(e+="/"),e+=this._path),this._query&&this._query.any()&&(e+="?"+this._query.toString()),e}replaceAll(e,t){e&&(this.setScheme(Object(c.m)(this.getScheme(),e,t)),this.setHost(Object(c.m)(this.getHost(),e,t)),this.setPort(Object(c.m)(this.getPort(),e,t)),this.setPath(Object(c.m)(this.getPath(),e,t)),this.setQuery(Object(c.m)(this.getQuery(),e,t)))}static parse(e){const t=new C;return t.set(e,"SCHEME_OR_HOST"),t}}class O{constructor(e,t){this.text=e,this.type=t}static scheme(e){return new O(e,"SCHEME")}static host(e){return new O(e,"HOST")}static port(e){return new O(e,"PORT")}static path(e){return new O(e,"PATH")}static query(e){return new O(e,"QUERY")}}class I{constructor(e,t){this._text=e,this._textLength=e?e.length:0,this._currentState=null!=t?t:"SCHEME_OR_HOST",this._currentIndex=0}current(){return this._currentToken}next(){if(A(this))switch(this._currentState){case"SCHEME":!function(e){const t=function(e){return k(e,e=>function(e){const t=e.charCodeAt(0);return 48<=t&&t<=57||65<=t&&t<=90||97<=t&&t<=122}(e))}(e);e._currentToken=O.scheme(t),A(e)?e._currentState="HOST":e._currentState="DONE"}(this);break;case"SCHEME_OR_HOST":!function(e){const t=N(e,":","/","?");A(e)?":"===P(e)?"://"===x(e,3)?(e._currentToken=O.scheme(t),e._currentState="HOST"):(e._currentToken=O.host(t),e._currentState="PORT"):(e._currentToken=O.host(t),"/"===P(e)?e._currentState="PATH":e._currentState="QUERY"):(e._currentToken=O.host(t),e._currentState="DONE")}(this);break;case"HOST":!function(e){"://"===x(e,3)&&_(e,3);const t=N(e,":","/","?");e._currentToken=O.host(t),A(e)?":"===P(e)?e._currentState="PORT":"/"===P(e)?e._currentState="PATH":e._currentState="QUERY":e._currentState="DONE"}(this);break;case"PORT":!function(e){":"===P(e)&&_(e);const t=N(e,"/","?");e._currentToken=O.port(t),A(e)?"/"===P(e)?e._currentState="PATH":e._currentState="QUERY":e._currentState="DONE"}(this);break;case"PATH":!function(e){const t=N(e,"?");e._currentToken=O.path(t),A(e)?e._currentState="QUERY":e._currentState="DONE"}(this);break;case"QUERY":!function(e){"?"===P(e)&&_(e);const t=function(e){let t="";e._currentIndex<e._textLength&&(t=e._text.substring(e._currentIndex),e._currentIndex=e._textLength);return t}(e);e._currentToken=O.query(t),e._currentState="DONE"}(this);break;default:throw new Error("Unrecognized URLTokenizerState: "+this._currentState)}else this._currentToken=void 0;return!!this._currentToken}}function A(e){return e._currentIndex<e._textLength}function P(e){return e._text[e._currentIndex]}function _(e,t){A(e)&&(t||(t=1),e._currentIndex+=t)}function x(e,t){let n=e._currentIndex+t;return e._textLength<n&&(n=e._textLength),e._text.substring(e._currentIndex,n)}function k(e,t){let n="";for(;A(e);){const r=P(e);if(!t(r))break;n+=r,_(e)}return n}function N(e,...t){return k(e,e=>-1===t.indexOf(e))}const M=["x-ms-client-request-id","x-ms-return-client-request-id","x-ms-useragent","x-ms-correlation-request-id","x-ms-request-id","client-request-id","ms-cv","return-client-request-id","traceparent","Access-Control-Allow-Credentials","Access-Control-Allow-Headers","Access-Control-Allow-Methods","Access-Control-Allow-Origin","Access-Control-Expose-Headers","Access-Control-Max-Age","Access-Control-Request-Headers","Access-Control-Request-Method","Origin","Accept","Accept-Encoding","Cache-Control","Connection","Content-Length","Content-Type","Date","ETag","Expires","If-Match","If-Modified-Since","If-None-Match","If-Unmodified-Since","Last-Modified","Pragma","Request-Id","Retry-After","Server","Transfer-Encoding","User-Agent"],D=["api-version"];class j{constructor({allowedHeaderNames:e=[],allowedQueryParameters:t=[]}={}){e=Array.isArray(e)?M.concat(e):M,t=Array.isArray(t)?D.concat(t):D,this.allowedHeaderNames=new Set(e.map(e=>e.toLowerCase())),this.allowedQueryParameters=new Set(t.map(e=>e.toLowerCase()))}sanitize(e){const t=new Set;return JSON.stringify(e,(e,n)=>{if(n instanceof Error)return Object.assign(Object.assign({},n),{name:n.name,message:n.message});if("_headersMap"===e)return this.sanitizeHeaders(n);if("url"===e)return this.sanitizeUrl(n);if("query"===e)return this.sanitizeQuery(n);if("body"!==e&&"response"!==e&&"operationSpec"!==e){if(Array.isArray(n)||Object(c.g)(n)){if(t.has(n))return"[Circular]";t.add(n)}return n}},2)}sanitizeHeaders(e){return this.sanitizeObject(e,this.allowedHeaderNames,(e,t)=>e[t].value)}sanitizeQuery(e){return this.sanitizeObject(e,this.allowedQueryParameters,(e,t)=>e[t])}sanitizeObject(e,t,n){if("object"!=typeof e||null===e)return e;const r={};for(const o of Object.keys(e))t.has(o.toLowerCase())?r[o]=n(e,o):r[o]="REDACTED";return r}sanitizeUrl(e){if("string"!=typeof e||null===e)return e;const t=C.parse(e),n=t.getQuery();if(!n)return e;const r=R.parse(n);for(const e of r.keys())this.allowedQueryParameters.has(e.toLowerCase())||r.set(e,"REDACTED");return t.setQuery(r.toString()),t.toString()}}const U=new j;class L extends Error{constructor(e,t,n,r,o){super(e),this.name="RestError",this.code=t,this.statusCode=n,this.request=r,this.response=o,Object.setPrototypeOf(this,L.prototype)}[S](){return`RestError: ${this.message} \n ${U.sanitize(this)}`}}L.REQUEST_SEND_ERROR="REQUEST_SEND_ERROR",L.PARSE_ERROR="PARSE_ERROR";class q{sendRequest(e){var t;const n=new XMLHttpRequest;if(e.proxySettings)throw new Error("HTTP proxy is not supported in browser environment");const r=e.abortSignal;if(r){if(r.aborted)return Promise.reject(new E.a("The operation was aborted."));const e=()=>{n.abort()};r.addEventListener("abort",e),n.addEventListener("readystatechange",()=>{n.readyState===XMLHttpRequest.DONE&&r.removeEventListener("abort",e)})}if(B(n.upload,e.onUploadProgress),B(n,e.onDownloadProgress),e.formData){const t=e.formData,n=new FormData,r=(e,t)=>{t&&Object.prototype.hasOwnProperty.call(t,"value")&&Object.prototype.hasOwnProperty.call(t,"options")?n.append(e,t.value,t.options):n.append(e,t)};for(const e of Object.keys(t)){const n=t[e];if(Array.isArray(n))for(let t=0;t<n.length;t++)r(e,n[t]);else r(e,n)}e.body=n,e.formData=void 0;const o=e.headers.get("Content-Type");o&&-1!==o.indexOf("multipart/form-data")&&e.headers.remove("Content-Type")}n.open(e.method,e.url),n.timeout=e.timeout,n.withCredentials=e.withCredentials;for(const t of e.headers.headersArray())n.setRequestHeader(t.name,t.value);return n.responseType=(null===(t=e.streamResponseStatusCodes)||void 0===t?void 0:t.size)||e.streamResponseBody?"blob":"text",n.send(void 0===e.body?null:e.body),"blob"===n.responseType?new Promise((t,r)=>{!function(e,t,n,r){e.addEventListener("readystatechange",()=>{var o;if(e.readyState===XMLHttpRequest.HEADERS_RECEIVED)if(t.streamResponseBody||(null===(o=t.streamResponseStatusCodes)||void 0===o?void 0:o.has(e.status))){const r=new Promise((n,r)=>{e.addEventListener("load",()=>{n(e.response)}),H(t,e,r)});n({request:t,status:e.status,headers:z(e),blobBody:r})}else e.addEventListener("load",()=>{if(e.response){const o=new FileReader;o.onload=function(r){var o;const i=null===(o=r.target)||void 0===o?void 0:o.result;n({request:t,status:e.status,headers:z(e),bodyAsText:i})},o.onerror=function(e){r(o.error)},o.readAsText(e.response,"UTF-8")}else n({request:t,status:e.status,headers:z(e)})})})}(n,e,t,r),H(e,n,r)}):new Promise((function(t,r){n.addEventListener("load",()=>t({request:e,status:n.status,headers:z(n),bodyAsText:n.responseText})),H(e,n,r)}))}}function B(e,t){t&&e.addEventListener("progress",e=>t({loadedBytes:e.loaded}))}function z(e){const t=new i,n=e.getAllResponseHeaders().trim().split(/[\r\n]+/);for(const e of n){const n=e.indexOf(":"),r=e.slice(0,n),o=e.slice(n+2);t.set(r,o)}return t}function H(e,t,n){t.addEventListener("error",()=>n(new L("Failed to send request to "+e.url,L.REQUEST_SEND_ERROR,void 0,e)));const r=new E.a("The operation was aborted.");t.addEventListener("abort",()=>n(r)),t.addEventListener("timeout",()=>n(r))}var F;!function(e){e[e.OFF=0]="OFF",e[e.ERROR=1]="ERROR",e[e.WARNING=2]="WARNING",e[e.INFO=3]="INFO"}(F||(F={}));Object.create;Object.create;function $(e){var t;const{requestOptions:n,tracingOptions:r}=e;let o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}(e,["requestOptions","tracingOptions"]);return n&&(o=Object.assign(Object.assign({},o),n)),r&&(o.tracingContext=r.tracingContext,o.spanOptions=null===(t=r)||void 0===t?void 0:t.spanOptions),o}function G(e){const t=e;return t&&"function"==typeof t.getToken&&(void 0===t.signRequest||t.getToken.length>0)}class V{constructor(e,t){this._nextPolicy=e,this._options=t}shouldLog(e){return this._options.shouldLog(e)}log(e,t){this._options.log(e,t)}}class J{constructor(e){this._logger=e}shouldLog(e){return!!this._logger&&e!==F.OFF&&e<=this._logger.minimumLogLevel}log(e,t){this._logger&&this.shouldLog(e)&&this._logger.log(e,t)}}var W=n(30);const Y=Object(W.a)("core-http");function K(e={}){return{create:(t,n)=>new X(t,n,e)}}class X extends V{constructor(e,t,{logger:n=Y.info,allowedHeaderNames:r=[],allowedQueryParameters:o=[]}={}){super(e,t),this.logger=n,this.sanitizer=new j({allowedHeaderNames:r,allowedQueryParameters:o})}get allowedHeaderNames(){return this.sanitizer.allowedHeaderNames}set allowedHeaderNames(e){this.sanitizer.allowedHeaderNames=e}get allowedQueryParameters(){return this.sanitizer.allowedQueryParameters}set allowedQueryParameters(e){this.sanitizer.allowedQueryParameters=e}sendRequest(e){return this.logger.enabled?(this.logRequest(e),this._nextPolicy.sendRequest(e).then(e=>this.logResponse(e))):this._nextPolicy.sendRequest(e)}logRequest(e){this.logger("Request: "+this.sanitizer.sanitize(e))}logResponse(e){return this.logger("Response status code: "+e.status),this.logger("Headers: "+this.sanitizer.sanitize(e.headers)),e}}function Q(e){return Z(e.parameterPath,e.mapper)}function Z(e,t){let n;return n="string"==typeof e?e:Array.isArray(e)?e.join("."):t.serializedName,n}if(!(self.document&&self.DOMParser&&self.Node&&self.XMLSerializer))throw new Error('This library depends on the following DOM objects: ["document", "DOMParser", "Node", "XMLSerializer"] to parse XML, but some of these are undefined. You may provide a polyfill to make these globally available in order to support your environment. For more information, please refer to https://aka.ms/azsdk/js/web-workers. ');const ee=document.implementation.createDocument(null,null,null),te=new DOMParser;function ne(e,t={}){var n,r,o;try{const i={rootName:null!==(n=t.rootName)&&void 0!==n?n:"",includeRoot:null!==(r=t.includeRoot)&&void 0!==r&&r,xmlCharKey:null!==(o=t.xmlCharKey)&&void 0!==o?o:u.b},s=te.parseFromString(e,"application/xml");let a;return function(e){const t=e.getElementsByTagName("parsererror");if(t.length>0&&function(){var e;if(void 0===re)try{re=null!==(e=te.parseFromString("INVALID","text/xml").getElementsByTagName("parsererror")[0].namespaceURI)&&void 0!==e?e:""}catch(e){re=""}return re}())for(let e=0;e<t.length;e++)if(t[e].namespaceURI===re)throw new Error(t[e].innerHTML)}(s),a=i.includeRoot?oe(s,i):oe(s.childNodes[0],i),Promise.resolve(a)}catch(e){return Promise.reject(e)}}let re;function oe(e,t){let n={};const r=e.childNodes.length,o=e.childNodes[0],i=o&&1===r&&o.nodeType===Node.TEXT_NODE&&o.nodeValue||void 0,s=function(e){return function(e){return!!e.attributes}(e)&&e.hasAttributes()?e:void 0}(e);if(s){n[u.a]={};for(let e=0;e<s.attributes.length;e++){const t=s.attributes[e];n[u.a][t.nodeName]=t.nodeValue}i&&(n[t.xmlCharKey]=i)}else 0===r?n="":i&&(n=i);if(!i)for(let o=0;o<r;o++){const r=e.childNodes[o];if(r.nodeType!==Node.TEXT_NODE){const e=oe(r,t);n[r.nodeName]?Array.isArray(n[r.nodeName])?n[r.nodeName].push(e):n[r.nodeName]=[n[r.nodeName],e]:n[r.nodeName]=e}}return n}const ie=new XMLSerializer;function se(e,t={}){var n,r,o;const i={rootName:null!==(n=t.rootName)&&void 0!==n?n:"root",includeRoot:null!==(r=t.includeRoot)&&void 0!==r&&r,xmlCharKey:null!==(o=t.xmlCharKey)&&void 0!==o?o:u.b},s=function e(t,n,r){if(null==t||"string"==typeof t||"number"==typeof t||"boolean"==typeof t){const e=ee.createElement(n);return e.textContent=null==t?"":t.toString(),[e]}if(Array.isArray(t)){const o=[];for(const i of t)for(const t of e(i,n,r))o.push(t);return o}if("object"==typeof t){const o=ee.createElement(n);for(const n of Object.keys(t))if(n===u.a)for(const e of ae(t[n]))o.attributes.setNamedItem(e);else if(n===r.xmlCharKey)o.textContent=t[n].toString();else for(const i of e(t[n],n,r))o.appendChild(i);return[o]}throw new Error("Illegal value passed to buildObject: "+t)}(e,i.rootName,i)[0];return'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>'+ie.serializeToString(s)}function ae(e){const t=[];for(const n of Object.keys(e)){const r=ee.createAttribute(n);r.value=e[n].toString(),t.push(r)}return t}function ce(e,t){return{create:(n,r)=>new pe(n,r,e,t)}}const ue=["application/json","text/json"],le=["application/xml","application/atom+xml"],de={expectedContentTypes:{json:ue,xml:le}};class pe extends V{constructor(e,t,n,r={}){var o;super(e,t),this.jsonContentTypes=n&&n.json||ue,this.xmlContentTypes=n&&n.xml||le,this.xmlCharKey=null!==(o=r.xmlCharKey)&&void 0!==o?o:u.b}async sendRequest(e){return this._nextPolicy.sendRequest(e).then(e=>he(this.jsonContentTypes,this.xmlContentTypes,e,{xmlCharKey:this.xmlCharKey}))}}function he(e,t,n,r={}){var o,i,s;const a={rootName:null!==(o=r.rootName)&&void 0!==o?o:"",includeRoot:null!==(i=r.includeRoot)&&void 0!==i&&i,xmlCharKey:null!==(s=r.xmlCharKey)&&void 0!==s?s:u.b};return function(e,t,n,r){var o;const i=e=>{const t=`Error "${e}" occurred while parsing the response body - ${n.bodyAsText}.`,r=e.code||L.PARSE_ERROR,o=new L(t,r,n.status,n.request,n);return Promise.reject(o)};if(!(null===(o=n.request.streamResponseStatusCodes)||void 0===o?void 0:o.has(n.status))&&!n.request.streamResponseBody&&n.bodyAsText){const o=n.bodyAsText,s=n.headers.get("Content-Type")||"",a=s?s.split(";").map(e=>e.toLowerCase()):[];if(0===a.length||a.some(t=>-1!==e.indexOf(t)))return new Promise(e=>{n.parsedBody=JSON.parse(o),e(n)}).catch(i);if(a.some(e=>-1!==t.indexOf(e)))return ne(o,r).then(e=>(n.parsedBody=e,n)).catch(i)}return Promise.resolve(n)}(e,t,n,a).then(e=>{if(!function(e){const t=e.request.shouldDeserialize;let n;return n=void 0===t||("boolean"==typeof t?t:t(e)),n}(e))return e;const t=e.request.operationSpec;if(!t||!t.responses)return e;const o=function(e){let t;const n=e.request,r=n.operationSpec;if(r){const o=n.operationResponseGetter;t=o?o(r,e):r.responses[e.status]}return t}(e),{error:i,shouldReturnResponse:s}=function(e,t,n){var r;const o=200<=e.status&&e.status<300;if(function(e){const t=Object.keys(e.responses);return 0===t.length||1===t.length&&"default"===t[0]}(t)?o:n){if(!n)return{error:null,shouldReturnResponse:!1};if(!n.isError)return{error:null,shouldReturnResponse:!1}}const i=null!=n?n:t.responses.default,s=(null===(r=e.request.streamResponseStatusCodes)||void 0===r?void 0:r.has(e.status))||e.request.streamResponseBody?"Unexpected status code: "+e.status:e.bodyAsText,a=new L(s,void 0,e.status,e.request,e);if(!i)throw a;const c=i.bodyMapper,u=i.headersMapper;try{if(e.parsedBody){const n=e.parsedBody;let r;if(c){let e=n;t.isXML&&c.type.name===T.Sequence&&(e="object"==typeof n?n[c.xmlElementName]:[]),r=t.serializer.deserialize(c,e,"error.response.parsedBody")}const o=n.error||r||n;a.code=o.code,o.message&&(a.message=o.message),c&&(a.response.parsedBody=r)}e.headers&&u&&(a.response.parsedHeaders=t.serializer.deserialize(u,e.headers.rawHeaders(),"operationRes.parsedHeaders"))}catch(t){a.message=`Error "${t.message}" occurred in deserializing the responseBody - "${e.bodyAsText}" for the default response.`}return{error:a,shouldReturnResponse:!1}}(e,t,o);if(i)throw i;if(s)return e;if(o){if(o.bodyMapper){let n=e.parsedBody;t.isXML&&o.bodyMapper.type.name===T.Sequence&&(n="object"==typeof n?n[o.bodyMapper.xmlElementName]:[]);try{e.parsedBody=t.serializer.deserialize(o.bodyMapper,n,"operationRes.parsedBody",r)}catch(t){throw new L(`Error ${t} occurred in deserializing the responseBody - ${e.bodyAsText}`,void 0,e.status,e.request,e)}}else"HEAD"===t.httpMethod&&(e.parsedBody=n.status>=200&&n.status<300);o.headersMapper&&(e.parsedHeaders=t.serializer.deserialize(o.headersMapper,e.headers.rawHeaders(),"operationRes.parsedHeaders",r))}return e})}function fe(e){return"number"==typeof e}function ge(e,t,n,r,o){return!!t(r,o)&&n.retryCount<e}function me(e,t={retryCount:0,retryInterval:0},n){n&&(t.error&&(n.innerError=t.error),t.error=n),t.retryCount++;let r=Math.pow(2,t.retryCount-1)-1;return r*=.8*e.retryInterval+Math.floor(Math.random()*(.4*e.retryInterval)),t.retryInterval=Math.min(e.minRetryInterval+r,e.maxRetryInterval),t}var ye=n(8);function ve(e,t,n){return new Promise((r,o)=>{let i=void 0,s=void 0;const a=()=>o(new E.a((null==n?void 0:n.abortErrorMsg)?null==n?void 0:n.abortErrorMsg:"The operation was aborted.")),c=()=>{(null==n?void 0:n.abortSignal)&&s&&n.abortSignal.removeEventListener("abort",s)};if(s=()=>(null!=i&&clearTimeout(i),c(),a()),(null==n?void 0:n.abortSignal)&&n.abortSignal.aborted)return a();i=setTimeout(()=>{c(),r(t)},e),(null==n?void 0:n.abortSignal)&&n.abortSignal.addEventListener("abort",s)})}function be(e,t,n){return{create:(r,o)=>new Ee(r,o,e,t,n)}}var Te;!function(e){e[e.Exponential=0]="Exponential"}(Te||(Te={}));const we={maxRetries:3,retryDelayInMs:3e4,maxRetryDelayInMs:9e4};class Ee extends V{constructor(e,t,n,r,o){super(e,t),this.retryCount=fe(n)?n:3,this.retryInterval=fe(r)?r:3e4,this.maxRetryInterval=fe(o)?o:9e4}sendRequest(e){return this._nextPolicy.sendRequest(e.clone()).then(t=>Se(this,e,t)).catch(t=>Se(this,e,t.response,void 0,t))}}async function Se(e,t,n,r,o){r=me({retryInterval:e.retryInterval,minRetryInterval:0,maxRetryInterval:e.maxRetryInterval},r,o);const i=t.abortSignal&&t.abortSignal.aborted;if(i||!ge(e.retryCount,(function(e){const t=null==e?void 0:e.status;return(503!==t||!(null==n?void 0:n.headers.get(ye.a.HeaderConstants.RETRY_AFTER)))&&!(void 0===t||t<500&&408!==t||501===t||505===t)}),r,n)){if(i||o||!n){throw r.error||new L("Failed to send the request.",L.REQUEST_SEND_ERROR,n&&n.status,n&&n.request,n)}return n}Y.info("Retrying request in "+r.retryInterval);try{await ve(r.retryInterval);const n=await e._nextPolicy.sendRequest(t.clone());return Se(e,t,n,r)}catch(o){return Se(e,t,n,r,o)}}function Re(e="x-ms-client-request-id"){return{create:(t,n)=>new Ce(t,n,e)}}class Ce extends V{constructor(e,t,n){super(e,t),this._requestIdHeaderName=n}sendRequest(e){return e.headers.contains(this._requestIdHeaderName)||e.headers.set(this._requestIdHeaderName,e.requestId),this._nextPolicy.sendRequest(e)}}function Oe(){return"x-ms-useragent"}const Ie=Oe;function Ae(){const e=[{key:"core-http",value:ye.a.coreHttpVersion}],t=function(){const e=self.navigator;return[{key:"OS",value:(e.oscpu||e.platform).replace(" ","")}]}();return function(e,t=" ",n="/"){return e.map(e=>{const t=e.value?`${n}${e.value}`:"";return`${e.key}${t}`}).join(t)}(e.concat(t))}function Pe(e){const t=e&&void 0!==e.key&&null!==e.key?e.key:"x-ms-useragent",n=e&&void 0!==e.value&&null!==e.value?e.value:Ae();return{create:(e,r)=>new _e(e,r,t,n)}}class _e extends V{constructor(e,t,n,r){super(e,t),this._nextPolicy=e,this._options=t,this.headerKey=n,this.headerValue=r}sendRequest(e){return this.addUserAgentHeader(e),this._nextPolicy.sendRequest(e)}addUserAgentHeader(e){e.headers||(e.headers=new i),!e.headers.get(this.headerKey)&&this.headerValue&&e.headers.set(this.headerKey,this.headerValue)}}const xe=["GET","HEAD"],ke={handleRedirects:!0,maxRetries:20};function Ne(e=20){return{create:(t,n)=>new Me(t,n,e)}}class Me extends V{constructor(e,t,n=20){super(e,t),this.maxRetries=n}sendRequest(e){return this._nextPolicy.sendRequest(e).then(e=>function e(t,n,r){const{request:o,status:i}=n,s=n.headers.get("location");if(s&&(300===i||301===i&&xe.includes(o.method)||302===i&&xe.includes(o.method)||303===i&&"POST"===o.method||307===i)&&(!t.maxRetries||r<t.maxRetries)){const n=C.parse(o.url);return n.setPath(s),o.url=n.toString(),303===i&&(o.method="GET",delete o.body),t._nextPolicy.sendRequest(o).then(n=>e(t,n,r+1))}return Promise.resolve(n)}(this,e,0))}}class De extends V{constructor(e,t,n=30){super(e,t),this._retryTimeout=n}sendRequest(e){return this._nextPolicy.sendRequest(e.clone()).then(t=>function(e,t,n){if(409===n.status){const r=function(e){let t,n;if(e){try{n=JSON.parse(e)}catch(e){}if(n&&n.error&&n.error.message&&n.error.code&&"MissingSubscriptionRegistration"===n.error.code){const e=n.error.message.match(/.*'(.*)'/i);e&&(t=e.pop())}}return t}(n.bodyAsText);if(r){const o=function(e){let t;const n=e.match(/.*\/subscriptions\/[a-f0-9-]+\//gi);if(!n||!n[0])throw new Error(`Unable to extract subscriptionId from the given url - ${e}.`);t=n[0];return t}(t.url);return async function(e,t,n,r){const o=`${t}providers/${n}/register?api-version=2016-02-01`,i=`${t}providers/${n}?api-version=2016-02-01`,s=je(r);s.method="POST",s.url=o;if(200!==(await e._nextPolicy.sendRequest(s)).status)throw new Error(`Autoregistration of ${n} failed. Please try registering manually.`);return async function e(t,n,r){const o=je(r);o.url=n,o.method="GET";const i=await t._nextPolicy.sendRequest(o),s=i.parsedBody;return!(!i.parsedBody||!s.registrationState||"Registered"!==s.registrationState)||(await ve(1e3*t._retryTimeout),e(t,n,r))}(e,i,r)}(e,o,r,t).catch(()=>!1).then(r=>r?(t.headers.set("x-ms-client-request-id",c.d()),e._nextPolicy.sendRequest(t.clone())):n)}}return Promise.resolve(n)}(this,e,t))}}function je(e,t=!1){const n=e.clone();return t&&(n.url=e.url),n.headers.set("x-ms-client-request-id",c.d()),n.headers.set("Content-Type","application/json; charset=utf-8"),n}const Ue={forcedRefreshWindowInMs:1e3,retryIntervalInMs:3e3,refreshWindowInMs:12e4};function Le(e,t,n){let r=null,o=null;const i=Object.assign(Object.assign({},Ue),n),s={get isRefreshing(){return null!==r},get shouldRefresh(){var e;return!s.isRefreshing&&(null!==(e=null==o?void 0:o.expiresOnTimestamp)&&void 0!==e?e:0)-i.refreshWindowInMs<Date.now()},get mustRefresh(){return null===o||o.expiresOnTimestamp-i.forcedRefreshWindowInMs<Date.now()}};function a(n){var a;if(!s.isRefreshing){r=async function(e,t,n){async function r(){if(!(Date.now()<n)){const t=await e();if(null===t)throw new Error("Failed to refresh access token.");return t}try{return await e()}catch(e){return null}}let o=await r();for(;null===o;)await ve(t),o=await r();return o}(()=>e.getToken(t,n),i.retryIntervalInMs,null!==(a=null==o?void 0:o.expiresOnTimestamp)&&void 0!==a?a:Date.now()).then(e=>(r=null,o=e,o)).catch(e=>{throw r=null,o=null,e})}return r}return async e=>s.mustRefresh?a(e):(s.shouldRefresh&&a(e),o)}function qe(e,t){const n=Le(e,t);class r extends V{constructor(e,t){super(e,t)}async sendRequest(e){if(!e.url.toLowerCase().startsWith("https://"))throw new Error("Bearer token authentication is not permitted for non-TLS protected (non-https) URLs.");const{token:t}=await n({abortSignal:e.abortSignal,tracingOptions:{tracingContext:e.tracingContext}});return e.headers.set(ye.a.HeaderConstants.AUTHORIZATION,"Bearer "+t),this._nextPolicy.sendRequest(e)}}return{create:(e,t)=>new r(e,t)}}function Be(e,t,n,r){return{create:(o,i)=>new ze(o,i,e,t,n,r)}}class ze extends V{constructor(e,t,n,r,o,i){super(e,t),this.retryCount=fe(n)?n:3,this.retryInterval=fe(r)?r:3e4,this.minRetryInterval=fe(o)?o:3e3,this.maxRetryInterval=fe(i)?i:9e4}sendRequest(e){return this._nextPolicy.sendRequest(e.clone()).catch(t=>async function e(t,n,r,o,i){if(i=me(t,i,o),!ge(t.retryCount,(function(e,t){if(t&&t.code&&("ETIMEDOUT"===t.code||"ESOCKETTIMEDOUT"===t.code||"ECONNREFUSED"===t.code||"ECONNRESET"===t.code||"ENOENT"===t.code))return!0;return!1}),i,r,o))return o?Promise.reject(i.error):r;try{return await ve(i.retryInterval),t._nextPolicy.sendRequest(n.clone())}catch(o){return e(t,n,r,o,i)}}(this,e,t.response,t))}}var He;!function(e){e.Csv=",",e.Ssv=" ",e.Tsv="\t",e.Pipes="|",e.Multi="Multi"}(He||(He={}));const Fe=new Error("ProxyPolicy is not supported in browser environment");function $e(e){}function Ge(e){return{create:(e,t)=>{throw Fe}}}const Ve=ye.a.HttpConstants.StatusCodes;function Je(){return{create:(e,t)=>new We(e,t)}}class We extends V{constructor(e,t,n){super(e,t),this.numberOfRetries=0,this._handleResponse=n||this._defaultResponseHandler}async sendRequest(e){const t=await this._nextPolicy.sendRequest(e.clone());return t.status!==Ve.TooManyRequests&&t.status!==Ve.ServiceUnavailable?t:this._handleResponse(e,t)}async _defaultResponseHandler(e,t){var n;const r=t.headers.get(ye.a.HeaderConstants.RETRY_AFTER);if(r){const t=We.parseRetryAfterHeader(r);if(t){if(this.numberOfRetries+=1,await ve(t,void 0,{abortSignal:e.abortSignal,abortErrorMsg:"The operation was aborted."}),null===(n=e.abortSignal)||void 0===n?void 0:n.aborted)throw new E.a("The operation was aborted.");return this.numberOfRetries<3?this.sendRequest(e):this._nextPolicy.sendRequest(e)}}return t}static parseRetryAfterHeader(e){const t=Number(e);return Number.isNaN(t)?We.parseDateRetryAfterHeader(e):1e3*t}static parseDateRetryAfterHeader(e){try{const t=Date.now(),n=Date.parse(e)-t;return Number.isNaN(n)?void 0:n}catch(e){return}}}function Ye(e){return{create:(t,n)=>new Ke(t,n,e)}}class Ke extends V{constructor(e,t,n){super(e,t),this.authenticationProvider=n}signRequest(e){return this.authenticationProvider.signRequest(e)}sendRequest(e){return this.signRequest(e).then(e=>this._nextPolicy.sendRequest(e))}}const Xe={enable:!0};function Qe(e){return{create:(t,n)=>new Ze(t,n,e||Xe)}}class Ze extends V{constructor(e,t,n){super(e,t),this.keepAliveOptions=n}async sendRequest(e){return e.keepAlive=this.keepAliveOptions.enable,this._nextPolicy.sendRequest(e)}}var et=n(208),tt=n(36),nt=n(209);const rt=Object(et.a)({packagePrefix:"",namespace:""});function ot(e={}){return{create:(t,n)=>new it(t,n,e)}}class it extends V{constructor(e,t,n){super(e,t),this.userAgent=n.userAgent}async sendRequest(e){if(!e.tracingContext)return this._nextPolicy.sendRequest(e);const t=this.tryCreateSpan(e);if(!t)return this._nextPolicy.sendRequest(e);try{const n=await this._nextPolicy.sendRequest(e);return this.tryProcessResponse(t,n),n}catch(e){throw this.tryProcessError(t,e),e}}tryCreateSpan(e){var t;try{const n=C.parse(e.url).getPath()||"/",{span:r}=rt(n,{tracingOptions:{spanOptions:Object.assign(Object.assign({},e.spanOptions),{kind:tt.a.CLIENT}),tracingContext:e.tracingContext}});if(!r.isRecording())return void r.end();const o=null===(t=e.tracingContext)||void 0===t?void 0:t.getValue(Symbol.for("az.namespace"));"string"==typeof o&&r.setAttribute("az.namespace",o),r.setAttributes({"http.method":e.method,"http.url":e.url,requestId:e.requestId}),this.userAgent&&r.setAttribute("http.user_agent",this.userAgent);const i=r.spanContext(),s=Object(nt.a)(i);if(s&&Object(tt.e)(i)){e.headers.set("traceparent",s);const t=i.traceState&&i.traceState.serialize();t&&e.headers.set("tracestate",t)}return r}catch(e){return void Y.warning("Skipping creating a tracing span due to an error: "+e.message)}}tryProcessError(e,t){try{e.setStatus({code:tt.b.ERROR,message:t.message}),t.statusCode&&e.setAttribute("http.status_code",t.statusCode),e.end()}catch(e){Y.warning("Skipping tracing span processing due to an error: "+e.message)}}tryProcessResponse(e,t){try{e.setAttribute("http.status_code",t.status);const n=t.headers.get("x-ms-request-id");n&&e.setAttribute("serviceRequestId",n),e.setStatus({code:tt.b.OK}),e.end()}catch(e){Y.warning("Skipping tracing span processing due to an error: "+e.message)}}}const st=new Error("DisableResponseDecompressionPolicy is not supported in browser environment");function at(){return{create:(e,t)=>{throw st}}}class ct extends V{constructor(e,t){super(e,t)}async sendRequest(e){if("string"==typeof e.body&&e.body.startsWith("[")){const t=JSON.parse(e.body);Array.isArray(t)&&(e.body=t.map(e=>JSON.stringify(e)+"\n").join(""))}return this._nextPolicy.sendRequest(e)}}const ut=URL;let lt;class dt{constructor(e,t){let n;if(t||(t={}),this._withCredentials=t.withCredentials||!1,this._httpClient=t.httpClient||(lt||(lt=new q),lt),this._requestPolicyOptions=new J(t.httpPipelineLogger),Array.isArray(t.requestPolicyFactories))Y.info("ServiceClient: using custom request policies"),n=t.requestPolicyFactories;else{let r=void 0;if(G(e)){Y.info("ServiceClient: creating bearer token authentication policy from provided credentials");r=(()=>{let n=void 0;const r=this,o=t;return{create(t,i){const s=function(e,t){if(null==e?void 0:e.credentialScopes){const t=e.credentialScopes;return Array.isArray(t)?t.map(e=>new ut(e).toString()):new ut(t).toString()}if(t)return t+"/.default";return}(o,r.baseUri);if(!s)throw new Error("When using credential, the ServiceClient must contain a baseUri or a credentialScopes in ServiceClientOptions. Unable to create a bearerTokenAuthenticationPolicy");return null==n&&(n=qe(e,s)),n.create(t,i)}}})()}else if(e&&"function"==typeof e.signRequest)Y.info("ServiceClient: creating signing policy from provided credentials"),r=Ye(e);else if(null!=e)throw new Error("The credentials argument must implement the TokenCredential interface");if(Y.info("ServiceClient: using default request policies"),n=function(e,t){const n=[];t.generateClientRequestIdHeader&&n.push(Re(t.clientRequestIdHeaderName));e&&n.push(e);const r=pt(t.userAgentHeaderName,Ie),o=pt(t.userAgent,Ae);r&&o&&n.push(Pe({key:r,value:o}));n.push(Ne()),n.push(function(e=30){return{create:(t,n)=>new De(t,n,e)}}(t.rpRegistrationRetryTimeout)),t.noRetryPolicy||(n.push(be()),n.push(Be()),n.push(Je()));n.push(ce(t.deserializationContentTypes)),c.f&&n.push(Ge(t.proxySettings));return n.push(K({logger:Y.info})),n}(r,t),t.requestPolicyFactories){const e=t.requestPolicyFactories(n);e&&(n=e)}}this._requestPolicyFactories=n}sendRequest(e){if(null==e||"object"!=typeof e)throw new Error("options cannot be null or undefined and it must be of type object.");let t;try{!function(e){if(e&&"object"==typeof e){const t=e;if("string"==typeof t.url&&"string"==typeof t.method&&"object"==typeof t.headers&&o(t.headers)&&"function"==typeof t.validateRequestProperties&&"function"==typeof t.prepare&&"function"==typeof t.clone)return!0}return!1}(e)?(t=new w,t=t.prepare(e)):(e.validateRequestProperties(),t=e)}catch(e){return Promise.reject(e)}let n=this._httpClient;if(this._requestPolicyFactories&&this._requestPolicyFactories.length>0)for(let e=this._requestPolicyFactories.length-1;e>=0;--e)n=this._requestPolicyFactories[e].create(n,this._requestPolicyOptions);return n.sendRequest(t)}async sendOperationRequest(e,t,n){var r;"function"==typeof e.options&&(n=e.options,e.options=void 0);const o=null===(r=e.options)||void 0===r?void 0:r.serializerOptions,i=new w;let s;try{const n=t.baseUrl||this.baseUri;if(!n)throw new Error("If operationSpec.baseUrl is not specified, then the ServiceClient must have a baseUri string property that contains the base URL to use.");i.method=t.httpMethod,i.operationSpec=t;const r=C.parse(n);if(t.path&&r.appendPath(t.path),t.urlParameters&&t.urlParameters.length>0)for(const n of t.urlParameters){let i=ft(this,e,n,t.serializer);i=t.serializer.serialize(n.mapper,i,Q(n),o),n.skipEncoding||(i=encodeURIComponent(i)),r.replaceAll(`{${n.mapper.serializedName||Q(n)}}`,i)}if(t.queryParameters&&t.queryParameters.length>0)for(const n of t.queryParameters){let i=ft(this,e,n,t.serializer);if(null!=i){if(i=t.serializer.serialize(n.mapper,i,Q(n),o),void 0!==n.collectionFormat&&null!==n.collectionFormat)if(n.collectionFormat===He.Multi){if(0===i.length)continue;for(const e in i){const t=i[e];i[e]=null==t?"":t.toString()}}else n.collectionFormat!==He.Ssv&&n.collectionFormat!==He.Tsv||(i=i.join(n.collectionFormat));if(!n.skipEncoding)if(Array.isArray(i))for(const e in i)void 0!==i[e]&&null!==i[e]&&(i[e]=encodeURIComponent(i[e]));else i=encodeURIComponent(i);void 0!==n.collectionFormat&&null!==n.collectionFormat&&n.collectionFormat!==He.Multi&&n.collectionFormat!==He.Ssv&&n.collectionFormat!==He.Tsv&&(i=i.join(n.collectionFormat)),r.setQueryParameter(n.mapper.serializedName||Q(n),i)}}i.url=r.toString();const a=t.contentType||this.requestContentType;if(a&&t.requestBody&&i.headers.set("Content-Type",a),t.headerParameters)for(const n of t.headerParameters){let r=ft(this,e,n,t.serializer);if(null!=r){r=t.serializer.serialize(n.mapper,r,Q(n),o);const e=n.mapper.headerCollectionPrefix;if(e)for(const t of Object.keys(r))i.headers.set(e+t,r[t]);else i.headers.set(n.mapper.serializedName||Q(n),r)}}const l=e.options;if(l){if(l.customHeaders)for(const e in l.customHeaders)i.headers.set(e,l.customHeaders[e]);l.abortSignal&&(i.abortSignal=l.abortSignal),l.timeout&&(i.timeout=l.timeout),l.onUploadProgress&&(i.onUploadProgress=l.onUploadProgress),l.onDownloadProgress&&(i.onDownloadProgress=l.onDownloadProgress),l.spanOptions&&(i.spanOptions=l.spanOptions),l.tracingContext&&(i.tracingContext=l.tracingContext),void 0!==l.shouldDeserialize&&null!==l.shouldDeserialize&&(i.shouldDeserialize=l.shouldDeserialize)}let d,p;i.withCredentials=this._withCredentials,function(e,t,n,r){var o,i,s,a,l,d;const p=null!==(i=null===(o=n.options)||void 0===o?void 0:o.serializerOptions)&&void 0!==i?i:{},h={rootName:null!==(s=p.rootName)&&void 0!==s?s:"",includeRoot:null!==(a=p.includeRoot)&&void 0!==a&&a,xmlCharKey:null!==(l=p.xmlCharKey)&&void 0!==l?l:u.b},f=p.xmlCharKey;if(r.requestBody&&r.requestBody.mapper){t.body=ft(e,n,r.requestBody,r.serializer);const o=r.requestBody.mapper,{required:i,xmlName:s,xmlElementName:a,serializedName:l,xmlNamespace:p,xmlNamespacePrefix:g}=o,m=o.type.name;try{if(void 0!==t.body&&null!==t.body||i){const e=Q(r.requestBody);t.body=r.serializer.serialize(o,t.body,e,h);const n=m===T.Stream;if(r.isXML){const e=g?"xmlns:"+g:"xmlns",r=function(e,t,n,r,o){if(e&&!["Composite","Sequence","Dictionary"].includes(n)){const n={};return n[o.xmlCharKey]=r,n[u.a]={[t]:e},n}return r}(p,e,m,t.body,h);m===T.Sequence?t.body=se(c.j(r,a||s||l,e,p),{rootName:s||l,xmlCharKey:f}):n||(t.body=se(r,{rootName:s||l,xmlCharKey:f}))}else{if(m===T.String&&((null===(d=r.contentType)||void 0===d?void 0:d.match("text/plain"))||"text"===r.mediaType))return;n||(t.body=JSON.stringify(t.body))}}}catch(e){throw new Error(`Error "${e.message}" occurred in serializing the payload - ${JSON.stringify(l,void 0,"  ")}.`)}}else if(r.formDataParameters&&r.formDataParameters.length>0){t.formData={};for(const o of r.formDataParameters){const i=ft(e,n,o,r.serializer);if(null!=i){const e=o.mapper.serializedName||Q(o);t.formData[e]=r.serializer.serialize(o.mapper,i,Q(o),h)}}}}(this,i,e,t),void 0===i.streamResponseStatusCodes&&(i.streamResponseStatusCodes=function(e){const t=new Set;for(const n in e.responses){const r=e.responses[n];r.bodyMapper&&r.bodyMapper.type.name===T.Stream&&t.add(Number(n))}return t}(t));try{d=await this.sendRequest(i)}catch(e){p=e}p?(p.response&&(p.details=mt(p.response,t.responses[p.statusCode]||t.responses.default)),s=Promise.reject(p)):s=Promise.resolve(mt(d,t.responses[d.status]))}catch(e){s=Promise.reject(e)}const a=n;return a&&s.then(e=>a(null,e._response.parsedBody,e._response.request,e._response)).catch(e=>a(e)),s}}function pt(e,t){let n;return"string"==typeof e?n=e:(n=t(),"function"==typeof e&&(n=e(n))),n}function ht(e,t){const n=[];e.sendStreamingJson&&n.push({create:(e,t)=>new ct(e,t)});let r=void 0;if(e.userAgentOptions&&e.userAgentOptions.userAgentPrefix){const t=[];t.push(e.userAgentOptions.userAgentPrefix);const n=Ae();-1===t.indexOf(n)&&t.push(n),r=t.join(" ")}const o=Object.assign(Object.assign({},Xe),e.keepAliveOptions),i=Object.assign(Object.assign({},we),e.retryOptions),s=Object.assign(Object.assign({},ke),e.redirectOptions);c.f&&n.push(Ge(e.proxyOptions));const a=Object.assign(Object.assign({},de),e.deserializationOptions),u=Object.assign({},e.loggingOptions);return n.push(ot({userAgent:r}),Qe(o),Pe({value:r}),Re(),ce(a.expectedContentTypes),Je(),Be(),be(i.maxRetries,i.retryDelayInMs,i.maxRetryDelayInMs)),s.handleRedirects&&n.push(Ne(s.maxRetries)),t&&n.push(t),n.push(K(u)),c.f&&!1===e.decompressResponse&&n.push(at()),{httpClient:e.httpClient,requestPolicyFactories:n}}function ft(e,t,n,r){return function e(t,n,r,o,i){var s;let a;"string"==typeof r&&(r=[r]);const c=null===(s=n.options)||void 0===s?void 0:s.serializerOptions;if(Array.isArray(r)){if(r.length>0){if(o.isConstant)a=o.defaultValue;else{let e=gt(n,r);e.propertyFound||(e=gt(t,r));let i=!1;e.propertyFound||(i=o.required||"options"===r[0]&&2===r.length),a=i?o.defaultValue:e.propertyValue}const e=Z(r,o);i.serialize(o,a,e,c)}}else{o.required&&(a={});for(const s in r){const u=o.type.modelProperties[s],l=r[s],d=e(t,n,l,u,i),p=Z(l,u);i.serialize(u,d,p,c),null!=d&&(a||(a={}),a[s]=d)}}return a}(e,t,n.parameterPath,n.mapper,r)}function gt(e,t){const n={propertyFound:!1};let r=0;for(;r<t.length;++r){const n=t[r];if(null==e||!(n in e))break;e=e[n]}return r===t.length&&(n.propertyValue=e,n.propertyFound=!0),n}function mt(e,t){const n=e.parsedHeaders,r=t&&t.bodyMapper,o=t=>Object.defineProperty(t,"_response",{value:e});if(r){const t=r.type.name;if("Stream"===t)return o(Object.assign(Object.assign({},n),{blobBody:e.blobBody,readableStreamBody:e.readableStreamBody}));const i="Composite"===t&&r.type.modelProperties||{},s=Object.keys(i).some(e=>""===i[e].serializedName);if("Sequence"===t||s){const t=[...e.parsedBody||[]];for(const n of Object.keys(i))i[n].serializedName&&(t[n]=e.parsedBody[n]);if(n)for(const e of Object.keys(n))t[e]=n[e];return o(t),t}if("Composite"===t||"Dictionary"===t)return o(Object.assign(Object.assign({},n),e.parsedBody))}return r||"HEAD"===e.request.method||c.h(e.parsedBody)?o(Object.assign(Object.assign({},n),{body:e.parsedBody})):o(Object.assign(Object.assign({},n),e.parsedBody))}function yt(e){return Object(et.a)(e)}class vt{constructor(e=12e4){this.cachedToken=void 0,this.tokenRefreshBufferMs=e}setCachedToken(e){this.cachedToken=e}getCachedToken(){return this.cachedToken&&Date.now()+this.tokenRefreshBufferMs>=this.cachedToken.expiresOnTimestamp&&(this.cachedToken=void 0),this.cachedToken}}class bt{constructor(e,t,n=3e4){this.credential=e,this.scopes=t,this.requiredMillisecondsBeforeNewRefresh=n,this.lastCalled=0}isReady(){return!this.lastCalled||Date.now()-this.lastCalled>this.requiredMillisecondsBeforeNewRefresh}async getToken(e){this.lastCalled=Date.now();const t=await this.credential.getToken(this.scopes,e);return this.promise=void 0,t||void 0}refresh(e){return this.promise||(this.promise=this.getToken(e)),this.promise}}const Tt=ye.a.HeaderConstants;class wt{constructor(e,t,n="Basic"){if(this.authorizationScheme="Basic",null==e||"string"!=typeof e.valueOf())throw new Error("userName cannot be null or undefined and must be of type string.");if(null==t||"string"!=typeof t.valueOf())throw new Error("password cannot be null or undefined and must be of type string.");this.userName=e,this.password=t,this.authorizationScheme=n}signRequest(e){const t=`${this.userName}:${this.password}`,n=`${this.authorizationScheme} ${r=t,btoa(r)}`;var r;return e.headers||(e.headers=new i),e.headers.set(Tt.AUTHORIZATION,n),Promise.resolve(e)}}class Et{constructor(e){if(!e||e&&!e.inHeader&&!e.inQuery)throw new Error('options cannot be null or undefined. Either "inHeader" or "inQuery" property of the options object needs to be provided.');this.inHeader=e.inHeader,this.inQuery=e.inQuery}signRequest(e){if(!e)return Promise.reject(new Error('webResource cannot be null or undefined and must be of type "object".'));if(this.inHeader){e.headers||(e.headers=new i);for(const t in this.inHeader)e.headers.set(t,this.inHeader[t])}if(this.inQuery){if(!e.url)return Promise.reject(new Error("url cannot be null in the request object."));e.url.indexOf("?")<0&&(e.url+="?");for(const t in this.inQuery)e.url.endsWith("?")||(e.url+="&"),e.url+=`${t}=${this.inQuery[t]}`}return Promise.resolve(e)}}class St extends Et{constructor(e){if(!e||e&&"string"!=typeof e)throw new Error("topicKey cannot be null or undefined and must be of type string.");super({inHeader:{"aeg-sas-key":e}})}}n(198)},function(e,t,n){"use strict";var r,o=new Uint8Array(16);function i(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(o)}var s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var a=function(e){return"string"==typeof e&&s.test(e)},c=[],u=0;u<256;++u)c.push((u+256).toString(16).substr(1));var l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!a(n))throw TypeError("Stringified UUID is invalid");return n};t.a=function(e,t,n){var r=(e=e||{}).random||(e.rng||i)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return l(r)}},,,,,,function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return i}));var r=n(36),o=n(16);function i(t){return function(n,i){const s=Object(r.d)(),a=(null==i?void 0:i.tracingOptions)||{},c=Object.assign({kind:r.a.INTERNAL},a.spanOptions),u=t.packagePrefix?`${t.packagePrefix}.${n}`:n;let l;l=function(){var t;if(void 0===e)return!1;const n=null===(t=e.env.AZURE_TRACING_DISABLED)||void 0===t?void 0:t.toLowerCase();return"false"!==n&&"0"!==n&&Boolean(n)}()?o.c.wrapSpanContext(o.a):s.startSpan(u,c,a.tracingContext),t.namespace&&l.setAttribute("az.namespace",t.namespace);let d=a.spanOptions||{};l.isRecording()&&t.namespace&&(d=Object.assign(Object.assign({},a.spanOptions),{attributes:Object.assign(Object.assign({},c.attributes),{"az.namespace":t.namespace})}));const p=Object.assign(Object.assign({},a),{spanOptions:d,tracingContext:Object(r.f)(a.tracingContext||r.c.active(),l)});return{span:l,updatedOptions:Object.assign(Object.assign({},i),{tracingOptions:p})}}}}).call(this,n(35))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));function r(e){const t=[];if(e.traceId||t.push("traceId"),e.spanId||t.push("spanId"),t.length)return;const n=(e.traceFlags||0).toString(16),r=1===n.length?"0"+n:n;return`00-${e.traceId}-${e.spanId}-${r}`}},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(0),o=new WeakMap,i=new WeakMap,s=function(){function e(){this.onabort=null,o.set(this,[]),i.set(this,!1)}return Object.defineProperty(e.prototype,"aborted",{get:function(){if(!i.has(this))throw new TypeError("Expected `this` to be an instance of AbortSignal.");return i.get(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e,"none",{get:function(){return new e},enumerable:!0,configurable:!0}),e.prototype.addEventListener=function(e,t){if(!o.has(this))throw new TypeError("Expected `this` to be an instance of AbortSignal.");o.get(this).push(t)},e.prototype.removeEventListener=function(e,t){if(!o.has(this))throw new TypeError("Expected `this` to be an instance of AbortSignal.");var n=o.get(this),r=n.indexOf(t);r>-1&&n.splice(r,1)},e.prototype.dispatchEvent=function(e){throw new Error("This is a stub dispatchEvent implementation that should not be used.  It only exists for type-checking purposes.")},e}();function a(e){if(!e.aborted){e.onabort&&e.onabort.call(e);var t=o.get(e);t&&t.forEach((function(t){t.call(e,{type:"abort"})})),i.set(e,!0)}}var c=function(e){function t(t){var n=e.call(this,t)||this;return n.name="AbortError",n}return Object(r.e)(t,e),t}(Error);!function(){function e(e){var t=this;if(this._signal=new s,e){Array.isArray(e)||(e=arguments);for(var n=0,r=e;n<r.length;n++){var o=r[n];o.aborted?this.abort():o.addEventListener("abort",(function(){t.abort()}))}}}Object.defineProperty(e.prototype,"signal",{get:function(){return this._signal},enumerable:!0,configurable:!0}),e.prototype.abort=function(){a(this._signal)},e.timeout=function(e){var t=new s,n=setTimeout(a,e,t);return"function"==typeof n.unref&&n.unref(),t}}()}])}));