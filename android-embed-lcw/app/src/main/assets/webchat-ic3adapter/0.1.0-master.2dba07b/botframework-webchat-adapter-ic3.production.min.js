window.Microsoft=window.Microsoft||{},window.Microsoft.BotFramework=window.Microsoft.BotFramework||{},window.Microsoft.BotFramework.WebChat=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=37)}([function(e,t,n){"use strict";var r=n(2),o=n(46),i=n(13),s=n(48),c=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator,i=o.toSubscriber(e,t,n);if(r?r.call(i,this.source):i.add(this.source||!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.syncErrorThrown=!0,e.syncErrorValue=t,e.error(t)}},e.prototype.forEach=function(e,t){var n=this;if(t||(r.root.Rx&&r.root.Rx.config&&r.root.Rx.config.Promise?t=r.root.Rx.config.Promise:r.root.Promise&&(t=r.root.Promise)),!t)throw new Error("no Promise impl found");return new t((function(t,r){var o;o=n.subscribe((function(t){if(o)try{e(t)}catch(e){r(e),o.unsubscribe()}else e(t)}),r,t)}))},e.prototype._subscribe=function(e){return this.source.subscribe(e)},e.prototype[i.observable]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return 0===e.length?this:s.pipeFromArray(e)(this)},e.prototype.toPromise=function(e){var t=this;if(e||(r.root.Rx&&r.root.Rx.config&&r.root.Rx.config.Promise?e=r.root.Rx.config.Promise:r.root.Promise&&(e=r.root.Promise)),!e)throw new Error("no Promise impl found");return new e((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();t.Observable=c},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(19),i=n(3),s=n(21),c=n(12),a=function(e){function t(t,n,r){switch(e.call(this),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=s.empty;break;case 1:if(!t){this.destination=s.empty;break}if("object"==typeof t){if(l(t)){var o=t[c.rxSubscriber]();this.syncErrorThrowable=o.syncErrorThrowable,this.destination=o,o.add(this)}else this.syncErrorThrowable=!0,this.destination=new u(this,t);break}default:this.syncErrorThrowable=!0,this.destination=new u(this,t,n,r)}}return r(t,e),t.prototype[c.rxSubscriber]=function(){return this},t.create=function(e,n,r){var o=new t(e,n,r);return o.syncErrorThrowable=!1,o},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parent,t=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=e,this._parents=t,this},t}(i.Subscription);t.Subscriber=a;var u=function(e){function t(t,n,r,i){var c;e.call(this),this._parentSubscriber=t;var a=this;o.isFunction(n)?c=n:n&&(c=n.next,r=n.error,i=n.complete,n!==s.empty&&(a=Object.create(n),o.isFunction(a.unsubscribe)&&this.add(a.unsubscribe.bind(a)),a.unsubscribe=this.unsubscribe.bind(this))),this._context=a,this._next=c,this._error=r,this._complete=i}return r(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber;if(this._error)t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else{if(!t.syncErrorThrowable)throw this.unsubscribe(),e;t.syncErrorValue=e,t.syncErrorThrown=!0,this.unsubscribe()}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){throw this.unsubscribe(),e}},t.prototype.__tryOrSetError=function(e,t,n){try{t.call(this._context,n)}catch(t){return e.syncErrorValue=t,e.syncErrorThrown=!0,!0}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(a);function l(e){return e instanceof a||"syncErrorThrowable"in e&&e[c.rxSubscriber]}},function(e,t,n){"use strict";(function(e){var n="undefined"!=typeof window&&window,r="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,o=n||void 0!==e&&e||r;t.root=o,function(){if(!o)throw new Error("RxJS could not find any global context (window, self, global)")}()}).call(this,n(45))},function(e,t,n){"use strict";var r=n(5),o=n(20),i=n(19),s=n(11),c=n(6),a=n(47),u=function(){function e(e){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}var t;return e.prototype.unsubscribe=function(){var e,t=!1;if(!this.closed){var n=this._parent,u=this._parents,f=this._unsubscribe,p=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var h=-1,d=u?u.length:0;n;)n.remove(this),n=++h<d&&u[h]||null;if(i.isFunction(f))s.tryCatch(f).call(this)===c.errorObject&&(t=!0,e=e||(c.errorObject.e instanceof a.UnsubscriptionError?l(c.errorObject.e.errors):[c.errorObject.e]));if(r.isArray(p))for(h=-1,d=p.length;++h<d;){var b=p[h];if(o.isObject(b))if(s.tryCatch(b.unsubscribe).call(b)===c.errorObject){t=!0,e=e||[];var v=c.errorObject.e;v instanceof a.UnsubscriptionError?e=e.concat(l(v.errors)):e.push(v)}}if(t)throw new a.UnsubscriptionError(e)}},e.prototype.add=function(t){if(!t||t===e.EMPTY)return e.EMPTY;if(t===this)return this;var n=t;switch(typeof t){case"function":n=new e(t);case"object":if(n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if("function"!=typeof n._addParent){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(n),n._addParent(this),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.prototype._addParent=function(e){var t=this._parent,n=this._parents;t&&t!==e?n?-1===n.indexOf(e)&&n.push(e):this._parents=[e]:this._parent=e},e.EMPTY=((t=new e).closed=!0,t),e}();function l(e){return e.reduce((function(e,t){return e.concat(t instanceof a.UnsubscriptionError?t.errors:t)}),[])}t.Subscription=u},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(0),i=n(1),s=n(3),c=n(22),a=n(50),u=n(12),l=function(e){function t(t){e.call(this,t),this.destination=t}return r(t,e),t}(i.Subscriber);t.SubjectSubscriber=l;var f=function(e){function t(){e.call(this),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}return r(t,e),t.prototype[u.rxSubscriber]=function(){return new l(this)},t.prototype.lift=function(e){var t=new p(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new c.ObjectUnsubscribedError;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),o=0;o<n;o++)r[o].next(e)},t.prototype.error=function(e){if(this.closed)throw new c.ObjectUnsubscribedError;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),o=0;o<n;o++)r[o].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new c.ObjectUnsubscribedError;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new c.ObjectUnsubscribedError;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new c.ObjectUnsubscribedError;return this.hasError?(e.error(this.thrownError),s.Subscription.EMPTY):this.isStopped?(e.complete(),s.Subscription.EMPTY):(this.observers.push(e),new a.SubjectSubscription(this,e))},t.prototype.asObservable=function(){var e=new o.Observable;return e.source=this,e},t.create=function(e,t){return new p(e,t)},t}(o.Observable);t.Subject=f;var p=function(e){function t(t,n){e.call(this),this.destination=t,this.source=n}return r(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):s.Subscription.EMPTY},t}(f);t.AnonymousSubject=p},function(e,t,n){"use strict";t.isArray=Array.isArray||function(e){return e&&"number"==typeof e.length}},function(e,t,n){"use strict";t.errorObject={e:{}}},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.notifyNext=function(e,t,n,r,o){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(n(1).Subscriber);t.OuterSubscriber=o},function(e,t,n){"use strict";var r=n(2),o=n(23),i=n(24),s=n(20),c=n(0),a=n(14),u=n(54),l=n(13);t.subscribeToResult=function(e,t,n,f){var p=new u.InnerSubscriber(e,n,f);if(p.closed)return null;if(t instanceof c.Observable)return t._isScalar?(p.next(t.value),p.complete(),null):(p.syncErrorThrowable=!0,t.subscribe(p));if(o.isArrayLike(t)){for(var h=0,d=t.length;h<d&&!p.closed;h++)p.next(t[h]);p.closed||p.complete()}else{if(i.isPromise(t))return t.then((function(e){p.closed||(p.next(e),p.complete())}),(function(e){return p.error(e)})).then(null,(function(e){r.root.setTimeout((function(){throw e}))})),p;if(t&&"function"==typeof t[a.iterator])for(var b=t[a.iterator]();;){var v=b.next();if(v.done){p.complete();break}if(p.next(v.value),p.closed)break}else if(t&&"function"==typeof t[l.observable]){var y=t[l.observable]();if("function"==typeof y.subscribe)return y.subscribe(new u.InnerSubscriber(e,n,f));p.error(new TypeError("Provided object does not correctly implement Symbol.observable"))}else{var g="You provided "+(s.isObject(t)?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";p.error(new TypeError(g))}}return null}},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=function(e){function t(t){e.call(this),this.scheduler=t}return r(t,e),t.create=function(e){return new t(e)},t.dispatch=function(e){e.subscriber.complete()},t.prototype._subscribe=function(e){var n=this.scheduler;if(n)return n.schedule(t.dispatch,0,{subscriber:e});e.complete()},t}(n(0).Observable);t.EmptyObservable=o},function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";var r,o=n(6);function i(){try{return r.apply(this,arguments)}catch(e){return o.errorObject.e=e,o.errorObject}}t.tryCatch=function(e){return r=e,i}},function(e,t,n){"use strict";var r=n(2).root.Symbol;t.rxSubscriber="function"==typeof r&&"function"==typeof r.for?r.for("rxSubscriber"):"@@rxSubscriber",t.$$rxSubscriber=t.rxSubscriber},function(e,t,n){"use strict";var r=n(2);function o(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}t.getSymbolObservable=o,t.observable=o(r.root),t.$$observable=t.observable},function(e,t,n){"use strict";var r=n(2);function o(e){var t=e.Symbol;if("function"==typeof t)return t.iterator||(t.iterator=t("iterator polyfill")),t.iterator;var n=e.Set;if(n&&"function"==typeof(new n)["@@iterator"])return"@@iterator";var r=e.Map;if(r)for(var o=Object.getOwnPropertyNames(r.prototype),i=0;i<o.length;++i){var s=o[i];if("entries"!==s&&"size"!==s&&r.prototype[s]===r.prototype.entries)return s}return"@@iterator"}t.symbolIteratorPonyfill=o,t.iterator=o(r.root),t.$$iterator=t.iterator},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(0),i=n(25),s=n(9),c=n(58),a=function(e){function t(t,n){e.call(this),this.array=t,this.scheduler=n,n||1!==t.length||(this._isScalar=!0,this.value=t[0])}return r(t,e),t.create=function(e,n){return new t(e,n)},t.of=function(){for(var e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];var r=e[e.length-1];c.isScheduler(r)?e.pop():r=null;var o=e.length;return o>1?new t(e,r):1===o?new i.ScalarObservable(e[0],r):new s.EmptyObservable(r)},t.dispatch=function(e){var t=e.array,n=e.index,r=e.count,o=e.subscriber;n>=r?o.complete():(o.next(t[n]),o.closed||(e.index=n+1,this.schedule(e)))},t.prototype._subscribe=function(e){var n=this.array,r=n.length,o=this.scheduler;if(o)return o.schedule(t.dispatch,0,{array:n,index:0,count:r,subscriber:e});for(var i=0;i<r&&!e.closed;i++)e.next(n[i]);e.complete()},t}(o.Observable);t.ArrayObservable=a},function(e,t,n){"use strict";var r=n(64),o=n(66);t.async=new o.AsyncScheduler(r.AsyncAction)},function(e,t,n){"use strict";function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.MessageQueueConstants=t.HTMLConstants=t.Constants=void 0;var s=function e(){o(this,e)};t.Constants=s,i(s,"ic3ChannelId","ic3"),i(s,"attachments","attachments"),i(s,"imageTypes",["gif","jpg","jpeg","png","jiff","bmp"]),i(s,"audioTypes",["mp3","aac","aiff","alac","flac","mp2","pcm","wav","wma"]),i(s,"videoTypes",["mp4","avchd","avi","flv","mpe","mpeg","mpg","mpv","m4p","m4v","mov","qt","swf","webm","wmv"]),i(s,"supportTypes",[].concat(r(s.imageTypes),r(s.audioTypes),r(s.videoTypes))),i(s,"typingIndicatorPayload",'{"isTyping":true}'),i(s,"notificationIdMessage","ic3adapter_message"),i(s,"notificationIdConnection","ic3adapter_connection"),i(s,"notificationIdInternetConnection","internet connection"),i(s,"AdaptiveCardActionSubmit","Action.Submit"),i(s,"AdaptiveCardActionTypeMap",{imback:"imBack",postback:"postBack",messageback:"messageBack"});var c=function e(){o(this,e)};t.HTMLConstants=c,i(c,"contentURIObject","URIObject"),i(c,"contentTextXml","text/xml"),i(c,"tagParseError","parseerror"),i(c,"tagSwift","Swift"),i(c,"attributeB64","b64"),i(c,"typeMessageCard","message/card"),i(c,"typeImage","image"),i(c,"typeAudio","audio"),i(c,"typeVideo","video"),i(c,"typeApplicationOctetStream","application/octet-stream"),i(c,"status_201",201);var a=function e(){o(this,e)};t.MessageQueueConstants=a,i(a,"defaultjobExecutionInterval",1500),i(a,"connectionTestUrl","https://ocsdk-prod.azureedge.net/public/connecttest.txt"),i(a,"connectionTestUrlText","Omnichannel Connect Test")},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(4),i=n(22),s=function(e){function t(t){e.call(this),this._value=t}return r(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new i.ObjectUnsubscribedError;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(o.Subject);t.BehaviorSubject=s},function(e,t,n){"use strict";t.isFunction=function(e){return"function"==typeof e}},function(e,t,n){"use strict";t.isObject=function(e){return null!=e&&"object"==typeof e}},function(e,t,n){"use strict";t.empty={closed:!0,next:function(e){},error:function(e){throw e},complete:function(){}}},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=function(e){function t(){var t=e.call(this,"object unsubscribed");this.name=t.name="ObjectUnsubscribedError",this.stack=t.stack,this.message=t.message}return r(t,e),t}(Error);t.ObjectUnsubscribedError=o},function(e,t,n){"use strict";t.isArrayLike=function(e){return e&&"number"==typeof e.length}},function(e,t,n){"use strict";t.isPromise=function(e){return e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=function(e){function t(t,n){e.call(this),this.value=t,this.scheduler=n,this._isScalar=!0,n&&(this._isScalar=!1)}return r(t,e),t.create=function(e,n){return new t(e,n)},t.dispatch=function(e){var t=e.done,n=e.value,r=e.subscriber;t?r.complete():(r.next(n),r.closed||(e.done=!0,this.schedule(e)))},t.prototype._subscribe=function(e){var n=this.value,r=this.scheduler;if(r)return r.schedule(t.dispatch,0,{done:!1,value:n,subscriber:e});e.next(n),e.closed||e.complete()},t}(n(0).Observable);t.ScalarObservable=o},function(e,t,n){"use strict";var r=n(0),o=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){switch(this.kind){case"N":return r.Observable.of(this.value);case"E":return r.Observable.throw(this.error);case"C":return r.Observable.empty()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}();t.Notification=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(1);t.map=function(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new i(e,t))}};var i=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.project,this.thisArg))},e}();t.MapOperator=i;var s=function(e){function t(t,n,r){e.call(this,t),this.project=n,this.count=0,this.thisArg=r||this}return r(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(o.Subscriber)},function(e,t,n){"use strict";var r=n(0),o=n(84);r.Observable.prototype.share=o.share},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(1);t.refCount=function(){return function(e){return e.lift(new i(e))}};var i=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;n._refCount++;var r=new s(e,n),o=t.subscribe(r);return r.closed||(r.connection=n.connect()),o},e}(),s=function(e){function t(t,n){e.call(this,t),this.connectable=n}return r(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null},t}(o.Subscriber)},function(e,t,n){"use strict";var r=n(0),o=n(108);r.Observable.of=o.of},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,o=(r=n(118))&&r.__esModule?r:{default:r};function i(e,t,n,r,o,i,s){try{var c=e[i](s),a=c.value}catch(e){return void n(e)}c.done?t(a):Promise.resolve(a).then(r,o)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r,c,a;return t=e,n=null,r=[{key:"initSdk",value:(c=regeneratorRuntime.mark((function t(n,r,i,s){var c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e._sdk&&(console.info("IC3 SDK re-initialization"),e._sdk=null),e._sessionInfo=s,c=r||null){t.next=10;break}return t.next=7,(0,o.default)(n,i);case 7:return c=t.sent,t.next=10,c.initialize(s);case 10:e._sdk=c,t.next=18;break;case 13:throw t.prev=13,t.t0=t.catch(0),console.error("IC3 SDK init failed",t.t0),e._sdk=null,t.t0;case 18:return t.abrupt("return",e._sdk);case 19:case"end":return t.stop()}}),t,null,[[0,13]])})),a=function(){var e=this,t=arguments;return new Promise((function(n,r){var o=c.apply(e,t);function s(e){i(o,n,r,s,a,"next",e)}function a(e){i(o,n,r,s,a,"throw",e)}s(void 0)}))},function(e,t,n,r){return a.apply(this,arguments)})},{key:"getSdk",value:function(){return e._sdk}},{key:"reInitialize",value:function(){return e._sdk?e._sdk.initialize(e._sessionInfo):Promise.reject()}},{key:"setSessionInfo",value:function(t){e._sessionInfo=t}},{key:"getSessionInfo",value:function(){return e._sessionInfo}},{key:"disposeSdk",value:function(){var t;null===(t=e._sdk)||void 0===t||t.dispose()}}],n&&s(t.prototype,n),r&&s(t,r),e}();t.default=a,c(a,"_sdk",null),c(a,"_sessionInfo",void 0)},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.DirectLineSenderRole=void 0,t.DirectLineSenderRole=r,function(e){e.User="user",e.Bot="bot",e.Channel="channel"}(r||(t.DirectLineSenderRole=r={}))},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationLevel=void 0,t.NotificationLevel=r,function(e){e.Success="success",e.Info="info",e.Warning="warn",e.Error="error"}(r||(t.NotificationLevel=r={}))},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.MessageTag=void 0,t.MessageTag=r,function(e){e.System="system",e.Private="private",e.History="history"}(r||(t.MessageTag=r={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==s(e)&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var c=r?Object.getOwnPropertyDescriptor(e,o):null;c&&(c.get||c.set)?Object.defineProperty(n,o,c):n[o]=e[o]}n.default=e,t&&t.set(e,n);return n}(n(121)),o=n(17);function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n,r,o,i,s){try{var c=e[i](s),a=c.value}catch(e){return void n(e)}c.done?t(a):Promise.resolve(a).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function s(e){c(i,r,o,s,a,"next",e)}function a(e){c(i,r,o,s,a,"throw",e)}s(void 0)}))}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),e}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){var t,n,r;function i(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=function(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?l(e):t}(this,u(i).call(this))).handleOnline=e.handleOnline.bind(l(e)),e.handleOffline=e.handleOffline.bind(l(e)),window.addEventListener("online",e.handleOnline),window.addEventListener("offline",e.handleOffline),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(i,e),p(i,[{key:"raiseCustomEvent",value:function(e,t){var n=t?{detail:t}:void 0,r=null;try{r=new CustomEvent(e)}catch(t){(r=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,n)}this.dispatchEvent(r)}}],[{key:"isInternetConnected",value:(t=a(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(o.MessageQueueConstants.connectionTestUrl,{cache:"no-cache"});case 3:if(!(t=e.sent).ok){e.next=11;break}return e.next=8,t.text();case 8:if(e.sent!==o.MessageQueueConstants.connectionTestUrlText){e.next=11;break}return e.abrupt("return",!0);case 11:e.next=15;break;case 13:e.prev=13,e.t0=e.catch(0);case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[0,13]])}))),function(){return t.apply(this,arguments)})}]),p(i,[{key:"end",value:function(){window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline)}},{key:"handleOnline",value:(r=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.isInternetConnected();case 2:if(!e.sent){e.next=4;break}this.raiseCustomEvent("online");case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"handleOffline",value:(n=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.isInternetConnected();case 2:if(e.sent){e.next=4;break}this.raiseCustomEvent("offline");case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]),i}(r.default);t.default=d,(0,r.defineEventAttribute)(d.prototype,"online"),(0,r.defineEventAttribute)(d.prototype,"offline")},function(e,t,n){"use strict";var r,o;Object.defineProperty(t,"__esModule",{value:!0}),t.HostType=t.ProtocolType=void 0,t.ProtocolType=r,function(e){e[e.IC3V1SDK=0]="IC3V1SDK",e[e.IC3V2SDK=1]="IC3V2SDK",e[e.MockIC3SDK=2]="MockIC3SDK"}(r||(t.ProtocolType=r={})),t.HostType=o,function(e){e[e.IFrame=0]="IFrame",e[e.Page=1]="Page"}(o||(t.HostType=o={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"IC3Adapter",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"IC3SDKProvider",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"INotification",{enumerable:!0,get:function(){return i.INotification}}),Object.defineProperty(t,"NotificationLevel",{enumerable:!0,get:function(){return s.NotificationLevel}}),Object.defineProperty(t,"HostType",{enumerable:!0,get:function(){return c.HostType}}),Object.defineProperty(t,"ProtocolType",{enumerable:!0,get:function(){return c.ProtocolType}});var r=a(n(38)),o=a(n(31)),i=n(124),s=n(33),c=n(36);function a(e){return e&&e.__esModule?e:{default:e}}if("undefined"!=typeof document){var u=document.createElement("meta");u.setAttribute("name","botframework-webchat-adapter-ic3"),u.setAttribute("content","version=".concat("0.1.0-master.2dba07b")),document.head.appendChild(u)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(39),o=n(18);n(28),n(30);var i=n(0),s=y(n(31)),c=n(17),a=n(119),u=n(32),l=n(33),f=n(120),p=y(n(35)),h=y(n(122)),d=n(36),b=n(34),v=n(123);function y(e){return e&&e.__esModule?e:{default:e}}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){S(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w(e,t,n,r,o,i,s){try{var c=e[i](s),a=c.value}catch(e){return void n(e)}c.done?t(a):Promise.resolve(a).then(r,o)}function O(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function s(e){w(i,r,o,s,c,"next",e)}function c(e){w(i,r,o,s,c,"throw",e)}s(void 0)}))}}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _=function(){function e(t,n){var s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),S(this,"userDisplayName",void 0),S(this,"conversationBotId",""),S(this,"currentUserId",""),S(this,"activityObserver",void 0),S(this,"conversation",void 0),S(this,"callbackOnNotification",(function(e){return console.log(e.message)})),S(this,"callbackOnThreadNotFound",(function(){})),S(this,"connectivityManager",new p.default),S(this,"hasDisconnected",!1),S(this,"messagequeue",void 0),S(this,"agentMessagesSeen",new Set),S(this,"sendingMessagesMap",new Map),S(this,"featureConfig",{ShouldEnableInlinePlaying:!0}),S(this,"logger",void 0),S(this,"triggerReload",!1),S(this,"reloadTimer",void 0),S(this,"missingAckMessageReportCount",0),S(this,"activity$",void 0),S(this,"connectionStatus$",new o.BehaviorSubject(r.ConnectionStatus.Uninitialized)),S(this,"registerCallbackOnNotification",(function(e){s.callbackOnNotification=e})),S(this,"registerCallbackOnThreadNotFound",(function(e){s.callbackOnThreadNotFound=e})),this.conversation=t.conversation,this.currentUserId=t.userId,this.userDisplayName=t.userDisplayName,this.reloadMessages=this.reloadMessages.bind(this),t.callbackOnNotification&&this.registerCallbackOnNotification(t.callbackOnNotification),t.callbackOnThreadNotFound&&this.registerCallbackOnThreadNotFound(t.callbackOnThreadNotFound),t.featureConfig&&(this.featureConfig=t.featureConfig),n?this.logger=n:n={logClientSdkTelemetryEvent:function(e,t){console.log(t)}},this.activity$=new i.Observable((function(e){s.activityObserver=e,Promise.resolve().then(O(regeneratorRuntime.mark((function e(){var o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.connectionStatus$.next(r.ConnectionStatus.Connecting),e.prev=1,s.conversation){e.next=6;break}return e.next=5,s.createConversation(t,n);case 5:s.conversation=e.sent;case 6:return e.next=8,f.Utilities.getPlatformBotId(s.conversation);case 8:s.conversationBotId=e.sent,s.connectionStatus$&&s.connectionStatus$.next(r.ConnectionStatus.Online),s.conversation.registerOnNewMessage((function(e){return s.onNewMessage(e)})).then(O(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s.conversation){e.next=5;break}return e.next=3,s.conversation.getMessages();case 3:1===(t=e.sent).length?((n=t[0]).tags=n.tags||[],s.onNewMessage(n)):t.forEach((function(e){e.tags=e.tags||[],e.tags.push(b.MessageTag.History),s.onNewMessage(e)}));case 5:case"end":return e.stop()}}),e)})))),s.conversation.registerOnThreadUpdate((function(e){return s.onThreadUpdate(e)})),s.conversation.registerOnIC3ErrorRecovery((function(e){return s.onIC3Error(e)})),e.next=20;break;case 15:e.prev=15,e.t0=e.catch(1),s.connectionStatus$.next(r.ConnectionStatus.FailedToConnect),console.error(e.t0),null===(o=s.logger)||void 0===o||o.logClientSdkTelemetryEvent(Microsoft.CRM.Omnichannel.IC3Client.Model.LogLevel.ERROR,{Event:"Failed to connect to conversation",Description:f.Utilities.stringifyHelper({ConversationId:null===(i=s.conversation)||void 0===i?void 0:i.id}),ExceptionDetails:e.t0});case 20:case"end":return e.stop()}}),e,null,[[1,15]])}))))})).share(),this.messagequeue=new h.default,this.connectivityManager.ononline=function(){s.internetConnectionChangeHandler()},this.connectivityManager.onoffline=function(){s.internetConnectionChangeHandler()},this.reloadTimer=window.setInterval((function(){s.triggerReload&&s.conversation&&s.reloadMessages()}),3e3)}var t,n,y,g,w,_,C,k,M,T;return t=e,n=[{key:"reloadMessages",value:(T=O(regeneratorRuntime.mark((function e(){var t,n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.conversation.getMessages();case 3:e.sent.forEach((function(e){var t=e.clientmessageid,n=e.messageType,o=e.deliveryMode,i=n===Microsoft.CRM.Omnichannel.IC3Client.Model.MessageType.UserMessage&&o===Microsoft.CRM.Omnichannel.IC3Client.Model.DeliveryMode.Bridged;t&&i&&!r.agentMessagesSeen.has(t)&&(r.onNewMessage(e),r.agentMessagesSeen.add(t))})),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Failed to reload messages: ",e.t0),null===(t=this.logger)||void 0===t||t.logClientSdkTelemetryEvent(Microsoft.CRM.Omnichannel.IC3Client.Model.LogLevel.ERROR,{Event:"Failed to reload messages:",Description:f.Utilities.stringifyHelper({ConversationId:null===(n=this.conversation)||void 0===n?void 0:n.id}),ExceptionDetails:e.t0});case 11:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return T.apply(this,arguments)})},{key:"end",value:function(){this.conversation&&this.conversation.disconnect(),this.connectivityManager.end(),this.messagequeue.end(),s.default.disposeSdk(),(0===this.reloadTimer||this.reloadTimer)&&clearInterval(this.reloadTimer)}},{key:"getSessionId",value:function(){return i.Observable.of("")}},{key:"updateChatToken",value:(M=O(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.default.getSessionInfo(),n&&(r.regionGtms=n),r.token=t,s.default.setSessionInfo(r),e.next=6,s.default.reInitialize();case 6:case"end":return e.stop()}}),e)}))),function(e,t){return M.apply(this,arguments)})},{key:"processJob",value:function(e,t){var n;this.isPostActivityRetry(e)&&this.messagequeue.remove(e.previousClientActivityID),n={id:e.channelData.clientActivityID,run:t},this.messagequeue.add(n)}},{key:"isPostActivityRetry",value:function(e){return e.previousClientActivityID}},{key:"postActivity",value:function(t){var n=this;if(!this.conversation)return i.Observable.of("");if(t=m({},t,{id:f.Utilities.getMessageId()}),this.internetConnectionChangeHandler(),t.type===a.DirectLineMessageType.Typing){var r={imdisplayname:this.userDisplayName||t.from.name||""};this.conversation.indicateTypingStatus(Microsoft.CRM.Omnichannel.IC3Client.Model.TypingStatus.Typing,r),this.conversationBotId&&!f.Utilities.isInternalActivity(t)&&this.conversation.sendMessageToBot(this.conversationBotId,{payload:c.Constants.typingIndicatorPayload})}else if(t.type===a.DirectLineMessageType.Message){var o=t,s=o.attachments||[];if(s&&s.length)this.processJob(t,(function(){return Promise.all(s.map(function(){var t=O(regeneratorRuntime.mark((function t(r){var i,c,u,l,p,h,d,b,v,y,g,w,O,x,_;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,c=r.contentType,u=r.contentUrl,l=r.name,t.next=4,fetch(u);case 4:return p=t.sent,t.next=7,p.blob();case 7:return h=t.sent,(d=new Blob([h],{type:c})).name=l||"",d.lastModified=Date.now(),d.lastModifiedDate=(new Date).toISOString(),r.blob=d,t.next=15,null===(i=n.conversation)||void 0===i?void 0:i.uploadFile(d);case 15:if(b=t.sent,v=s.reduce((function(e,t){return m({},e,S({},t.name||"",t.contentUrl))}),{}),o=m({},o,{type:a.DirectLineMessageType.Message,channelData:m({},o.channelData,{middlewareData:v})}),y=Date.now().toString(),n.sendingMessagesMap.set(y,o),!b){t.next=25;break}return t.next=23,null===(g=n.conversation)||void 0===g?void 0:g.sendFileMessage(b,n.directLineActivityToIC3Message(o,y));case 23:w=t.sent,e.shouldAckDeliveredMessage(w,n.sendingMessagesMap)&&(null===(O=n.logger)||void 0===O||O.logClientSdkTelemetryEvent(Microsoft.CRM.Omnichannel.IC3Client.Model.LogLevel.DEBUG,{Event:"Ack sendFileMessage",Description:f.Utilities.stringifyHelper(w)}),_=n.sendingMessagesMap.get(y),null===(x=n.activityObserver)||void 0===x||x.next(m({},_)));case 25:t.next=30;break;case 27:t.prev=27,t.t0=t.catch(0),console.warn("[IC3Adapter] Error sending file",t.t0);case 30:case"end":return t.stop()}}),t,null,[[0,27]])})));return function(e){return t.apply(this,arguments)}}()))}));else{var u=function(){var t=O(regeneratorRuntime.mark((function t(){var r,i,s,c,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i=Date.now().toString(),n.sendingMessagesMap.set(i,o),t.next=5,null===(r=n.conversation)||void 0===r?void 0:r.sendMessage(n.directLineActivityToIC3Message(o,i));case 5:s=t.sent,e.shouldAckDeliveredMessage(s,n.sendingMessagesMap)&&(n.logger.logClientSdkTelemetryEvent(Microsoft.CRM.Omnichannel.IC3Client.Model.LogLevel.DEBUG,{Event:"Ack sendMessage",Description:f.Utilities.stringifyHelper(s)}),a=n.sendingMessagesMap.get(i),null===(c=n.activityObserver)||void 0===c||c.next(m({},a))),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),console.warn("[IC3Adapter] Error sending message",t.t0);case 12:case 13:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(){return t.apply(this,arguments)}}();this.processJob(t,u)}}return i.Observable.of(t.id||"")}},{key:"callNotificationCallback",value:function(e,t,n){var r={id:e,message:t,level:n};this.callbackOnNotification&&this.callbackOnNotification(r)}},{key:"callThreadNotFoundCallback",value:function(){this.callbackOnThreadNotFound&&this.callbackOnThreadNotFound()}},{key:"internetConnectionChangeHandler",value:(k=O(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.default.isInternetConnected();case 2:if((t=e.sent)||this.hasDisconnected){e.next=7;break}return this.callNotificationCallback(c.Constants.notificationIdInternetConnection,"",l.NotificationLevel.Error),this.hasDisconnected=!0,e.abrupt("return");case 7:this.hasDisconnected&&t&&s.default.reInitialize().then(O(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.callNotificationCallback(c.Constants.notificationIdInternetConnection,"",l.NotificationLevel.Success),e.next=3,n.reloadMessages();case 3:n.hasDisconnected=!1;case 4:case"end":return e.stop()}}),e)})))).catch((function(e){var t,r;console.error("IC3 Client is not initialized:",e),null===(t=n.logger)||void 0===t||t.logClientSdkTelemetryEvent(Microsoft.CRM.Omnichannel.IC3Client.Model.LogLevel.ERROR,{Event:"IC3 Client is not initialized",Description:f.Utilities.stringifyHelper({ConversationId:null===(r=n.conversation)||void 0===r?void 0:r.id}),ExceptionDetails:e})}));case 8:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"createConversation",value:(C=O(regeneratorRuntime.mark((function e(t,n){var r,o,i,c,a,u,l,f,p,h,b=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.chatToken){e.next=2;break}throw new Error("chatToken option is not initialized");case 2:return a=t.chatToken,u=null!==(r=t.hostType)&&void 0!==r?r:d.HostType.IFrame,l=null!==(o=t.protocolType)&&void 0!==o?o:d.ProtocolType.IC3V1SDK,f=null===(i=t.visitor)||void 0===i||i,p=null===(c=t.sendHeartBeat)||void 0===c||c,e.next=9,s.default.initSdk(t&&t.sdkURL,t&&t.sdk,{hostType:u,protocolType:l,logger:n},{regionGtms:a.regionGTMS,token:a.token,visitor:f});case 9:return(h=e.sent).registerOnIC3FatalError((function(e){(null==e?void 0:e.errorCode)===v.IC3ErrorCode.ThreadNotFound||(null==e?void 0:e.errorCode)===v.IC3ErrorCode.ThreadNotFound.toString()||(null==e?void 0:e.errorCode)===v.IC3ErrorCode.InsufficientPrivileges||(null==e?void 0:e.errorCode)===v.IC3ErrorCode.InsufficientPrivileges.toString()?b.callThreadNotFoundCallback():(null==e?void 0:e.errorCode)!==v.CustomErrorCode.InvalidPollResult&&(null==e?void 0:e.errorCode)!==v.CustomErrorCode.InvalidPollResult.toString()||(b.triggerReload=!0,b.missingAckMessageReportCount++,b.missingAckMessageReportCount>5&&(s.default.reInitialize(),b.missingAckMessageReportCount=0))})),e.next=13,h.joinConversation(a.chatId,p);case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e)}))),function(e,t){return C.apply(this,arguments)})},{key:"onNewMessage",value:(_=O(regeneratorRuntime.mark((function e(t){var n,r,o,i,s,a,l,p,h,d,b,v,y,g,w,O;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.conversation&&this.activityObserver){e.next=2;break}return e.abrupt("return");case 2:if(n=t.clientmessageid,r=t.messageType,o=t.timestamp,i=t.resourceType,s=r===Microsoft.CRM.Omnichannel.IC3Client.Model.MessageType.UserMessage,a=i===Microsoft.CRM.Omnichannel.IC3Client.Model.ResourceType.MessageUpdate,!(s&&n&&this.agentMessagesSeen.has(n))||a){e.next=7;break}return e.abrupt("return");case 7:if(n&&this.agentMessagesSeen.add(n),!(l=t.fileMetadata)){e.next=19;break}return h=l.type,e.next=13,this.conversation.downloadFile(l);case 13:d=e.sent,b=c.HTMLConstants.typeApplicationOctetStream,c.Constants.imageTypes.includes(h)?b="".concat(c.HTMLConstants.typeImage,"/").concat(h):c.Constants.audioTypes.includes(h)&&this.featureConfig.ShouldEnableInlinePlaying?b="".concat(c.HTMLConstants.typeAudio,"/").concat(h):c.Constants.videoTypes.includes(h)&&this.featureConfig.ShouldEnableInlinePlaying&&(b="".concat(c.HTMLConstants.typeVideo,"/").concat(h)),v=URL.createObjectURL(d),y=c.Constants.supportTypes.includes(h)?v:void 0,p=[m({},l,{contentType:b,contentUrl:v,thumbnailUrl:y,tempContentUrl:v,blob:d})];case 19:if(!(s&&n&&o&&f.Utilities.getDirectLineSenderType(t,this.currentUserId)===u.DirectLineSenderRole.User&&this.sendingMessagesMap.has(n))){e.next=24;break}return w=this.sendingMessagesMap.get(n),null===(g=this.activityObserver)||void 0===g||g.next(m({},w,{timestamp:o.toISOString(),attachments:p})),this.sendingMessagesMap.delete(n),e.abrupt("return");case 24:(O=this.ic3MessageToDirectLineActivity(this.conversation.id,t,p))&&this.activityObserver.next(O);case 26:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)})},{key:"onThreadUpdate",value:(w=O(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.conversation&&this.activityObserver){e.next=2;break}return e.abrupt("return");case 2:(n=this.ic3ThreadToDirectLineActivity(this.conversation.id,t))&&this.activityObserver.next(n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"onIC3Error",value:(g=O(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.conversation&&this.activityObserver){e.next=2;break}return e.abrupt("return");case 2:return(null==t?void 0:t.errorCode)===v.CustomErrorCode.InvalidPollResult&&(this.missingAckMessageReportCount=0,this.triggerReload=!1),e.prev=3,e.next=6,this.conversation.getMessages();case 6:e.sent.forEach((function(e){var t=e.clientmessageid,r=e.messageType,o=e.deliveryMode,i=r===Microsoft.CRM.Omnichannel.IC3Client.Model.MessageType.UserMessage&&o===Microsoft.CRM.Omnichannel.IC3Client.Model.DeliveryMode.Bridged;t&&i&&!n.agentMessagesSeen.has(t)&&(n.onNewMessage(e),n.agentMessagesSeen.add(t))})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.warn("[OnIC3ErrorRecovery] Rehydrating messages on IC3Error failed.");case 13:case"end":return e.stop()}}),e,this,[[3,10]])}))),function(e){return g.apply(this,arguments)})},{key:"fetchSuggestedActions",value:function(e){if(!(f.Utilities.isNullOrUndefined(e)||f.Utilities.isNullOrUndefined(e.suggestedActions)||e.suggestedActions instanceof String)){var t=e.suggestedActions.actions;if(!(f.Utilities.isNullOrUndefined(t)||!Array.isArray(t)||t.length<=0))return{actions:t}}}},{key:"processAdaptiveCardAttachments",value:function(e){if(e&&Array.isArray(e)&&e.length>0)for(var t=0;t<e.length;t++){var n=e[t],r=n.content,o=n.content.buttons;if(r&&o&&Array.isArray(o)&&o.length>0)for(var i=0;i<o.length;i++)if(o[i]&&o[i].type){var s=o[i].type;e[t].content.buttons[i].type=c.Constants.AdaptiveCardActionTypeMap[s.toLowerCase()]}var a=e[t].content.actions;if(r&&a&&Array.isArray(a)&&a.length>0)for(var u=0;u<a.length;u++){var l=a[u];l&&l.type&&l.type===c.Constants.AdaptiveCardActionSubmit&&f.Utilities.isNullOrUndefined(l.data)&&(e[t].content.actions[u].data={})}}return e}},{key:"b64DecodeUnicode",value:function(e){return decodeURIComponent(atob(e).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))}},{key:"ic3MessageToDirectLineActivity",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=t.messageid,o=t.clientmessageid,i=t.content,s=t.messageType,l=t.sender,p=l.displayName,h=l.id,d=t.timestamp,b=t.tags,v=t.properties,y=f.Utilities.getMessageId(),g=f.Utilities.getDirectLineSenderType(t,this.currentUserId),m=p;if(g===u.DirectLineSenderRole.User&&this.userDisplayName&&(m=this.userDisplayName),s===Microsoft.CRM.Omnichannel.IC3Client.Model.MessageType.Typing)return{channelId:c.Constants.ic3ChannelId,conversation:{id:e},from:{id:h,name:m,role:g},id:y,timestamp:d.toISOString(),type:a.DirectLineMessageType.Typing};if(s===Microsoft.CRM.Omnichannel.IC3Client.Model.MessageType.UserMessage){var w={attachments:n,channelId:c.Constants.ic3ChannelId,channelData:{tags:b,clientmessageid:o,messageid:r},conversation:{id:e},from:{id:h,name:m,role:g},id:y,text:i,timestamp:d.toISOString(),type:a.DirectLineMessageType.Message,suggestedActions:this.fetchSuggestedActions(v)};if(i&&i.includes(c.HTMLConstants.contentURIObject)){var O=new DOMParser,x=O.parseFromString(i,c.HTMLConstants.contentTextXml);if(x.getElementsByTagName(c.HTMLConstants.tagParseError).length>0)return console.warn("[AdaptiveCard] Unable to parse XML"),w;if(x.documentElement.nodeName!==c.HTMLConstants.contentURIObject)return console.warn("[AdaptiveCard] Wrong XML schema"),w;var S=x.getElementsByTagName(c.HTMLConstants.tagSwift)[0],_=S.getAttribute(c.HTMLConstants.attributeB64),C=this.b64DecodeUnicode(_);if(!C)return console.warn("[AdaptiveCard] Data is empty"),w;var k=JSON.parse(C),M=k.type;if(!M.includes(c.HTMLConstants.typeMessageCard))return w;if(!k[c.Constants.attachments])return console.warn("[AdaptiveCard] Key 'attachments' not found"),w;var T=k[c.Constants.attachments];try{T=this.processAdaptiveCardAttachments(T)}catch(e){console.error("Failed to processing attachments: ",T)}w.attachments=T,w.text=""}return w}return null}},{key:"directLineActivityToIC3Message",value:function(e,t){var n=e.text,r=e.timestamp,o=e.channelData,i=e.from,s=e.value,c=o.deliveryMode?o.deliveryMode:Microsoft.CRM.Omnichannel.IC3Client.Model.DeliveryMode.Bridged,a={clientmessageid:t,content:n=n||"",contentType:Microsoft.CRM.Omnichannel.IC3Client.Model.MessageContentType.Text,deliveryMode:c,messageType:Microsoft.CRM.Omnichannel.IC3Client.Model.MessageType.UserMessage,properties:{deliveryMode:c},sender:{displayName:this.userDisplayName||i.name||"",id:i.id,type:Microsoft.CRM.Omnichannel.IC3Client.Model.PersonType.User},timestamp:new Date(r),tags:o.tags};return!f.Utilities.isNullOrUndefined(s)&&a&&a.properties&&(a.properties.userSubmitData=s),a}},{key:"ic3ThreadToDirectLineActivity",value:function(e,t){var n=t.id,r=t.type,o=t.properties,i=t.members,s=(t.version,t.messages,t.rosterVersion,f.Utilities.getMessageId()),l=u.DirectLineSenderRole.Channel;return{channelId:c.Constants.ic3ChannelId,channelData:{type:r,properties:o,members:i},conversation:{id:e},from:{id:n,name:name,role:l},id:s,type:a.DirectLineMessageType.Message}}}],y=[{key:"shouldAckDeliveredMessage",value:function(e,t){return!(!(e&&e.status&&e.clientmessageid&&e.contextid)||"string"==typeof e.status&&e.status!==String(c.HTMLConstants.status_201)||"number"==typeof e.status&&e.status!==c.HTMLConstants.status_201||!t.has(e.clientmessageid))}}],n&&x(t.prototype,n),y&&x(t,y),e}();t.default=_},function(e,t,n){"use strict";var r=n(10);Object.defineProperty(t,"__esModule",{value:!0}),t.DirectLine=t.ConnectionStatus=void 0;var o=r(n(40)),i=r(n(42)),s=r(n(43)),c=r(n(44)),a=n(18),u=n(0);n(51),n(55),n(59),n(62),n(70),n(73),n(76),n(78),n(81),n(28),n(88),n(92),n(95),n(97),n(104),n(30),n(109);var l=r(n(112));function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(n,!0).forEach((function(t){(0,c.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h;t.ConnectionStatus=h,function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Connecting=1]="Connecting",e[e.Online=2]="Online",e[e.ExpiredToken=3]="ExpiredToken",e[e.FailedToConnect=4]="FailedToConnect",e[e.Ended=5]="Ended"}(h||(t.ConnectionStatus=h={}));var d=new Error("expired token"),b=new Error("conversation ended"),v=new Error("failed to connect"),y=function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];"undefined"!=typeof window&&window.botchatDebug&&e&&(t=console).log.apply(t,[e].concat(r))},g=function(){function e(t){(0,i.default)(this,e),(0,c.default)(this,"connectionStatus$",new a.BehaviorSubject(h.Uninitialized)),(0,c.default)(this,"activity$",void 0),(0,c.default)(this,"domain","https://directline.botframework.com/v3/directline"),(0,c.default)(this,"webSocket",void 0),(0,c.default)(this,"conversationId",void 0),(0,c.default)(this,"expiredTokenExhaustion",void 0),(0,c.default)(this,"secret",void 0),(0,c.default)(this,"token",void 0),(0,c.default)(this,"watermark",""),(0,c.default)(this,"streamUrl",void 0),(0,c.default)(this,"_botAgent",""),(0,c.default)(this,"_userAgent",void 0),(0,c.default)(this,"referenceGrammarId",void 0),(0,c.default)(this,"pollingInterval",1e3),(0,c.default)(this,"tokenRefreshSubscription",void 0),this.secret=t.secret,this.token=t.secret||t.token,this.webSocket=(void 0===t.webSocket||t.webSocket)&&"undefined"!=typeof WebSocket&&void 0!==WebSocket,t.domain&&(this.domain=t.domain),t.conversationId&&(this.conversationId=t.conversationId),t.watermark&&(this.watermark=t.watermark),t.streamUrl&&(t.token&&t.conversationId?this.streamUrl=t.streamUrl:console.warn("DirectLineJS: streamUrl was ignored: you need to provide a token and a conversationid")),this._botAgent=this.getBotAgent(t.botAgent);var n=~~t.pollingInterval;n<200?void 0!==t.pollingInterval&&console.warn("DirectLineJS: provided pollingInterval (".concat(t.pollingInterval,") is under lower bound (200ms), using default of 1000ms")):this.pollingInterval=n,this.expiredTokenExhaustion=this.setConnectionStatusFallback(h.ExpiredToken,h.FailedToConnect,5),this.activity$=(this.webSocket?this.webSocketActivity$():this.pollingGetActivity$()).share()}return(0,s.default)(e,[{key:"checkConnection",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.connectionStatus$.flatMap((function(t){return t===h.Uninitialized?(e.connectionStatus$.next(h.Connecting),e.token&&e.streamUrl?(e.connectionStatus$.next(h.Online),u.Observable.of(t)):e.startConversation().do((function(t){e.conversationId=t.conversationId,e.token=e.secret||t.token,e.streamUrl=t.streamUrl,e.referenceGrammarId=t.referenceGrammarId,e.secret||e.refreshTokenLoop(),e.connectionStatus$.next(h.Online)}),(function(t){e.connectionStatus$.next(h.FailedToConnect)})).map((function(e){return t}))):u.Observable.of(t)})).filter((function(e){return e!=h.Uninitialized&&e!=h.Connecting})).flatMap((function(e){switch(e){case h.Ended:return u.Observable.throw(b);case h.FailedToConnect:return u.Observable.throw(v);case h.ExpiredToken:default:return u.Observable.of(e)}}));return t?n.take(1):n}},{key:"setConnectionStatusFallback",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;n--;var r=0,o=null;return function(i){return i===e&&o===i&&r>=n?(r=0,t):(r++,o=i,i)}}},{key:"expiredToken",value:function(){var e=this.connectionStatus$.getValue();e!=h.Ended&&e!=h.FailedToConnect&&this.connectionStatus$.next(h.ExpiredToken);var t=this.expiredTokenExhaustion(this.connectionStatus$.getValue());this.connectionStatus$.next(t)}},{key:"startConversation",value:function(){var e=this.conversationId?"".concat(this.domain,"/conversations/").concat(this.conversationId,"?watermark=").concat(this.watermark):"".concat(this.domain,"/conversations"),t=this.conversationId?"GET":"POST";return u.Observable.ajax({method:t,url:e,timeout:2e4,headers:p({Accept:"application/json"},this.commonHeaders())}).map((function(e){return e.response})).retryWhen((function(e){return e.mergeMap((function(e){return e.status>=400&&e.status<600?u.Observable.throw(e):u.Observable.of(e)})).delay(2e4).take(45)}))}},{key:"refreshTokenLoop",value:function(){var e=this;this.tokenRefreshSubscription=u.Observable.interval(9e5).flatMap((function(t){return e.refreshToken()})).subscribe((function(t){y("refreshing token",t,"at",new Date),e.token=t}))}},{key:"refreshToken",value:function(){var e=this;return this.checkConnection(!0).flatMap((function(t){return u.Observable.ajax({method:"POST",url:"".concat(e.domain,"/tokens/refresh"),timeout:2e4,headers:p({},e.commonHeaders())}).map((function(e){return e.response.token})).retryWhen((function(t){return t.mergeMap((function(t){return 403===t.status?(e.expiredToken(),u.Observable.throw(t)):404===t.status?u.Observable.throw(t):u.Observable.of(t)})).delay(2e4).take(45)}))}))}},{key:"reconnect",value:function(e){this.token=e.token,this.streamUrl=e.streamUrl,this.connectionStatus$.getValue()===h.ExpiredToken&&this.connectionStatus$.next(h.Online)}},{key:"end",value:function(){this.tokenRefreshSubscription&&this.tokenRefreshSubscription.unsubscribe();try{this.connectionStatus$.next(h.Ended)}catch(e){if(e===b)return;throw e}}},{key:"getSessionId",value:function(){var e=this;return y("getSessionId"),this.checkConnection(!0).flatMap((function(t){return u.Observable.ajax({method:"GET",url:"".concat(e.domain,"/session/getsessionid"),withCredentials:!0,timeout:2e4,headers:p({"Content-Type":"application/json"},e.commonHeaders())}).map((function(e){return e&&e.response&&e.response.sessionId?(y("getSessionId response: "+e.response.sessionId),e.response.sessionId):""})).catch((function(e){return y("getSessionId error: "+e.status),u.Observable.of("")}))})).catch((function(t){return e.catchExpiredToken(t)}))}},{key:"postActivity",value:function(e){var t=this;return"message"===e.type&&e.attachments&&e.attachments.length>0?this.postMessageWithAttachments(e):(y("postActivity",e),this.checkConnection(!0).flatMap((function(n){return u.Observable.ajax({method:"POST",url:"".concat(t.domain,"/conversations/").concat(t.conversationId,"/activities"),body:e,timeout:2e4,headers:p({"Content-Type":"application/json"},t.commonHeaders())}).map((function(e){return e.response.id})).catch((function(e){return t.catchPostError(e)}))})).catch((function(e){return t.catchExpiredToken(e)})))}},{key:"postMessageWithAttachments",value:function(e){var t,n=this,r=e.attachments,i=(0,l.default)(r.map((function(e){return e.name||"blob"}))),s=r.map((function(e,t){return p({},e,{name:i[t]})}));return this.checkConnection(!0).flatMap((function(n){return(t=new FormData).append("activity",new Blob([JSON.stringify(p({},e,{attachments:s.map((function(e){e.contentUrl;return p({},(0,o.default)(e,["contentUrl"]))}))}))],{type:"application/vnd.microsoft.activity"})),u.Observable.from(s).flatMap((function(e){return u.Observable.ajax({method:"GET",url:e.contentUrl,responseType:"arraybuffer"}).do((function(n){return t.append("file",new Blob([n.response],{type:e.contentType}),e.name)}))})).count()})).flatMap((function(r){return u.Observable.ajax({method:"POST",url:"".concat(n.domain,"/conversations/").concat(n.conversationId,"/upload?userId=").concat(e.from.id),body:t,timeout:2e4,headers:p({},n.commonHeaders())}).map((function(e){return e.response.id})).catch((function(e){return n.catchPostError(e)}))})).catch((function(e){return n.catchPostError(e)}))}},{key:"catchPostError",value:function(e){if(403===e.status)this.expiredToken();else if(e.status>=400&&e.status<500)return u.Observable.throw(e);return u.Observable.of("retry")}},{key:"catchExpiredToken",value:function(e){return e===d?u.Observable.of("retry"):u.Observable.throw(e)}},{key:"pollingGetActivity$",value:function(){var e=this,t=u.Observable.create((function(t){var n=new a.BehaviorSubject({});n.subscribe((function(){if(e.connectionStatus$.getValue()===h.Online){var r=Date.now();u.Observable.ajax({headers:p({Accept:"application/json"},e.commonHeaders()),method:"GET",url:"".concat(e.domain,"/conversations/").concat(e.conversationId,"/activities?watermark=").concat(e.watermark),timeout:2e4}).subscribe((function(o){t.next(o),setTimeout((function(){return n.next(null)}),Math.max(0,e.pollingInterval-Date.now()+r))}),(function(r){switch(r.status){case 403:e.connectionStatus$.next(h.ExpiredToken),setTimeout((function(){return n.next(null)}),e.pollingInterval);break;case 404:e.connectionStatus$.next(h.Ended);break;default:t.error(r)}}))}}))}));return this.checkConnection().flatMap((function(n){return t.catch((function(){return u.Observable.empty()})).map((function(e){return e.response})).flatMap((function(t){return e.observableFromActivityGroup(t)}))}))}},{key:"observableFromActivityGroup",value:function(e){return e.watermark&&(this.watermark=e.watermark),u.Observable.from(e.activities)}},{key:"webSocketActivity$",value:function(){var e=this;return this.checkConnection().flatMap((function(t){return e.observableWebSocket().retryWhen((function(t){return t.delay(e.getRetryDelay()).mergeMap((function(t){return e.reconnectToConversation()}))}))})).flatMap((function(t){return e.observableFromActivityGroup(t)}))}},{key:"getRetryDelay",value:function(){return Math.floor(3e3+12e3*Math.random())}},{key:"observableWebSocket",value:function(){var e=this;return u.Observable.create((function(t){y("creating WebSocket",e.streamUrl);var n,r=new WebSocket(e.streamUrl);return r.onopen=function(e){y("WebSocket open",e),n=u.Observable.interval(2e4).subscribe((function(e){try{r.send("")}catch(e){y("Ping error",e)}}))},r.onclose=function(e){y("WebSocket close",e),n&&n.unsubscribe(),t.error(e)},r.onmessage=function(e){return e.data&&t.next(JSON.parse(e.data))},function(){0!==r.readyState&&1!==r.readyState||r.close()}}))}},{key:"reconnectToConversation",value:function(){var e=this;return this.checkConnection(!0).flatMap((function(t){return u.Observable.ajax({method:"GET",url:"".concat(e.domain,"/conversations/").concat(e.conversationId,"?watermark=").concat(e.watermark),timeout:2e4,headers:p({Accept:"application/json"},e.commonHeaders())}).do((function(t){e.secret||(e.token=t.response.token),e.streamUrl=t.response.streamUrl})).map((function(e){return null})).retryWhen((function(t){return t.mergeMap((function(t){if(403===t.status)e.expiredToken();else if(404===t.status)return u.Observable.throw(b);return u.Observable.of(t)})).delay(2e4).take(45)}))}))}},{key:"commonHeaders",value:function(){return{Authorization:"Bearer ".concat(this.token),"x-ms-bot-agent":this._botAgent}}},{key:"getBotAgent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t="directlinejs";return e&&(t+="; ".concat(e)),"".concat("DirectLine/3.0"," (").concat(t,")")}}]),e}();t.DirectLine=g},function(e,t,n){var r=n(41);e.exports=function(e,t){if(null==e)return{};var n,o,i=r(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)n=s[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}},function(e,t){e.exports=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var r=n(1),o=n(12),i=n(21);t.toSubscriber=function(e,t,n){if(e){if(e instanceof r.Subscriber)return e;if(e[o.rxSubscriber])return e[o.rxSubscriber]()}return e||t||n?new r.Subscriber(e,t,n):new r.Subscriber(i.empty)}},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=function(e){function t(t){e.call(this),this.errors=t;var n=Error.call(this,t?t.length+" errors occurred during unsubscription:\n  "+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"");this.name=n.name="UnsubscriptionError",this.stack=n.stack,this.message=n.message}return r(t,e),t}(Error);t.UnsubscriptionError=o},function(e,t,n){"use strict";var r=n(49);function o(e){return e?1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}:r.noop}t.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return o(e)},t.pipeFromArray=o},function(e,t,n){"use strict";t.noop=function(){}},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=function(e){function t(t,n){e.call(this),this.subject=t,this.subscriber=n,this.closed=!1}return r(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(n(3).Subscription);t.SubjectSubscription=o},function(e,t,n){"use strict";var r=n(0),o=n(52);r.Observable.prototype.catch=o._catch,r.Observable.prototype._catch=o._catch},function(e,t,n){"use strict";var r=n(53);t._catch=function(e){return r.catchError(e)(this)}},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(7),i=n(8);t.catchError=function(e){return function(t){var n=new s(e),r=t.lift(n);return n.caught=r}};var s=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.selector,this.caught))},e}(),c=function(e){function t(t,n,r){e.call(this,t),this.selector=n,this.caught=r}return r(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=void 0;try{n=this.selector(t,this.caught)}catch(t){return void e.prototype.error.call(this,t)}this._unsubscribeAndRecycle(),this.add(i.subscribeToResult(this,n))}},t}(o.OuterSubscriber)},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=function(e){function t(t,n,r){e.call(this),this.parent=t,this.outerValue=n,this.outerIndex=r,this.index=0}return r(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(n(1).Subscriber);t.InnerSubscriber=o},function(e,t,n){"use strict";var r=n(0),o=n(56);r.Observable.prototype.combineLatest=o.combineLatest},function(e,t,n){"use strict";var r=n(57);t.combineLatest=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return r.combineLatest.apply(void 0,e)(this)}},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(15),i=n(5),s=n(7),c=n(8),a={};t.combineLatest=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var n=null;return"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&i.isArray(e[0])&&(e=e[0].slice()),function(t){return t.lift.call(new o.ArrayObservable([t].concat(e)),new u(n))}};var u=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.project))},e}();t.CombineLatestOperator=u;var l=function(e){function t(t,n){e.call(this,t),this.project=n,this.active=0,this.values=[],this.observables=[]}return r(t,e),t.prototype._next=function(e){this.values.push(a),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var n=0;n<t;n++){var r=e[n];this.add(c.subscribeToResult(this,r,r,n))}}},t.prototype.notifyComplete=function(e){0==(this.active-=1)&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n,r,o){var i=this.values,s=i[n],c=this.toRespond?s===a?--this.toRespond:this.toRespond:0;i[n]=t,0===c&&(this.project?this._tryProject(i):this.destination.next(i.slice()))},t.prototype._tryProject=function(e){var t;try{t=this.project.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(s.OuterSubscriber);t.CombineLatestSubscriber=l},function(e,t,n){"use strict";t.isScheduler=function(e){return e&&"function"==typeof e.schedule}},function(e,t,n){"use strict";var r=n(0),o=n(60);r.Observable.prototype.count=o.count},function(e,t,n){"use strict";var r=n(61);t.count=function(e){return r.count(e)(this)}},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(1);t.count=function(e){return function(t){return t.lift(new i(e,t))}};var i=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.predicate,this.source))},e}(),s=function(e){function t(t,n,r){e.call(this,t),this.predicate=n,this.source=r,this.count=0,this.index=0}return r(t,e),t.prototype._next=function(e){this.predicate?this._tryPredicate(e):this.count++},t.prototype._tryPredicate=function(e){var t;try{t=this.predicate(e,this.index++,this.source)}catch(e){return void this.destination.error(e)}t&&this.count++},t.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()},t}(o.Subscriber)},function(e,t,n){"use strict";var r=n(0),o=n(63);r.Observable.prototype.delay=o.delay},function(e,t,n){"use strict";var r=n(16),o=n(68);t.delay=function(e,t){return void 0===t&&(t=r.async),o.delay(e,t)(this)}},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(2),i=function(e){function t(t,n){e.call(this,t,n),this.scheduler=t,this.pending=!1,this.work=n}return r(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e,this.pending=!0;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),o.root.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;o.root.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n=!1,r=void 0;try{this.work(e)}catch(e){n=!0,r=!!e&&e||new Error(e)}if(n)return this.unsubscribe(),r},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(n(65).Action);t.AsyncAction=i},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=function(e){function t(t,n){e.call(this)}return r(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(n(3).Subscription);t.Action=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=function(e){function t(){e.apply(this,arguments),this.actions=[],this.active=!1,this.scheduled=void 0}return r(t,e),t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(n(67).Scheduler);t.AsyncScheduler=o},function(e,t,n){"use strict";var r=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=Date.now?Date.now:function(){return+new Date},e}();t.Scheduler=r},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(16),i=n(69),s=n(1),c=n(26);t.delay=function(e,t){void 0===t&&(t=o.async);var n=i.isDate(e)?+e-t.now():Math.abs(e);return function(e){return e.lift(new a(n,t))}};var a=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.delay,this.scheduler))},e}(),u=function(e){function t(t,n,r){e.call(this,t),this.delay=n,this.scheduler=r,this.queue=[],this.active=!1,this.errored=!1}return r(t,e),t.dispatch=function(e){for(var t=e.source,n=t.queue,r=e.scheduler,o=e.destination;n.length>0&&n[0].time-r.now()<=0;)n.shift().notification.observe(o);if(n.length>0){var i=Math.max(0,n[0].time-r.now());this.schedule(e,i)}else this.unsubscribe(),t.active=!1},t.prototype._schedule=function(e){this.active=!0,this.add(e.schedule(t.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},t.prototype.scheduleNotification=function(e){if(!0!==this.errored){var t=this.scheduler,n=new l(t.now()+this.delay,e);this.queue.push(n),!1===this.active&&this._schedule(t)}},t.prototype._next=function(e){this.scheduleNotification(c.Notification.createNext(e))},t.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e)},t.prototype._complete=function(){this.scheduleNotification(c.Notification.createComplete())},t}(s.Subscriber),l=function(e,t){this.time=e,this.notification=t}},function(e,t,n){"use strict";t.isDate=function(e){return e instanceof Date&&!isNaN(+e)}},function(e,t,n){"use strict";var r=n(0),o=n(71);r.Observable.prototype.do=o._do,r.Observable.prototype._do=o._do},function(e,t,n){"use strict";var r=n(72);t._do=function(e,t,n){return r.tap(e,t,n)(this)}},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(1);t.tap=function(e,t,n){return function(r){return r.lift(new i(e,t,n))}};var i=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.nextOrObserver,this.error,this.complete))},e}(),s=function(e){function t(t,n,r,i){e.call(this,t);var s=new o.Subscriber(n,r,i);s.syncErrorThrowable=!0,this.add(s),this.safeSubscriber=s}return r(t,e),t.prototype._next=function(e){var t=this.safeSubscriber;t.next(e),t.syncErrorThrown?this.destination.error(t.syncErrorValue):this.destination.next(e)},t.prototype._error=function(e){var t=this.safeSubscriber;t.error(e),t.syncErrorThrown?this.destination.error(t.syncErrorValue):this.destination.error(e)},t.prototype._complete=function(){var e=this.safeSubscriber;e.complete(),e.syncErrorThrown?this.destination.error(e.syncErrorValue):this.destination.complete()},t}(o.Subscriber)},function(e,t,n){"use strict";var r=n(0),o=n(74);r.Observable.prototype.filter=o.filter},function(e,t,n){"use strict";var r=n(75);t.filter=function(e,t){return r.filter(e,t)(this)}},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(1);t.filter=function(e,t){return function(n){return n.lift(new i(e,t))}};var i=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.predicate,this.thisArg))},e}(),s=function(e){function t(t,n,r){e.call(this,t),this.predicate=n,this.thisArg=r,this.count=0}return r(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(o.Subscriber)},function(e,t,n){"use strict";var r=n(0),o=n(77);r.Observable.prototype.map=o.map},function(e,t,n){"use strict";var r=n(27);t.map=function(e,t){return r.map(e,t)(this)}},function(e,t,n){"use strict";var r=n(0),o=n(79);r.Observable.prototype.mergeMap=o.mergeMap,r.Observable.prototype.flatMap=o.mergeMap},function(e,t,n){"use strict";var r=n(80);t.mergeMap=function(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),r.mergeMap(e,t,n)(this)}},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(8),i=n(7);t.mergeMap=function(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),function(r){return"number"==typeof t&&(n=t,t=null),r.lift(new s(e,t,n))}};var s=function(){function e(e,t,n){void 0===n&&(n=Number.POSITIVE_INFINITY),this.project=e,this.resultSelector=t,this.concurrent=n}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.project,this.resultSelector,this.concurrent))},e}();t.MergeMapOperator=s;var c=function(e){function t(t,n,r,o){void 0===o&&(o=Number.POSITIVE_INFINITY),e.call(this,t),this.project=n,this.resultSelector=r,this.concurrent=o,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}return r(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(t,e,n)},t.prototype._innerSub=function(e,t,n){this.add(o.subscribeToResult(this,e,t,n))},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n,r,o){this.resultSelector?this._notifyResultSelector(e,t,n,r):this.destination.next(t)},t.prototype._notifyResultSelector=function(e,t,n,r){var o;try{o=this.resultSelector(e,t,n,r)}catch(e){return void this.destination.error(e)}this.destination.next(o)},t.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(i.OuterSubscriber);t.MergeMapSubscriber=c},function(e,t,n){"use strict";var r=n(0),o=n(82);r.Observable.prototype.retryWhen=o.retryWhen},function(e,t,n){"use strict";var r=n(83);t.retryWhen=function(e){return r.retryWhen(e)(this)}},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(4),i=n(11),s=n(6),c=n(7),a=n(8);t.retryWhen=function(e){return function(t){return t.lift(new u(e,t))}};var u=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.notifier,this.source))},e}(),l=function(e){function t(t,n,r){e.call(this,t),this.notifier=n,this.source=r}return r(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.errors,r=this.retries,c=this.retriesSubscription;if(r)this.errors=null,this.retriesSubscription=null;else{if(n=new o.Subject,(r=i.tryCatch(this.notifier)(n))===s.errorObject)return e.prototype.error.call(this,s.errorObject.e);c=a.subscribeToResult(this,r)}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=c,n.next(t)}},t.prototype._unsubscribe=function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=null),t&&(t.unsubscribe(),this.retriesSubscription=null),this.retries=null},t.prototype.notifyNext=function(e,t,n,r,o){var i=this.errors,s=this.retries,c=this.retriesSubscription;this.errors=null,this.retries=null,this.retriesSubscription=null,this._unsubscribeAndRecycle(),this.errors=i,this.retries=s,this.retriesSubscription=c,this.source.subscribe(this)},t}(c.OuterSubscriber)},function(e,t,n){"use strict";var r=n(85);t.share=function(){return r.share()(this)}},function(e,t,n){"use strict";var r=n(86),o=n(29),i=n(4);function s(){return new i.Subject}t.share=function(){return function(e){return o.refCount()(r.multicast(s)(e))}}},function(e,t,n){"use strict";var r=n(87);t.multicast=function(e,t){return function(n){var i;if(i="function"==typeof e?e:function(){return e},"function"==typeof t)return n.lift(new o(i,t));var s=Object.create(n,r.connectableObservableDescriptor);return s.source=n,s.subjectFactory=i,s}};var o=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var n=this.selector,r=this.subjectFactory(),o=n(r).subscribe(e);return o.add(t.subscribe(r)),o},e}();t.MulticastOperator=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(4),i=n(0),s=n(1),c=n(3),a=n(29),u=function(e){function t(t,n){e.call(this),this.source=t,this.subjectFactory=n,this._refCount=0,this._isComplete=!1}return r(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new c.Subscription).add(this.source.subscribe(new f(this.getSubject(),this))),e.closed?(this._connection=null,e=c.Subscription.EMPTY):this._connection=e),e},t.prototype.refCount=function(){return a.refCount()(this)},t}(i.Observable);t.ConnectableObservable=u;var l=u.prototype;t.connectableObservableDescriptor={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:l._subscribe},_isComplete:{value:l._isComplete,writable:!0},getSubject:{value:l.getSubject},connect:{value:l.connect},refCount:{value:l.refCount}};var f=function(e){function t(t,n){e.call(this,t),this.connectable=n}return r(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(o.SubjectSubscriber),p=(function(){function e(e){this.connectable=e}e.prototype.call=function(e,t){var n=this.connectable;n._refCount++;var r=new p(e,n),o=t.subscribe(r);return r.closed||(r.connection=n.connect()),o}}(),function(e){function t(t,n){e.call(this,t),this.connectable=n}return r(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null},t}(s.Subscriber))},function(e,t,n){"use strict";var r=n(0),o=n(89);r.Observable.prototype.take=o.take},function(e,t,n){"use strict";var r=n(90);t.take=function(e){return r.take(e)(this)}},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(1),i=n(91),s=n(9);t.take=function(e){return function(t){return 0===e?new s.EmptyObservable:t.lift(new c(e))}};var c=function(){function e(e){if(this.total=e,this.total<0)throw new i.ArgumentOutOfRangeError}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.total))},e}(),a=function(e){function t(t,n){e.call(this,t),this.total=n,this.count=0}return r(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(o.Subscriber)},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=function(e){function t(){var t=e.call(this,"argument out of range");this.name=t.name="ArgumentOutOfRangeError",this.stack=t.stack,this.message=t.message}return r(t,e),t}(Error);t.ArgumentOutOfRangeError=o},function(e,t,n){"use strict";var r=n(0),o=n(93);r.Observable.ajax=o.ajax},function(e,t,n){"use strict";var r=n(94);t.ajax=r.AjaxObservable.create},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(2),i=n(11),s=n(6),c=n(0),a=n(1),u=n(27);function l(){if(o.root.XMLHttpRequest)return new o.root.XMLHttpRequest;if(o.root.XDomainRequest)return new o.root.XDomainRequest;throw new Error("CORS is not supported by your browser")}function f(e,t){return void 0===t&&(t=null),new g({method:"GET",url:e,headers:t})}function p(e,t,n){return new g({method:"POST",url:e,body:t,headers:n})}function h(e,t){return new g({method:"DELETE",url:e,headers:t})}function d(e,t,n){return new g({method:"PUT",url:e,body:t,headers:n})}function b(e,t,n){return new g({method:"PATCH",url:e,body:t,headers:n})}t.ajaxGet=f,t.ajaxPost=p,t.ajaxDelete=h,t.ajaxPut=d,t.ajaxPatch=b;var v=u.map((function(e,t){return e.response}));function y(e,t){return v(new g({method:"GET",url:e,responseType:"json",headers:t}))}t.ajaxGetJSON=y;var g=function(e){function t(t){e.call(this);var n={async:!0,createXHR:function(){return this.crossDomain?l.call(this):function(){if(o.root.XMLHttpRequest)return new o.root.XMLHttpRequest;var e=void 0;try{for(var t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],n=0;n<3;n++)try{if(e=t[n],new o.root.ActiveXObject(e))break}catch(e){}return new o.root.ActiveXObject(e)}catch(e){throw new Error("XMLHttpRequest is not supported by your browser")}}()},crossDomain:!1,withCredentials:!1,headers:{},method:"GET",responseType:"json",timeout:0};if("string"==typeof t)n.url=t;else for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);this.request=n}var n;return r(t,e),t.prototype._subscribe=function(e){return new m(e,this.request)},t.create=((n=function(e){return new t(e)}).get=f,n.post=p,n.delete=h,n.put=d,n.patch=b,n.getJSON=y,n),t}(c.Observable);t.AjaxObservable=g;var m=function(e){function t(t,n){e.call(this,t),this.request=n,this.done=!1;var r=n.headers=n.headers||{};n.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest"),"Content-Type"in r||o.root.FormData&&n.body instanceof o.root.FormData||void 0===n.body||(r["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"),n.body=this.serializeBody(n.body,n.headers["Content-Type"]),this.send()}return r(t,e),t.prototype.next=function(e){this.done=!0;var t=this.xhr,n=this.request,r=this.destination,o=new w(e,t,n);r.next(o)},t.prototype.send=function(){var e=this.request,t=this.request,n=t.user,r=t.method,o=t.url,c=t.async,a=t.password,u=t.headers,l=t.body,f=e.createXHR,p=i.tryCatch(f).call(e);if(p===s.errorObject)this.error(s.errorObject.e);else{this.xhr=p,this.setupEvents(p,e);if((n?i.tryCatch(p.open).call(p,r,o,c,n,a):i.tryCatch(p.open).call(p,r,o,c))===s.errorObject)return this.error(s.errorObject.e),null;if(c&&(p.timeout=e.timeout,p.responseType=e.responseType),"withCredentials"in p&&(p.withCredentials=!!e.withCredentials),this.setHeaders(p,u),(l?i.tryCatch(p.send).call(p,l):i.tryCatch(p.send).call(p))===s.errorObject)return this.error(s.errorObject.e),null}return p},t.prototype.serializeBody=function(e,t){if(!e||"string"==typeof e)return e;if(o.root.FormData&&e instanceof o.root.FormData)return e;if(t){var n=t.indexOf(";");-1!==n&&(t=t.substring(0,n))}switch(t){case"application/x-www-form-urlencoded":return Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&");case"application/json":return JSON.stringify(e);default:return e}},t.prototype.setHeaders=function(e,t){for(var n in t)t.hasOwnProperty(n)&&e.setRequestHeader(n,t[n])},t.prototype.setupEvents=function(e,t){var n=t.progressSubscriber;function r(e){var t=r,n=t.subscriber,o=t.progressSubscriber,i=t.request;o&&o.error(e),n.error(new S(this,i))}if(e.ontimeout=r,r.request=t,r.subscriber=this,r.progressSubscriber=n,e.upload&&"withCredentials"in e){var i,s;if(n)i=function(e){i.progressSubscriber.next(e)},o.root.XDomainRequest?e.onprogress=i:e.upload.onprogress=i,i.progressSubscriber=n;s=function(e){var t=s,n=t.progressSubscriber,r=t.subscriber,o=t.request;n&&n.error(e),r.error(new O("ajax error",this,o))},e.onerror=s,s.request=t,s.subscriber=this,s.progressSubscriber=n}function c(e){var t=c,n=t.subscriber,r=t.progressSubscriber,o=t.request;if(4===this.readyState){var i=1223===this.status?204:this.status,s="text"===this.responseType?this.response||this.responseText:this.response;0===i&&(i=s?200:0),200<=i&&i<300?(r&&r.complete(),n.next(e),n.complete()):(r&&r.error(e),n.error(new O("ajax error "+i,this,o)))}}e.onreadystatechange=c,c.subscriber=this,c.progressSubscriber=n,c.request=t},t.prototype.unsubscribe=function(){var t=this.done,n=this.xhr;!t&&n&&4!==n.readyState&&"function"==typeof n.abort&&n.abort(),e.prototype.unsubscribe.call(this)},t}(a.Subscriber);t.AjaxSubscriber=m;var w=function(e,t,n){this.originalEvent=e,this.xhr=t,this.request=n,this.status=t.status,this.responseType=t.responseType||n.responseType,this.response=x(this.responseType,t)};t.AjaxResponse=w;var O=function(e){function t(t,n,r){e.call(this,t),this.message=t,this.xhr=n,this.request=r,this.status=n.status,this.responseType=n.responseType||r.responseType,this.response=x(this.responseType,n)}return r(t,e),t}(Error);function x(e,t){switch(e){case"json":return"response"in t?t.responseType?t.response:JSON.parse(t.response||t.responseText||"null"):JSON.parse(t.responseText||"null");case"xml":return t.responseXML;case"text":default:return"response"in t?t.response:t.responseText}}t.AjaxError=O;var S=function(e){function t(t,n){e.call(this,"ajax timeout",t,n)}return r(t,e),t}(O);t.AjaxTimeoutError=S},function(e,t,n){"use strict";var r=n(0),o=n(96);r.Observable.empty=o.empty},function(e,t,n){"use strict";var r=n(9);t.empty=r.EmptyObservable.create},function(e,t,n){"use strict";var r=n(0),o=n(98);r.Observable.from=o.from},function(e,t,n){"use strict";var r=n(99);t.from=r.FromObservable.create},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(5),i=n(23),s=n(24),c=n(100),a=n(101),u=n(15),l=n(102),f=n(14),p=n(0),h=n(103),d=n(13),b=function(e){function t(t,n){e.call(this,null),this.ish=t,this.scheduler=n}return r(t,e),t.create=function(e,n){if(null!=e){if("function"==typeof e[d.observable])return e instanceof p.Observable&&!n?e:new t(e,n);if(o.isArray(e))return new u.ArrayObservable(e,n);if(s.isPromise(e))return new c.PromiseObservable(e,n);if("function"==typeof e[f.iterator]||"string"==typeof e)return new a.IteratorObservable(e,n);if(i.isArrayLike(e))return new l.ArrayLikeObservable(e,n)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")},t.prototype._subscribe=function(e){var t=this.ish,n=this.scheduler;return null==n?t[d.observable]().subscribe(e):t[d.observable]().subscribe(new h.ObserveOnSubscriber(e,n,0))},t}(p.Observable);t.FromObservable=b},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(2),i=function(e){function t(t,n){e.call(this),this.promise=t,this.scheduler=n}return r(t,e),t.create=function(e,n){return new t(e,n)},t.prototype._subscribe=function(e){var t=this,n=this.promise,r=this.scheduler;if(null==r)this._isScalar?e.closed||(e.next(this.value),e.complete()):n.then((function(n){t.value=n,t._isScalar=!0,e.closed||(e.next(n),e.complete())}),(function(t){e.closed||e.error(t)})).then(null,(function(e){o.root.setTimeout((function(){throw e}))}));else if(this._isScalar){if(!e.closed)return r.schedule(s,0,{value:this.value,subscriber:e})}else n.then((function(n){t.value=n,t._isScalar=!0,e.closed||e.add(r.schedule(s,0,{value:n,subscriber:e}))}),(function(t){e.closed||e.add(r.schedule(c,0,{err:t,subscriber:e}))})).then(null,(function(e){o.root.setTimeout((function(){throw e}))}))},t}(n(0).Observable);function s(e){var t=e.value,n=e.subscriber;n.closed||(n.next(t),n.complete())}function c(e){var t=e.err,n=e.subscriber;n.closed||n.error(t)}t.PromiseObservable=i},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(2),i=n(0),s=n(14),c=function(e){function t(t,n){if(e.call(this),this.scheduler=n,null==t)throw new Error("iterator cannot be null.");this.iterator=function(e){var t=e[s.iterator];if(!t&&"string"==typeof e)return new a(e);if(!t&&void 0!==e.length)return new u(e);if(!t)throw new TypeError("object is not iterable");return e[s.iterator]()}(t)}return r(t,e),t.create=function(e,n){return new t(e,n)},t.dispatch=function(e){var t=e.index,n=e.hasError,r=e.iterator,o=e.subscriber;if(n)o.error(e.error);else{var i=r.next();i.done?o.complete():(o.next(i.value),e.index=t+1,o.closed?"function"==typeof r.return&&r.return():this.schedule(e))}},t.prototype._subscribe=function(e){var n=this.iterator,r=this.scheduler;if(r)return r.schedule(t.dispatch,0,{index:0,iterator:n,subscriber:e});for(;;){var o=n.next();if(o.done){e.complete();break}if(e.next(o.value),e.closed){"function"==typeof n.return&&n.return();break}}},t}(i.Observable);t.IteratorObservable=c;var a=function(){function e(e,t,n){void 0===t&&(t=0),void 0===n&&(n=e.length),this.str=e,this.idx=t,this.len=n}return e.prototype[s.iterator]=function(){return this},e.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.str.charAt(this.idx++)}:{done:!0,value:void 0}},e}(),u=function(){function e(e,t,n){void 0===t&&(t=0),void 0===n&&(n=function(e){var t=+e.length;if(isNaN(t))return 0;if(0===t||(n=t,"number"!=typeof n||!o.root.isFinite(n)))return t;var n;if((t=function(e){var t=+e;if(0===t)return t;if(isNaN(t))return t;return t<0?-1:1}(t)*Math.floor(Math.abs(t)))<=0)return 0;if(t>l)return l;return t}(e)),this.arr=e,this.idx=t,this.len=n}return e.prototype[s.iterator]=function(){return this},e.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.arr[this.idx++]}:{done:!0,value:void 0}},e}();var l=Math.pow(2,53)-1},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(0),i=n(25),s=n(9),c=function(e){function t(t,n){e.call(this),this.arrayLike=t,this.scheduler=n,n||1!==t.length||(this._isScalar=!0,this.value=t[0])}return r(t,e),t.create=function(e,n){var r=e.length;return 0===r?new s.EmptyObservable:1===r?new i.ScalarObservable(e[0],n):new t(e,n)},t.dispatch=function(e){var t=e.arrayLike,n=e.index,r=e.length,o=e.subscriber;o.closed||(n>=r?o.complete():(o.next(t[n]),e.index=n+1,this.schedule(e)))},t.prototype._subscribe=function(e){var n=this.arrayLike,r=this.scheduler,o=n.length;if(r)return r.schedule(t.dispatch,0,{arrayLike:n,index:0,length:o,subscriber:e});for(var i=0;i<o&&!e.closed;i++)e.next(n[i]);e.complete()},t}(o.Observable);t.ArrayLikeObservable=c},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(1),i=n(26);t.observeOn=function(e,t){return void 0===t&&(t=0),function(n){return n.lift(new s(e,t))}};var s=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.scheduler,this.delay))},e}();t.ObserveOnOperator=s;var c=function(e){function t(t,n,r){void 0===r&&(r=0),e.call(this,t),this.scheduler=n,this.delay=r}return r(t,e),t.dispatch=function(e){var t=e.notification,n=e.destination;t.observe(n),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.add(this.scheduler.schedule(t.dispatch,this.delay,new a(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(i.Notification.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(i.Notification.createError(e))},t.prototype._complete=function(){this.scheduleMessage(i.Notification.createComplete())},t}(o.Subscriber);t.ObserveOnSubscriber=c;var a=function(e,t){this.notification=e,this.destination=t};t.ObserveOnMessage=a},function(e,t,n){"use strict";var r=n(0),o=n(105);r.Observable.interval=o.interval},function(e,t,n){"use strict";var r=n(106);t.interval=r.IntervalObservable.create},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=n(107),i=n(0),s=n(16),c=function(e){function t(t,n){void 0===t&&(t=0),void 0===n&&(n=s.async),e.call(this),this.period=t,this.scheduler=n,(!o.isNumeric(t)||t<0)&&(this.period=0),n&&"function"==typeof n.schedule||(this.scheduler=s.async)}return r(t,e),t.create=function(e,n){return void 0===e&&(e=0),void 0===n&&(n=s.async),new t(e,n)},t.dispatch=function(e){var t=e.index,n=e.subscriber,r=e.period;n.next(t),n.closed||(e.index+=1,this.schedule(e,r))},t.prototype._subscribe=function(e){var n=this.period,r=this.scheduler;e.add(r.schedule(t.dispatch,n,{index:0,subscriber:e,period:n}))},t}(i.Observable);t.IntervalObservable=c},function(e,t,n){"use strict";var r=n(5);t.isNumeric=function(e){return!r.isArray(e)&&e-parseFloat(e)+1>=0}},function(e,t,n){"use strict";var r=n(15);t.of=r.ArrayObservable.of},function(e,t,n){"use strict";var r=n(0),o=n(110);r.Observable.throw=o._throw},function(e,t,n){"use strict";var r=n(111);t._throw=r.ErrorObservable.create},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=function(e){function t(t,n){e.call(this),this.error=t,this.scheduler=n}return r(t,e),t.create=function(e,n){return new t(e,n)},t.dispatch=function(e){var t=e.error;e.subscriber.error(t)},t.prototype._subscribe=function(e){var n=this.error,r=this.scheduler;if(e.syncErrorThrowable=!0,r)return r.schedule(t.dispatch,0,{error:n,subscriber:e});e.error(n)},t}(n(0).Observable);t.ErrorObservable=o},function(e,t,n){"use strict";var r=n(10);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=[];return e.forEach((function(e){for(var n=(0,o.default)(e),r=n.extname,i=n.name,s=0,c=e;t.includes(c);)c=[i,"(".concat(++s,")")].filter((function(e){return e})).join(" ")+r;t.push(c)})),t};var o=r(n(113))},function(e,t,n){"use strict";var r=n(10);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(e){if(~e.indexOf(".")){var t=e.split(".").reverse(),n=(0,o.default)(t),r=n[0],i=n.slice(1);return{extname:"."+r,name:i.reverse().join(".")}}return{extname:"",name:e}}return{extname:"",name:""}};var o=r(n(114))},function(e,t,n){var r=n(115),o=n(116),i=n(117);e.exports=function(e){return r(e)||o(e)||i()}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return new Promise((function(n,r){Array.from(document.getElementsByTagName("script")).filter((function(t){return t.src==e})).length&&(console.info("SDK URL exists in DOM"),n(Microsoft.CRM.Omnichannel.IC3Client.SDK.SDKProvider.getSDK(t)));var o=document.createElement("script");o.setAttribute("async",""),o.setAttribute("referrerpolicy","no-referrer"),o.setAttribute("src",e||"https://comms.omnichannelengagementhub.com/release/2020.01.15.1/Scripts/SDK/SDK.min.js"),o.addEventListener("load",(function(){return n(Microsoft.CRM.Omnichannel.IC3Client.SDK.SDKProvider.getSDK(t))})),o.addEventListener("error",(function(e){var t=e.error;return r(t||new Error("Failed to load IC3 SDK from URL."))})),document.head.append(o)}))}},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.DirectLineMessageType=void 0,t.DirectLineMessageType=r,function(e){e.Typing="typing",e.Message="message"}(r||(t.DirectLineMessageType=r={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Utilities=void 0;var r=n(32),o=n(34);function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,s;return t=e,s=[{key:"isSentMessage",value:function(e,t){return!!(e&&e.sender&&e.sender.id)&&e.sender.id.includes("contacts/8:")}},{key:"isInternalActivity",value:function(e){return e.channelData&&e.channelData.tags&&e.channelData.tags.includes(o.MessageTag.Private)}},{key:"getDirectLineSenderType",value:function(e,t){return this.isSentMessage(e,t)?r.DirectLineSenderRole.User:r.DirectLineSenderRole.Bot}},{key:"getMessageId",value:function(){return Math.random().toString(36).substr(2)}},{key:"getPlatformBotId",value:function(e){return e.getMembers().then((function(e){var t=e.filter((function(e){return e.type===Microsoft.CRM.Omnichannel.IC3Client.Model.PersonType.Bot}));if(t&&1===t.length)return t[0].id;console.error("Bot Id not found")})).catch((function(){console.error("Error while fetching members")}))}},{key:"stringifyHelper",value:function(e){var t="";try{t=JSON.stringify(e)}catch(t){console.error("Failed to stringify the data: ",e)}return t}},{key:"isNullOrUndefined",value:function(e){return null==e}}],(n=null)&&i(t.prototype,n),s&&i(t,s),e}();t.Utilities=s},function(e,t){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.r(t);var o=new WeakMap,i=new WeakMap;function s(e){var t=o.get(e);return console.assert(null!=t,"'this' is expected an Event object, but got",e),t}function c(e){null==e.passiveListener?e.event.cancelable&&(e.canceled=!0,"function"==typeof e.event.preventDefault&&e.event.preventDefault()):"undefined"!=typeof console&&"function"==typeof console.error&&console.error("Unable to preventDefault inside passive event listener invocation.",e.passiveListener)}function a(e,t){o.set(this,{eventTarget:e,event:t,eventPhase:2,currentTarget:e,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:t.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});for(var n=Object.keys(t),r=0;r<n.length;++r){var i=n[r];i in this||Object.defineProperty(this,i,u(i))}}function u(e){return{get:function(){return s(this).event[e]},set:function(t){s(this).event[e]=t},configurable:!0,enumerable:!0}}function l(e){return{value:function(){var t=s(this).event;return t[e].apply(t,arguments)},configurable:!0,enumerable:!0}}function f(e){if(null==e||e===Object.prototype)return a;var t=i.get(e);return null==t&&(t=function(e,t){var n=Object.keys(t);if(0===n.length)return e;function r(t,n){e.call(this,t,n)}r.prototype=Object.create(e.prototype,{constructor:{value:r,configurable:!0,writable:!0}});for(var o=0;o<n.length;++o){var i=n[o];if(!(i in e.prototype)){var s="function"==typeof Object.getOwnPropertyDescriptor(t,i).value;Object.defineProperty(r.prototype,i,s?l(i):u(i))}}return r}(f(Object.getPrototypeOf(e)),e),i.set(e,t)),t}function p(e){return s(e).immediateStopped}function h(e,t){s(e).passiveListener=t}a.prototype={get type(){return s(this).event.type},get target(){return s(this).eventTarget},get currentTarget(){return s(this).currentTarget},composedPath:function(){var e=s(this).currentTarget;return null==e?[]:[e]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return s(this).eventPhase},stopPropagation:function(){var e=s(this);e.stopped=!0,"function"==typeof e.event.stopPropagation&&e.event.stopPropagation()},stopImmediatePropagation:function(){var e=s(this);e.stopped=!0,e.immediateStopped=!0,"function"==typeof e.event.stopImmediatePropagation&&e.event.stopImmediatePropagation()},get bubbles(){return Boolean(s(this).event.bubbles)},get cancelable(){return Boolean(s(this).event.cancelable)},preventDefault:function(){c(s(this))},get defaultPrevented(){return s(this).canceled},get composed(){return Boolean(s(this).event.composed)},get timeStamp(){return s(this).timeStamp},get srcElement(){return s(this).eventTarget},get cancelBubble(){return s(this).stopped},set cancelBubble(e){if(e){var t=s(this);t.stopped=!0,"boolean"==typeof t.event.cancelBubble&&(t.event.cancelBubble=!0)}},get returnValue(){return!s(this).canceled},set returnValue(e){e||c(s(this))},initEvent:function(){}},Object.defineProperty(a.prototype,"constructor",{value:a,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.Event&&(Object.setPrototypeOf(a.prototype,window.Event.prototype),i.set(window.Event.prototype,a));var d=new WeakMap;function b(e){return null!==e&&"object"===r(e)}function v(e){var t=d.get(e);if(null==t)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return t}function y(e,t){Object.defineProperty(e,"on".concat(t),function(e){return{get:function(){for(var t=v(this).get(e);null!=t;){if(3===t.listenerType)return t.listener;t=t.next}return null},set:function(t){"function"==typeof t||b(t)||(t=null);for(var n=v(this),r=null,o=n.get(e);null!=o;)3===o.listenerType?null!==r?r.next=o.next:null!==o.next?n.set(e,o.next):n.delete(e):r=o,o=o.next;if(null!==t){var i={listener:t,listenerType:3,passive:!1,once:!1,next:null};null===r?n.set(e,i):r.next=i}},configurable:!0,enumerable:!0}}(t))}function g(e){function t(){m.call(this)}t.prototype=Object.create(m.prototype,{constructor:{value:t,configurable:!0,writable:!0}});for(var n=0;n<e.length;++n)y(t.prototype,e[n]);return t}function m(){if(!(this instanceof m)){if(1===arguments.length&&Array.isArray(arguments[0]))return g(arguments[0]);if(arguments.length>0){for(var e=new Array(arguments.length),t=0;t<arguments.length;++t)e[t]=arguments[t];return g(e)}throw new TypeError("Cannot call a class as a function")}d.set(this,new Map)}m.prototype={addEventListener:function(e,t,n){if(null!=t){if("function"!=typeof t&&!b(t))throw new TypeError("'listener' should be a function or an object.");var r=v(this),o=b(n),i=(o?Boolean(n.capture):Boolean(n))?1:2,s={listener:t,listenerType:i,passive:o&&Boolean(n.passive),once:o&&Boolean(n.once),next:null},c=r.get(e);if(void 0!==c){for(var a=null;null!=c;){if(c.listener===t&&c.listenerType===i)return;a=c,c=c.next}a.next=s}else r.set(e,s)}},removeEventListener:function(e,t,n){if(null!=t)for(var r=v(this),o=(b(n)?Boolean(n.capture):Boolean(n))?1:2,i=null,s=r.get(e);null!=s;){if(s.listener===t&&s.listenerType===o)return void(null!==i?i.next=s.next:null!==s.next?r.set(e,s.next):r.delete(e));i=s,s=s.next}},dispatchEvent:function(e){if(null==e||"string"!=typeof e.type)throw new TypeError('"event.type" should be a string.');var t=v(this),n=e.type,r=t.get(n);if(null==r)return!0;for(var o=function(e,t){return new(f(Object.getPrototypeOf(t)))(e,t)}(this,e),i=null;null!=r;){if(r.once?null!==i?i.next=r.next:null!==r.next?t.set(n,r.next):t.delete(n):i=r,h(o,r.passive?r.listener:null),"function"==typeof r.listener)try{r.listener.call(this,o)}catch(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e)}else 3!==r.listenerType&&"function"==typeof r.listener.handleEvent&&r.listener.handleEvent(o);if(p(o))break;r=r.next}return h(o,null),function(e,t){s(e).eventPhase=0}(o),function(e,t){s(e).currentTarget=null}(o),!o.defaultPrevented}},Object.defineProperty(m.prototype,"constructor",{value:m,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.EventTarget&&Object.setPrototypeOf(m.prototype,window.EventTarget.prototype);var w=m;n.d(t,"defineEventAttribute",(function(){return y})),n.d(t,"EventTarget",(function(){return w})),t.default=w}])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,o=n(17),i=(r=n(35))&&r.__esModule?r:{default:r};function s(e,t,n,r,o,i,s){try{var c=e[i](s),a=c.value}catch(e){return void n(e)}c.done?t(a):Promise.resolve(a).then(r,o)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function c(e){s(i,r,o,c,a,"next",e)}function a(e){s(i,r,o,c,a,"throw",e)}c(void 0)}))}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){return new Promise((function(t){return setTimeout(t,e)}))}var p=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.MessageQueueConstants.defaultjobExecutionInterval;a(this,e),l(this,"jobExecutionInterval",void 0),l(this,"jobQueue",void 0),l(this,"jobProcessing",!1),l(this,"connectionHandlers",void 0),l(this,"connectivityManager",void 0),this.jobExecutionInterval=n,this.jobQueue=[],this.connectionHandlers=[],this.connectivityManager=new i.default,this.connectivityManager.ononline=function(){t.connectionStatusChangeHandler()},this.connectivityManager.onoffline=function(){t.connectionStatusChangeHandler()}}var t,n,r,s,p,h,d;return t=e,(n=[{key:"add",value:(d=c(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.default.isInternetConnected();case 2:n=e.sent,r=this.getConnectionStatus(),n&&r&&!this.jobQueue.length?t.run():this.jobQueue.find((function(e){return e.id==t.id}))||(this.jobQueue.push(t),console.log("[MessageQueue] Added job to queue")),this.connectionStatusChangeHandler();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"remove",value:function(e){var t=this.jobQueue.findIndex((function(t){return t.id===e}));this.jobQueue.splice(t,1)}},{key:"addConnectionHandler",value:(h=c(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("boolean"==typeof t()){e.next=3;break}return e.abrupt("return");case 3:this.connectionHandlers.push(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"end",value:function(){this.connectivityManager.end()}},{key:"getConnectionStatus",value:function(){return!this.connectionHandlers.length||this.connectionHandlers.every((function(e){return e()}))}},{key:"processJobs",value:(p=c(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.jobProcessing){e.next=2;break}return e.abrupt("return");case 2:console.log("[MessageQueue] Process started."),this.jobProcessing=!0,e.prev=4;case 5:if(!this.jobQueue.length){e.next=28;break}return console.log("[MessageQueue] JOB(S): ".concat(this.jobQueue.length)),e.next=9,i.default.isInternetConnected();case 9:if(t=e.sent,n=this.getConnectionStatus(),t&&n){e.next=14;break}return console.log("[MessageQueue] Network disconnection detected."),e.abrupt("break",28);case 14:return e.prev=14,e.next=17,this.jobQueue[0].run();case 17:this.jobQueue.shift(),console.log("[MessageQueue]: Job processed"),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(14),console.log("[MessageQueue]: Unable to process job");case 24:return e.next=26,f(this.jobExecutionInterval);case 26:e.next=5;break;case 28:console.log("[MessageQueue] Process stopped.");case 29:return e.prev=29,this.jobProcessing=!1,e.finish(29);case 32:case"end":return e.stop()}}),e,this,[[4,,29,32],[14,21]])}))),function(){return p.apply(this,arguments)})},{key:"connectionStatusChangeHandler",value:(s=c(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[ConnectionStatusChanged]"),e.next=3,i.default.isInternetConnected();case 3:if(t=e.sent,n=this.getConnectionStatus(),t&&n&&this.jobQueue.length){e.next=8;break}return console.log("[MessageQueue] Process stopped."),e.abrupt("return");case 8:this.processJobs();case 9:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})}])&&u(t.prototype,n),r&&u(t,r),e}();t.default=p},function(e,t,n){"use strict";var r,o;Object.defineProperty(t,"__esModule",{value:!0}),t.CustomErrorCode=t.IC3ErrorCode=void 0,t.IC3ErrorCode=r,function(e){e[e.ThreadNotFound=732]="ThreadNotFound",e[e.InsufficientPrivileges=209]="InsufficientPrivileges"}(r||(t.IC3ErrorCode=r={})),t.CustomErrorCode=o,function(e){e[e.InvalidPollResult=1e4]="InvalidPollResult"}(o||(t.CustomErrorCode=o={}))},function(e,t,n){}]);